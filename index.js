!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=94)}([function(module,__webpack_exports__,__webpack_require__){"use strict";var frame;__webpack_require__.d(__webpack_exports__,"h",(function(){return frame})),__webpack_require__.d(__webpack_exports__,"u",(function(){return isTablet})),__webpack_require__.d(__webpack_exports__,"c",(function(){return DEGTOR})),__webpack_require__.d(__webpack_exports__,"H",(function(){return scaleMultiplier})),__webpack_require__.d(__webpack_exports__,"i",(function(){return fullscreenScaleMultiplier})),__webpack_require__.d(__webpack_exports__,"v",(function(){return isiOS})),__webpack_require__.d(__webpack_exports__,"t",(function(){return isAndroid})),__webpack_require__.d(__webpack_exports__,"w",(function(){return libInit})),__webpack_require__.d(__webpack_exports__,"A",(function(){return newDiv})),__webpack_require__.d(__webpack_exports__,"C",(function(){return newImage})),__webpack_require__.d(__webpack_exports__,"z",(function(){return newCanvas})),__webpack_require__.d(__webpack_exports__,"B",(function(){return newHTML})),__webpack_require__.d(__webpack_exports__,"D",(function(){return newP})),__webpack_require__.d(__webpack_exports__,"s",(function(){return hitRect})),__webpack_require__.d(__webpack_exports__,"r",(function(){return hit3DRect})),__webpack_require__.d(__webpack_exports__,"I",(function(){return setCanvasSize})),__webpack_require__.d(__webpack_exports__,"J",(function(){return setCanvasSizeScaledToWindowDocumentHeight})),__webpack_require__.d(__webpack_exports__,"x",(function(){return localx})),__webpack_require__.d(__webpack_exports__,"o",(function(){return globalx})),__webpack_require__.d(__webpack_exports__,"y",(function(){return localy})),__webpack_require__.d(__webpack_exports__,"p",(function(){return globaly})),__webpack_require__.d(__webpack_exports__,"K",(function(){return setProps})),__webpack_require__.d(__webpack_exports__,"a",(function(){return CSSTransition})),__webpack_require__.d(__webpack_exports__,"b",(function(){return CSSTransition3D})),__webpack_require__.d(__webpack_exports__,"f",(function(){return drawThumbnail})),__webpack_require__.d(__webpack_exports__,"e",(function(){return drawScaled})),__webpack_require__.d(__webpack_exports__,"g",(function(){return fitInRect})),__webpack_require__.d(__webpack_exports__,"j",(function(){return getDocumentHeight})),__webpack_require__.d(__webpack_exports__,"k",(function(){return getDocumentWidth})),__webpack_require__.d(__webpack_exports__,"n",(function(){return getStringSize})),__webpack_require__.d(__webpack_exports__,"L",(function(){return writeText})),__webpack_require__.d(__webpack_exports__,"q",(function(){return gn})),__webpack_require__.d(__webpack_exports__,"E",(function(){return newTextInput})),__webpack_require__.d(__webpack_exports__,"l",(function(){return getIdFor})),__webpack_require__.d(__webpack_exports__,"m",(function(){return getIdForCamera})),__webpack_require__.d(__webpack_exports__,"F",(function(){return rgb2hsb})),__webpack_require__.d(__webpack_exports__,"G",(function(){return rgbToHex})),__webpack_require__.d(__webpack_exports__,"d",(function(){return colorToRGBA}));var isTablet="undefined"!=window.orientation,DEGTOR=Math.PI/180,WINDOW_INNER_HEIGHT=window.innerHeight,WINDOW_INNER_WIDTH=window.innerWidth,scaleMultiplier=WINDOW_INNER_HEIGHT/768,fullscreenScaleMultiplier=136,isiOS="undefined"==typeof AndroidInterface,isAndroid="undefined"!=typeof AndroidInterface;function libInit(){frame=document.getElementById("frame")}function preprocess(s){for(var result="",len=s.length,i=0,j;i<len&&-1!=(j=s.indexOf("$",i));)if(result+=s.substring(i,j),i=j+1,i<len-1&&"{"===s[i]){var start=i+1,end=s.indexOf("}",start);if(-1!=end){var expression=s.substring(start,end);result+=eval(expression),i=end+1}else result+="$"}else result+="$";return i<len&&(result+=s.substring(i)),result}function preprocessAndLoad(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),preprocess(t.responseText)}function preprocessAndLoadCss(e,t){var r=preprocessAndLoad(t);r=(r=r.replace(/url\('/g,"url('"+e+"/")).replace(/url\(([^'])/g,"url("+e+"/$1");var n=document.head,i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r)),n.appendChild(i)}function rl(){window.location.reload()}function newDiv(e,t,r,n,i,a){var o=document.createElement("div");return o.style.position="absolute",o.style.top=r+"px",o.style.left=t+"px",n&&(o.style.width=n+"px"),i&&(o.style.height=i+"px"),setProps(o.style,a),e.appendChild(o),o}function newImage(e,t,r){var n=document.createElement("img");return n.src=t,setProps(n.style,r),e&&e.appendChild(n),n}function newCanvas(e,t,r,n,i,a){var o=document.createElement("canvas");return o.style.position="absolute",o.style.top=r+"px",o.style.left=t+"px",setCanvasSize(o,n,i),setProps(o.style,a),e.appendChild(o),o}function newHTML(e,t,r){var n=document.createElement(e);return t&&n.setAttribute("class",t),r&&r.appendChild(n),n}function newP(e,t,r){var n=document.createElement("p");return n.appendChild(document.createTextNode(t)),setProps(n.style,r),e.appendChild(n),n}function hitRect(e,t){if(!t)return!1;if(!e)return!1;var r=t.x,n=t.y;return null!=e.offsetLeft&&(null!=e.offsetTop&&(!(r<e.offsetLeft)&&(!(r>e.offsetLeft+e.offsetWidth)&&(!(n<e.offsetTop)&&!(n>e.offsetTop+e.offsetHeight)))))}function hit3DRect(e,t){if(t){var r=t.x,n=t.y,i=new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform);return null!=i.m41&&(null!=i.m42&&(!(r<i.m41)&&(!(r>i.m41+e.offsetWidth)&&(!(n<i.m42)&&!(n>i.m42+e.offsetHeight)))))}}function hitTest(e,t){if(t){var r=t.x,n=t.y;if(r<e.offsetLeft)return!1;if(r>e.offsetLeft+e.offsetWidth)return!1;if(n<e.offsetTop)return!1;if(n>e.offsetTop+e.offsetHeight)return!1;var i=t.x-e.offsetLeft,a=t.y-e.offsetTop;return 0!=e.getContext("2d").getImageData(i,a,1,1).data[3]}}function setCanvasSize(e,t,r){e.width=t,e.height=r,e.style.width=t+"px",e.style.height=r+"px"}function setCanvasSizeScaledToWindowDocumentHeight(e,t,r){var n=window.devicePixelRatio*scaleMultiplier,i=Math.floor(t*n),a=Math.floor(r*n);e.width=i,e.height=a,e.style.width=i+"px",e.style.height=a+"px",e.style.zoom=scaleMultiplier/n}function localx(e,t){for(var r=t;e&&null!=e.offsetTop;)r-=e.offsetLeft+e.clientLeft+new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform).m41,e=e.parentNode;return r}function globalx(e){for(var t=0;e&&null!=e.offsetLeft;){var r=new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform),n=r.m11;t+=(e.clientWidth-n*e.clientWidth)/2,t+=r.m41,t+=e.offsetLeft+e.clientLeft,e=e.parentNode}return t}function localy(e,t){for(var r=t;e&&null!=e.offsetTop;)r-=e.offsetTop+e.clientTop+new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform).m42,e=e.parentNode;return r}function globaly(e){for(var t=0;e&&null!=e.offsetTop;){var r=new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform),n=r.m22;t+=(e.clientHeight-n*e.clientHeight)/2,t+=r.m42,t+=e.offsetTop+e.clientTop,e=e.parentNode}return t}function setProps(e,t){for(var r in t)e[r]=t[r]}function CSSTransition(e,t){var r=1,n="ease",i={left:e.offsetLeft+"px",top:e.offsetTop+"px"};t.duration&&(r=t.duration),t.transition&&(n=t.transition),t.style&&(i=t.style);var a="";for(var o in i)a+=o+" "+r+"s "+n+", ";a=a.substring(0,a.length-2),e.style.webkitTransition=a,e.addEventListener("webkitTransitionEnd",(function(){e.style.webkitTransition="",t.onComplete&&t.onComplete()}),!0),setProps(e.style,i)}function CSSTransition3D(e,t){var r=1,n="ease",i={left:e.left+"px",top:e.top+"px"};if(t.duration&&(r=t.duration),t.transition&&(n=t.transition),t.style)for(var a in t.style)i[a]=t.style[a];var o="-webkit-transform "+r+"s "+n,s="translate3d("+i.left+","+i.top+",0px)";e.addEventListener("webkitTransitionEnd",(function(){e.style.webkitTransition="";var r=new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform);e.left=r.m41,e.top=r.m42,t.onComplete&&t.onComplete()}),!0),e.style.webkitTransition=o,e.style.webkitTransform=s}function drawThumbnail(e,t){var r=e.naturalWidth?e.naturalWidth:e.width,n=e.naturalHeight?e.naturalHeight:e.height,i=(t.width-r)/2,a=(t.height-n)/2,o=t.width/r,s=t.height/n,l=r,c=n;switch(getFit(o,s)){case"noscale":break;case"scaleh":l=r*s,c=n*s,i=(t.width-l)/2,a=(t.height-c)/2;break;case"scalew":l=r*o,c=n*o,i=(t.width-l)/2,a=(t.height-c)/2}t.getContext("2d").drawImage(e,i,a,l,c)}function drawScaled(e,t){var r=e.naturalWidth?e.naturalWidth:e.width,n=e.naturalHeight?e.naturalHeight:e.height,i=t.width,a=t.height,o=i/r,s=r*o,l=n*o;l>a&&(s=r*(o=a/n),l=n*o);var c=(i-s)/2,u=(a-l)/2;t.getContext("2d").drawImage(e,c,u,s,l)}function fitInRect(e,t,r,n){var i=(r-e)/2,a=(n-t)/2,o=r/e,s=n/t,l=e,c=t;switch(getFit(o,s)){case"noscale":break;case"scaleh":i=(r-(l=e*s))/2,a=(n-(c=t*s))/2;break;case"scalew":i=(r-(l=e*o))/2,a=(n-(c=t*o))/2}return[i,a,l,c]}function getFit(e,t){return e>=1&&t>=1?"noscale":e>=1&&t<1?"scaleh":e<1&&t>=1?"scalew":e<t?"scalew":"scaleh"}function getDocumentHeight(){return Math.max(document.body.clientHeight,document.documentElement.clientHeight)}function getDocumentWidth(){return Math.max(document.body.clientWidth,document.documentElement.clientWidth)}function getStringSize(e,t,r){return e.font=t,e.measureText(r)}function writeText(e,t,r,n,i,a){a=null==a?0:a,e.font=t,e.fillStyle=r,e.textAlign="left",e.textBaseline="bottom",e.fillText(n,a,i)}function gn(e){return document.getElementById(e)}function newForm(e,t,r,n,i,a,o){var s=document.createElement("form");return s.style.position="absolute",s.style.top=n+"px",s.style.left=r+"px",i&&(s.style.width=i+"px"),a&&(s.style.height=a+"px"),setProps(s.style,o),e.appendChild(s),s.name=t,s}function newTextInput(e,t,r,n){var i=document.createElement("input");return i.value=r,setProps(i.style,n),i.type=t,e.appendChild(i),i}function getUrlVars(){if(window.location.href.indexOf("?")<0)return[];for(var e,t=[],r=window.location.href.split("?").pop().split("&"),n=0;n<r.length;n++)e=r[n].split("="),t.push(e[0]),t[e[0]]=e[1];return t}function getIdFor(e){for(var t=1;null!=gn(e+" "+t);)t++;return e+" "+t}function getIdForCamera(e){for(var t=1;null!=gn(e+"_"+t);)t++;return e+"_"+t}function rgb2hsb(e){if(null==e)return[24,1,1];var t,r,n,i,a,o;e=e.indexOf("rgb")>-1?rgbToHex(e):rgbaToHex(e);var s=getRGB(parseInt(e.substring(1,e.length),16)),l=s[0];l/=255;var c=s[1];c/=255;var u=s[2];return u/=255,(t=Math.min(Math.min(l,c),u))==(r=Math.max(Math.max(l,c),u))?new Array(0,0,r):(n=l==t?c-u:c==t?u-l:l-c,i=l==t?3:c==t?5:1,a=Math.round(60*(i-n/(r-t)))%360,o=Math.round((r-t)/r*100),r=Math.round(100*r),new Array(a,o/100,r/100))}function rgbToHex(e){if(e.indexOf("rgb")<0)return e;var t=e.substring(4,e.length-1).split(",");return rgbToString({r:Number(t[0]),g:Number(t[1]),b:Number(t[2])})}function rgbaToHex(e){if(e.indexOf("rgba")<0)return e;var t=e.substring(5,e.length-1).split(",");return rgbToString({r:Number(t[0]),g:Number(t[1]),b:Number(t[2])})}function rgbToString(e){return"#"+getHex(e.r)+getHex(e.g)+getHex(e.b)}function getRGB(e){return[Number(e>>16&255),Number(e>>8&255),Number(255&e)]}function getHex(e){var t=e.toString(16);return 1==t.length?"0"+t:t}function findKeyframesRule(e){for(var t=document.styleSheets,r=0;r<t.length;++r)for(var n=0;n<t[r].cssRules.length;++n)for(var i=t[r].cssRules[n].styleSheet.rules,a=0;a<i.length;++a)if(i[a].type==window.CSSRule.WEBKIT_KEYFRAMES_RULE&&i[a].name==e)return i[a];return null}function colorToRGBA(e,t){var r=parseInt("0x"+e.substr(1,e.length));return"rgba("+(r>>16)%256+","+(r>>8)%256+","+r%256+","+t+")"}function css_vh(e){return e*WINDOW_INNER_HEIGHT/100+"px"}function css_vw(e){return e*WINDOW_INNER_WIDTH/100+"px"}Number.prototype.mod=function(e){return(this%e+e)%e}},function(e,t,r){"use strict";var n=r(4),i=r(34),a=r(18),o=r(70),s=r(13);function l(e){return e}function c(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}t.newBlob=function(e,r){t.checkSupport("blob");try{return new Blob([e],{type:r})}catch(t){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(e),n.getBlob(r)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(e,t,r){var n=[],i=0,a=e.length;if(a<=r)return String.fromCharCode.apply(null,e);for(;i<a;)"array"===t||"nodebuffer"===t?n.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+r,a)))):n.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+r,a)))),i+=r;return n.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,a.allocBuffer(1)).length}catch(e){return!1}}()}};function d(e){var r=65536,n=t.getTypeOf(e),i=!0;if("uint8array"===n?i=u.applyCanBeUsed.uint8array:"nodebuffer"===n&&(i=u.applyCanBeUsed.nodebuffer),i)for(;r>1;)try{return u.stringifyByChunk(e,n,r)}catch(e){r=Math.floor(r/2)}return u.stringifyByChar(e)}function h(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}t.applyFromCharCode=d;var f={};f.string={string:l,array:function(e){return c(e,new Array(e.length))},arraybuffer:function(e){return f.string.uint8array(e).buffer},uint8array:function(e){return c(e,new Uint8Array(e.length))},nodebuffer:function(e){return c(e,a.allocBuffer(e.length))}},f.array={string:d,array:l,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return a.newBufferFrom(e)}},f.arraybuffer={string:function(e){return d(new Uint8Array(e))},array:function(e){return h(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:l,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return a.newBufferFrom(new Uint8Array(e))}},f.uint8array={string:d,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:l,nodebuffer:function(e){return a.newBufferFrom(e)}},f.nodebuffer={string:d,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return f.nodebuffer.uint8array(e).buffer},uint8array:function(e){return h(e,new Uint8Array(e.length))},nodebuffer:l},t.transformTo=function(e,r){if(r||(r=""),!e)return r;t.checkSupport(e);var n=t.getTypeOf(r);return f[n][e](r)},t.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":n.nodebuffer&&a.isBuffer(e)?"nodebuffer":n.uint8array&&e instanceof Uint8Array?"uint8array":n.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},t.checkSupport=function(e){if(!n[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},t.MAX_VALUE_16BITS=65535,t.MAX_VALUE_32BITS=-1,t.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)n+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return n},t.delay=function(e,t,r){o((function(){e.apply(r||null,t||[])}))},t.inherits=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r},t.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},t.prepareContent=function(e,r,a,o,l){return s.Promise.resolve(r).then((function(e){return n.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new s.Promise((function(t,r){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=function(e){r(e.target.error)},n.readAsArrayBuffer(e)})):e})).then((function(r){var u,d=t.getTypeOf(r);return d?("arraybuffer"===d?r=t.transformTo("uint8array",r):"string"===d&&(l?r=i.decode(r):a&&!0!==o&&(r=c(u=r,n.uint8array?new Uint8Array(u.length):new Array(u.length)))),r):s.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},function(e,t,r){"use strict";e.exports=r(54)},function(e,t,r){"use strict";function n(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},e.exports=n},function(e,t,r){"use strict";(function(e){if(t.base64=!0,t.array=!0,t.string=!0,t.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,t.nodebuffer=void 0!==e,t.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)t.blob=!1;else{var n=new ArrayBuffer(0);try{t.blob=0===new Blob([n],{type:"application/zip"}).size}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(n),t.blob=0===i.getBlob("application/zip").size}catch(e){t.blob=!1}}}try{t.nodestream=!!r(27).Readable}catch(e){t.nodestream=!1}}).call(this,r(11).Buffer)},function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(n)},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var n=r(16),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=d;var a=r(12);a.inherits=r(9);var o=r(28),s=r(21);a.inherits(d,o);for(var l=i(s.prototype),c=0;c<l.length;c++){var u=l[c];d.prototype[u]||(d.prototype[u]=s.prototype[u])}function d(e){if(!(this instanceof d))return new d(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||n.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},function(e,t,r){"use strict";for(var n=r(1),i=r(4),a=r(18),o=r(3),s=new Array(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1;function c(){o.call(this,"utf-8 decode"),this.leftOver=null}function u(){o.call(this,"utf-8 encode")}t.utf8encode=function(e){return i.nodebuffer?a.newBufferFrom(e,"utf-8"):function(e){var t,r,n,a,o,s=e.length,l=0;for(a=0;a<s;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=i.uint8array?new Uint8Array(l):new Array(l),o=0,a=0;o<l;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t}(e)},t.utf8decode=function(e){return i.nodebuffer?n.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,r,i,a,o=e.length,l=new Array(2*o);for(r=0,t=0;t<o;)if((i=e[t++])<128)l[r++]=i;else if((a=s[i])>4)l[r++]=65533,t+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&t<o;)i=i<<6|63&e[t++],a--;a>1?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),n.applyFromCharCode(l)}(e=n.transformTo(i.uint8array?"uint8array":"array",e))},n.inherits(c,o),c.prototype.processChunk=function(e){var r=n.transformTo(i.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var a=r;(r=new Uint8Array(a.length+this.leftOver.length)).set(this.leftOver,0),r.set(a,this.leftOver.length)}else r=this.leftOver.concat(r);this.leftOver=null}var o=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+s[e[r]]>t?r:t}(r),l=r;o!==r.length&&(i.uint8array?(l=r.subarray(0,o),this.leftOver=r.subarray(o,r.length)):(l=r.slice(0,o),this.leftOver=r.slice(o,r.length))),this.push({data:t.utf8decode(l),meta:e.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:t.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},t.Utf8DecodeWorker=c,n.inherits(u,o),u.prototype.processChunk=function(e){this.push({data:t.utf8encode(e.data),meta:e.meta})},t.Utf8EncodeWorker=u},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},function(e){e.exports=JSON.parse('{"path":"/static/scratchjr/svglibrary/","samples":["samples/Underthesea.txt","samples/Farm.txt","samples/Seasons.txt","samples/Friends.txt","samples/Dance.txt","samples/AnimalRace.txt","samples/Bump.txt","samples/QuickIntro.txt"],"backgrounds":[{"md5":"Farm.svg","width":480,"height":360,"ext":"svg","name":"Farm"},{"md5":"Park.svg","width":480,"height":360,"ext":"svg","name":"Park"},{"md5":"Suburbs.svg","width":480,"height":360,"ext":"svg","name":"Suburbs"},{"md5":"City.svg","width":480,"height":360,"ext":"svg","name":"City"},{"md5":"Library.svg","width":480,"height":360,"ext":"svg","name":"Library"},{"md5":"Classroom.svg","width":480,"height":360,"ext":"svg","name":"Classroom"},{"md5":"Theatre.svg","width":480,"height":360,"ext":"svg","name":"Theatre"},{"md5":"Gym.svg","width":480,"height":360,"ext":"svg","name":"Gym"},{"md5":"Gym2.svg","width":480,"height":360,"ext":"svg","name":"Gym"},{"md5":"Bedroom.svg","width":480,"height":360,"ext":"svg","name":"Bedroom"},{"md5":"EmptyRoom.svg","width":480,"height":360,"ext":"svg","name":"Empty Room"},{"md5":"Summer.svg","width":480,"height":360,"ext":"svg","name":"Summer"},{"md5":"Fall.svg","width":480,"height":360,"ext":"svg","name":"Fall"},{"md5":"Winter.svg","width":480,"height":360,"ext":"svg","name":"Winter"},{"md5":"Spring.svg","width":480,"height":360,"ext":"svg","name":"Spring"},{"md5":"Creek.svg","width":480,"height":360,"ext":"svg","name":"River"},{"md5":"Lake.svg","width":480,"height":360,"ext":"svg","name":"Lake"},{"md5":"Woods.svg","width":480,"height":360,"ext":"svg","name":"Woods"},{"md5":"BeachDay.svg","width":480,"height":360,"ext":"svg","name":"Beach Day"},{"md5":"BeachSunrise.svg","width":480,"height":360,"ext":"svg","name":"Beach Sunset"},{"md5":"BeachNight.svg","width":480,"height":360,"ext":"svg","name":"Beach Night"},{"md5":"Underwater.svg","width":480,"height":360,"ext":"svg","name":"Underwater"},{"md5":"Jungle.svg","width":480,"height":360,"ext":"svg","name":"Jungle"},{"md5":"Savannah.svg","width":480,"height":360,"ext":"svg","name":"Savannah"},{"md5":"Desert.svg","width":480,"height":360,"ext":"svg","name":"Desert"},{"md5":"Arctic.svg","width":480,"height":360,"ext":"svg","name":"Arctic"},{"md5":"Space.svg","width":480,"height":360,"ext":"svg","name":"Space"},{"md5":"MoonBkg.svg","width":480,"height":360,"ext":"svg","name":"Moon"}],"sprites":[{"md5":"Cat.svg","width":166,"height":232,"ext":"svg","name":"Cat","order":"characters,02 funky","tags":["characters","02 funky"]},{"md5":"Cat2.svg","width":157,"height":232,"ext":"svg","name":"Cat Walking","order":"characters,02 funky","tags":["characters","02 funky"]},{"md5":"Blue.svg","width":151,"height":253,"ext":"svg","name":"Tic","order":"characters,02 funky","tags":["characters","02 funky"]},{"md5":"Purple.svg","width":161,"height":185,"ext":"svg","name":"Tac","order":"characters,02 funky","tags":["characters","02 funky"]},{"md5":"Red.svg","width":213,"height":198,"ext":"svg","name":"Toc","order":"characters,02 funky","tags":["characters","02 funky"]},{"md5":"Dragon.svg","width":577,"height":532,"ext":"svg","name":"Dragon","order":"characters,02 funky","tags":["characters","04 magic"]},{"md5":"Fairy.svg","width":235,"height":320,"ext":"svg","name":"Fairy","order":"characters,02 funky","tags":["characters","04 magic"]},{"md5":"Wizard.svg","width":411,"height":443,"ext":"svg","name":"Wizard","order":"characters,02 funky","tags":["characters","04 magic"]},{"md5":"Dog.svg","width":296,"height":213,"ext":"svg","name":"Dog","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Rabbit.svg","width":217,"height":208,"ext":"svg","name":"Rabbit","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Chicken.svg","width":142,"height":148,"ext":"svg","name":"Chicken","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Pig.svg","width":275,"height":211,"ext":"svg","name":"Pig","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Horse.svg","width":422,"height":417,"ext":"svg","name":"Horse","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Zebra.svg","width":408,"height":390,"ext":"svg","name":"Zebra","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Monkey.svg","width":387,"height":235,"ext":"svg","name":"Monkey","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Elephant.svg","width":659,"height":448,"ext":"svg","name":"Elephant","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Giraffe.svg","width":471,"height":655,"ext":"svg","name":"Giraffe","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Camel.svg","width":522,"height":420,"ext":"svg","name":"Camel","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Butterfly.svg","width":128,"height":97,"ext":"svg","name":"Butterfly","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Fly.svg","width":109,"height":93,"ext":"svg","name":"Fly","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Bat.svg","width":174,"height":85,"ext":"svg","name":"Bat","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Bird.svg","width":146,"height":210,"ext":"svg","name":"Bird","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Snake.svg","width":269,"height":79,"ext":"svg","name":"Snake","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Lizard.svg","width":305,"height":179,"ext":"svg","name":"Lizard","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Frog.svg","width":195,"height":166,"ext":"svg","name":"Frog","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Duck.svg","width":155,"height":116,"ext":"svg","name":"Duck","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Crab.svg","width":223,"height":145,"ext":"svg","name":"Crab","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Seahorse.svg","width":80,"height":171,"ext":"svg","name":"Seahorse","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Starfish.svg","width":121,"height":123,"ext":"svg","name":"Starfish","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Fish1.svg","width":196,"height":109,"ext":"svg","name":"Fish","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Fish2.svg","width":169,"height":122,"ext":"svg","name":"Fish","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Whale.svg","width":752,"height":406,"ext":"svg","name":"Whale","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Penguin.svg","width":176,"height":243,"ext":"svg","name":"Penguin","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"PolarBear.svg","width":481,"height":278,"ext":"svg","name":"Polar Bear","order":"characters,03 animals","tags":["characters","03 animals"]},{"md5":"Girl1.svg","width":133,"height":318,"ext":"svg","name":"Child","order":"characters,01 family","tags":["characters","05 faces"]},{"md5":"Girl2.svg","width":122,"height":298,"ext":"svg","name":"Child","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"Girl3.svg","width":145,"height":298,"ext":"svg","name":"Child","order":"characters,01 family","tags":["characters","05 faces"]},{"md5":"Boy1.svg","width":138,"height":311,"ext":"svg","name":"Child","order":"characters,01 family","tags":["characters","05 faces"]},{"md5":"Boy2.svg","width":156,"height":309,"ext":"svg","name":"Child","order":"characters,01 family","tags":["characters","05 faces"]},{"md5":"Boy3.svg","width":134,"height":310,"ext":"svg","name":"Child","order":"characters,01 family","tags":["characters","05 faces"]},{"md5":"TeenGirl1.svg","width":168,"height":363,"ext":"svg","name":"Teen","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"TeenGirl2.svg","width":200,"height":369,"ext":"svg","name":"Teen","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"TeenGirl3.svg","width":123,"height":368,"ext":"svg","name":"Teen","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"TeenBoy1.svg","width":144,"height":407,"ext":"svg","name":"Teen","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"TeenBoy2.svg","width":174,"height":398,"ext":"svg","name":"Teen","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"TeenBoy3.svg","width":134,"height":404,"ext":"svg","name":"Teen","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"Baby.svg","width":191,"height":159,"ext":"svg","name":"Baby","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"Mother.svg","width":224,"height":418,"ext":"svg","name":"Mother","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"Father.svg","width":210,"height":446,"ext":"svg","name":"Father","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"Grandmother.svg","width":149,"height":407,"ext":"svg","name":"Grandmother","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"Grandfather.svg","width":166,"height":402,"ext":"svg","name":"Grandfather","order":"characters,01 family","tags":["characters","01 family"]},{"md5":"Girl.svg","width":156,"height":309,"ext":"svg","name":"Child","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Boy.svg","width":134,"height":319,"ext":"svg","name":"Child","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Teen2.svg","width":200,"height":369,"ext":"svg","name":"Teen","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Teen3.svg","width":144,"height":407,"ext":"svg","name":"Teen","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Farmer1.svg","width":209,"height":441,"ext":"svg","name":"Rancher","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Farmer.svg","width":220,"height":429,"ext":"svg","name":"Rancher","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Bike2.svg","width":368,"height":417,"ext":"svg","name":"Cyclist","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Bike.svg","width":368,"height":417,"ext":"svg","name":"Cyclist","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Car2.svg","width":640,"height":415,"ext":"svg","name":"Driver","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Car1.svg","width":638,"height":415,"ext":"svg","name":"Driver","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Aeroplane.svg","width":570,"height":394,"ext":"svg","name":"Pilot","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Astronaut.svg","width":238,"height":442,"ext":"svg","name":"Astronaut","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Inuit.svg","width":244,"height":390,"ext":"svg","name":"Northerner","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Scubadiver.svg","width":510,"height":235,"ext":"svg","name":"Scuba Diver","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Rowboat.svg","width":589,"height":344,"ext":"svg","name":"Rower","order":"characters,05 faces","tags":["characters","05 faces"]},{"md5":"Tree1.svg","width":284,"height":348,"ext":"svg","name":"Tree","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Tree3.svg","width":209,"height":388,"ext":"svg","name":"Tree","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Tree4.svg","width":306,"height":197,"ext":"svg","name":"Tree","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Evergreen.svg","width":201,"height":406,"ext":"svg","name":"Tree","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Weed.svg","width":132,"height":101,"ext":"svg","name":"Plant","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Pasture.svg","width":512,"height":128,"ext":"svg","name":"Tall Grass","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Cactus.svg","width":172,"height":362,"ext":"svg","name":"Cactus","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Daffodil.svg","width":160,"height":171,"ext":"svg","name":"Daffodils","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Daisy1.svg","width":95,"height":78,"ext":"svg","name":"Daisy","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Daisy2.svg","width":91,"height":81,"ext":"svg","name":"Daisy","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Daisy3.svg","width":77,"height":98,"ext":"svg","name":"Daisy","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Tulip2.svg","width":93,"height":169,"ext":"svg","name":"Tulip","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Flowers.svg","width":197,"height":119,"ext":"svg","name":"Flowers","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Apple.svg","width":112,"height":132,"ext":"svg","name":"Apple","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Peach.svg","width":112,"height":111,"ext":"svg","name":"Peach","order":"characters,06 plants","tags":["characters","09 objects"]},{"md5":"Mushroom.svg","width":128,"height":134,"ext":"svg","name":"Mushroom","order":"characters,06 plants","tags":["characters","06 plants"]},{"md5":"Star.svg","width":80,"height":101,"ext":"svg","name":"Star","order":"characters,07 weather","tags":["characters","07 weather"]},{"md5":"Star2.svg","width":64,"height":63,"ext":"svg","name":"Star","order":"characters,07 weather","tags":["characters","07 weather"]},{"md5":"Star3.svg","width":74,"height":77,"ext":"svg","name":"Star","order":"characters,07 weather","tags":["characters","07 weather"]},{"md5":"ShootingStar.svg","width":296,"height":78,"ext":"svg","name":"Shooting Star","order":"characters,07 weather","tags":["characters","07 weather"]},{"md5":"Earth.svg","width":220,"height":220,"ext":"svg","name":"Earth","order":"characters,07 weather","tags":["characters","07 weather"]},{"md5":"Planet.svg","width":393,"height":271,"ext":"svg","name":"Planet","order":"characters,07 weather","tags":["characters","07 weather"]},{"md5":"Sun.svg","width":176,"height":176,"ext":"svg","name":"Sun","order":"characters,07 weather","tags":["characters","07 weather"]},{"md5":"Moon.svg","width":204,"height":204,"ext":"svg","name":"Full Moon","order":"characters,07 weather","tags":["characters","09 weather"]},{"md5":"CrescentMoon.svg","width":157,"height":160,"ext":"svg","name":"Moon","order":"characters,07 weather","tags":["characters","07 weather"]},{"md5":"Cloud1.svg","width":238,"height":149,"ext":"svg","name":"Cloud","order":"characters,07 weather","tags":["characters","07 weather"]},{"md5":"Thundercloud.svg","width":344,"height":270,"ext":"svg","name":"Storm Cloud","order":"characters,07 weather","tags":["characters","07 weather"]},{"md5":"Tornado.svg","width":256,"height":328,"ext":"svg","name":"Tornado","order":"characters,07 weather","tags":["characters","07 weather"]},{"md5":"Barn.svg","width":594,"height":380,"ext":"svg","name":"Barn","order":"characters,08 buildings","tags":["characters","08 buildings "]},{"md5":"Fort.svg","width":576,"height":452,"ext":"svg","name":"Fort","order":"characters,08 buildings","tags":["characters","08 buildings"]},{"md5":"Castle.svg","width":379,"height":548,"ext":"svg","name":"Castle","order":"characters,08 buildings","tags":["characters","08 buildings"]},{"md5":"Igloo.svg","width":332,"height":194,"ext":"svg","name":"Igloo","order":"characters,08 buildings","tags":["characters","08 buildings"]},{"md5":"House1.svg","width":631,"height":379,"ext":"svg","name":"House","order":"characters,08 buildings","tags":["characters","08 buildings"]},{"md5":"House.svg","width":470,"height":258,"ext":"svg","name":"House","order":"characters,08 buildings","tags":["characters","08 buildings"]},{"md5":"House3.svg","width":286,"height":323,"ext":"svg","name":"House","order":"characters,08 buildings","tags":["characters","08 buildings"]},{"md5":"House4.svg","width":592,"height":341,"ext":"svg","name":"House","order":"characters,08 buildings","tags":["characters","08 buildings"]},{"md5":"Apartment.svg","width":230,"height":480,"ext":"svg","name":"Apartment","order":"characters,08 buildings","tags":["characters","07 buildings"]},{"md5":"School.svg","width":395,"height":334,"ext":"svg","name":"School","order":"characters,08 buildings","tags":["characters","07 buildings"]},{"md5":"Shop.svg","width":474,"height":304,"ext":"svg","name":"Shop","order":"characters,08 buildings","tags":["characters","07 buildings"]},{"md5":"Fence.svg","width":219,"height":123,"ext":"svg","name":"Fence","order":"characters,09 objects","tags":["characters","09 objects"]},{"md5":"Mailbox.svg","width":71,"height":210,"ext":"svg","name":"Mailbox","order":"characters,09 objects","tags":["characters","09 objects"]},{"md5":"Cake.svg","width":276,"height":270,"ext":"svg","name":"Cake","order":"characters,09 objects","tags":["characters","09 objects"]},{"md5":"Ball.svg","width":126,"height":129,"ext":"svg","name":"Ball","order":"characters,09 objects","tags":["characters","09 objects"]},{"md5":"Basketball.svg","width":96,"height":96,"ext":"svg","name":"Basketball","order":"characters,09 objects","tags":["characters","09 objects"]},{"md5":"Soccerball.svg","width":96,"height":96,"ext":"svg","name":"Soccer Ball","order":"characters,09 objects","tags":["characters","09 objects"]},{"md5":"SoccerNet.svg","width":219,"height":399,"ext":"svg","name":"Soccer Net","order":"characters,09 objects","tags":["characters","09 objects"]},{"md5":"Bed.svg","width":370,"height":343,"ext":"svg","name":"Bed","order":"characters,09 objects","tags":["characters","09 objects"]},{"md5":"NightTable.svg","width":175,"height":175,"ext":"svg","name":"Night Table","order":"characters,09 objects","tags":["characters","09 objects"]},{"md5":"Stool.svg","width":159,"height":182,"ext":"svg","name":"Stool","order":"characters,09 objects","tags":["characters","09 objects"]},{"md5":"Table.svg","width":399,"height":248,"ext":"svg","name":"Table","order":"characters,09 objects","tags":["characters","09 objects"]},{"md5":"Car.svg","width":534,"height":220,"ext":"svg","name":"Car","order":"characters,10 transportation","tags":["characters","10 transportation"]},{"md5":"Bus.svg","width":600,"height":319,"ext":"svg","name":"Bus","order":"characters,10 transportation","tags":["characters","10 transportation"]},{"md5":"SailBoat.svg","width":356,"height":393,"ext":"svg","name":"Boat","order":"characters,10 transportation","tags":["characters","10 transportation"]},{"md5":"Boat2.svg","width":488,"height":425,"ext":"svg","name":"Boat","order":"characters,10 transportation","tags":["characters","10 transportation"]},{"md5":"Rocket.svg","width":254,"height":495,"ext":"svg","name":"Rocket","order":"characters,10 transportation","tags":["characters","10 transportation"]}],"sounds":["pop.mp3"]}')},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var n=r(57),i=r(58),a=r(26);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return c(this,e,t,r)}function c(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=h(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|g(t,r),i=(e=s(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|f(t.length);return 0===(e=s(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):h(e,t);if("Buffer"===t.type&&a(t.data))return h(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(u(t),e=s(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function h(e,t){var r=t.length<0?0:0|f(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function g(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return H(e).length;default:if(n)return z(e).length;t=(""+t).toLowerCase(),n=!0}}function p(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,r);case"utf8":case"utf-8":return O(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return P(this,t,r);case"base64":return C(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:b(e,t,r,n,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):b(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,r,n,i){var a,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(a=r;a<s;a++)if(c(e,a)===c(t,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===l)return u*o}else-1!==u&&(a-=a-u),u=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){for(var d=!0,h=0;h<l;h++)if(c(e,a+h)!==c(t,h)){d=!1;break}if(d)return a}return-1}function y(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[r+o]=s}return o}function k(e,t,r,n){return U(z(t,e.length-r),e,r,n)}function w(e,t,r,n){return U(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function x(e,t,r,n){return w(e,t,r,n)}function S(e,t,r,n){return U(H(t),e,r,n)}function _(e,t,r,n){return U(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function C(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function O(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,l,c=e[i],u=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=r)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&c)<<6|63&a)>127&&(u=l);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(l=(15&c)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=d}return function(e){var t=e.length;if(t<=j)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=j));return r}(n)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return c(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,n){return u(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return d(null,e)},l.allocUnsafeSlow=function(e){return d(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},l.byteLength=g,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?O(this,0,e):p.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(n,i),u=e.slice(t,r),d=0;d<s;++d)if(c[d]!==u[d]){a=c[d],o=u[d];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return y(this,e,t,r);case"utf8":case"utf-8":return k(this,e,t,r);case"ascii":return w(this,e,t,r);case"latin1":case"binary":return x(this,e,t,r);case"base64":return S(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var j=4096;function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function P(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function T(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=F(e[a]);return i}function N(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function E(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function B(e,t,r,n,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function I(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function M(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function D(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function R(e,t,r,n,a){return a||D(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function q(e,t,r,n,a){return a||D(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;r=new l(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||E(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||E(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return t||E(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||E(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||E(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||E(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||E(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||E(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||E(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||E(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||E(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||E(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||E(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||E(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||B(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||B(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);B(this,e,t,r,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);B(this,e,t,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return R(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return R(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return q(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return q(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var o=l.isBuffer(e)?e:z(new l(e,n).toString()),s=o.length;for(a=0;a<r-t;++a)this[a+t]=o[a%s]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function z(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function H(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(6))},function(e,t,r){(function(e){function r(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===r(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===r(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===r(e)},t.isError=function(e){return"[object Error]"===r(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,r(11).Buffer)},function(e,t,r){"use strict";var n=null;n="undefined"!=typeof Promise?Promise:r(71),e.exports={Promise:n}},function(e,t,r){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}n.prototype=r(56),n.prototype.loadAsync=r(89),n.support=r(4),n.defaults=r(36),n.version="3.2.0",n.loadAsync=function(e,t){return(new n).loadAsync(e,t)},n.external=r(13),e.exports=n},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,c=[],u=!1,d=-1;function h(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&f())}function f(){if(!u){var e=s(h);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function p(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new g(e,t)),1!==c.length||u||s(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";(function(t){void 0===t||!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,r,n,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,r)}));case 3:return t.nextTick((function(){e.call(null,r,n)}));case 4:return t.nextTick((function(){e.call(null,r,n,i)}));default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return t.nextTick((function(){e.apply(null,a)}))}}}:e.exports=t}).call(this,r(15))},function(e,t,r){var n=r(11),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=o),a(i,o),o.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,r){"use strict";(function(t){e.exports={isNode:void 0!==t,newBufferFrom:function(e,r){if(t.from&&t.from!==Uint8Array.from)return t.from(e,r);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new t(e,r)},allocBuffer:function(e){if(t.alloc)return t.alloc(e);var r=new t(e);return r.fill(0),r},isBuffer:function(e){return t.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}}).call(this,r(11).Buffer)},function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var l=10;function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var i,a,o,s;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]),void 0===o)o=a[t]=r,++e._eventsCount;else if("function"==typeof o?o=a[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,s=l,console&&console.warn&&console.warn(s)}return e}function d(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,e))}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=d.bind(n);return i.listener=r,n.wrapFn=i,i}function f(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):p(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)a(l,this,t);else{var c=l.length,u=p(l,c);for(r=0;r<c;++r)a(u[r],this,t)}return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,a,o;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},s.prototype.listenerCount=g,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){(t=e.exports=r(28)).Stream=t,t.Readable=t,t.Writable=r(21),t.Duplex=r(7),t.Transform=r(33),t.PassThrough=r(65)},function(e,t,r){"use strict";(function(t,n,i){var a=r(16);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=b;var s,l=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?n:a.nextTick;b.WritableState=m;var c=r(12);c.inherits=r(9);var u={deprecate:r(64)},d=r(29),h=r(17).Buffer,f=i.Uint8Array||function(){};var g,p=r(30);function v(){}function m(e,t){s=s||r(7),e=e||{};var n=t instanceof s;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,c=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(c||0===c)?c:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var d=!1===e.decodeStrings;this.decodeStrings=!d,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(a.nextTick(i,n),a.nextTick(_,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),_(e,t))}(e,r,n,t,i);else{var o=x(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||w(e,r),n?l(k,e,r,o,i):k(e,r,o,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function b(e){if(s=s||r(7),!(g.call(b,this)||this instanceof s))return new b(e);this._writableState=new m(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),d.call(this)}function y(e,t,r,n,i,a,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function k(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),_(e,t)}function w(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),a=t.corkedRequestsFree;a.entry=r;for(var s=0,l=!0;r;)i[s]=r,r.isBuf||(l=!1),r=r.next,s+=1;i.allBuffers=l,y(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,u=r.encoding,d=r.callback;if(y(e,t,!1,t.objectMode?1:c.length,c,u,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function x(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function S(e,t){e._final((function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),_(e,t)}))}function _(e,t){var r=x(t);return r&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,a.nextTick(S,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}c.inherits(b,d),m.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(m.prototype,"buffer",{get:u.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(g=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(e){return!!g.call(this,e)||this===b&&(e&&e._writableState instanceof m)}})):g=function(e){return e instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(e,t,r){var n,i=this._writableState,o=!1,s=!i.objectMode&&(n=e,h.isBuffer(n)||n instanceof f);return s&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=v),i.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),a.nextTick(t,r)}(this,r):(s||function(e,t,r,n){var i=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),a.nextTick(n,o),i=!1),i}(this,i,e,r))&&(i.pendingcb++,o=function(e,t,r,n,i,a){if(!r){var o=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,r));return t}(t,n,i);n!==o&&(r=!0,i="buffer",n=o)}var s=t.objectMode?1:n.length;t.length+=s;var l=t.length<t.highWaterMark;l||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else y(e,t,!1,s,n,i,a);return l}(this,i,s,e,t,r)),o},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},b.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,_(e,t),r&&(t.finished?a.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),b.prototype.destroy=p.destroy,b.prototype._undestroy=p.undestroy,b.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,r(15),r(31).setImmediate,r(6))},function(e,t,r){"use strict";var n=r(13),i=r(37),a=r(38),o=r(39);a=r(38);function s(e,t,r,n,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=n,this.compressedContent=i}s.prototype={getContentWorker:function(){var e=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(e,t,r){return e.pipe(new o).pipe(new a("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new a("compressedSize")).withStreamInfo("compression",t)},e.exports=s},function(e,t,r){"use strict";var n=r(1);var i=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function(e,t){return void 0!==e&&e.length?"string"!==n.getTypeOf(e)?function(e,t,r,n){var a=i,o=n+r;e^=-1;for(var s=n;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}(0|t,e,e.length,0):function(e,t,r,n){var a=i,o=n+r;e^=-1;for(var s=n;s<o;s++)e=e>>>8^a[255&(e^t.charCodeAt(s))];return-1^e}(0|t,e,e.length,0):0}},function(e,t,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,r){e.exports={spin:"index_spin_M8QwX",cover:"index_cover_2olLF",rotate:"index_rotate_3aXu2"}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){e.exports=r(59)},function(e,t,r){"use strict";(function(t,n){var i=r(16);e.exports=y;var a,o=r(26);y.ReadableState=b;r(19).EventEmitter;var s=function(e,t){return e.listeners(t).length},l=r(29),c=r(17).Buffer,u=t.Uint8Array||function(){};var d=r(12);d.inherits=r(9);var h=r(60),f=void 0;f=h&&h.debuglog?h.debuglog("stream"):function(){};var g,p=r(61),v=r(30);d.inherits(y,l);var m=["error","close","destroy","pause","resume"];function b(e,t){e=e||{};var n=t instanceof(a=a||r(7));this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,o=e.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(o||0===o)?o:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(g||(g=r(32).StringDecoder),this.decoder=new g(e.encoding),this.encoding=e.encoding)}function y(e){if(a=a||r(7),!(this instanceof y))return new y(e);this._readableState=new b(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),l.call(this)}function k(e,t,r,n,i){var a,o=e._readableState;null===t?(o.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,_(e)}(e,o)):(i||(a=function(e,t){var r;n=t,c.isBuffer(n)||n instanceof u||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(o,t)),a?e.emit("error",a):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),n?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!r?(t=o.decoder.write(t),o.objectMode||0!==t.length?w(e,o,t,!1):O(e,o)):w(e,o,t,!1))):n||(o.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function w(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&_(e)),O(e,t)}Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),y.prototype.destroy=v.destroy,y.prototype._undestroy=v.undestroy,y.prototype._destroy=function(e,t){this.push(null),t(e)},y.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=c.from(e,t),t=""),r=!0),k(this,e,t,!1,r)},y.prototype.unshift=function(e){return k(this,e,null,!0,!1)},y.prototype.isPaused=function(){return!1===this._readableState.flowing},y.prototype.setEncoding=function(e){return g||(g=r(32).StringDecoder),this._readableState.decoder=new g(e),this._readableState.encoding=e,this};var x=8388608;function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=x?e=x:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function _(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(C,e):C(e))}function C(e){f("emit readable"),e.emit("readable"),T(e)}function O(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(j,e,t))}function j(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function A(e){f("readable nexttick read 0"),e.read(0)}function P(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),T(e),t.flowing&&!t.reading&&e.read(0)}function T(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function N(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(o===a.length?i+=a:i+=a.slice(0,e),0===(e-=o)){o===a.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=a.slice(o));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=c.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var a=n.data,o=e>a.length?a.length:e;if(a.copy(r,r.length-e,0,o),0===(e-=o)){o===a.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=a.slice(o));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function E(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(B,t,e))}function B(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function I(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}y.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?E(this):_(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&E(this),null;var n,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(r,t))),null===(n=e>0?N(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&E(this)),null!==n&&this.emit("data",n),n},y.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},y.prototype.pipe=function(e,t){var r=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,f("pipe count=%d opts=%j",a.pipesCount,t);var l=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?u:y;function c(t,n){f("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,f("cleanup"),e.removeListener("close",m),e.removeListener("finish",b),e.removeListener("drain",d),e.removeListener("error",v),e.removeListener("unpipe",c),r.removeListener("end",u),r.removeListener("end",y),r.removeListener("data",p),h=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||d())}function u(){f("onend"),e.end()}a.endEmitted?i.nextTick(l):r.once("end",l),e.on("unpipe",c);var d=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,T(e))}}(r);e.on("drain",d);var h=!1;var g=!1;function p(t){f("ondata"),g=!1,!1!==e.write(t)||g||((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==I(a.pipes,e))&&!h&&(f("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,g=!0),r.pause())}function v(t){f("onerror",t),y(),e.removeListener("error",v),0===s(e,"error")&&e.emit("error",t)}function m(){e.removeListener("finish",b),y()}function b(){f("onfinish"),e.removeListener("close",m),y()}function y(){f("unpipe"),r.unpipe(e)}return r.on("data",p),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",v),e.once("close",m),e.once("finish",b),e.emit("pipe",r),a.flowing||(f("pipe resume"),r.resume()),e},y.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,r);return this}var o=I(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},y.prototype.on=function(e,t){var r=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&_(this):i.nextTick(A,this))}return r},y.prototype.addListener=y.prototype.on,y.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(P,e,t))}(this,e)),this},y.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},y.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(f("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(f("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i)||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<m.length;a++)e.on(m[a],this.emit.bind(this,m[a]));return this._read=function(t){f("wrapped _read",t),n&&(n=!1,e.resume())},this},Object.defineProperty(y.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),y._fromList=N}).call(this,r(6),r(15))},function(e,t,r){e.exports=r(19).EventEmitter},function(e,t,r){"use strict";var n=r(16);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,a=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return a||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(n.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,r){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function a(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new a(i.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new a(i.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r(63),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(6))},function(e,t,r){"use strict";var n=r(17).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=h,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function u(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=a,a.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},a.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=o(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=o(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=o(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,r){"use strict";e.exports=o;var n=r(7),i=r(12);function a(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);n.call(this,e),this._transformState={afterTransform:a.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var e=this;"function"==typeof this._flush?this._flush((function(t,r){l(e,t,r)})):l(this,null,null)}function l(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=r(9),i.inherits(o,n),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,(function(e){t(e),r.emit("close")}))}},function(e,t,r){"use strict";var n=r(1),i=r(4),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.encode=function(e){for(var t,r,i,o,s,l,c,u=[],d=0,h=e.length,f=h,g="string"!==n.getTypeOf(e);d<e.length;)f=h-d,g?(t=e[d++],r=d<h?e[d++]:0,i=d<h?e[d++]:0):(t=e.charCodeAt(d++),r=d<h?e.charCodeAt(d++):0,i=d<h?e.charCodeAt(d++):0),o=t>>2,s=(3&t)<<4|r>>4,l=f>1?(15&r)<<2|i>>6:64,c=f>2?63&i:64,u.push(a.charAt(o)+a.charAt(s)+a.charAt(l)+a.charAt(c));return u.join("")},t.decode=function(e){var t,r,n,o,s,l,c=0,u=0;if("data:"===e.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var d,h=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===a.charAt(64)&&h--,e.charAt(e.length-2)===a.charAt(64)&&h--,h%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=i.uint8array?new Uint8Array(0|h):new Array(0|h);c<e.length;)t=a.indexOf(e.charAt(c++))<<2|(o=a.indexOf(e.charAt(c++)))>>4,r=(15&o)<<4|(s=a.indexOf(e.charAt(c++)))>>2,n=(3&s)<<6|(l=a.indexOf(e.charAt(c++))),d[u++]=t,64!==s&&(d[u++]=r),64!==l&&(d[u++]=n);return d}},function(e,t,r){"use strict";(function(t){var n=r(1),i=r(73),a=r(3),o=r(34),s=r(4),l=r(13),c=null;if(s.nodestream)try{c=r(74)}catch(e){}function u(e,r){return new l.Promise((function(i,a){var s=[],l=e._internalType,c=e._outputType,u=e._mimeType;e.on("data",(function(e,t){s.push(e),r&&r(t)})).on("error",(function(e){s=[],a(e)})).on("end",(function(){try{var e=function(e,t,r){switch(e){case"blob":return n.newBlob(n.transformTo("arraybuffer",t),r);case"base64":return o.encode(t);default:return n.transformTo(e,t)}}(c,function(e,r){var n,i=0,a=null,o=0;for(n=0;n<r.length;n++)o+=r[n].length;switch(e){case"string":return r.join("");case"array":return Array.prototype.concat.apply([],r);case"uint8array":for(a=new Uint8Array(o),n=0;n<r.length;n++)a.set(r[n],i),i+=r[n].length;return a;case"nodebuffer":return t.concat(r);default:throw new Error("concat : unsupported type '"+e+"'")}}(l,s),u);i(e)}catch(e){a(e)}s=[]})).resume()}))}function d(e,t,r){var o=t;switch(t){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=t,this._mimeType=r,n.checkSupport(o),this._worker=e.pipe(new i(o)),e.lock()}catch(e){this._worker=new a("error"),this._worker.error(e)}}d.prototype={accumulate:function(e){return u(this,e)},on:function(e,t){var r=this;return"data"===e?this._worker.on(e,(function(e){t.call(r,e.data,e.meta)})):this._worker.on(e,(function(){n.delay(t,arguments,r)})),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(n.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},e)}},e.exports=d}).call(this,r(11).Buffer)},function(e,t,r){"use strict";t.base64=!1,t.binary=!1,t.dir=!1,t.createFolders=!0,t.date=null,t.compression=null,t.compressionOptions=null,t.comment=null,t.unixPermissions=null,t.dosPermissions=null},function(e,t,r){"use strict";var n=r(1),i=r(3);function a(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=n.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}n.inherits(a,i),a.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=a},function(e,t,r){"use strict";var n=r(1),i=r(3);function a(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}n.inherits(a,i),a.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},e.exports=a},function(e,t,r){"use strict";var n=r(3),i=r(23);function a(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r(1).inherits(a,n),a.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},e.exports=a},function(e,t,r){"use strict";var n=r(3);t.STORE={magic:"\0\0",compressWorker:function(e){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},t.DEFLATE=r(77)},function(e,t,r){"use strict";e.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function(e,t,r,i){var a=n,o=i+r;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,r){"use strict";var n=r(5),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var o=new n.Buf8(256),s=0;s<256;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function l(e,t){if(t<65534&&(e.subarray&&a||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",o=0;o<t;o++)r+=String.fromCharCode(e[o]);return r}o[254]=o[254]=1,t.string2buf=function(e){var t,r,i,a,o,s=e.length,l=0;for(a=0;a<s;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(l),o=0,a=0;o<l;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},t.buf2binstring=function(e){return l(e,e.length)},t.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},t.buf2string=function(e,t){var r,n,i,a,s=t||e.length,c=new Array(2*s);for(n=0,r=0;r<s;)if((i=e[r++])<128)c[n++]=i;else if((a=o[i])>4)c[n++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&r<s;)i=i<<6|63&e[r++],a--;a>1?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return l(c,n)},t.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+o[e[r]]>t?r:t}},function(e,t,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,r){"use strict";t.LOCAL_FILE_HEADER="PK",t.CENTRAL_FILE_HEADER="PK",t.CENTRAL_DIRECTORY_END="PK",t.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",t.ZIP64_CENTRAL_DIRECTORY_END="PK",t.DATA_DESCRIPTOR="PK\b"},function(e,t,r){"use strict";var n=r(1),i=r(4),a=r(48),o=r(91),s=r(92),l=r(50);e.exports=function(e){var t=n.getTypeOf(e);return n.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new s(e):i.uint8array?new l(n.transformTo("uint8array",e)):new a(n.transformTo("array",e)):new o(e)}},function(e,t,r){"use strict";var n=r(49);function i(e){n.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}r(1).inherits(i,n),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===r&&this.data[a+2]===n&&this.data[a+3]===i)return a-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),a=this.readData(4);return t===a[0]&&r===a[1]&&n===a[2]&&i===a[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,r){"use strict";var n=r(1);function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},e.exports=i},function(e,t,r){"use strict";var n=r(48);function i(e){n.call(this,e)}r(1).inherits(i,n),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t){e.exports=function(e){var t=e.file.readJSON("package.json");e.initConfig({pkg:t,banner:e.file.read("./src/copy.js").replace(/@VERSION/,t.version).replace(/@DATE/,e.template.today("yyyy-mm-dd"))+"\n",uglify:{options:{banner:"<%= banner %>",report:"min"},dist:{src:"<%= concat.target.dest %>",dest:"dist/snap.svg-min.js"}},concat:{options:{banner:"<%= banner %>"},target:{dest:"dist/snap.svg.js",src:["./node_modules/eve/eve.js","./src/amd-banner.js","./src/mina.js","./src/svg.js","./src/matrix.js","./src/attr.js","./src/attradd.js","./src/paper.js","./src/path.js","./src/set.js","./src/equal.js","./src/mouse.js","./src/filter.js","./src/amd-footer.js"]}},exec:{dr:{command:"node node_modules/dr.js/dr dr.json"}}}),e.loadNpmTasks("grunt-contrib-concat"),e.loadNpmTasks("grunt-contrib-uglify"),e.loadNpmTasks("grunt-exec"),e.registerTask("default",["concat","uglify","exec"])}},function(e){e.exports=JSON.parse('{"edition":"official","scratchJrVersion":"iOSv01","useStoryStarters":false,"shareEnabled":true,"defaultSprite":"Cat.svg","spriteOutlineColor":"white","stageColor":"#F5F2F7","textSpriteFont":"Helvetica","blockArgFont":"Verdana","paletteBalloonFont":"Roboto","categoryStartColor":"#FFE75A","categoryMotionColor":"#4B8CC2","categoryLooksColor":"#CD7CD1","categorySoundColor":"#48CC7E","categoryFlowColor":"#FFBE57","categoryStopColor":"#D62222","paletteBlockShadowOpacity":0.8,"autoSaveInterval":30000,"defaultLocale":"en","defaultLocaleShort":"en","supportedLocales":{"Catal":"ca","Cymraeg":"cy","Dansk":"da","Deutsch":"de","English":"en","Espaol":"es","Franais":"fr","Italiano":"it","Nederlands":"nl","":"ja","Portugus":"pt","Svenska":"sv","":"th","":"zh-cn","":"zh-tw"},"settingsPageDisabled":false}')},function(e,t,r){},function(e,t,r){"use strict";
/** @license React v16.12.0
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=r(55),i="function"==typeof Symbol&&Symbol.for,a=i?Symbol.for("react.element"):60103,o=i?Symbol.for("react.portal"):60106,s=i?Symbol.for("react.fragment"):60107,l=i?Symbol.for("react.strict_mode"):60108,c=i?Symbol.for("react.profiler"):60114,u=i?Symbol.for("react.provider"):60109,d=i?Symbol.for("react.context"):60110,h=i?Symbol.for("react.forward_ref"):60112,f=i?Symbol.for("react.suspense"):60113;i&&Symbol.for("react.suspense_list");var g=i?Symbol.for("react.memo"):60115,p=i?Symbol.for("react.lazy"):60116;i&&Symbol.for("react.fundamental"),i&&Symbol.for("react.responder"),i&&Symbol.for("react.scope");var v="function"==typeof Symbol&&Symbol.iterator;function m(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y={};function k(e,t,r){this.props=e,this.context=t,this.refs=y,this.updater=r||b}function w(){}function x(e,t,r){this.props=e,this.context=t,this.refs=y,this.updater=r||b}k.prototype.isReactComponent={},k.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(m(85));this.updater.enqueueSetState(this,e,t,"setState")},k.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=k.prototype;var S=x.prototype=new w;S.constructor=x,n(S,k.prototype),S.isPureReactComponent=!0;var _={current:null},C={current:null},O=Object.prototype.hasOwnProperty,j={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,r){var n,i={},o=null,s=null;if(null!=t)for(n in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)O.call(t,n)&&!j.hasOwnProperty(n)&&(i[n]=t[n]);var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps)void 0===i[n]&&(i[n]=l[n]);return{$$typeof:a,type:e,key:o,ref:s,props:i,_owner:C.current}}function P(e){return"object"==typeof e&&null!==e&&e.$$typeof===a}var T=/\/+/g,N=[];function E(e,t,r,n){if(N.length){var i=N.pop();return i.result=e,i.keyPrefix=t,i.func=r,i.context=n,i.count=0,i}return{result:e,keyPrefix:t,func:r,context:n,count:0}}function B(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>N.length&&N.push(e)}function I(e,t,r){return null==e?0:function e(t,r,n,i){var s=typeof t;"undefined"!==s&&"boolean"!==s||(t=null);var l=!1;if(null===t)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case a:case o:l=!0}}if(l)return n(i,t,""===r?"."+M(t,0):r),1;if(l=0,r=""===r?".":r+":",Array.isArray(t))for(var c=0;c<t.length;c++){var u=r+M(s=t[c],c);l+=e(s,u,n,i)}else if(null===t||"object"!=typeof t?u=null:u="function"==typeof(u=v&&t[v]||t["@@iterator"])?u:null,"function"==typeof u)for(t=u.call(t),c=0;!(s=t.next()).done;)l+=e(s=s.value,u=r+M(s,c++),n,i);else if("object"===s)throw n=""+t,Error(m(31,"[object Object]"===n?"object with keys {"+Object.keys(t).join(", ")+"}":n,""));return l}(e,"",t,r)}function M(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function D(e,t){e.func.call(e.context,t,e.count++)}function R(e,t,r){var n=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?q(e,n,r,(function(e){return e})):null!=e&&(P(e)&&(e=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(T,"$&/")+"/")+r)),n.push(e))}function q(e,t,r,n,i){var a="";null!=r&&(a=(""+r).replace(T,"$&/")+"/"),I(e,R,t=E(t,a,n,i)),B(t)}function L(){var e=_.current;if(null===e)throw Error(m(321));return e}var F={Children:{map:function(e,t,r){if(null==e)return e;var n=[];return q(e,n,null,t,r),n},forEach:function(e,t,r){if(null==e)return e;I(e,D,t=E(null,null,t,r)),B(t)},count:function(e){return I(e,(function(){return null}),null)},toArray:function(e){var t=[];return q(e,t,null,(function(e){return e})),t},only:function(e){if(!P(e))throw Error(m(143));return e}},createRef:function(){return{current:null}},Component:k,PureComponent:x,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:u,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:h,render:e}},lazy:function(e){return{$$typeof:p,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:g,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return L().useCallback(e,t)},useContext:function(e,t){return L().useContext(e,t)},useEffect:function(e,t){return L().useEffect(e,t)},useImperativeHandle:function(e,t,r){return L().useImperativeHandle(e,t,r)},useDebugValue:function(){},useLayoutEffect:function(e,t){return L().useLayoutEffect(e,t)},useMemo:function(e,t){return L().useMemo(e,t)},useReducer:function(e,t,r){return L().useReducer(e,t,r)},useRef:function(e){return L().useRef(e)},useState:function(e){return L().useState(e)},Fragment:s,Profiler:c,StrictMode:l,Suspense:f,createElement:A,cloneElement:function(e,t,r){if(null==e)throw Error(m(267,e));var i=n({},e.props),o=e.key,s=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,l=C.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)O.call(t,u)&&!j.hasOwnProperty(u)&&(i[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];i.children=c}return{$$typeof:a,type:e.type,key:o,ref:s,props:i,_owner:l}},createFactory:function(e){var t=A.bind(null,e);return t.type=e,t},isValidElement:P,version:"16.12.0",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:_,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:C,IsSomeRendererActing:{current:!1},assign:n}},z={default:F},H=z&&F||z;e.exports=H.default||H},function(e,t,r){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var r,s,l=o(e),c=1;c<arguments.length;c++){for(var u in r=Object(arguments[c]))i.call(r,u)&&(l[u]=r[u]);if(n){s=n(r);for(var d=0;d<s.length;d++)a.call(r,s[d])&&(l[s[d]]=r[s[d]])}}return l}},function(e,t,r){"use strict";var n=r(8),i=r(1),a=r(3),o=r(35),s=r(36),l=r(22),c=r(75),u=r(76),d=r(18),h=r(88),f=function(e,t,r){var n,o=i.getTypeOf(t),u=i.extend(r||{},s);u.date=u.date||new Date,null!==u.compression&&(u.compression=u.compression.toUpperCase()),"string"==typeof u.unixPermissions&&(u.unixPermissions=parseInt(u.unixPermissions,8)),u.unixPermissions&&16384&u.unixPermissions&&(u.dir=!0),u.dosPermissions&&16&u.dosPermissions&&(u.dir=!0),u.dir&&(e=p(e)),u.createFolders&&(n=g(e))&&v.call(this,n,!0);var f="string"===o&&!1===u.binary&&!1===u.base64;r&&void 0!==r.binary||(u.binary=!f),(t instanceof l&&0===t.uncompressedSize||u.dir||!t||0===t.length)&&(u.base64=!1,u.binary=!0,t="",u.compression="STORE",o="string");var m=null;m=t instanceof l||t instanceof a?t:d.isNode&&d.isStream(t)?new h(e,t):i.prepareContent(e,t,u.binary,u.optimizedBinaryString,u.base64);var b=new c(e,m,u);this.files[e]=b},g=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},p=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},v=function(e,t){return t=void 0!==t?t:s.createFolders,e=p(e),this.files[e]||f.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function m(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var b={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,n;for(t in this.files)this.files.hasOwnProperty(t)&&(n=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,n))},filter:function(e){var t=[];return this.forEach((function(r,n){e(r,n)&&t.push(n)})),t},file:function(e,t,r){if(1===arguments.length){if(m(e)){var n=e;return this.filter((function(e,t){return!t.dir&&n.test(e)}))}var i=this.files[this.root+e];return i&&!i.dir?i:null}return(e=this.root+e,f.call(this,e,t,r),this)},folder:function(e){if(!e)return this;if(m(e))return this.filter((function(t,r){return r.dir&&e.test(t)}));var t=this.root+e,r=v.call(this,t),n=this.clone();return n.root=r.name,n},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter((function(t,r){return r.name.slice(0,e.length)===e})),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if((r=i.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");i.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var s=r.comment||this.comment||"";t=u.generateWorker(this,r,s)}catch(e){(t=new a("error")).error(e)}return new o(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};e.exports=b},function(e,t,r){"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=c(e),o=n[0],s=n[1],l=new a(function(e,t,r){return 3*(t+r)/4-r}(0,o,s)),u=0,d=s>0?o-4:o;for(r=0;r<d;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;2===s&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,l[u++]=255&t);1===s&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t);return l},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],o=0,s=r-i;o<s;o+=16383)a.push(u(e,o,o+16383>s?s:o+16383));1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return a.join("")};for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,r){for(var i,a,o=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,c=l>>1,u=-7,d=r?i-1:0,h=r?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-u)-1,f>>=-u,u+=s;u>0;a=256*a+e[t+d],d+=h,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=n;u>0;o=256*o+e[t+d],d+=h,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=c}return(f?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,l,c=8*a-i-1,u=(1<<c)-1,d=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,g=n?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=u?(s=0,o=u):o+d>=1?(s=(t*l-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&s,f+=g,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[r+f]=255&o,f+=g,o/=256,c-=8);e[r+f-g]|=128*p}},function(e,t,r){e.exports=i;var n=r(19).EventEmitter;function i(){n.call(this)}r(9)(i,n),i.Readable=r(20),i.Writable=r(66),i.Duplex=r(67),i.Transform=r(68),i.PassThrough=r(69),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function a(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(r.on("end",s),r.on("close",l));var o=!1;function s(){o||(o=!0,e.end())}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===n.listenerCount(this,"error"))throw e}function u(){r.removeListener("data",i),e.removeListener("drain",a),r.removeListener("end",s),r.removeListener("close",l),r.removeListener("error",c),e.removeListener("error",c),r.removeListener("end",u),r.removeListener("close",u),e.removeListener("close",u)}return r.on("error",c),e.on("error",c),r.on("end",u),r.on("close",u),e.on("close",u),e.emit("pipe",r),e}},function(e,t){},function(e,t,r){"use strict";var n=r(17).Buffer,i=r(62);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i,a=n.allocUnsafe(e>>>0),o=this.head,s=0;o;)t=o.data,r=a,i=s,t.copy(r,i),s+=o.data.length,o=o.next;return a},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,i,a,o,s,l=1,c={},u=!1,d=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick((function(){g(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){g(e.data)},n=function(e){a.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(i=d.documentElement,n=function(e){var t=d.createElement("script");t.onreadystatechange=function(){g(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):n=function(e){setTimeout(g,0,e)}:(o="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&g(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),n=function(t){e.postMessage(o+t,"*")}),h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return c[l]=i,n(l),l++},h.clearImmediate=f}function f(e){delete c[e]}function g(e){if(u)setTimeout(g,0,e);else{var t=c[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(r,n)}}(t)}finally{f(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r(6),r(15))},function(e,t,r){(function(t){function r(e){try{if(!t.localStorage)return!1}catch(e){return!1}var r=t.localStorage[e];return null!=r&&"true"===String(r).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,r(6))},function(e,t,r){"use strict";e.exports=a;var n=r(33),i=r(12);function a(e){if(!(this instanceof a))return new a(e);n.call(this,e)}i.inherits=r(9),i.inherits(a,n),a.prototype._transform=function(e,t,r){r(null,e)}},function(e,t,r){e.exports=r(21)},function(e,t,r){e.exports=r(7)},function(e,t,r){e.exports=r(20).Transform},function(e,t,r){e.exports=r(20).PassThrough},function(e,t,r){"use strict";(function(t){e.exports="function"==typeof t?t:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}}).call(this,r(31).setImmediate)},function(e,t,r){"use strict";var n=r(72);function i(){}var a={},o=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function u(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function d(e,t,r){n((function(){var n;try{n=t(r)}catch(t){return a.reject(e,t)}n===e?a.reject(e,new TypeError("Cannot resolve promise with itself")):a.resolve(e,n)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var r=!1;function n(t){r||(r=!0,a.reject(e,t))}function i(t){r||(r=!0,a.resolve(e,t))}var o=g((function(){t(i,n)}));"error"===o.status&&n(o.value)}function g(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}e.exports=c,c.prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){throw r}))}))},c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===o)return this;var r=new this.constructor(i);this.state!==l?d(r,this.state===s?e:t,this.outcome):this.queue.push(new u(r,e,t));return r},u.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){a.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},a.resolve=function(e,t){var r=g(h,t);if("error"===r.status)return a.reject(e,r.value);var n=r.value;if(n)f(e,n);else{e.state=s,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},a.reject=function(e,t){e.state=o,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},c.resolve=function(e){if(e instanceof this)return e;return a.resolve(new this(i),e)},c.reject=function(e){var t=new this(i);return a.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);var o=new Array(r),s=0,l=-1,c=new this(i);for(;++l<r;)u(e[l],l);return c;function u(e,i){t.resolve(e).then((function(e){o[i]=e,++s!==r||n||(n=!0,a.resolve(c,o))}),(function(e){n||(n=!0,a.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);var o=-1,s=new this(i);for(;++o<r;)l=e[o],t.resolve(l).then((function(e){n||(n=!0,a.resolve(s,e))}),(function(e){n||(n=!0,a.reject(s,e))}));var l;return s}},function(e,t,r){"use strict";(function(t){var r,n,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var a=0,o=new i(u),s=t.document.createTextNode("");o.observe(s,{characterData:!0}),r=function(){s.data=a=++a%2}}else if(t.setImmediate||void 0===t.MessageChannel)r="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new t.MessageChannel;l.port1.onmessage=u,r=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;n=!0;for(var r=c.length;r;){for(t=c,c=[],e=-1;++e<r;)t[e]();r=c.length}n=!1}e.exports=function(e){1!==c.push(e)||n||r()}}).call(this,r(6))},function(e,t,r){"use strict";var n=r(3),i=r(1);function a(e){n.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(a,n),a.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},e.exports=a},function(e,t,r){"use strict";var n=r(27).Readable;function i(e,t,r){n.call(this,t),this._helper=e;var i=this;e.on("data",(function(e,t){i.push(e)||i._helper.pause(),r&&r(t)})).on("error",(function(e){i.emit("error",e)})).on("end",(function(){i.push(null)}))}r(1).inherits(i,n),i.prototype._read=function(){this._helper.resume()},e.exports=i},function(e,t,r){"use strict";var n=r(35),i=r(37),a=r(8),o=r(22),s=r(3),l=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}};l.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");var i="string"===(r=e.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),t=this._decompressWorker();var o=!this._dataBinary;o&&!i&&(t=t.pipe(new a.Utf8EncodeWorker)),!o&&i&&(t=t.pipe(new a.Utf8DecodeWorker))}catch(e){(t=new s("error")).error(e)}return new n(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof s?this._data:new i(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<c.length;d++)l.prototype[c[d]]=u;e.exports=l},function(e,t,r){"use strict";var n=r(40),i=r(87);t.generateWorker=function(e,t,r){var a=new i(t.streamFiles,r,t.platform,t.encodeFileName),o=0;try{e.forEach((function(e,r){o++;var i=function(e,t){var r=e||t,i=n[r];if(!i)throw new Error(r+" is not a valid compression method !");return i}(r.options.compression,t.compression),s=r.options.compressionOptions||t.compressionOptions||{},l=r.dir,c=r.date;r._compressWorker(i,s).withStreamInfo("file",{name:e,dir:l,date:c,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(a)})),a.entriesCount=o}catch(e){a.error(e)}return a}},function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=r(78),a=r(1),o=r(3),s=n?"uint8array":"array";function l(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}t.magic="\b\0",a.inherits(l,o),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(s,e.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},t.compressWorker=function(e){return new l("Deflate",e)},t.uncompressWorker=function(){return new l("Inflate",{})}},function(e,t,r){"use strict";var n={};(0,r(5).assign)(n,r(79),r(82),r(45)),e.exports=n},function(e,t,r){"use strict";var n=r(80),i=r(5),a=r(43),o=r(24),s=r(44),l=Object.prototype.toString,c=0,u=-1,d=0,h=8;function f(e){if(!(this instanceof f))return new f(e);this.options=i.assign({level:u,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==c)throw new Error(o[r]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var g;if(g="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=n.deflateSetDictionary(this.strm,g))!==c)throw new Error(o[r]);this._dict_set=!0}}function g(e,t){var r=new f(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}f.prototype.push=function(e,t){var r,o,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=a.string2buf(e):"[object ArrayBuffer]"===l.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(u),s.next_out=0,s.avail_out=u),1!==(r=n.deflate(s,o))&&r!==c)return this.onEnd(r),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(a.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4===o?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c):2!==o||(this.onEnd(c),s.avail_out=0,!0)},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=f,t.deflate=g,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,g(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,g(e,t)}},function(e,t,r){"use strict";var n,i=r(5),a=r(81),o=r(41),s=r(42),l=r(24),c=0,u=1,d=3,h=4,f=5,g=0,p=1,v=-2,m=-3,b=-5,y=-1,k=1,w=2,x=3,S=4,_=0,C=2,O=8,j=9,A=15,P=8,T=286,N=30,E=19,B=2*T+1,I=15,M=3,D=258,R=D+M+1,q=32,L=42,F=69,z=73,H=91,U=103,W=113,V=666,G=1,K=2,Z=3,X=4,Y=3;function J(e,t){return e.msg=l[t],t}function $(e){return(e<<1)-(e>4?9:0)}function Q(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function te(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function re(e,t){e.pending_buf[e.pending++]=t}function ne(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ie(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-R?e.strstart-(e.w_size-R):0,c=e.window,u=e.w_mask,d=e.prev,h=e.strstart+D,f=c[a+o-1],g=c[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(r=t)+o]===g&&c[r+o-1]===f&&c[r]===c[a]&&c[++r]===c[a+1]){a+=2,r++;do{}while(c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&a<h);if(n=D-(h-a),a=h-D,n>o){if(e.match_start=t,o=n,n>=s)break;f=c[a+o-1],g=c[a+o]}}}while((t=d[t&u])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function ae(e){var t,r,n,a,l,c,u,d,h,f,g=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-R)){i.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=g?n-g:0}while(--r);t=r=g;do{n=e.prev[--t],e.prev[t]=n>=g?n-g:0}while(--r);a+=g}if(0===e.strm.avail_in)break;if(c=e.strm,u=e.window,d=e.strstart+e.lookahead,h=a,f=void 0,(f=c.avail_in)>h&&(f=h),r=0===f?0:(c.avail_in-=f,i.arraySet(u,c.input,c.next_in,f,d),1===c.state.wrap?c.adler=o(c.adler,u,f,d):2===c.state.wrap&&(c.adler=s(c.adler,u,f,d)),c.next_in+=f,c.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=M)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+M-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<M)););}while(e.lookahead<R&&0!==e.strm.avail_in)}function oe(e,t){for(var r,n;;){if(e.lookahead<R){if(ae(e),e.lookahead<R&&t===c)return G;if(0===e.lookahead)break}if(r=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-R&&(e.match_length=ie(e,r)),e.match_length>=M)if(n=a._tr_tally(e,e.strstart-e.match_start,e.match_length-M),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=M){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(te(e,!1),0===e.strm.avail_out))return G}return e.insert=e.strstart<M-1?e.strstart:M-1,t===h?(te(e,!0),0===e.strm.avail_out?Z:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?G:K}function se(e,t){for(var r,n,i;;){if(e.lookahead<R){if(ae(e),e.lookahead<R&&t===c)return G;if(0===e.lookahead)break}if(r=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=M-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-R&&(e.match_length=ie(e,r),e.match_length<=5&&(e.strategy===k||e.match_length===M&&e.strstart-e.match_start>4096)&&(e.match_length=M-1)),e.prev_length>=M&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-M,n=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-M),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=M-1,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return G}else if(e.match_available){if((n=a._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return G}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<M-1?e.strstart:M-1,t===h?(te(e,!0),0===e.strm.avail_out?Z:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?G:K}function le(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function ce(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=O,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*B),this.dyn_dtree=new i.Buf16(2*(2*N+1)),this.bl_tree=new i.Buf16(2*(2*E+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(I+1),this.heap=new i.Buf16(2*T+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*T+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ue(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=C,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?L:W,e.adler=2===t.wrap?0:1,t.last_flush=c,a._tr_init(t),g):J(e,v)}function de(e){var t,r=ue(e);return r===g&&((t=e.state).window_size=2*t.w_size,Q(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=M-1,t.match_available=0,t.ins_h=0),r}function he(e,t,r,n,a,o){if(!e)return v;var s=1;if(t===y&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>j||r!==O||n<8||n>15||t<0||t>9||o<0||o>S)return J(e,v);8===n&&(n=9);var l=new ce;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+M-1)/M),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,de(e)}n=[new le(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ae(e),0===e.lookahead&&t===c)return G;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,te(e,!1),0===e.strm.avail_out))return G;if(e.strstart-e.block_start>=e.w_size-R&&(te(e,!1),0===e.strm.avail_out))return G}return e.insert=0,t===h?(te(e,!0),0===e.strm.avail_out?Z:X):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),G)})),new le(4,4,8,4,oe),new le(4,5,16,8,oe),new le(4,6,32,32,oe),new le(4,4,16,16,se),new le(8,16,32,32,se),new le(8,16,128,128,se),new le(8,32,128,256,se),new le(32,128,258,1024,se),new le(32,258,258,4096,se)],t.deflateInit=function(e,t){return he(e,t,O,A,P,_)},t.deflateInit2=he,t.deflateReset=de,t.deflateResetKeep=ue,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?v:(e.state.gzhead=t,g):v},t.deflate=function(e,t){var r,i,o,l;if(!e||!e.state||t>f||t<0)return e?J(e,v):v;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===V&&t!==h)return J(e,0===e.avail_out?b:v);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===L)if(2===i.wrap)e.adler=0,re(i,31),re(i,139),re(i,8),i.gzhead?(re(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),re(i,255&i.gzhead.time),re(i,i.gzhead.time>>8&255),re(i,i.gzhead.time>>16&255),re(i,i.gzhead.time>>24&255),re(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),re(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(re(i,255&i.gzhead.extra.length),re(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=F):(re(i,0),re(i,0),re(i,0),re(i,0),re(i,0),re(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),re(i,Y),i.status=W);else{var m=O+(i.w_bits-8<<4)<<8;m|=(i.strategy>=w||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(m|=q),m+=31-m%31,i.status=W,ne(i,m),0!==i.strstart&&(ne(i,e.adler>>>16),ne(i,65535&e.adler)),e.adler=1}if(i.status===F)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending!==i.pending_buf_size));)re(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=z)}else i.status=z;if(i.status===z)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,re(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=H)}else i.status=H;if(i.status===H)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,re(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=U)}else i.status=U;if(i.status===U&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ee(e),i.pending+2<=i.pending_buf_size&&(re(i,255&e.adler),re(i,e.adler>>8&255),e.adler=0,i.status=W)):i.status=W),0!==i.pending){if(ee(e),0===e.avail_out)return i.last_flush=-1,g}else if(0===e.avail_in&&$(t)<=$(r)&&t!==h)return J(e,b);if(i.status===V&&0!==e.avail_in)return J(e,b);if(0!==e.avail_in||0!==i.lookahead||t!==c&&i.status!==V){var y=i.strategy===w?function(e,t){for(var r;;){if(0===e.lookahead&&(ae(e),0===e.lookahead)){if(t===c)return G;break}if(e.match_length=0,r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return G}return e.insert=0,t===h?(te(e,!0),0===e.strm.avail_out?Z:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?G:K}(i,t):i.strategy===x?function(e,t){for(var r,n,i,o,s=e.window;;){if(e.lookahead<=D){if(ae(e),e.lookahead<=D&&t===c)return G;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=M&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){o=e.strstart+D;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);e.match_length=D-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=M?(r=a._tr_tally(e,1,e.match_length-M),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(te(e,!1),0===e.strm.avail_out))return G}return e.insert=0,t===h?(te(e,!0),0===e.strm.avail_out?Z:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?G:K}(i,t):n[i.level].func(i,t);if(y!==Z&&y!==X||(i.status=V),y===G||y===Z)return 0===e.avail_out&&(i.last_flush=-1),g;if(y===K&&(t===u?a._tr_align(i):t!==f&&(a._tr_stored_block(i,0,0,!1),t===d&&(Q(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ee(e),0===e.avail_out))return i.last_flush=-1,g}return t!==h?g:i.wrap<=0?p:(2===i.wrap?(re(i,255&e.adler),re(i,e.adler>>8&255),re(i,e.adler>>16&255),re(i,e.adler>>24&255),re(i,255&e.total_in),re(i,e.total_in>>8&255),re(i,e.total_in>>16&255),re(i,e.total_in>>24&255)):(ne(i,e.adler>>>16),ne(i,65535&e.adler)),ee(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?g:p)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==L&&t!==F&&t!==z&&t!==H&&t!==U&&t!==W&&t!==V?J(e,v):(e.state=null,t===W?J(e,m):g):v},t.deflateSetDictionary=function(e,t){var r,n,a,s,l,c,u,d,h=t.length;if(!e||!e.state)return v;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==L||r.lookahead)return v;for(1===s&&(e.adler=o(e.adler,t,h,0)),r.wrap=0,h>=r.w_size&&(0===s&&(Q(r.head),r.strstart=0,r.block_start=0,r.insert=0),d=new i.Buf8(r.w_size),i.arraySet(d,t,h-r.w_size,r.w_size,0),t=d,h=r.w_size),l=e.avail_in,c=e.next_in,u=e.input,e.avail_in=h,e.next_in=0,e.input=t,ae(r);r.lookahead>=M;){n=r.strstart,a=r.lookahead-(M-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+M-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--a);r.strstart=n,r.lookahead=M-1,ae(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=M-1,r.match_available=0,e.next_in=c,e.input=u,e.avail_in=l,r.wrap=s,g},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,r){"use strict";var n=r(5),i=4,a=0,o=1,s=2;function l(e){for(var t=e.length;--t>=0;)e[t]=0}var c=0,u=1,d=2,h=29,f=256,g=f+1+h,p=30,v=19,m=2*g+1,b=15,y=16,k=7,w=256,x=16,S=17,_=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],O=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],P=new Array(2*(g+2));l(P);var T=new Array(2*p);l(T);var N=new Array(512);l(N);var E=new Array(256);l(E);var B=new Array(h);l(B);var I,M,D,R=new Array(p);function q(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function L(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function F(e){return e<256?N[e]:N[256+(e>>>7)]}function z(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function H(e,t,r){e.bi_valid>y-r?(e.bi_buf|=t<<e.bi_valid&65535,z(e,e.bi_buf),e.bi_buf=t>>y-e.bi_valid,e.bi_valid+=r-y):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function U(e,t,r){H(e,r[2*t],r[2*t+1])}function W(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function V(e,t,r){var n,i,a=new Array(b+1),o=0;for(n=1;n<=b;n++)a[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=W(a[s]++,s))}}function G(e){var t;for(t=0;t<g;t++)e.dyn_ltree[2*t]=0;for(t=0;t<p;t++)e.dyn_dtree[2*t]=0;for(t=0;t<v;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*w]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function K(e){e.bi_valid>8?z(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Z(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function X(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&Z(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Z(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function Y(e,t,r){var n,i,a,o,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===n?U(e,i,t):(U(e,(a=E[i])+f+1,t),0!==(o=C[a])&&H(e,i-=B[a],o),U(e,a=F(--n),r),0!==(o=O[a])&&H(e,n-=R[a],o))}while(s<e.last_lit);U(e,w,t)}function J(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=m,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)X(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],X(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,X(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,g=t.stat_desc.max_length,p=0;for(a=0;a<=b;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<m;r++)(a=l[2*l[2*(n=e.heap[r])+1]+1]+1)>g&&(a=g,p++),l[2*n+1]=a,n>c||(e.bl_count[a]++,o=0,n>=f&&(o=h[n-f]),s=l[2*n],e.opt_len+=s*(a+o),d&&(e.static_len+=s*(u[2*n+1]+o)));if(0!==p){do{for(a=g-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[g]--,p-=2}while(p>0);for(a=g;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>c||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}(e,t),V(a,c,e.bl_count)}function $(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++s<l&&i===o||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*x]++):s<=10?e.bl_tree[2*S]++:e.bl_tree[2*_]++,s=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4))}function Q(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++s<l&&i===o)){if(s<c)do{U(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(U(e,i,e.bl_tree),s--),U(e,x,e.bl_tree),H(e,s-3,2)):s<=10?(U(e,S,e.bl_tree),H(e,s-3,3)):(U(e,_,e.bl_tree),H(e,s-11,7));s=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4)}}l(R);var ee=!1;function te(e,t,r,i){H(e,(c<<1)+(i?1:0),3),function(e,t,r,i){K(e),i&&(z(e,r),z(e,~r)),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}t._tr_init=function(e){ee||(!function(){var e,t,r,n,i,a=new Array(b+1);for(r=0,n=0;n<h-1;n++)for(B[n]=r,e=0;e<1<<C[n];e++)E[r++]=n;for(E[r-1]=n,i=0,n=0;n<16;n++)for(R[n]=i,e=0;e<1<<O[n];e++)N[i++]=n;for(i>>=7;n<p;n++)for(R[n]=i<<7,e=0;e<1<<O[n]-7;e++)N[256+i++]=n;for(t=0;t<=b;t++)a[t]=0;for(e=0;e<=143;)P[2*e+1]=8,e++,a[8]++;for(;e<=255;)P[2*e+1]=9,e++,a[9]++;for(;e<=279;)P[2*e+1]=7,e++,a[7]++;for(;e<=287;)P[2*e+1]=8,e++,a[8]++;for(V(P,g+1,a),e=0;e<p;e++)T[2*e+1]=5,T[2*e]=W(e,5);I=new q(P,C,f+1,g,b),M=new q(T,O,0,p,b),D=new q(new Array(0),j,0,v,k)}(),ee=!0),e.l_desc=new L(e.dyn_ltree,I),e.d_desc=new L(e.dyn_dtree,M),e.bl_desc=new L(e.bl_tree,D),e.bi_buf=0,e.bi_valid=0,G(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,r,n){var l,c,h=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return a;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<f;t++)if(0!==e.dyn_ltree[2*t])return o;return a}(e)),J(e,e.l_desc),J(e,e.d_desc),h=function(e){var t;for($(e,e.dyn_ltree,e.l_desc.max_code),$(e,e.dyn_dtree,e.d_desc.max_code),J(e,e.bl_desc),t=v-1;t>=3&&0===e.bl_tree[2*A[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),l=e.opt_len+3+7>>>3,(c=e.static_len+3+7>>>3)<=l&&(l=c)):l=c=r+5,r+4<=l&&-1!==t?te(e,t,r,n):e.strategy===i||c===l?(H(e,(u<<1)+(n?1:0),3),Y(e,P,T)):(H(e,(d<<1)+(n?1:0),3),function(e,t,r,n){var i;for(H(e,t-257,5),H(e,r-1,5),H(e,n-4,4),i=0;i<n;i++)H(e,e.bl_tree[2*A[i]+1],3);Q(e,e.dyn_ltree,t-1),Q(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),Y(e,e.dyn_ltree,e.dyn_dtree)),G(e),n&&K(e)},t._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(E[r]+f+1)]++,e.dyn_dtree[2*F(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){H(e,u<<1,3),U(e,w,P),function(e){16===e.bi_valid?(z(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,r){"use strict";var n=r(83),i=r(5),a=r(43),o=r(45),s=r(24),l=r(44),c=r(86),u=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==o.Z_OK)throw new Error(s[r]);if(this.header=new c,n.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=a.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=n.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(s[r])}function h(e,t){var r=new d(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}d.prototype.push=function(e,t){var r,s,l,c,d,h=this.strm,f=this.options.chunkSize,g=this.options.dictionary,p=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?h.input=a.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new i.Buf8(f),h.next_out=0,h.avail_out=f),(r=n.inflate(h,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&g&&(r=n.inflateSetDictionary(this.strm,g)),r===o.Z_BUF_ERROR&&!0===p&&(r=o.Z_OK,p=!1),r!==o.Z_STREAM_END&&r!==o.Z_OK)return this.onEnd(r),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&r!==o.Z_STREAM_END&&(0!==h.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(h.output,h.next_out),c=h.next_out-l,d=a.buf2string(h.output,l),h.next_out=c,h.avail_out=f-c,c&&i.arraySet(h.output,h.output,l,c,0),this.onData(d)):this.onData(i.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(p=!0)}while((h.avail_in>0||0===h.avail_out)&&r!==o.Z_STREAM_END);return r===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),h.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=d,t.inflate=h,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},t.ungzip=h},function(e,t,r){"use strict";var n=r(5),i=r(41),a=r(42),o=r(84),s=r(85),l=0,c=1,u=2,d=4,h=5,f=6,g=0,p=1,v=2,m=-2,b=-3,y=-4,k=-5,w=8,x=1,S=2,_=3,C=4,O=5,j=6,A=7,P=8,T=9,N=10,E=11,B=12,I=13,M=14,D=15,R=16,q=17,L=18,F=19,z=20,H=21,U=22,W=23,V=24,G=25,K=26,Z=27,X=28,Y=29,J=30,$=31,Q=32,ee=852,te=592,re=15;function ne(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ae(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=x,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(ee),t.distcode=t.distdyn=new n.Buf32(te),t.sane=1,t.back=-1,g):m}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ae(e)):m}function se(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?m:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,oe(e))):m}function le(e,t){var r,n;return e?(n=new ie,e.state=n,n.window=null,(r=se(e,t))!==g&&(e.state=null),r):m}var ce,ue,de=!0;function he(e){if(de){var t;for(ce=new n.Buf32(512),ue=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(c,e.lens,0,288,ce,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(u,e.lens,0,32,ue,0,e.work,{bits:5}),de=!1}e.lencode=ce,e.lenbits=9,e.distcode=ue,e.distbits=5}function fe(e,t,r,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),i>=o.wsize?(n.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),n.arraySet(o.window,t,r-i,a,o.wnext),(i-=a)?(n.arraySet(o.window,t,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=oe,t.inflateReset2=se,t.inflateResetKeep=ae,t.inflateInit=function(e){return le(e,re)},t.inflateInit2=le,t.inflate=function(e,t){var r,ee,te,re,ie,ae,oe,se,le,ce,ue,de,ge,pe,ve,me,be,ye,ke,we,xe,Se,_e,Ce,Oe=0,je=new n.Buf8(4),Ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return m;(r=e.state).mode===B&&(r.mode=I),ie=e.next_out,te=e.output,oe=e.avail_out,re=e.next_in,ee=e.input,ae=e.avail_in,se=r.hold,le=r.bits,ce=ae,ue=oe,Se=g;e:for(;;)switch(r.mode){case x:if(0===r.wrap){r.mode=I;break}for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(2&r.wrap&&35615===se){r.check=0,je[0]=255&se,je[1]=se>>>8&255,r.check=a(r.check,je,2,0),se=0,le=0,r.mode=S;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",r.mode=J;break}if((15&se)!==w){e.msg="unknown compression method",r.mode=J;break}if(le-=4,xe=8+(15&(se>>>=4)),0===r.wbits)r.wbits=xe;else if(xe>r.wbits){e.msg="invalid window size",r.mode=J;break}r.dmax=1<<xe,e.adler=r.check=1,r.mode=512&se?N:B,se=0,le=0;break;case S:for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(r.flags=se,(255&r.flags)!==w){e.msg="unknown compression method",r.mode=J;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=J;break}r.head&&(r.head.text=se>>8&1),512&r.flags&&(je[0]=255&se,je[1]=se>>>8&255,r.check=a(r.check,je,2,0)),se=0,le=0,r.mode=_;case _:for(;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.head&&(r.head.time=se),512&r.flags&&(je[0]=255&se,je[1]=se>>>8&255,je[2]=se>>>16&255,je[3]=se>>>24&255,r.check=a(r.check,je,4,0)),se=0,le=0,r.mode=C;case C:for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.head&&(r.head.xflags=255&se,r.head.os=se>>8),512&r.flags&&(je[0]=255&se,je[1]=se>>>8&255,r.check=a(r.check,je,2,0)),se=0,le=0,r.mode=O;case O:if(1024&r.flags){for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.length=se,r.head&&(r.head.extra_len=se),512&r.flags&&(je[0]=255&se,je[1]=se>>>8&255,r.check=a(r.check,je,2,0)),se=0,le=0}else r.head&&(r.head.extra=null);r.mode=j;case j:if(1024&r.flags&&((de=r.length)>ae&&(de=ae),de&&(r.head&&(xe=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,ee,re,de,xe)),512&r.flags&&(r.check=a(r.check,ee,de,re)),ae-=de,re+=de,r.length-=de),r.length))break e;r.length=0,r.mode=A;case A:if(2048&r.flags){if(0===ae)break e;de=0;do{xe=ee[re+de++],r.head&&xe&&r.length<65536&&(r.head.name+=String.fromCharCode(xe))}while(xe&&de<ae);if(512&r.flags&&(r.check=a(r.check,ee,de,re)),ae-=de,re+=de,xe)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=P;case P:if(4096&r.flags){if(0===ae)break e;de=0;do{xe=ee[re+de++],r.head&&xe&&r.length<65536&&(r.head.comment+=String.fromCharCode(xe))}while(xe&&de<ae);if(512&r.flags&&(r.check=a(r.check,ee,de,re)),ae-=de,re+=de,xe)break e}else r.head&&(r.head.comment=null);r.mode=T;case T:if(512&r.flags){for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(se!==(65535&r.check)){e.msg="header crc mismatch",r.mode=J;break}se=0,le=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=B;break;case N:for(;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}e.adler=r.check=ne(se),se=0,le=0,r.mode=E;case E:if(0===r.havedict)return e.next_out=ie,e.avail_out=oe,e.next_in=re,e.avail_in=ae,r.hold=se,r.bits=le,v;e.adler=r.check=1,r.mode=B;case B:if(t===h||t===f)break e;case I:if(r.last){se>>>=7&le,le-=7&le,r.mode=Z;break}for(;le<3;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}switch(r.last=1&se,le-=1,3&(se>>>=1)){case 0:r.mode=M;break;case 1:if(he(r),r.mode=z,t===f){se>>>=2,le-=2;break e}break;case 2:r.mode=q;break;case 3:e.msg="invalid block type",r.mode=J}se>>>=2,le-=2;break;case M:for(se>>>=7&le,le-=7&le;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",r.mode=J;break}if(r.length=65535&se,se=0,le=0,r.mode=D,t===f)break e;case D:r.mode=R;case R:if(de=r.length){if(de>ae&&(de=ae),de>oe&&(de=oe),0===de)break e;n.arraySet(te,ee,re,de,ie),ae-=de,re+=de,oe-=de,ie+=de,r.length-=de;break}r.mode=B;break;case q:for(;le<14;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(r.nlen=257+(31&se),se>>>=5,le-=5,r.ndist=1+(31&se),se>>>=5,le-=5,r.ncode=4+(15&se),se>>>=4,le-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=J;break}r.have=0,r.mode=L;case L:for(;r.have<r.ncode;){for(;le<3;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.lens[Ae[r.have++]]=7&se,se>>>=3,le-=3}for(;r.have<19;)r.lens[Ae[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,_e={bits:r.lenbits},Se=s(l,r.lens,0,19,r.lencode,0,r.work,_e),r.lenbits=_e.bits,Se){e.msg="invalid code lengths set",r.mode=J;break}r.have=0,r.mode=F;case F:for(;r.have<r.nlen+r.ndist;){for(;me=(Oe=r.lencode[se&(1<<r.lenbits)-1])>>>16&255,be=65535&Oe,!((ve=Oe>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(be<16)se>>>=ve,le-=ve,r.lens[r.have++]=be;else{if(16===be){for(Ce=ve+2;le<Ce;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(se>>>=ve,le-=ve,0===r.have){e.msg="invalid bit length repeat",r.mode=J;break}xe=r.lens[r.have-1],de=3+(3&se),se>>>=2,le-=2}else if(17===be){for(Ce=ve+3;le<Ce;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}le-=ve,xe=0,de=3+(7&(se>>>=ve)),se>>>=3,le-=3}else{for(Ce=ve+7;le<Ce;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}le-=ve,xe=0,de=11+(127&(se>>>=ve)),se>>>=7,le-=7}if(r.have+de>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=J;break}for(;de--;)r.lens[r.have++]=xe}}if(r.mode===J)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=J;break}if(r.lenbits=9,_e={bits:r.lenbits},Se=s(c,r.lens,0,r.nlen,r.lencode,0,r.work,_e),r.lenbits=_e.bits,Se){e.msg="invalid literal/lengths set",r.mode=J;break}if(r.distbits=6,r.distcode=r.distdyn,_e={bits:r.distbits},Se=s(u,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,_e),r.distbits=_e.bits,Se){e.msg="invalid distances set",r.mode=J;break}if(r.mode=z,t===f)break e;case z:r.mode=H;case H:if(ae>=6&&oe>=258){e.next_out=ie,e.avail_out=oe,e.next_in=re,e.avail_in=ae,r.hold=se,r.bits=le,o(e,ue),ie=e.next_out,te=e.output,oe=e.avail_out,re=e.next_in,ee=e.input,ae=e.avail_in,se=r.hold,le=r.bits,r.mode===B&&(r.back=-1);break}for(r.back=0;me=(Oe=r.lencode[se&(1<<r.lenbits)-1])>>>16&255,be=65535&Oe,!((ve=Oe>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(me&&0==(240&me)){for(ye=ve,ke=me,we=be;me=(Oe=r.lencode[we+((se&(1<<ye+ke)-1)>>ye)])>>>16&255,be=65535&Oe,!(ye+(ve=Oe>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}se>>>=ye,le-=ye,r.back+=ye}if(se>>>=ve,le-=ve,r.back+=ve,r.length=be,0===me){r.mode=K;break}if(32&me){r.back=-1,r.mode=B;break}if(64&me){e.msg="invalid literal/length code",r.mode=J;break}r.extra=15&me,r.mode=U;case U:if(r.extra){for(Ce=r.extra;le<Ce;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.length+=se&(1<<r.extra)-1,se>>>=r.extra,le-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=W;case W:for(;me=(Oe=r.distcode[se&(1<<r.distbits)-1])>>>16&255,be=65535&Oe,!((ve=Oe>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(0==(240&me)){for(ye=ve,ke=me,we=be;me=(Oe=r.distcode[we+((se&(1<<ye+ke)-1)>>ye)])>>>16&255,be=65535&Oe,!(ye+(ve=Oe>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}se>>>=ye,le-=ye,r.back+=ye}if(se>>>=ve,le-=ve,r.back+=ve,64&me){e.msg="invalid distance code",r.mode=J;break}r.offset=be,r.extra=15&me,r.mode=V;case V:if(r.extra){for(Ce=r.extra;le<Ce;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.offset+=se&(1<<r.extra)-1,se>>>=r.extra,le-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=J;break}r.mode=G;case G:if(0===oe)break e;if(de=ue-oe,r.offset>de){if((de=r.offset-de)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=J;break}de>r.wnext?(de-=r.wnext,ge=r.wsize-de):ge=r.wnext-de,de>r.length&&(de=r.length),pe=r.window}else pe=te,ge=ie-r.offset,de=r.length;de>oe&&(de=oe),oe-=de,r.length-=de;do{te[ie++]=pe[ge++]}while(--de);0===r.length&&(r.mode=H);break;case K:if(0===oe)break e;te[ie++]=r.length,oe--,r.mode=H;break;case Z:if(r.wrap){for(;le<32;){if(0===ae)break e;ae--,se|=ee[re++]<<le,le+=8}if(ue-=oe,e.total_out+=ue,r.total+=ue,ue&&(e.adler=r.check=r.flags?a(r.check,te,ue,ie-ue):i(r.check,te,ue,ie-ue)),ue=oe,(r.flags?se:ne(se))!==r.check){e.msg="incorrect data check",r.mode=J;break}se=0,le=0}r.mode=X;case X:if(r.wrap&&r.flags){for(;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(se!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=J;break}se=0,le=0}r.mode=Y;case Y:Se=p;break e;case J:Se=b;break e;case $:return y;case Q:default:return m}return e.next_out=ie,e.avail_out=oe,e.next_in=re,e.avail_in=ae,r.hold=se,r.bits=le,(r.wsize||ue!==e.avail_out&&r.mode<J&&(r.mode<Z||t!==d))&&fe(e,e.output,e.next_out,ue-e.avail_out)?(r.mode=$,y):(ce-=e.avail_in,ue-=e.avail_out,e.total_in+=ce,e.total_out+=ue,r.total+=ue,r.wrap&&ue&&(e.adler=r.check=r.flags?a(r.check,te,ue,e.next_out-ue):i(r.check,te,ue,e.next_out-ue)),e.data_type=r.bits+(r.last?64:0)+(r.mode===B?128:0)+(r.mode===z||r.mode===D?256:0),(0===ce&&0===ue||t===d)&&Se===g&&(Se=k),Se)},t.inflateEnd=function(e){if(!e||!e.state)return m;var t=e.state;return t.window&&(t.window=null),e.state=null,g},t.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?m:(r.head=t,t.done=!1,g):m},t.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&r.mode!==E?m:r.mode===E&&i(1,t,n,0)!==r.check?b:fe(e,t,n,n)?(r.mode=$,y):(r.havedict=1,g):m},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,r){"use strict";e.exports=function(e,t){var r,n,i,a,o,s,l,c,u,d,h,f,g,p,v,m,b,y,k,w,x,S,_,C,O;r=e.state,n=e.next_in,C=e.input,i=n+(e.avail_in-5),a=e.next_out,O=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,c=r.wsize,u=r.whave,d=r.wnext,h=r.window,f=r.hold,g=r.bits,p=r.lencode,v=r.distcode,m=(1<<r.lenbits)-1,b=(1<<r.distbits)-1;e:do{g<15&&(f+=C[n++]<<g,g+=8,f+=C[n++]<<g,g+=8),y=p[f&m];t:for(;;){if(f>>>=k=y>>>24,g-=k,0===(k=y>>>16&255))O[a++]=65535&y;else{if(!(16&k)){if(0==(64&k)){y=p[(65535&y)+(f&(1<<k)-1)];continue t}if(32&k){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}w=65535&y,(k&=15)&&(g<k&&(f+=C[n++]<<g,g+=8),w+=f&(1<<k)-1,f>>>=k,g-=k),g<15&&(f+=C[n++]<<g,g+=8,f+=C[n++]<<g,g+=8),y=v[f&b];r:for(;;){if(f>>>=k=y>>>24,g-=k,!(16&(k=y>>>16&255))){if(0==(64&k)){y=v[(65535&y)+(f&(1<<k)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(x=65535&y,g<(k&=15)&&(f+=C[n++]<<g,(g+=8)<k&&(f+=C[n++]<<g,g+=8)),(x+=f&(1<<k)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=k,g-=k,x>(k=a-o)){if((k=x-k)>u&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(S=0,_=h,0===d){if(S+=c-k,k<w){w-=k;do{O[a++]=h[S++]}while(--k);S=a-x,_=O}}else if(d<k){if(S+=c+d-k,(k-=d)<w){w-=k;do{O[a++]=h[S++]}while(--k);if(S=0,d<w){w-=k=d;do{O[a++]=h[S++]}while(--k);S=a-x,_=O}}}else if(S+=d-k,k<w){w-=k;do{O[a++]=h[S++]}while(--k);S=a-x,_=O}for(;w>2;)O[a++]=_[S++],O[a++]=_[S++],O[a++]=_[S++],w-=3;w&&(O[a++]=_[S++],w>1&&(O[a++]=_[S++]))}else{S=a-x;do{O[a++]=O[S++],O[a++]=O[S++],O[a++]=O[S++],w-=3}while(w>2);w&&(O[a++]=O[S++],w>1&&(O[a++]=O[S++]))}break}}break}}while(n<i&&a<s);n-=w=g>>3,f&=(1<<(g-=w<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<s?s-a+257:257-(a-s),r.hold=f,r.bits=g}},function(e,t,r){"use strict";var n=r(5),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,r,l,c,u,d,h){var f,g,p,v,m,b,y,k,w,x=h.bits,S=0,_=0,C=0,O=0,j=0,A=0,P=0,T=0,N=0,E=0,B=null,I=0,M=new n.Buf16(16),D=new n.Buf16(16),R=null,q=0;for(S=0;S<=15;S++)M[S]=0;for(_=0;_<l;_++)M[t[r+_]]++;for(j=x,O=15;O>=1&&0===M[O];O--);if(j>O&&(j=O),0===O)return c[u++]=20971520,c[u++]=20971520,h.bits=1,0;for(C=1;C<O&&0===M[C];C++);for(j<C&&(j=C),T=1,S=1;S<=15;S++)if(T<<=1,(T-=M[S])<0)return-1;if(T>0&&(0===e||1!==O))return-1;for(D[1]=0,S=1;S<15;S++)D[S+1]=D[S]+M[S];for(_=0;_<l;_++)0!==t[r+_]&&(d[D[t[r+_]]++]=_);if(0===e?(B=R=d,b=19):1===e?(B=i,I-=257,R=a,q-=257,b=256):(B=o,R=s,b=-1),E=0,_=0,S=C,m=u,A=j,P=0,p=-1,v=(N=1<<j)-1,1===e&&N>852||2===e&&N>592)return 1;for(;;){y=S-P,d[_]<b?(k=0,w=d[_]):d[_]>b?(k=R[q+d[_]],w=B[I+d[_]]):(k=96,w=0),f=1<<S-P,C=g=1<<A;do{c[m+(E>>P)+(g-=f)]=y<<24|k<<16|w|0}while(0!==g);for(f=1<<S-1;E&f;)f>>=1;if(0!==f?(E&=f-1,E+=f):E=0,_++,0==--M[S]){if(S===O)break;S=t[r+d[_]]}if(S>j&&(E&v)!==p){for(0===P&&(P=j),m+=C,T=1<<(A=S-P);A+P<O&&!((T-=M[A+P])<=0);)A++,T<<=1;if(N+=1<<A,1===e&&N>852||2===e&&N>592)return 1;c[p=E&v]=j<<24|A<<16|m-u|0}}return 0!==E&&(c[m+E]=S-P<<24|64<<16|0),h.bits=j,0}},function(e,t,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,r){"use strict";var n=r(1),i=r(3),a=r(8),o=r(23),s=r(46),l=function(e,t){var r,n="";for(r=0;r<t;r++)n+=String.fromCharCode(255&e),e>>>=8;return n},c=function(e,t,r,i,c,u){var d,h,f=e.file,g=e.compression,p=u!==a.utf8encode,v=n.transformTo("string",u(f.name)),m=n.transformTo("string",a.utf8encode(f.name)),b=f.comment,y=n.transformTo("string",u(b)),k=n.transformTo("string",a.utf8encode(b)),w=m.length!==f.name.length,x=k.length!==b.length,S="",_="",C="",O=f.dir,j=f.date,A={crc32:0,compressedSize:0,uncompressedSize:0};t&&!r||(A.crc32=e.crc32,A.compressedSize=e.compressedSize,A.uncompressedSize=e.uncompressedSize);var P=0;t&&(P|=8),p||!w&&!x||(P|=2048);var T,N,E,B=0,I=0;O&&(B|=16),"UNIX"===c?(I=798,B|=(T=f.unixPermissions,N=O,E=T,T||(E=N?16893:33204),(65535&E)<<16)):(I=20,B|=63&(f.dosPermissions||0)),d=j.getUTCHours(),d<<=6,d|=j.getUTCMinutes(),d<<=5,d|=j.getUTCSeconds()/2,h=j.getUTCFullYear()-1980,h<<=4,h|=j.getUTCMonth()+1,h<<=5,h|=j.getUTCDate(),w&&(_=l(1,1)+l(o(v),4)+m,S+="up"+l(_.length,2)+_),x&&(C=l(1,1)+l(o(y),4)+k,S+="uc"+l(C.length,2)+C);var M="";return M+="\n\0",M+=l(P,2),M+=g.magic,M+=l(d,2),M+=l(h,2),M+=l(A.crc32,4),M+=l(A.compressedSize,4),M+=l(A.uncompressedSize,4),M+=l(v.length,2),M+=l(S.length,2),{fileRecord:s.LOCAL_FILE_HEADER+M+v+S,dirRecord:s.CENTRAL_FILE_HEADER+l(I,2)+M+l(y.length,2)+"\0\0\0\0"+l(B,4)+l(i,4)+v+S+y}},u=function(e){return s.DATA_DESCRIPTOR+l(e.crc32,4)+l(e.compressedSize,4)+l(e.uncompressedSize,4)};function d(e,t,r,n){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(d,i),d.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-n-1))/r:100}}))},d.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=c(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=c(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:u(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,i=function(e,t,r,i,a){var o=n.transformTo("string",a(i));return s.CENTRAL_DIRECTORY_END+"\0\0\0\0"+l(e,2)+l(e,2)+l(t,4)+l(r,4)+l(o.length,2)+o}(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},d.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(e){var t=this._sources;if(!i.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},d.prototype.lock=function(){i.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},e.exports=d},function(e,t,r){"use strict";var n=r(1),i=r(3);function a(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}n.inherits(a,i),a.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},a.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=a},function(e,t,r){"use strict";var n=r(1),i=r(13),a=r(8),o=(n=r(1),r(90)),s=r(39),l=r(18);function c(e){return new i.Promise((function(t,r){var n=e.decompressed.getContentWorker().pipe(new s);n.on("error",(function(e){r(e)})).on("end",(function(){n.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}e.exports=function(e,t){var r=this;return t=n.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var r=new o(t);return r.load(e),r})).then((function(e){var r=[i.Promise.resolve(e)],n=e.files;if(t.checkCRC32)for(var a=0;a<n.length;a++)r.push(c(n[a]));return i.Promise.all(r)})).then((function(e){for(var n=e.shift(),i=n.files,a=0;a<i.length;a++){var o=i[a];r.file(o.fileNameStr,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders})}return n.zipComment.length&&(r.comment=n.zipComment),r}))}},function(e,t,r){"use strict";var n=r(47),i=r(1),a=r(46),o=r(93),s=(r(8),r(4));function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var n=this.reader.readString(4)===t;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=s.uint8array?"uint8array":"array",r=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;0<n;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var n=t-r;if(n>0)this.isSignature(t,a.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(e){this.reader=n(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},function(e,t,r){"use strict";var n=r(49);function i(e){n.call(this,e)}r(1).inherits(i,n),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,r){"use strict";var n=r(50);function i(e){n.call(this,e)}r(1).inherits(i,n),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},e.exports=i},function(e,t,r){"use strict";var n=r(47),i=r(1),a=r(22),o=r(23),s=r(8),l=r(40),c=r(4);function u(e,t){this.options=e,this.loadOptions=t}u.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<i;)t=e.readInt(2),r=e.readInt(2),n=e.readData(r),this.extraFields[t]={id:t,length:r,value:n}},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var r=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var a=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:o(this.fileName)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:o(this.fileComment)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null}},e.exports=u},function(e,t,r){"use strict";r.r(t);r(53);var n=r(2),i=r.n(n);function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"determineLocaleFromBrowser",value:function(){}},{key:"includeLocales",value:function(e,t){}},{key:"localize",value:function(e,t){return""}},{key:"isSampleLocalizedKey",value:function(e){return"key_"==e.slice(0,"key_".length)}},{key:"currentLocale",get:function(){}}],(r=null)&&a(t.prototype,r),n&&a(t,n),e}(),s=r(0);function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=0,u=0,d=0,h=0,f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"render",value:function(t,r){for(var n in d=0,h=0,r)e.drawSection(r[n],t)}},{key:"drawSection",value:function(t,r){var n,i,a,o;switch(String(t[0]).toLowerCase()){case"m":e.absoluteMove(t[1],t[2]),r.moveTo(d,h),c=t[1],u=t[2];break;case"l":e.relativeMove(t[1],t[2]),r.lineTo(d,h);break;case"h":d+=t[1],r.lineTo(d,h);break;case"v":h+=t[1],r.lineTo(d,h);break;case"q":n=d+t[1],i=h+t[2],a=d+t[3],o=h+t[4],r.quadraticCurveTo(n,i,a,o),e.relativeMove(t[3],t[4]);break;case"c":n=d+t[1],i=h+t[2];var s=d+t[3],l=h+t[4];a=d+t[5],o=h+t[6],r.bezierCurveTo(n,i,s,l,a,o),e.relativeMove(t[5],t[6]);break;case"z":e.absoluteMove(c,u),r.lineTo(d,h)}}},{key:"absoluteMove",value:function(e,t){d=e,h=t}},{key:"relativeMove",value:function(e,t){d+=e,h+=t}}],(r=null)&&l(t.prototype,r),n&&l(t,n),e}();function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=void 0,v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"close",value:function(){p&&(p.parentNode.removeChild(p),p=void 0)}},{key:"open",value:function(t,r,n,i){p&&e.close();var a=s.H,o=80,l=Object(s.o)(r,r.offsetLeft)+r.offsetWidth/2-(o+14+4)*a/2,c=Object(s.p)(r,r.offsetTop)-24*a;c<5*a&&(c=5*a),(p=Object(s.z)(t,l,c,o,24,{position:"absolute",zIndex:2})).icon=r;var u=p.getContext("2d");(o=16+Object(s.n)(u,"bold 14px Verdana",n).width)<36&&(o=36),(l=Object(s.o)(r,r.offsetLeft)+r.offsetWidth/2-(o+14+4)*a/2)<5*a&&(l=5*a),l=Math.floor(l),Object(s.I)(p,o,36),Object(s.K)(p.style,{position:"absolute",left:l+"px",zIndex:1e3,webkitTransform:"translate("+-o/2+"px, "+-12+"px) scale("+a+", "+a+") translate("+o/2+"px, 12px) "}),e.draw(p.getContext("2d"),6,o,24,i),Object(s.L)(u,"bold 14px Verdana","white",n,20,8)}},{key:"draw",value:function(e,t,r,n,i){var a=new Array(["M",0,10],["q",0,-10,10,-10],["h",r-20],["q",10,0,10,10],["v",n-20],["q",0,10,-10,10],["h",-r/2+7+10],["l",-7,7],["l",-7,-7],["h",-r/2+7+10],["q",-10,0,-10,-10],["Z"]);e.clearRect(0,0,Math.max(e.canvas.width,r),Math.max(e.canvas.height,n)),e.fillStyle=i,e.beginPath(),f.render(e,a),e.fill()}},{key:"balloon",get:function(){return p}}],(r=null)&&g(t.prototype,r),n&&g(t,n),e}();function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.audio=new Audio,this.audio.src=t,this.audio.load(),this.playing=!1,this.initEvent()}var t,r,n;return t=e,(r=[{key:"initEvent",value:function(){var e=this;this.audio.addEventListener("canplay",(function(){e.time=e.audio.duration})),this.audio.addEventListener("ended",(function(){e.playing=!1}))}},{key:"play",value:function(){this.playing=!0,this.audio.play()}},{key:"done",value:function(){return!this.playing}},{key:"clear",value:function(){this.playing=!1}},{key:"stop",value:function(){this.audio.pause()}}])&&m(t.prototype,r),n&&m(t,n),e}();function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var k={},w={},x=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"sndFX",value:function(e){}},{key:"init",value:function(){e.addSound("pop.mp3","/static/scratchjr/pop.mp3",w)}},{key:"addSound",value:function(e,t,r,n){r[e]=new b(t),n&&n(e)}},{key:"soundDone",value:function(e){w[e]&&(w[e].playing=!1)}},{key:"loadProjectSound",value:function(t,r){t&&bn.files[t]&&e.addSound(t,bn.files[t],w,r)}},{key:"uiSounds",get:function(){return k}},{key:"projectSounds",get:function(){return w}}],(r=null)&&y(t.prototype,r),n&&y(t,n),e}();function S(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}window.ScratchAudio=x;var _,C=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"set",value:function(e,t){var r=new Date;r.setTime(r.getTime()+31536e6);var n="; expires="+r.toGMTString();document.cookie=e+"="+t+n+"; path=/"}},{key:"get",value:function(e){e+="=";for(var t=document.cookie.split(";"),r=0;r<t.length;r++){for(var n=t[r];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return null}}],(r=null)&&S(t.prototype,r),n&&S(t,n),e}();function O(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"initUsage",value:function(){var e=C.get("usage");_=e?e+"::":""}},{key:"askForUsage",value:function(){return null===C.get("usage")}},{key:"setUsage",value:function(e){""===e?C.set("usage","noanswer"):C.set("usage",e),_=""===e?"noanswer::":e+"::"}},{key:"currentUsage",get:function(){return _}}],(r=null)&&O(t.prototype,r),n&&O(t,n),e}();function A(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var P=void 0,T=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"openDropDown",value:function(t,r){var n="setspeed"==t.owner.blocktype?"orange":"yellow",i=JSON.parse(t.owner.arg.list),a=t.owner.arg.numperrow,o=t.parentNode,l=50*Math.round(i.length/a),c=i.length/a,u=50*i.length/c,d=u*s.H,h=t.left+(t.offsetWidth-d)/2;h+d>o.width&&(h-=h+d-o.width),h<5&&(h=5),h+=Object(s.o)(o,0);var f=t.top+t.offsetHeight-28*s.H+Object(s.p)(o,0);f+(10+l)*s.H>Object(s.j)()&&(f=Object(s.j)()-(15+l)*s.H);var g=Object(s.A)(s.h,h,f,u,l,{position:"absolute",zIndex:1e5,webkitTransform:"translate("+-u/2+"px,"+-l/2+"px) scale("+s.H+", "+s.H+") translate("+u/2+"px, "+l/2+"px)"});g.setAttribute("class","menustyle "+n),g.active=t;for(var p=0;p<i.length;p++)e.addImageToDropDown(g,i[p],t,r);P=g}},{key:"addImageToDropDown",value:function(t,r,n,i){var a=on.getImageFrom("/static/scratchjr/assets/blockicons/"+r,"svg"),o=Object(s.B)("div","ddchoice",t),l=Object(s.B)("canvas",void 0,o),c=42*window.devicePixelRatio;Object(s.I)(l,c,c),Object(s.K)(l.style,{webkitTransform:"translate("+-c/2+"px, "+-c/2+"px) scale("+1/window.devicePixelRatio+", "+1/window.devicePixelRatio+") translate("+c/2+"px, "+c/2+"px)"}),a.complete?Object(s.f)(a,l):a.onload=function(){Object(s.f)(a,l)},s.u?o.ontouchstart=function(e){var a;a=e,s.u&&a.touches&&a.touches.length>1||(a.preventDefault(),a.stopPropagation(),i(a,t,n,r))}:(o.onmouseover=function(t){e.highlightdot(t)},o.onmouseout=function(t){e.unhighlightdot(t)},o.onmousedown=function(e){i(e,t,n,r)})}},{key:"closeMyOpenMenu",value:function(){P&&(P.parentNode.removeChild(P),P=void 0)}},{key:"openMenu",get:function(){return P},set:function(e){P=e}}],(r=null)&&A(t.prototype,r),n&&A(t,n),e}();function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var E=!1,B=void 0,I=0,M=0,D=void 0,R=void 0,q=void 0,L=void 0,F=void 0,z=void 0,H=void 0,U=1,W=10,V={x:0,y:0,distance:0},G=1,K=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"init",value:function(){(q=document.createElement("div")).id="dragDiv",q.style.position="absolute",q.style.width="0px",q.style.height="0px",q.style.zIndex=7001,Object(s.q)("frame").appendChild(q)}},{key:"startDrag",value:function(t,r,n,i,a,o,l){E=!1;var c=e.getTargetPoint(t);I=c.x,M=c.y,B=r,L=n,F=i,H=o,l&&e.holdit(r,l),z=a,s.u?(W=10*s.H,window.ontouchmove=function(t){e.mouseMove(t)},window.ontouchend=function(t){e.mouseUp(t)},window.ontouchleave=function(t){e.mouseUp(t)},window.ontouchcancel=function(t){e.mouseUp(t)}):(W=7,window.onmousemove=function(t){e.mouseMove(t)},window.onmouseup=function(t){e.mouseUp(t)})}},{key:"holdit",value:function(t,r){D=setTimeout((function(){e.clearEvents(),r(B),e.clearDragAndDrop()}),500)}},{key:"clearDragAndDrop",value:function(){D=void 0,R=void 0,E=!1,B=void 0,L=void 0,F=void 0,z=void 0,H=void 0}},{key:"mouseMove",value:function(t){var r=e.getTargetPoint(t);!E&&e.distance(I-r.x,M-r.y)<W||(D&&clearTimeout(D),D=void 0,E||L(t),E=!0,z&&z(t,R),I=r.x,M=r.y)}},{key:"distance",value:function(e,t){return Math.round(Math.sqrt(e*e+t*t))}},{key:"mouseUp",value:function(t){D&&clearTimeout(D),D=void 0,e.clearEvents(),E?e.performMouseUpAction(t):e.itIsAClick(t),e.clearDragAndDrop()}},{key:"cancelAll",value:function(){D&&clearTimeout(D),D=void 0,e.clearEvents()}},{key:"clearEvents",value:function(){s.u?(window.ontouchmove=void 0,window.ontouchend=void 0):(window.onmousemove=function(e){e.preventDefault()},window.onmouseup=void 0)}},{key:"performMouseUpAction",value:function(e){F&&F(e,R)}},{key:"itIsAClick",value:function(e){H&&H(e,B)}},{key:"moveThumbnail",value:function(e,t,r){e&&(e.top+=r,e.left+=t,e.style.top=e.top+"px",e.style.left=e.left+"px")}},{key:"move3D",value:function(e,t,r){if(e){var n=new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform);e.top=r+n.m42,e.left=t+n.m41,e.style.webkitTransform="translate3d("+e.left+"px,"+e.top+"px, 0)"}}},{key:"getTargetPoint",value:function(e){if(s.u){if(e.touches&&e.touches.length>0)return{x:e.touches[0].pageX,y:e.touches[0].pageY};if(e.changedTouches)return{x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY}}return{x:e.clientX,y:e.clientY}}},{key:"updatePinchCenter",value:function(e){if(2==e.touches.length){var t=e.touches[0].clientX,r=e.touches[0].clientY,n=e.touches[1].clientX,i=e.touches[1].clientY,a=t+(n-t)/2,o=r+(i-r)/2,s=Math.sqrt((n-t)*(n-t)+(i-r)*(i-r));V={x:a,y:o,distance:s}}}},{key:"zoomScale",value:function(e){if(2!==e.touches.length)return G;var t=e.touches[0].clientX,r=e.touches[0].clientY,n=e.touches[1].clientX,i=e.touches[1].clientY,a=Math.sqrt((n-t)*(n-t)+(i-r)*(i-r));return G=a/V.distance}},{key:"dragged",get:function(){return E},set:function(e){E=e}},{key:"dragthumbnail",get:function(){return B},set:function(e){B=e}},{key:"dragmousex",get:function(){return I},set:function(e){I=e}},{key:"dragmousey",get:function(){return M},set:function(e){M=e}},{key:"timeoutEvent",get:function(){return D},set:function(e){D=e}},{key:"dragcanvas",get:function(){return R},set:function(e){R=e}},{key:"dragDiv",get:function(){return q}},{key:"scaleStartsAt",get:function(){return U},set:function(e){U=e}},{key:"pinchcenter",get:function(){return V}}],(r=null)&&N(t.prototype,r),n&&N(t,n),e}();function Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var X=!0,Y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"init",value:function(t){var r=t.offsetWidth,n=t.offsetHeight,i=Object(s.A)(t,0,0,482,362,{position:"absolute",zIndex:Kn.layerTop});e.setScaleAndPosition(i,s.H,47,75,482,362),i.setAttribute("id","livegrid"),e.drawLines(i,482,362),e.createNumbering(r,n),e.createCursor(),e.createYcursor(),e.createXcursor()}},{key:"setScaleAndPosition",value:function(e,t,r,n,i,a){Object(s.K)(e.style,{webkitTransform:"translate("+-i/2+"px, "+-a/2+"px) scale("+t+") translate("+(i/2+r)+"px, "+(a/2+n)+"px)"})}},{key:"drawLines",value:function(e,t,r){var n=Object(s.z)(e,0,0,t,r,{position:"absolute"});n.style.opacity=.5;var i=n.getContext("2d");i.strokeStyle="#B3B3B3",i.lineWidth=1;for(var a=24,o=0;o<20;o++)i.moveTo(a,0),i.lineTo(a,360),i.stroke(),a+=24;var l=24;for(o=0;o<15;o++)i.moveTo(0,l),i.lineTo(480,l),i.stroke(),l+=24;s.u?n.ontouchstart=function(e){Kn.stage.mouseDown(e)}:n.onmousedown=function(e){Kn.stage.mouseDown(e)}}},{key:"createNumbering",value:function(t,r){var n=Object(s.A)(Object(s.q)("stageframe"),0,0,t-46-30,24,{position:"absolute",zIndex:Kn.layerTop});n.setAttribute("id","rownum"),e.setScaleAndPosition(n,s.H,22,437,t-46-30,24);for(var i=24,a=0;a<20;a++){var l=Object(s.A)(n,i,0,24,24,{position:"absolute",zIndex:10});Object(s.D)(l,o.localize("GRID_NUMBER",{N:a+1}),{}).setAttribute("class","stylelabel"),i+=24}var c=Object(s.A)(Object(s.q)("stageframe"),0,0,24,r+24,{position:"absolute",zIndex:Kn.layerTop});c.setAttribute("id","colnum"),e.setScaleAndPosition(c,s.H,22,75,24,r+24);for(var u=336,d=0;d<15;d++){var h=Object(s.A)(c,0,u,24,24,{position:"absolute",zIndex:10});Object(s.D)(h,o.localize("GRID_NUMBER",{N:d+1}),{}).setAttribute("class","stylelabel"),u-=24}}},{key:"createYcursor",value:function(){var e=Object(s.A)(Object(s.q)("colnum"),0,0,24,24,{position:"absolute",zIndex:20});e.setAttribute("class","circle"),e.style.background="#6a99c1",e.setAttribute("id","ycursor"),Object(s.D)(e,15,{}).setAttribute("class","circlenum")}},{key:"createXcursor",value:function(){var e=Object(s.A)(Object(s.q)("rownum"),24,0,24,24,{position:"absolute",zIndex:20});e.setAttribute("class","circle"),e.style.background="#6a99c1",e.setAttribute("id","xcursor"),Object(s.D)(e,1,{}).setAttribute("class","circlenum")}},{key:"createCursor",value:function(){var t=Object(s.A)(Object(s.q)("livegrid"),0,0,26,26,{position:"absolute",zIndex:Kn.layerAboveBottom});t.setAttribute("id","circlenum");var r=Object(s.z)(t,0,0,26,26,{position:"absolute"});s.u?r.ontouchstart=function(t){e.mouseDownOnCursor(t)}:r.onmousedown=function(t){e.mouseDownOnCursor(t)};var n=r.getContext("2d");n.globalAlpha=.5,n.fillStyle="#28A5DA",n.strokeStyle="#656e73",n.lineWidth=3,n.strokeRect(3,3,18,18),n.fillRect(3,3,18,18),s.u?t.ontouchstart=e.mouseDownOnCursor:t.onmousedown=e.mouseDownOnCursor}},{key:"mouseDownOnCursor",value:function(e){e.preventDefault(),e.stopPropagation();var t=Kn.stage.getStagePt(e),r=Kn.getSprite();Kn.stage.initialPoint={x:t.x,y:t.y},K.dragthumbnail=r.div,K.clearEvents(),!Kn.inFullscreen&&r&&K.holdit(r.div,Kn.stage.startShaking),Kn.stage.setEvents()}},{key:"updateCursor",value:function(){if(!X&&!Kn.inFullscreen&&Kn.stage.currentPage){if(!Kn.getSprite())return Object(s.q)("circlenum").style.visibility="hidden",Object(s.q)("xcursor").style.visibility="hidden",void(Object(s.q)("ycursor").style.visibility="hidden");var t=Object(s.q)(Kn.stage.currentPage.currentSpriteName);if(t){var r=t.owner;if(Object(s.q)("circlenum")){var n=r.xcoor+12,i=r.ycoor-12;Object(s.q)("xcursor").style.visibility="visible",Object(s.q)("ycursor").style.visibility="visible",Object(s.q)("circlenum").style.visibility="visible",e.setCursorsValues(n,i)}}}}},{key:"setCursorsValues",value:function(e,t){var r=Object(s.q)("circlenum"),n=Math.round(e/24),i=Math.round(t/24);if(r.offsetLeft!=24*n){var a=Object(s.q)("xcursor"),l=n<1||n>20?"hidden":"visible";Object(s.K)(a.style,{position:"absolute",left:24*n+"px",visibility:l}),a.childNodes[0].textContent=o.localize("GRID_NUMBER",{N:n})}if(r.offsetTop!=24*i){var c=Object(s.q)("ycursor"),u=i<0||i>14?"hidden":"visible";Object(s.K)(c.style,{position:"absolute",top:24*i+"px",visibility:u}),c.childNodes[0].textContent=o.localize("GRID_NUMBER",{N:15-i})}Object(s.K)(r.style,{position:"absolute",top:24*i+"px",left:24*(n-1)+"px"})}},{key:"hide",value:function(e){var t=(X=e)?"hidden":"visible";Object(s.q)("livegrid").style.visibility=t,Object(s.q)("rownum").style.visibility=t,Object(s.q)("colnum").style.visibility=t,Kn.stage.currentPage&&(t=Kn.getSprite()?t:"hidden"),Object(s.q)("circlenum").style.visibility=t,Object(s.q)("xcursor").style.visibility=t,Object(s.q)("ycursor").style.visibility=t}},{key:"size",get:function(){return 24}},{key:"hidden",get:function(){return X}}],(r=null)&&Z(t.prototype,r),n&&Z(t,n),e}();function J(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $=function(){function e(t,r,n,i,a,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hasHorizontal=!0,this.hasVertical=!0,this.arrowDistance=6,this.aleft=void 0,this.aright=void 0,this.aup=void 0,this.adown=void 0,this.contents=Object(s.A)(t,0,0,n,i,{}),this.contents.setAttribute("id",r),this.contents.owner=this,this.addArrows(t,n,i),this.getContent=a,this.getObjects=o,t.scroll=this}var t,r,n;return t=e,(r=[{key:"update",value:function(){this.adjustCanvas(),this.refresh(),this.bounceBack()}},{key:"addArrows",value:function(e,t,r){this.aleft=Object(s.B)("div","leftarrow",e),this.aleft.style.height=r+"px";var n=Object(s.B)("span",void 0,this.aleft);n.style.top=Math.floor((r-n.offsetHeight)/2)+"px",this.aright=Object(s.B)("div","rightarrow",e),this.aright.style.height=r+"px";var i=Object(s.B)("span",void 0,this.aright);i.style.top=Math.floor((r-i.offsetHeight)/2)+"px",this.aup=Object(s.B)("div","toparrow",e),this.adown=Object(s.B)("div","bottomarrow",e),Object(s.B)("div","halign up",this.aup),Object(s.B)("div","halign down",this.adown);var a=this;s.u?this.aup.ontouchstart=function(e){a.scrolldown(e)}:this.aup.onmousedown=function(e){a.scrolldown(e)},s.u?this.adown.ontouchstart=function(e){a.scrollup(e)}:this.adown.onmousedown=function(e){a.scrollup(e)},s.u?this.aleft.ontouchstart=function(e){a.scrollright(e)}:this.aleft.onmousedown=function(e){a.scrollright(e)},s.u?this.aright.ontouchstart=function(e){a.scrollleft(e)}:this.aright.onmousedown=function(e){a.scrollleft(e)}}},{key:"repositionArrows",value:function(e){this.aleft.style.height=e+"px",this.aleft.childNodes[0].style.top=Math.floor((e-this.aleft.childNodes[0].offsetHeight)/2)+"px",this.aright.style.height=e+"px",this.aright.childNodes[0].style.top=Math.floor((e-this.aright.childNodes[0].offsetHeight)/2)+"px"}},{key:"getAdjustment",value:function(e){var t=this.contents.parentNode,r=t.offsetWidth,n=t.offsetHeight;return e.x>0&&e.y>0?"topleft":e.x+e.width<r&&e.y+e.height<n?"bottomright":e.x>0&&e.y+e.height<n?"bottomleft":e.x+e.width<r&&e.y>0?"topright":e.x+e.width<r?"right":e.y+e.height<n?"down":e.y>0?"up":e.x>0?"left":"none"}},{key:"bounceBack",value:function(){var e=this,t=this.contents,r=this.getContent(),n=r.left,i=r.top,a=t.offsetHeight,o=t.offsetWidth,l={x:n,y:i,width:r.offsetWidth,height:r.offsetHeight},c={duration:.5,transition:"ease-out",style:{},onComplete:function(){e.refresh()}};switch(this.getAdjustment(l)){case"topright":c.style.left=(this.hasHorizontal?o-l.width:0)+"px",c.style.top="0px",Object(s.b)(r,c);break;case"bottomright":c.style.left=(this.hasHorizontal?o-l.width:0)+"px",c.style.top=(this.hasVertical?a-l.height:0)+"px",Object(s.b)(r,c);break;case"topleft":c.style.top="0px",c.style.left="0px",Object(s.b)(r,c);break;case"bottomleft":c.style.top=(this.hasVertical?a-l.height:0)+"px",c.style.left="0px",Object(s.b)(r,c);break;case"right":c.style.top=i+"px",c.style.left=(this.hasHorizontal?o-l.width:0)+"px",Object(s.b)(r,c);break;case"left":this.hasHorizontal&&(c.style.top=i+"px",c.style.left="0px",Object(s.b)(r,c));break;case"down":c.style.top=a-l.height+"px",c.style.left=n+"px",Object(s.b)(r,c);break;case"up":this.hasVertical&&(c.style.top="0px",c.style.left=n+"px",Object(s.b)(r,c))}}},{key:"refresh",value:function(){for(var e,t=this.contents,r=this.getContent(),n=t.offsetWidth,i=t.offsetHeight,a="hidden",o="hidden",s="hidden",l="hidden",c=this.getObjects(),u=0;u<c.length;u++)null!=(e=c[u].div)&&e.owner&&"hidden"!=e.style.visibility&&(e.left+r.left<0&&(a="visible"),e.left+e.offsetWidth+r.left>n&&(o="visible"),e.top+r.top+10<0&&(s="visible"),e.top+e.offsetHeight+r.top>i&&(l="visible"));this.aleft.style.visibility=a,this.aright.style.visibility=o,this.aup.style.visibility=s,this.adown.style.visibility=l}},{key:"adjustCanvas",value:function(){for(var e,t=this.getContent(),r=this.contents,n=r.offsetWidth,i=r.offsetHeight,a=t.offsetWidth,o=t.offsetHeight,l=99999,c=0,u=99999,d=0,h=this.getObjects(),f=0;f<h.length;f++)null!=(e=h[f].div)&&e.owner&&"hidden"!=e.style.visibility&&(e.left<l&&(l=e.left),e.left+e.offsetWidth+0>c&&(c=e.left+e.offsetWidth+0),e.top<u&&(u=e.top),e.top+e.offsetHeight+20>d&&(d=e.top+e.offsetHeight+20));l<0?(l-=0,n-=l+=t.left):l=0,u<0?(u-=20,i-=u+=t.top):u=0,c-l>n&&(n=Math.round(c-l)),d-u>i&&(i=Math.round(d-u)),a==n&&o==i||Object(s.I)(t,n,i),(l<0||u<0)&&(this.moveBlocks(-l,-u),K.move3D(t,l,u))}},{key:"moveBlocks",value:function(e,t){for(var r=this.getObjects(),n=0;n<r.length;n++){var i=r[n];i.moveBlock(i.div.left+e,i.div.top+t)}}},{key:"scrolldown",value:function(e){if(!(s.u&&e.touches&&e.touches.length>1)){e.preventDefault(),e.stopPropagation();var t=this,r=this.contents,n=this.getContent(),i=r.offsetHeight,a=n.top+i;a>0&&(a=0);var o={duration:.5,transition:"ease-out",style:{top:(a=Math.round(a))+"px"},onComplete:function(){t.refresh()}};Object(s.b)(n,o)}}},{key:"scrollup",value:function(e){if(!(s.u&&e.touches&&e.touches.length>1)){e.preventDefault(),e.stopPropagation();var t=this,r=this.contents,n=this.getContent(),i=r.offsetHeight,a=n.top-i;a+n.offsetHeight<i&&(a=i-n.offsetHeight);var o={duration:.5,transition:"ease-out",style:{top:(a=Math.round(a))+"px"},onComplete:function(){t.refresh()}};Object(s.b)(n,o)}}},{key:"scrollright",value:function(e){if(!(s.u&&e.touches&&e.touches.length>1)){e.preventDefault(),e.stopPropagation();var t=this,r=this.contents,n=this.getContent(),i=r.offsetWidth,a=n.left+i;a>0&&(a=0);var o={duration:.5,transition:"ease-out",style:{left:(a=Math.round(a))+"px"},onComplete:function(){t.refresh()}};Object(s.b)(n,o)}}},{key:"scrollleft",value:function(e){if(!(s.u&&e.touches&&e.touches.length>1)){e.preventDefault(),e.stopPropagation();var t=this,r=this.contents,n=this.getContent(),i=r.offsetWidth,a=n.left-i;a+n.offsetWidth<i&&(a=i-n.offsetWidth);var o={duration:.5,transition:"ease-out",style:{left:(a=Math.round(a))+"px"},onComplete:function(){t.refresh()}};Object(s.b)(n,o)}}},{key:"fitToScreen",value:function(){var e=this.contents,t=this.getContent(),r=t.left,n=t.top,i=e.offsetHeight,a=e.offsetWidth,o={x:r,y:n,width:t.offsetWidth,height:t.offsetHeight};switch(this.getAdjustment(o)){case"topright":r=a-o.width,n=0;break;case"bottomright":r=a-o.width,n=i-o.height;break;case"topleft":r=0,n=0;break;case"bottomleft":n=i-o.height,r=0;break;case"right":r=a-o.width;break;case"left":r=0;break;case"down":n=i-o.height;break;case"up":n=0}K.move3D(t,r,n)}}])&&J(t.prototype,r),n&&J(t,n),e}();function Q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ee,te=void 0,re=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"createScripts",value:function(e){var t=Object(s.B)("div","scripts",e);t.setAttribute("id","scripts"),ee=Object(s.B)("div","watermark",t);var r=Math.max(Object(s.j)(),s.h.offsetHeight);Object(s.I)(t,t.offsetWidth,r-t.offsetTop),te=new $(t,"scriptscontainer",t.offsetWidth,r-t.offsetTop,Kn.getActiveScript,Kn.getBlocks)}},{key:"setActiveScript",value:function(e){var t=Object(s.q)(e+"_scripts");t&&(Kn.stage.currentPage.setCurrentSprite(Object(s.q)(e).owner),t.owner.activate(),t.parentNode.ontouchstart=function(e){t.owner.scriptsMouseDown(e)},te.update())}},{key:"runBlock",value:function(e,t){e.preventDefault(),e.stopPropagation();var r=t.owner.findFirst();r&&(Kn.runtime.addRunScript(Kn.getSprite(),r),Kn.startCurrentPageStrips(["ontouch"]),Kn.userStart=!0)}},{key:"prepareToDrag",value:function(t){t.preventDefault();var r=K.getTargetPoint(t);e.pickBlock(r.x,r.y,t)}},{key:"pickBlock",value:function(t,r,n){Kn.runtime.inactive()||Kn.stopStrips(),e.cleanCarets(),Kn.unfocus(n);var i=Kn.getActiveScript().owner;i.dragList=i.findGroup(K.dragthumbnail.owner),i.flowCaret=null;var a=K.dragthumbnail.parentNode.scrollTop,o=K.dragthumbnail.parentNode.scrollLeft;K.dragmousex=t,K.dragmousey=r;var l=Object(s.x)(K.dragthumbnail.parentNode,t),c=Object(s.y)(K.dragthumbnail.parentNode,r),u=K.dragmousex-Object(s.o)(K.dragDiv)-l+K.dragthumbnail.left,d=K.dragmousey-Object(s.p)(K.dragDiv)-c+K.dragthumbnail.top,h=new WebKitCSSMatrix(window.getComputedStyle(K.dragthumbnail).webkitTransform);d-=a,u-=o,K.dragcanvas=K.dragthumbnail,K.dragcanvas.origin="scripts",K.dragcanvas.startx=h.m41,K.dragcanvas.starty=h.m42,!K.dragcanvas.isReporter&&K.dragcanvas.parentNode&&K.dragcanvas.parentNode.removeChild(K.dragcanvas),K.move3D(K.dragcanvas,u,d),K.dragcanvas.style.zIndex=Kn.dragginLayer,K.dragDiv.appendChild(K.dragcanvas);var f=K.dragcanvas.owner;if(f.detachBlock(),!K.dragcanvas.isReporter){Kn.getActiveScript().owner.prepareCaret(f);for(var g=1;g<i.dragList.length;g++){f=i.dragList[g];var p=new WebKitCSSMatrix(window.getComputedStyle(f.div).webkitTransform),v=p.m41-h.m41,m=p.m42-h.m42;f.moveBlock(v,m),K.dragcanvas.appendChild(f.div)}}}},{key:"draggingBlock",value:function(t){t.preventDefault();var r=K.getTargetPoint(t),n=r.x-K.dragmousex,i=r.y-K.dragmousey;K.move3D(K.dragcanvas,n,i),e.blockFeedback(K.dragcanvas.left,K.dragcanvas.top,t)}},{key:"blockFeedback",value:function(t,r,n){var i,a=Kn.getActiveScript().owner,o=Object(s.q)("palette").parentNode.offsetTop+Object(s.q)("palette").parentNode.offsetHeight;switch(r+K.dragcanvas.offsetHeight<o?a.removeCaret():(a.removeCaret(),a.insertCaret(t,r)),Sr.getLandingPlace(a.dragList[0].div,n)){case"library":(i=Sr.getHittedThumb(a.dragList[0].div,Object(s.q)("spritecc")))&&Object(s.q)(i.owner).owner.type==Kn.getSprite().type?or.quickHighlight(i):i=void 0;for(var l=0;l<Object(s.q)("spritecc").childElementCount;l++){var c=Object(s.q)("spritecc").childNodes[l];"FORM"!=c.nodeName&&i&&i.id!=c.id&&or.quickRestore(c)}break;default:e.removeLibCaret()}}},{key:"dropBlock",value:function(t,r){t.preventDefault();var n=Kn.getActiveScript(),i=n.owner.spr.id,a=Kn.stage.currentPage;switch(Sr.getLandingPlace(r,t)){case"scripts":var o=Object(s.x)(n,r.left),l=Object(s.y)(n,r.top);e.blockDropped(n,o,l);break;case"library":var c=Sr.getHittedThumb(r,Object(s.q)("spritecc"));if(e.blockDropped(Kn.getActiveScript(),r.startx,r.starty),c&&Object(s.q)(c.owner).owner.type==Object(s.q)(a.currentSpriteName).owner.type){Kn.storyStart("ScriptsPane.dropBlock:library"),x.sndFX("copy.wav"),or.quickHighlight(c),setTimeout((function(){or.quickRestore(c)}),300),n=Object(s.q)(c.owner+"_scripts").owner;var u=bn.encodeStrip(r.owner),d=u[0],h=3*n.gettopblocks().length;d[2]=d[2]+h,d[3]=d[3]+h,n.recreateStrip(u),i=c.owner}break;default:Kn.getActiveScript().owner.deleteBlocks(),te.adjustCanvas(),te.refresh(),te.fitToScreen()}dr.record({action:"scripts",where:a.id,who:i}),Kn.getActiveScript().owner.dragList=[]}},{key:"blockDropped",value:function(t,r,n){K.dragcanvas.style.zIndex="";var i=Kn.getActiveScript().owner;e.cleanCarets(),i.addBlockToScripts(K.dragcanvas,r,n),i.layout(K.dragcanvas.owner),t.id==Kn.getActiveScript().id&&(te.adjustCanvas(),te.refresh(),te.bounceBack())}},{key:"cleanCarets",value:function(){Kn.getActiveScript().owner.removeCaret(),e.removeLibCaret()}},{key:"removeLibCaret",value:function(){for(var e=0;e<Object(s.q)("spritecc").childElementCount;e++){var t=Object(s.q)("spritecc").childNodes[e];"FORM"!=t.nodeName&&or.quickRestore(t)}}},{key:"dragBackground",value:function(t){if(!(T.openMenu||s.u&&t.touches&&t.touches.length>1)){t.preventDefault(),t.stopPropagation();var r=Kn.getActiveScript();r.top=r.offsetTop,r.left=r.offsetLeft;var n=K.getTargetPoint(t);K.dragmousex=n.x,K.dragmousey=n.y,K.dragged=!1,e.setDragBackgroundEvents(e.dragMove,e.dragEnd)}}},{key:"setDragBackgroundEvents",value:function(e,t){s.u?(window.ontouchmove=function(t){e(t)},window.ontouchend=function(e){t(e)}):(window.onmousemove=function(t){e(t)},window.onmouseup=function(e){t(e)})}},{key:"dragMove",value:function(e){var t=K.getTargetPoint(e);if(K.dragged||!(K.distance(K.dragmousex-t.x,K.dragmousey-t.y)<5)){K.dragged=!0;var r=t.x-K.dragmousex,n=t.y-K.dragmousey;K.dragmousex=t.x,K.dragmousey=t.y,K.move3D(Kn.getActiveScript(),r,n),te.refresh(),e.preventDefault()}}},{key:"dragEnd",value:function(e){K.dragged=!1,e.preventDefault(),K.clearEvents(),te.bounceBack()}},{key:"updateScriptsPageBlocks",value:function(e){for(var t=0;t<e.length;t++)if(Object(s.q)(e[t]+"_scripts")){var r=Object(s.q)(e[t]+"_scripts").owner;if(r)for(var n=r.getBlocks(),i=0;i<n.length;i++)n[i].updateBlock()}}},{key:"scroll",get:function(){return te}},{key:"watermark",get:function(){return ee}}],(r=null)&&Q(t.prototype,r),n&&Q(t,n),e}();function ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ie=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=r,this.width=n,this.height=i}var t,r,n;return t=e,(r=[{key:"hitRect",value:function(e){var t=e.x,r=e.y;return!(t<this.x||t>this.x+this.width||r<this.y||r>this.y+this.height)}},{key:"intersects",value:function(e){return Math.max(this.x,e.x)<=Math.min(this.x+this.width,e.x+e.width)&&Math.max(this.y,e.y)<=Math.min(this.y+this.height,e.y+e.height)}},{key:"overlapElemBy",value:function(e,t){return this.overlapElem(e)>=t}},{key:"overlapElem",value:function(e){var t=this.intersection(e);return t.isEmpty()?0:t.isEqual(e)?1:t.isEqual(this)?1:t.width*t.height/(e.width*e.height)}},{key:"intersection",value:function(t){var r=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width);if(r<=n){var i=Math.max(this.y,t.y),a=Math.min(this.y+this.height,t.y+t.height);return i>a?new e(0,0,0,0):new e(r,i,n-r,a-i)}return new e(0,0,0,0)}},{key:"union",value:function(t){var r=new e(0,0,0,0);return r.x=this.x<t.x?this.x:t.x,r.y=this.y<t.y?this.y:t.y,this.extentsw=9999999==this.x?0:this.x+this.width,this.extentsh=9999999==this.y?0:this.y+this.height,t.extentsw=9999999==t.x?0:t.x+t.width,t.extentsh=9999999==t.y?0:t.y+t.height,r.width=this.extentsw>t.extentsw?this.extentsw:t.extentsw,r.height=this.extentsh>t.extentsh?this.extentsh:t.extentsh,r.width-=r.x,r.height-=r.y,r.isEmpty()&&(r={x:9999999,y:9999999,width:0,height:0}),r}},{key:"expandBy",value:function(e){return this.x-=e/2,this.y-=e/2,this.width+=e,this.height+=e,this}},{key:"crop",value:function(e){this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.width+this.x>e.width+e.x&&(this.width+=e.width+e.x-(this.width+this.x)),this.height+this.y>e.height+e.y&&(this.height+=e.height+e.y-(this.height+this.y))}},{key:"getArea",value:function(){return this.width*this.height}},{key:"rounded",value:function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.round(this.width)+1,Math.round(this.height)+1)}},{key:"isEqual",value:function(e){return this.x==e.x&&this.y==e.y&&this.width==e.width&&this.height==e.height}},{key:"isEmpty",value:function(){return 0==this.x&&0==this.y&&0==this.width&&0==this.height}},{key:"scale",value:function(e,t){this.x*=e,this.y*=t,this.width*=e,this.height*=t}}])&&ne(t.prototype,r),n&&ne(t,n),e}();function ae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var oe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"sum",value:function(e,t){var r={};return r.x=e.x+t.x,r.y=e.y+t.y,r}},{key:"diff",value:function(e,t){var r={};return r.x=e.x-t.x,r.y=e.y-t.y,r}},{key:"equal",value:function(t,r){return 0==e.len(e.diff(t,r))}},{key:"floor",value:function(e){var t={};return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t}},{key:"neg",value:function(e){var t={};return t.x=-e.x,t.y=-e.y,t}},{key:"len",value:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)}},{key:"norm",value:function(t){var r=e.len(t),n={};return 0==r&&(r=.001),n.x=t.x/r,n.y=t.y/r,n}},{key:"perp",value:function(e){var t={};return t.x=-e.y,t.y=e.x,t}},{key:"scale",value:function(e,t){var r={};return r.x=e.x*t,r.y=e.y*t,r}},{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y}},{key:"mid",value:function(e,t){var r={};return r.x=(e.x+t.x)/2,r.y=(e.y+t.y)/2,r}},{key:"lineIntersect",value:function(t,r,n,i){var a=e.diff(r,t),o=e.diff(i,n),s=e.diff(t,n),l=o.y*a.x-o.x*a.y,c=o.x*s.y-o.y*s.x,u=a.x*s.y-a.y*s.x;if(0==l)return null;var d=c/l,h=u/l;return d<0||d>1||h<0||h>1?null:{x:t.x+d*a.x,y:t.y+d*a.y}}}],(r=null)&&ae(t.prototype,r),n&&ae(t,n),e}();function se(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var le,ce,ue,de,he,fe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentPage=void 0,this.div=Object(s.B)("div","stage",t),this.div.setAttribute("id","stage"),this.div.style.webkitTextSizeAdjust="100%",this.width=480,this.height=360,this.setStageScaleAndPosition(s.H,46,74),this.pages=[],this.pagesdiv=Object(s.A)(this.div,0,0,480,360,{position:"absolute"});var r=this;this.div.ontouchstart=function(e){r.mouseDown(e)},this.div.owner=this,this.currentZoom=1,this.initialPoint={x:0,y:0},this.deltaPoint={x:0,y:0}}var t,r,n;return t=e,(r=[{key:"setStageScaleAndPosition",value:function(e,t,r){this.stageScale=e,Object(s.K)(Object(s.q)("stage").style,{webkitTransform:"scale("+e+")"})}},{key:"getPagesID",value:function(){for(var e=[],t=0;t<this.pages.length;t++)e.push(this.pages[t].id);return e}},{key:"getPage",value:function(e){for(var t=0;t<this.pages.length;t++)if(this.pages[t].id==e)return this.pages[t];return this.pages[0]}},{key:"resetPage",value:function(e){for(var t=e.div,r=0;r<t.childElementCount;r++){var n=t.childNodes[r].owner;n&&"sprite"==n.type&&n.goHome()}}},{key:"resetPages",value:function(){for(var t=0;t<Kn.stage.pages.length;t++)e.prototype.resetPage(Kn.stage.pages[t])}},{key:"gotoPage",value:function(e){e<1||e>this.pages.length||K.dragthumbnail&&K.dragthumbnail.owner||this.setPage(this.pages[e-1],!0)}},{key:"setPage",value:function(e,t){Kn.stopStrips();var r=Kn.getSprite()?Object(s.q)(Kn.stage.currentPage.currentSpriteName+"_scripts"):void 0;r&&r.owner.deactivate(),this.currentPage.div.style.visibility="hidden",this.currentPage.setPageSprites("hidden"),this.currentPage=e,this.currentPage.div.style.visibility="visible",this.currentPage.setPageSprites("visible"),or.updateSprites(),or.updatePages();var n=Kn.getSprite();n&&n.activate(),t&&this.loadPageThreads()}},{key:"loadPageThreads",value:function(){Kn.blur();for(var e=this.currentPage,t=0;t<e.div.childElementCount;t++){var r=e.div.childNodes[t].owner;if(r){r.goHome();var n=Object(s.q)(r.id+"_scripts");if(n)for(var i=n.owner.getBlocksType(["onflag","ontouch"]),a=0;a<i.length;a++){var o=i[a];Kn.runtime.addRunScript(r,o)}}}}},{key:"copySprite",value:function(e,t){x.sndFX("copy.wav"),or.overpage(t);var r=bn.encodeSprite(e.owner);Object(s.q)(t.owner).owner==this.currentPage&&(r.xcoor+=10,r.ycoor+=10,r.homex=r.xcoor,r.homey=r.ycoor);var n=r.id.split(" ");"NaN"!=Number(n[n.length-1]).toString()&&n.pop();var i=Object(s.q)(t.owner).owner,a=Object(s.l)(n.join(" "));r.id=a,bn.recreateObject(i,a,r,(function(e){e.page.id==Kn.stage.currentPage.id&&(e.div.style.visibility="visible"),i.currentSpriteName||(i.currentSpriteName=e.id),or.updateSprites(),or.updatePages(),dr.record({action:"copy",who:a,where:Object(s.q)(t.owner).owner.id}),Kn.storyStart("Stage.prototype.copySprite")}),i.id==this.currentPage.id)}},{key:"deletePage",value:function(e,t){Kn.storyStart("Stage.prototype.deletePage");var r=Object(s.l)("page"),n=Xt.mascotData(),i=new Object,a=n.id;i.sprites=[a],i.num=1,i.lastSprite=a,i[a]=n,i.layers=[a];var o=Object(s.q)(e).owner,l=this.getPagesID().indexOf(e);if(!(l<0)){var c=document.forms.activetextbox.textsprite;if(c&&Object(s.q)(c.id)&&Kn.blur(),this.removePageBlocks(e),this.pages.splice(l,1),t||x.sndFX("cut.wav"),this.removePage(o),0==this.pages.length){var u=new nr(r,i,(function(){Kn.stage.setViewPage(Kn.stage.currentPage),or.updateSprites(),or.updatePages(),t||dr.record({action:"deletepage",where:e,who:e})}));n.page=u}else e==this.currentPage.id&&this.setViewPage(this.pages[0]),or.updateSprites(),or.updatePages(),t||dr.record({action:"deletepage",where:e,who:e})}}},{key:"setViewPage",value:function(e){this.currentPage=e,this.currentPage.div.style.visibility="visible",this.currentPage.setPageSprites("visible")}},{key:"removePageBlocks",value:function(e){for(var t=this.getPagesID().indexOf(e),r=0;r<this.pages.length;r++)for(var n=this.pages[r],i=0;i<n.div.childElementCount;i++){var a=n.div.childNodes[i].owner;if(a){var o=Object(s.q)(a.id+"_scripts");if(o)for(var l=o.owner.getBlocksType(["gotopage"]),c=0;c<l.length;c++){var u=l[c],d=u.getArgValue()-1;if(this.pages[d].id==e){var h=u.prev;u.detachBlock(),u.div.parentNode.removeChild(u.div),h&&h.aStart&&h.div.parentNode.removeChild(h.div)}else u.getArgValue()-1>t&&(u.arg.argValue-=1,this.pages[d].num=u.arg.argValue,u.arg.updateIcon())}}}}},{key:"mouseDown",value:function(e){if(!(e.touches&&e.touches.length>1)&&!Kn.onHold&&(e.preventDefault(),Kn.blur(),this.currentPage&&!document.forms.activetextbox.textsprite)){var t=e.target.owner?e.target.owner:e.target.parentNode.owner;t&&"sprite"===t.type&&(Kn.shaking?Kn.clearSelection():this.mouseDownOnSprite(t,{x:0,y:0}))}}},{key:"checkShaking",value:function(e,t){if(!Kn.shaking)return t;var r=Object(s.o)(Object(s.q)("deletesprite"))-Object(s.o)(Kn.stage.pagesdiv),n=Object(s.p)(Object(s.q)("deletesprite"))-Object(s.p)(Kn.stage.pagesdiv),i=Object(s.q)("deletesprite").offsetWidth,a=Object(s.q)("deletesprite").offsetHeight;return new ie(r,n,i,a).hitRect(e)?Object(s.q)("deletesprite"):t}},{key:"mouseDownOnSprite",value:function(e,t){this.initialPoint={x:t.x,y:t.y},K.dragthumbnail=e.div,K.clearEvents(),!Kn.inFullscreen&&Kn.isEditable()&&K.holdit(e.div,this.startShaking),this.setEvents()}},{key:"whoIsIt",value:function(e,t){for(var r,n=this.currentPage.div,i=n.childElementCount-1;i>-1;i--)if((r=n.childNodes[i].owner)&&r.shown&&(r.stamp(e),0!=e.getImageData(t.x,t.y,1,1).data[3]))return r;e.clearRect(0,0,480,360);for(var a=n.childElementCount-1;a>-1;a--)if((r=n.childNodes[a].owner)&&r.shown&&(r.stamp(e),r.stamp(e,5,0),r.stamp(e,0,5),r.stamp(e,-5,0),r.stamp(e,0,-5),0!=e.getImageData(t.x,t.y,1,1).data[3]))return r}},{key:"getStagePt",value:function(e){var t=K.getTargetPoint(e),r=this.div,n=Object(s.o)(r),i=Object(s.p)(r);return t.x-=n,t.y-=i,t.x/=this.stageScale,t.y/=this.stageScale,t}},{key:"setEvents",value:function(){var e=this;window.ontouchend=function(t){e.mouseUp(t)}}},{key:"startShaking",value:function(e){e.owner&&(K.clearEvents(),Kn.shaking=e,Kn.stopShaking=Kn.stage.stopShaking,e.owner.startShaking())}},{key:"stopShaking",value:function(e){e.owner&&(e.owner.stopShaking(),Kn.shaking=void 0,Kn.stopShaking=void 0)}},{key:"startSpriteDrag",value:function(){var e=K.dragthumbnail.owner;e.threads=Kn.runtime.removeRunScript(e),this.currentPage.div.appendChild(K.dragthumbnail),this.deltaPoint={x:this.initialPoint.x,y:this.initialPoint.y},K.dragged=!0,Kn.changed=!0}},{key:"mouseMove",value:function(e){if(K.dragthumbnail){var t=this.getStagePt(e),r=oe.diff(t,this.initialPoint),n=Kn.inFullscreen?15:5;if(!K.dragged&&oe.len(r)>n&&this.startSpriteDrag(e),K.dragged){K.timeoutEvent&&clearTimeout(K.timeoutEvent),K.timeoutEvent=void 0;var i=K.dragthumbnail.owner;r=this.wrapDelta(i,oe.diff(t,this.deltaPoint)),i.xcoor+=r.x,i.ycoor+=r.y,i.render(),this.deltaPoint={x:t.x,y:t.y}}}}},{key:"wrapDelta",value:function(e,t){return"text"==e.type?this.wrapText(e,t):this.wrapChar(e,t)}},{key:"wrapChar",value:function(e,t){return t.x+e.xcoor<0&&(t.x-=e.xcoor+t.x),t.y+e.ycoor<0&&(t.y-=e.ycoor+t.y),t.x+e.xcoor>=480&&(t.x+=479-(e.xcoor+t.x)),t.y+e.ycoor>=360&&(t.y+=359-(e.ycoor+t.y)),t}},{key:"wrapText",value:function(e,t){var r=e.cx>480?e.cx:480,n=e.cx>480?480-e.cx:0;return t.x+e.xcoor<=n&&(t.x-=e.xcoor+t.x-n),t.y+e.ycoor<0&&(t.y-=e.ycoor+t.y),t.x+e.xcoor>r&&(t.x+=r-1-(e.xcoor+t.x)),t.y+e.ycoor>=360&&(t.y+=359-(e.ycoor+t.y)),t}},{key:"mouseUp",value:function(e){var t=K.dragthumbnail.owner;K.timeoutEvent&&clearTimeout(K.timeoutEvent),K.timeoutEvent=void 0,K.dragged?(this.moveElementBy(t),"sprite"==t.type&&(Kn.runtime.threadsRunning=Kn.runtime.threadsRunning.concat(t.threads),Kn.startCurrentPageStrips(["ontouch"]))):this.clickOnElement(e,K.dragthumbnail),K.clearEvents(),K.dragged=!1,K.dragthumbnail=void 0}},{key:"moveElementBy",value:function(e){Kn.inFullscreen||(e.homex=e.xcoor,e.homey=e.ycoor,e.homeflip=e.flip),or.updatePages()}},{key:"clickOnSprite",value:function(e,t){e.preventDefault(),Kn.clearSelection(),Kn.startScriptsFor(t,["onclick"]),Kn.startCurrentPageStrips(["ontouch"])}},{key:"removeSprite",value:function(e){Kn.shaking=void 0,Kn.stopShaking=void 0,x.sndFX("cut.wav"),"text"==e.type?e.deleteText(!0):this.removeCharacter(e),this.currentPage.updateThumb(),this.updatePageBlocks()}},{key:"removeCharacter",value:function(e){Kn.runtime.stopThreadSprite(e),this.removeFromPage(e),dr.record({action:"deletesprite",who:e.id,where:Kn.stage.currentPage.id}),Kn.storyStart("Stage.prototype.removeCharacter"),or.updateSprites()}},{key:"updatePageBlocks",value:function(){for(var e=0;e<Kn.stage.pages.length;e++){var t=Kn.stage.pages[e];re.updateScriptsPageBlocks(JSON.parse(t.sprites))}}},{key:"removeFromPage",value:function(e){var t=e.id,r=Object(s.q)(t+"_scripts"),n=this.currentPage,i=JSON.parse(n.sprites),a=i.indexOf(t);if(!(a<0)){var o=e.thumbnail,l=Kn.getSprite();if(x.sndFX("cut.wav"),i.splice(a,1),e.div.parentNode.removeChild(e.div),r&&r.parentNode.removeChild(r),n.sprites=JSON.stringify(i),o.parentNode.removeChild(o),l&&l.id==e.id){var c=n.getSprites();n.setCurrentSprite(c.length>0?Object(s.q)(c[0]).owner:void 0)}}}},{key:"renumberPageBlocks",value:function(e){for(var t=this.getPagesID(),r=0;r<this.pages.length;r++)for(var n=this.pages[r],i=0;i<n.div.childElementCount;i++){var a=n.div.childNodes[i].owner;if(a){var o=Object(s.q)(a.id+"_scripts");if(o)for(var l=o.owner.getBlocksType(["gotopage"]),c=0;c<l.length;c++){var u=l[c],d=u.getArgValue()-1;u.arg.argValue=t.indexOf(e[d])+1,u.updateBlock()}}}}},{key:"clickOnElement",value:function(e,t){"text"==t.owner.type?Kn.inFullscreen||t.owner.clickOnText(e):"sprite"==t.owner.type&&this.clickOnSprite(e,t.owner)}},{key:"clear",value:function(){for(var e=0;e<this.pages.length;e++)this.removePage(this.pages[e]);for(this.pages=[];this.pagesdiv.childElementCount>0;)this.pagesdiv.removeChild(this.pagesdiv.childNodes[0])}},{key:"removePage",value:function(e){for(var t=JSON.parse(e.sprites),r=0;r<t.length;r++){var n=t[r],i=Object(s.q)(n),a=Object(s.q)(n+"_scripts");a&&a.parentNode.removeChild(a),i.parentNode.removeChild(i)}e.div.parentNode.removeChild(e.div)}},{key:"sd",value:function(){var e=Object(s.q)("stage"),t=Object(s.A)(Object(s.q)("stageframe"),e.offsetLeft+1,e.offsetTop+1,482,362,{position:"absolute",zIndex:Kn.layerTop+20,visibility:"hidden"});t.setAttribute("id","pagemask"),t.appendChild(Kn.workingCanvas)}},{key:"on",value:function(){Object(s.q)("pagemask").style.visibility="visible"}},{key:"off",value:function(){Object(s.q)("pagemask").style.visibility="hidden"}},{key:"sm",value:function(e){var t=Object(s.q)("stage"),r=e.outline.width,n=e.outline.height,i=Object(s.A)(Object(s.q)("stageframe"),t.offsetLeft+1,t.offsetTop+1,r,n,{position:"absolute",zIndex:Kn.layerTop+20,visibility:"hidden"});i.setAttribute("id","spritemask"),i.appendChild(e.outline)}},{key:"son",value:function(){Object(s.q)("spritemask").style.visibility="visible"}},{key:"soff",value:function(){Object(s.q)("spritemask").style.visibility="hidden"}}])&&se(t.prototype,r),n&&se(t,n),e}(),ge=r(10);function pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ve={},me=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"loadMediaLib",value:function(t,r){le=ge.path,ce=ge.samples,de=ge.sprites,ue=ge.backgrounds,he=ge.sounds,e.localizeMediaNames(),e.generateKeys()}},{key:"localizeMediaNames",value:function(){for(var e=0;e<de.length;e++)de[e].name=o.localize("CHARACTER_"+de[e].md5);for(var t=0;t<ue.length;t++)ue[t].name=o.localize("BACKGROUND_"+ue[t].md5)}},{key:"generateKeys",value:function(){for(var e=0;e<ue.length;e++){var t=ue[e];ve[t.md5]={width:t.width,height:t.height,name:t.name}}for(var r=0;r<de.length;r++){var n=de[r];ve[n.md5]={width:n.width,height:n.height,name:n.name}}}},{key:"path",get:function(){return le}},{key:"samples",get:function(){return ce}},{key:"sprites",get:function(){return de}},{key:"backgrounds",get:function(){return ue}},{key:"sounds",get:function(){return he}},{key:"keys",get:function(){return ve}}],(r=null)&&pe(t.prototype,r),n&&pe(t,n),e}(),be=r(51),ye=r.n(be);function ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var we,xe=void 0,Se=void 0,_e=[],Ce=0,Oe=!1,je=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"mouseDown",value:function(t){if(Se=void 0,Object(s.q)("layer1")&&!(t.touches&&t.touches.length>1)){e.clearDragGroup(),Oe=!1;var r=e.getMouseTarget(t);r&&("div"!=r.tagName.toLowerCase()&&"svg"!=r.tagName.toLowerCase()&&(Se=r),t.preventDefault(),Vt.initialPoint=e.getScreenPt(t),Vt.deltaPoint=e.getScreenPt(t),$e.hitDot(t)&&(Vt.mode="grab"),xe=void 0,e.clearEvents(),Ae[Vt.mode](t),e.setEvents())}}},{key:"clearDragGroup",value:function(){for(var e=0;e<Object(s.q)("layer1").childElementCount;e++){var t=Object(s.q)("layer1").childNodes[e],r=pt.getRotation(t);if(0!=r.angle){for(var n=[],i=0;i<t.childElementCount;i++){var a=t.childNodes[i];a&&(pt.rotateFromPoint(r,a),n.push(a))}for(i=0;i<t.childElementCount;i++)Object(s.q)("layer1").appendChild(n[i]);Object(s.q)("layer1").removeChild(t)}}}},{key:"clearEvents",value:function(){xe=void 0,window.ontouchmove=void 0,window.ontouchend=void 0}},{key:"stopAction",value:function(t){var r=["path","ellipse","rect","tri"].indexOf(Vt.mode)>-1;if(xe&&xe.parentNode&&r)e.removeShape(null);else{if(["select","grab","rotate"].indexOf(Vt.mode)<0)return;"select"==Vt.mode&&(we&&clearTimeout(we),Oe&&e.stopDrag()),"grab"!=Vt.mode&&"rotate"!=Vt.mode||Te[Vt.mode](t),De.clearLayer(),(Se||xe)&&Ve.record(),pt.updateAll(xe),De.drawOffscreen()}}},{key:"setEvents",value:function(){window.ontouchmove=function(t){e.mouseMove(t)},window.ontouchend=function(t){e.mouseUp(t)},window.ontouchcancel=function(t){e.mouseMove(t),e.mouseUp(t)}}},{key:"mouseMove",value:function(t){t.preventDefault(),Pe[Vt.mode](t),Vt.deltaPoint=e.getScreenPt(t)}},{key:"mouseUp",value:function(t){t.preventDefault(),Te[Vt.mode](t),De.clearLayer(),Oe?(Se||xe)&&Ve.record():e.getMouseTarget(t)&&Ne[Vt.mode](t),"grab"==Vt.mode&&(Vt.mode="select");var r=xe;xe=void 0,_e=[],Oe=!1,pt.updateAll(r),e.clearEvents(),De.drawOffscreen()}},{key:"selectMouseDown",value:function(t){e.fingerDown(t),xe&&(xe="yes"==xe.getAttribute("stencil")?null:xe),xe&&"yes"!=xe.getAttribute("stencil")&&e.startHold(t)}},{key:"fingerDown",value:function(e){xe=De.findTarget(e),Se=xe||Se,_e=[]}},{key:"fingerUp",value:function(t){xe=void 0,Se=void 0,e.fingerDown(t)}},{key:"startHold",value:function(){xe&&(we=setTimeout((function(){Xe.bringToFront(xe),we=null}),600))}},{key:"cloneMouseDown",value:function(t){e.fingerDown(t),e.selectTarget(),xe&&"staticbkg"==xe.id&&(xe=null)}},{key:"pathMouseDown",value:function(){xe=yt.addPolyline(Object(s.q)("layer1"),Vt.initialPoint.x,Vt.initialPoint.y);var e=$e.getClosestPath(Vt.initialPoint,xe,Object(s.q)("layer1"),$e.maxDistance());if(e){var t=xe.getAttribute("stroke"),r=xe.getAttribute("stroke-width");if(t==e.getAttribute("stroke")&&r==e.getAttribute("stroke-width")){var n=yt.createGroup(Object(s.q)("draglayer"),"cusorstate");De.getKid(n,e,.7),Se=e}}}},{key:"selectTarget",value:function(){if(xe)for(;"g"==xe.parentNode.tagName&&"layer1"!=xe.parentNode.id;)xe=xe.parentNode}},{key:"makeAgroup",value:function(e){for(var t=Object(s.q)("layer1"),r=yt.createGroup(t,Object(s.l)("group")),n=0;n<e.length;n++)t.removeChild(e[n]),r.appendChild(e[n]);return r}},{key:"ellipseMouseDown",value:function(){xe=yt.addEllipse(Object(s.q)("layer1"),Vt.initialPoint.x,Vt.initialPoint.y)}},{key:"rectMouseDown",value:function(){xe=yt.addRect(Object(s.q)("layer1"),Vt.initialPoint.x,Vt.initialPoint.y)}},{key:"triMouseDown",value:function(){xe=yt.addTriangle(Object(s.q)("layer1"),Vt.initialPoint.x,Vt.initialPoint.y)}},{key:"grabMouseDown",value:function(){(xe=Se).setAttributeNS(null,"fill",$e.selectedDotColor),xe.setAttributeNS(null,"r",1.5*xe.getAttribute("r"))}},{key:"selectMouseMove",value:function(t){if(!(t.touches&&t.touches.length>1))return e.onBackground()?(e.clearEvents(),void Vt.Scroll(t)):void e.moveObject(t)}},{key:"moveObject",value:function(t){if(Se){var r=e.getScreenPt(t),n=oe.diff(r,Vt.initialPoint);if(!Oe&&oe.len(n)>10&&e.startDragShape(t),Oe){for(var i=0;i<_e.length;i++)pt.extract(_e[i],2).setTranslate(n.x,n.y);pt.extract(Object(s.q)("ghostgroup"),2).setTranslate(n.x,n.y)}}}},{key:"onBackground",value:function(){return!xe||Se.id.indexOf("staticbkg")>-1||"yes"==xe.getAttribute("stencil")}},{key:"paintBucketMouseMove",value:function(e){De.findTarget(e)}},{key:"isMoving",value:function(t){if(Oe)return!0;var r=e.getScreenPt(t),n=oe.diff(r,Vt.initialPoint);return!Oe&&oe.len(n)>10}},{key:"fingerMove",value:function(e){De.findTarget(e)}},{key:"cloneMouseMove",value:function(e){De.findTarget(e)}},{key:"startDragShape",value:function(){we&&clearTimeout(we),e.selectTarget(),we=void 0,$e.quitEditMode(),_e=Xe.findGroup(xe);for(var t=0;t<_e.length;t++)pt.eleminateTranslates(_e[t]),Object(s.q)("layer1").appendChild(_e[t]);De.highlight(_e);for(var r=0;r<_e.length;r++)pt.appendForMove(_e[r],pt.getTranslateTransform());pt.appendForMove(Object(s.q)("ghostgroup"),pt.getTranslateTransform()),Oe=!0}},{key:"rotateMouseMove",value:function(t){if(Se){var r=e.getScreenPt(t),n=oe.diff(r,Vt.initialPoint);!Oe&&oe.len(n)>10&&e.startRotateShape(t),xe&&Oe&&(e.rotateFromMouse(t,xe),e.rotateFromMouse(t,Object(s.q)("ghostgroup")))}}},{key:"startRotateShape",value:function(t){if(e.selectTarget(),xe&&(xe&&"svg"==xe.tagName.toLowerCase()&&(xe=void 0),e.onBackground()&&(xe=void 0),xe)){_e=Xe.findGroup(xe),De.highlight(_e),xe=e.makeAgroup(_e);var r=e.getScreenPt(t),n=pt.getCombinedMatrices(xe);e.center=yt.getBoxCenter(xe);var i={x:e.center.x,y:e.center.y};i=pt.point(i.x,i.y,n);var a=oe.diff(i,r);Ce=Math.atan2(a.y,a.x)*(180/Math.PI)%360,Ce-=90,yt.getBoxCenter(xe),Oe=!0}}},{key:"rotateFromMouse",value:function(t,r){var n=e.getScreenPt(t),i=pt.getRotation(r),a=pt.getCombinedMatrices(r),o={x:e.center.x,y:e.center.y};o=pt.point(o.x,o.y,a);var s=oe.diff(o,n),l=Math.atan2(s.y,s.x)*(180/Math.PI)%360;l-=90,l=(l-=Ce)<0?360+l:l,l%=360,i.setRotate(l,o.x,o.y)}},{key:"rectMouseMove",value:function(t){var r=e.getScreenPt(t),n=oe.diff(r,Vt.initialPoint);if(!Oe&&oe.len(n)>10&&(Oe=!0),Oe){var i,a,o=Math.abs(n.x),s=Math.abs(n.y);t.shiftKey?(o=s=Math.max(o,s),i=Vt.initialPoint.x<r.x?Vt.initialPoint.x:Vt.initialPoint.x-o,a=Vt.initialPoint.y<r.y?Vt.initialPoint.y:Vt.initialPoint.y-s):(i=Math.min(Vt.initialPoint.x,r.x),a=Math.min(Vt.initialPoint.y,r.y));var l={width:o,height:s,x:i,y:a};for(var c in l)xe.setAttributeNS(null,c,l[c])}}},{key:"triMouseMove",value:function(t){var r=e.getScreenPt(t),n=oe.diff(r,Vt.initialPoint);if(!Oe&&oe.len(n)>10&&(Oe=!0),Oe){var i=n.x,a=n.y,o=Vt.initialPoint.x,s=Vt.initialPoint.y,l=[["M",o,s+a],["L",o+.5*i,s],["L",o+i,s+a],["L",o,s+a],["z"]],c=dt.arrayToString(l);xe.setAttribute("d",c)}}},{key:"pathMouseMove",value:function(t){var r=e.getScreenPt(t),n=oe.diff(r,Vt.initialPoint);if(!Oe&&oe.len(n)>10&&(Oe=!0),Oe){var i=" "+r.x+","+r.y+" ",a=xe.getAttribute("points");a+=i,xe.setAttributeNS(null,"points",a)}}},{key:"ellipseMouseMove",value:function(t){var r=e.getScreenPt(t),n=oe.diff(r,Vt.initialPoint);if(!Oe&&oe.len(n)>10&&(Oe=!0),Oe){var i,a,o=Math.abs(n.x),s=Math.abs(n.y);t.shiftKey?(o=s=Math.max(o,s),i=Vt.initialPoint.x<r.x?Vt.initialPoint.x:Vt.initialPoint.x-o,a=Vt.initialPoint.y<r.y?Vt.initialPoint.y:Vt.initialPoint.y-s):(i=Math.min(Vt.initialPoint.x,r.x),a=Math.min(Vt.initialPoint.y,r.y));var l=o/2,c=s/2,u={cx:i+l,cy:a+c,rx:l,ry:c};for(var d in u)xe.setAttributeNS(null,d,u[d])}}},{key:"grabMouseMove",value:function(t){var r=e.getScreenPt(t),n=oe.diff(r,Vt.deltaPoint);e.movePointByDrag(n.x,n.y),Oe=!0;var i=Object(s.q)(xe.getAttribute("parentid")),a=dt.isCloseDPath(i);if($e.reshape(i),a!=dt.isCloseDPath(i)&&e.playSnapSound(a),!dt.isCloseDPath(i)&&$e.isTip(xe)){De.clearLayer();var o=$e.getClosestPath(r,i,Object(s.q)("layer1"),$e.maxDistance());if(o){var l=yt.createGroup(Object(s.q)("draglayer"),"cusorstate");De.getKid(l,o,.7),Se=o}}}},{key:"playSnapSound",value:function(e){x.sndFX(e?"cut.wav":"snap.wav")}},{key:"movePointByDrag",value:function(e,t){var r=xe.getAttribute("cx"),n=xe.getAttribute("cy"),i=Number(r)+e,a=Number(n)+t;xe.setAttributeNS(null,"cx",i),xe.setAttributeNS(null,"cy",a)}},{key:"rectMouseUp",value:function(t){var r=Number(xe.getAttribute("width")),n=Number(xe.getAttribute("height")),i=Number(xe.getAttribute("x")),a=Number(xe.getAttribute("y")),o=[{x:i,y:a},{x:i+r,y:a},{x:i+r,y:a+n},{x:i,y:a+n}],s=$e.makeRectangle(xe.parentNode,o);xe.parentNode.removeChild(xe),xe=s;var l=yt.getBox(xe);(yt.notValidBox(l)||l.isEmpty())&&e.removeShape(t)}},{key:"triMouseUp",value:function(t){var r=yt.getBox(xe);yt.notValidBox(r)&&e.removeShape(t)}},{key:"ellipseMouseUp",value:function(t){var r=yt.getBox(xe);if(yt.notValidBox(r))e.removeShape(t);else{var n=$e.makeEllipse(xe);xe.parentNode.removeChild(xe),xe=n}}},{key:"rotateMouseUp",value:function(t){if(xe&&Oe){e.rotateFromMouse(t,xe);for(var r=pt.getRotation(xe),n=0;n<_e.length;n++)Object(s.q)("layer1").appendChild(_e[n]),0!=r.angle&&pt.rotateFromPoint(r,_e[n]);Object(s.q)("layer1").removeChild(xe),xe=Se}}},{key:"pathMouseUp",value:function(t){if(Oe){xe=$e.process(xe);var r=yt.getBox(xe),n=new ie(0,0,Vt.workspaceWidth,Vt.workspaceHeight);if(r.intersects(n)){if(!dt.isCloseDPath(xe)){var i=e.getScreenPt(t),a=$e.getClosestPath(i,xe,Object(s.q)("layer1"),$e.maxDistance());a||(i=$e.getCommands(xe.getAttribute("d"))[0].pt,a=$e.getClosestPath(i,xe,Object(s.q)("layer1"),$e.maxDistance()));var o=xe.getAttribute("stroke"),l=xe.getAttribute("stroke-width");a&&o==a.getAttribute("stroke")&&l==a.getAttribute("stroke-width")&&(xe=$e.join(xe,a,i)),Object(s.q)("staticbkg")&&$e.checkBackgroundCrop(xe)}}else e.removeShape(t)}else e.removeShape(t)}},{key:"selectMouseUp",value:function(t){if(we&&clearTimeout(we),Oe)e.stopDrag();else{if(e.fingerUp(t),$e.selector&&$e.selector!=xe&&$e.quitEditMode(),!xe)return;Oe&&!$e.selector&&$e.enterEditMode(xe)}}},{key:"scissorsMouseUp",value:function(t){if(e.fingerUp(t),e.selectTarget(),xe&&"fixed"==xe.id&&(xe=null),xe){x.sndFX("cut.wav");for(var r=rt.getImage(xe),n=xe.parentNode,i=[],a=0;a<n.childElementCount;a++){var o=n.childNodes[a];o.getAttribute("relatedto")==xe.id&&i.push(o)}for(var l=0;l<i.length;l++)n.removeChild(i[l]);r?rt.removeClip(r):xe.parentNode&&xe.parentNode.removeChild(xe),yt.cleanup(Object(s.q)("layer1")),Ve.record()}}},{key:"cameraMouseUp",value:function(t){s.u&&e.fingerUp(t),null!=xe&&(ze.startFeed(xe),Kn.onBackButtonCallback.push((function(){Vt.closeCameraMode()})))}},{key:"cloneMouseUp",value:function(t){e.fingerUp(t),e.selectTarget(),xe&&"staticbkg"==xe.id&&(xe=null),xe&&(x.sndFX("copy.wav"),yt.cloneSVGelement(xe),De.clearLayer(),Ve.record(),e.backToSelect(t))}},{key:"setStrokeSizeAndColor",value:function(){xe&&(xe.getAttribute("stroke")==Vt.fillcolor&&xe.getAttribute("stroke-width")==Vt.strokewidth||(xe.getAttribute("stroke")?(xe.setAttribute("stroke",Vt.fillcolor),xe.setAttribute("stroke-width",Vt.strokewidth)):(xe=Object(s.q)(xe.id+"Border")?Object(s.q)(xe.id+"Border"):xe).id.indexOf("Border")>-1&&xe.setAttribute("fill",Vt.fillcolor),Ve.record()))}},{key:"paintBucketMouseUp",value:function(t){e.fingerUp(t),xe&&e.paintRegion(t)}},{key:"paintRegion",value:function(){switch(x.sndFX("splash.wav"),e.getPaintType()){case"paths":$e.setData(xe);break;case"image":var t=rt.getImage(xe);rt.paint(t);break;case"check":for(var r=Xe.findGroup(xe),n=0;n<r.length;n++)r[n].id!=xe.id&&r[n].getAttribute("relatedto")!=xe.id||r[n].setAttribute("stroke",Vt.fillcolor)}xe.setAttribute("fill",Vt.fillcolor),Ve.record()}},{key:"getPaintType",value:function(){return rt.getImage(xe)?"image":e.justPaint(xe)?null==xe.getAttribute("fill")&&null==xe.getAttribute("stroke")?"paths":xe.getAttribute("fill")==xe.getAttribute("stroke")?"check":"none":"paths"}},{key:"justPaint",value:function(e){return"path"!=e.tagName||!!dt.isCompoundPath(e)||"none"!=e.getAttribute("fill")||null!=e.getAttribute("fill")}},{key:"stopDrag",value:function(){if(Oe&&0!=_e.length){for(var e=0;e<_e.length;e++)pt.eleminateTranslates(_e[e]);for(var t=yt.getTransformedBox(_e[0]),r={x:0,y:0,width:Vt.workspaceWidth,height:Vt.workspaceHeight},n=1;n<_e.length;n++)t=t.union(yt.getTransformedBox(_e[n]).expandBy(yt.getPenWidthForm(_e[n])));if(!t.intersects(r)){x.sndFX("boing.wav");var i={x:0,y:0};t.x>Vt.workspaceWidth&&(i.x=Math.floor(Vt.workspaceWidth-t.x-.25*t.width)),t.y>r.height&&(i.y=Math.floor(Vt.workspaceHeight-t.y-.25*t.height)),t.x<0&&(i.x=Math.floor(-t.x-.75*t.width)),t.y<0&&(i.y=Math.floor(-t.y-.75*t.height)),window.xform.setTranslate(i.x,i.y);for(var a=0;a<_e.length;a++)pt.translateTo(_e[a],window.xform)}_e=[]}}},{key:"ignoreEvt",value:function(){}},{key:"backToSelect",value:function(){Vt.selectButton("select")}},{key:"grabMouseUp",value:function(t){var r=Object(s.q)(xe.getAttribute("parentid"));xe.setAttributeNS(null,"fill",$e.getDotColor(r,xe)),xe.setAttributeNS(null,"r",xe.getAttribute("r")/1.5);var n=e.getScreenPt(t);if(Oe){var i=oe.diff(n,Vt.deltaPoint);if(e.movePointByDrag(i.x,i.y),$e.reshape(r),$e.isTip(xe)&&!dt.isCloseDPath(r)){var a=$e.getClosestPath(n,r,Object(s.q)("layer1"),$e.maxDistance());if(!a)return;a!=r&&(r=$e.join(r,a,n))}$e.showDots(r)}else $e.deleteDot(xe,r)}},{key:"removeShape",value:function(){null!=xe&&(xe.parentNode.removeChild(xe),xe=void 0)}},{key:"rectClick",value:function(t){if(xe){e.removeShape(t);var r=(xe=yt.addRect(Object(s.q)("layer1"),Vt.initialPoint.x,Vt.initialPoint.y)).getAttribute("stroke"),n={width:16/Vt.currentZoom,height:16/Vt.currentZoom};for(var i in n)xe.setAttribute(i,n[i]);for(var a in e.rectMouseUp(t),n={fill:r,"stroke-width":4})xe.setAttribute(a,n[a]);Ve.record()}}},{key:"ellipseClick",value:function(t){if(xe){e.removeShape(t);var r=(xe=yt.addEllipse(Object(s.q)("layer1"),Vt.initialPoint.x,Vt.initialPoint.y)).getAttribute("stroke"),n={rx:8/Vt.currentZoom,ry:8/Vt.currentZoom};for(var i in n)xe.setAttribute(i,n[i]);for(var a in e.ellipseMouseUp(t),n={fill:r,"stroke-width":4})xe.setAttribute(a,n[a]);Ve.record()}}},{key:"pathClick",value:function(t){(xe=De.findWho(t))&&"yes"!=xe.getAttribute("fixed")&&e.setStrokeSizeAndColor()}},{key:"triClick",value:function(t){if(xe){e.removeShape(t),xe=yt.addTriangle(Object(s.q)("layer1"),Vt.initialPoint.x,Vt.initialPoint.y);var r=16/Vt.currentZoom,n=16/Vt.currentZoom,i=Vt.initialPoint.x,a=Vt.initialPoint.y,o=[["M",i,a+n],["L",i+.5*r,a],["L",i+r,a+n],["L",i,a+n]],l=dt.arrayToString(o);l+="z";var c={fill:xe.getAttribute("stroke"),"stroke-width":2,d:l};for(var u in c)xe.setAttribute(u,c[u]);Ve.record()}}},{key:"selectClick",value:function(t){if(we&&(we=void 0,xe&&!(xe&&xe.parentNode&&"g"==xe.parentNode.tagName&&"layer1"!=xe.parentNode.id||xe&&"staticbkg"==xe.id||xe&&"g"==xe.tagName))){var r=e.getScreenPt(t);oe.len(oe.diff(r,Vt.initialPoint))>10||($e.selector&&$e.selector==xe&&$e.addDot($e.selector),$e.selector||$e.enterEditMode(xe))}}},{key:"paintBucketClick",value:function(){}},{key:"getMouseTarget",value:function(e){var t;if(null==e)return null;if(!(t=window.event?window.event.srcElement:e.target))return null;if(t.correspondingUseElement&&(t=t.correspondingUseElement),"maincanvas"==t.id)return t.childNodes[0];if("workspacebkg"==t.id)return t;for(;t&&Vt.xmlns!=t.namespaceURI&&t!=Vt.root&&t!=Vt.frame;)t=t.parentNode;return t&&t.parentNode?t.parentNode.id.indexOf("group_")>-1?t.parentNode:t:null}},{key:"getScreenPt",value:function(t){var r=K.getTargetPoint(t);return e.zoomPt(r)}},{key:"zoomPt",value:function(e){if(!Object(s.q)("maincanvas"))return e;var t=Vt.root.createSVGPoint();t.x=e.x,t.y=e.y;var r=t.matrixTransform(Vt.root.getScreenCTM().inverse());return s.v&&(r.x=r.x/Vt.currentZoom,r.y=r.y/Vt.currentZoom),r}},{key:"target",set:function(e){Se=e}},{key:"dragGroup",get:function(){return _e}}],(r=null)&&ke(t.prototype,r),n&&ke(t,n),e}(),Ae={select:je.selectMouseDown,rotate:je.fingerDown,tri:je.triMouseDown,rect:je.rectMouseDown,path:je.pathMouseDown,ellipse:je.ellipseMouseDown,grab:je.grabMouseDown,paintbucket:je.fingerDown,stamper:je.cloneMouseDown,scissors:je.cloneMouseDown,camera:je.fingerDown},Pe={select:je.selectMouseMove,rotate:je.rotateMouseMove,tri:je.triMouseMove,rect:je.rectMouseMove,path:je.pathMouseMove,ellipse:je.ellipseMouseMove,grab:je.grabMouseMove,paintbucket:je.paintBucketMouseMove,stamper:je.cloneMouseMove,scissors:je.cloneMouseMove,camera:je.fingerMove},Te={select:je.selectMouseUp,rotate:je.rotateMouseUp,tri:je.triMouseUp,rect:je.rectMouseUp,path:je.pathMouseUp,ellipse:je.ellipseMouseUp,grab:je.grabMouseUp,paintbucket:je.paintBucketMouseUp,stamper:je.ignoreEvt,scissors:je.scissorsMouseUp,camera:je.cameraMouseUp},Ne={select:je.selectClick,rotate:je.ignoreEvt,tri:je.triClick,rect:je.rectClick,path:je.pathClick,ellipse:je.ellipseClick,grab:je.ignoreEvt,paintbucket:je.paintBucketClick,stamper:je.cloneMouseUp,scissors:je.ignoreEvt,camera:je.ignoreEvt};function Ee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Be=document.createElement("canvas"),Ie={},Me=16,De=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"highlight",value:function(t){e.clearLayer();var r=yt.createGroup(Object(s.q)("draglayer"),"ghostgroup");r.setAttribute("class","active3d");for(var n=0;n<t.length;n++)e.hightlightElem(r,t[n],.5,"5,5","black",3)}},{key:"hightlightElem",value:function(t,r,n,i,a,o){if("g"==r.tagName)for(var s=0;s<r.childElementCount;s++)e.hightlightElem(t,r.childNodes[s],n,i,a,o);else e.hasGhost(r)&&e.getKid(t,r,n,i,a,o)}},{key:"hasGhost",value:function(e){if(!e.id)return!0;if(e.id.indexOf("Border")<0)return!0;var t=e.id.split("Border")[0];return""==t||!Object(s.q)(t)}},{key:"clearLayer",value:function(){var e=Object(s.q)("draglayer");if(e)for(;e.childElementCount>0;)e.removeChild(e.childNodes[0])}},{key:"findTarget",value:function(t){if(e.clearLayer(),null==t)return null;var r=je.getScreenPt(t);return e.outsideArea(oe.floor(oe.scale(r,Vt.currentZoom)),Be)?null:e.allTools(r)}},{key:"findWho",value:function(t){if(e.clearLayer(),null==t)return null;var r=je.getScreenPt(t),n=e.getPtColor(r),i=Ie[n],a=i&&Object(s.q)(i)?Object(s.q)(i):null;return a&&"yes"!=a.getAttribute("fixed")?a:e.getHitObject(r)}},{key:"allTools",value:function(t){var r=e.getPtColor(t),n=Ie[r];return n?e.hitSomething(t,n,r):e.notHitted(t)}},{key:"hitSomething",value:function(t,r){var n=Object(s.q)(r),i=!0;switch(n&&n.getAttribute("relatedto")&&(n=Object(s.q)(n.getAttribute("relatedto"))),Vt.mode){case"select":case"rotate":case"stamper":case"scissors":case"path":"yes"==n.getAttribute("fixed")&&(n=e.getHitObject(t,"path"==Vt.mode)),i=!!n&&"yes"!=n.getAttribute("fixed");break;case"paintbucket":case"camera":n=e.getHitObject(t,"path"==Vt.mode)}return n&&i?e.setGhostTo(n):null}},{key:"svgHit",value:function(t){var r=Vt.root.createSVGRect();r.x=t.x,r.y=t.y,r.width=1,r.height=1;var n=Vt.root.getIntersectionList(r,null);return null!==n?n:e.svgHitHelper(Object(s.q)("layer1"),t)}},{key:"svgHitHelper",value:function(e,t){var r=[];if(!e)return r;for(var n=e.getElementsByTagName("path"),i=0;i<n.length;++i){var a=n[i].getAttribute("d");a&&ye.a.path.isPointInside(a,t.x,t.y)&&r.push(n[i])}return r}},{key:"setGhostTo",value:function(t){var r=yt.createGroup(Object(s.q)("draglayer"),"ghostlayer");return e.setDashBorder(r,t,.7,"5,5","black",3),t}},{key:"notHitted",value:function(t){var r;switch(Vt.mode){case"select":case"rotate":case"stamper":case"scissors":(r=e.getActualHit(e.getHitObject(t,"path"!=Vt.mode),t))&&r.id&&(r.getAttribute("relatedto")&&(r=Object(s.q)(r.getAttribute("relatedto"))),(r.id.indexOf("staticbkg")>-1||"yes"==r.getAttribute("stencil")||"yes"==r.getAttribute("fixed"))&&(r=void 0));break;case"camera":case"paintbucket":var n=e.getHitObject(t,!1),i=e.getActualHit(n,t);i&&"g"!=i.nodeName&&(r=i)}return r?e.setGhostTo(r):null}},{key:"getActualHit",value:function(t,r){if(!t)return null;r=oe.floor(oe.scale(r,Vt.currentZoom));for(var n=Xe.findUnderMe(t),i=0;i<n.length;i++){var a=n[i];e.contains(t,a)&&e.hittedSingleObject(a,r)&&(t=a)}return t}},{key:"contains",value:function(e,t){var r=yt.getBox(e),n=yt.getBox(t),i=r.intersection(n);return!i.isEmpty()&&i.isEqual(n)}},{key:"hittedSingleObject",value:function(e,t){var r=Kn.workingCanvas.getContext("2d");return r.clearRect(0,0,Kn.workingCanvas.width,Kn.workingCanvas.height),r.save(),Xe.drawInContext(e,r,Vt.currentZoom),r.restore(),0!=r.getImageData(t.x,t.y,1,1).data[3]}},{key:"getPtColor",value:function(t){if(t=oe.floor(oe.scale(t,Vt.currentZoom)),e.outsideArea(t,Be))return 0;var r=Be.getContext("2d").getImageData(t.x,t.y,1,1).data,n=r[0],i=r[1],a=r[2];return e.getHex([n,i,a])}},{key:"outsideArea",value:function(e,t){return e.x<0||e.x>t.width-1||e.y<0||e.y>t.height-1}},{key:"setDashBorder",value:function(t,r,n,i,a,o){if("g"==r.tagName)for(var s=0;s<r.childElementCount;s++)e.setDashBorder(t,r.childNodes[s],n,i,a,o);else e.getKid(t,r,n,i,a,o)}},{key:"getKid",value:function(e,t,r,n,i,a){a||(a=t.getAttribute("stroke-width"));var o=yt.attributeTable[t.tagName];o||(o=[]);var s=yt.attributePenTable[t.tagName];s||(s=[]);var l=document.createElementNS(Vt.xmlns,t.tagName);e.appendChild(l),o=o.concat(s);for(var c=0;c<o.length;c++)null!=t.getAttribute(o[c])&&l.setAttribute(o[c],t.getAttribute(o[c]));l.setAttribute("fill","none"),l.setAttribute("stroke",i),l.setAttribute("stroke-width",a/Vt.currentZoom),l.setAttribute("class","active3d");var u=pt.getRotationAngle(t);0!=u&&pt.applyRotation(l,u),r&&l.setAttribute("opacity",r);var d=document.createElementNS(Vt.xmlns,t.tagName);e.appendChild(d),o=o.concat(s);for(var h=0;h<o.length;h++)null!=t.getAttribute(o[h])&&d.setAttribute(o[h],t.getAttribute(o[h]));return d.setAttribute("fill","none"),d.setAttribute("stroke","white"),d.setAttribute("stroke-width",3/Vt.currentZoom),d.setAttribute("stroke-dasharray",n),d.setAttribute("class","active3d"),r&&d.setAttribute("opacity",r),0!=u&&pt.applyRotation(d,u),d}},{key:"drawOffscreen",value:function(){Object(s.I)(Be,Math.round(Number(Vt.root.getAttribute("width"))*Vt.currentZoom),Math.round(Number(Vt.root.getAttribute("height"))*Vt.currentZoom));var t=Be.getContext("2d");t.clearRect(0,0,Be.width,Be.height);var r=Object(s.q)("layer1");r&&(Ie={},Me=16,e.drawElements(r,t))}},{key:"drawElements",value:function(t,r){for(var n=0;n<t.childElementCount;n++){var i=t.childNodes[n];"pathdots"!=i.id&&"image"!=i.tagName&&"clipPath"!=i.tagName&&("g"==i.nodeName?e.drawElements(i,r):e.drawElement(i,r))}}},{key:"drawElement",value:function(t,r){var n=e.getRGB(Me),i=e.getRGB(Me+8);Me+=16,r.save();var a=!t.getAttribute("stroke")||"none"==t.getAttribute("stroke"),o=Number(t.getAttribute("stroke-width"));r.lineWidth=a?0:o,r.fillStyle="none"==t.getAttribute("fill")?"rgba(0,0,0,0)":"rgba("+n[0]+","+n[1]+","+n[2]+",255)",r.strokeStyle=t.getAttribute("stroke")?"rgba("+i[0]+","+i[1]+","+i[2]+",255)":"rgba(0,0,0,0)",dt.isCloseDPath(t)||(r.strokeStyle="rgba("+n[0]+","+n[1]+","+n[2]+",255)"),t.id.indexOf("pathborder_image")>-1&&(r.fillStyle="rgba("+n[0]+","+n[1]+","+n[2]+",255)"),t.getAttribute("fill")||t.getAttribute("stroke")||(r.fillStyle="rgba("+i[0]+","+i[1]+","+i[2]+",255)"),Ie[e.getHex(n)]=t.id,Ie[e.getHex(i)]=t.id;var s=pt.extract(t,4);0!=s.angle&&Xe.rotateFromCenter(r,t,s.angle),r.scale(Vt.currentZoom,Vt.currentZoom),dt.processXMLnode(t,r,!0),r.restore(),dt.isCloseDPath(t)||(r.save(),r.scale(Vt.currentZoom,Vt.currentZoom),r.lineWidth=16<o?o:16,r.fillStyle="rgba("+n[0]+","+n[1]+","+n[2]+",255)",r.strokeStyle="rgba("+i[0]+","+i[1]+","+i[2]+",255)",0!=(s=pt.extract(t,4)).angle&&Xe.rotateFromCenter(r,t,s.angle),dt.renderPathTips(t,r),r.restore())}},{key:"getRGB",value:function(e){return[Number(e>>16&255),Number(e>>8&255),Number(255&e)]}},{key:"getHex",value:function(e){var t=e[0].toString(16);t.length<2&&(t="0"+t);var r=e[1].toString(16);r.length<2&&(r="0"+r);var n=e[2].toString(16);return n.length<2&&(n="0"+n),t+r+n}},{key:"getHitObject",value:function(t,r,n){var i=e.svgHit(t);if(t=oe.floor(oe.scale(t,Vt.currentZoom)),!Vt.root)return!1;Object(s.I)(Kn.workingCanvas,Math.round(Vt.root.getAttribute("width")*Vt.currentZoom),Math.round(Vt.root.getAttribute("height")*Vt.currentZoom));var a=Kn.workingCanvas.getContext("2d");return e.outsideArea(t,Kn.workingCanvas)?null:(a.clearRect(0,0,Kn.workingCanvas.width,Kn.workingCanvas.height),e.findHit(i,t,Kn.workingCanvas.getContext("2d"),r,n))}},{key:"findHit",value:function(e,t,r,n,i){for(var a=e.length-1;a>=0;a--){var o=e[a];if(!i||o!=i){var s=o.getAttribute("stroke-width")?o.getAttribute("stroke-width"):0;if(r.save(),Xe.drawInContext(o,r,Vt.currentZoom,s,n),r.restore(),0!=r.getImageData(t.x,t.y,1,1).data[3])return o}}return null}},{key:"showmask",value:function(){var e=Object(s.A)(Vt.frame,0,0,Be.width,Be.height,{position:"absolute",zIndex:Kn.layerTop+20});e.setAttribute("id","ghostmask"),e.appendChild(Be)}},{key:"off",value:function(){Object(s.q)("ghostmask").style.visibility="hidden"}},{key:"on",value:function(){Object(s.q)("ghostmask").style.visibility="visible"}},{key:"maskCanvas",get:function(){return Be}},{key:"maskData",get:function(){return Ie},set:function(e){Ie=e}},{key:"linemask",get:function(){return 16}}],(r=null)&&Ee(t.prototype,r),n&&Ee(t,n),e}();function Re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var qe="front",Le=void 0,Fe=!1,ze=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"startFeed",value:function(t){x.sndFX("entertap.wav"),Vt.canvasFits()||Vt.scaleToFit(),Le=t,e.active=!0;var r=window.devicePixelRatio,n=yt.getBox(Le).rounded(),i=new ie(0,0,Vt.workspaceWidth,Vt.workspaceHeight);(n=n.expandBy(20)).crop(i);var a=e.getLayerMask(Le),o=new Object,l=Math.floor((n.x+n.width/2)*Vt.currentZoom-n.width/2),c=Math.floor((n.y+n.height/2)*Vt.currentZoom-n.height/2);o.x=Object(s.o)(Object(s.q)("workspacebkg"))+l+Object(s.q)("maincanvas").dx+Object(s.q)("maincanvas").cx-Object(s.q)("maincanvas").cx*Vt.currentZoom,o.y=Object(s.p)(Object(s.q)("workspacebkg"))+c+Object(s.q)("maincanvas").dy+Object(s.q)("maincanvas").cy-Object(s.q)("maincanvas").cy*Vt.currentZoom,o.width=n.width,o.height=n.height,o.scale=Vt.currentZoom,o.devicePixelRatio=r,o.mx=Object(s.o)(Object(s.q)("workspacebkg"))+Object(s.q)("maincanvas").dx,o.my=Object(s.p)(Object(s.q)("workspacebkg"))+Object(s.q)("maincanvas").dy,o.mw=Vt.workspaceWidth,o.mh=Vt.workspaceHeight,o.image=a.toDataURL("image/png"),zr.startfeed(o,zr.trace),Vt.cameraToolsOn()}},{key:"prepareForLandscapeMode",value:function(e){var t=document.createElement("canvas");Object(s.I)(t,e.height,e.width);var r=t.getContext("2d"),n=Math.min(e.width,e.height),i=(Math.max(e.width,e.height)-n)/2,a={x:e.width/2,y:e.height/2};return r.translate(a.x,a.y),r.rotate(90*s.c),r.translate(-a.x,-a.y),r.drawImage(e,i,i),t}},{key:"doAction",value:function(t){switch(t){case"cameraflip":x.sndFX("tap.wav"),qe="front"==qe?"back":"front",zr.choosecamera(qe,e.flip);break;case"camerasnap":e.snapShot(),Vt.cameraToolsOff();break;case"cammera":e.close(),Vt.selectButton("select");break;default:e.close(),Vt.selectButton(t)}}},{key:"close",value:function(){Le=void 0,qe="front",e.active=!1,zr.stopfeed(),Vt.cameraToolsOff(),s.t&&Kn.onBackButtonCallback.pop()}},{key:"snapShot",value:function(){zr.captureimage("Camera.processimage")}},{key:"getLayerMask",value:function(t){var r,n;if(s.t){var i=Object(s.q)("maincanvas").getBoundingClientRect();r=i.width,n=i.height}else r=Vt.workspaceWidth,n=Vt.workspaceHeight;var a=document.createElement("canvas");Object(s.I)(a,r,n);var o=a.getContext("2d");o.fillStyle=Kn.stagecolor,o.fillRect(0,0,a.width,a.height),s.t&&(o.save(),o.scale(Vt.currentZoom,Vt.currentZoom)),dt.drawImage(Object(s.q)("paintgrid"),o);var l=t.parentNode&&"layer1"!=t.parentNode.id,c=l?Xe.groupStartsAt(Object(s.q)("layer1"),t.parentNode):Xe.groupStartsAt(Object(s.q)("layer1"),t);if(e.drawLayers(Object(s.q)("layer1"),o,0,c),l){var u=Xe.groupStartsAt(t.parentNode,t);e.drawLayers(t.parentNode,o,0,u)}return e.drawHole(t,o),l&&e.drawLayers(t.parentNode,o,u+1,t.parentNode.childElementCount),e.drawLayers(Object(s.q)("layer1"),o,c+1,Object(s.q)("layer1").childElementCount),s.t&&o.restore(),a}},{key:"drawLayers",value:function(e,t,r,n){for(var i=Math.min(r,e.childElementCount),a=Math.min(n,e.childElementCount),o=i;o<a;o++)dt.drawLayer(e.childNodes[o],t,dt.drawLayer)}},{key:"drawHole",value:function(e,t){t.save(),t.globalCompositeOperation="destination-out",dt.drawElementHole(e,t),t.restore(),t.fillStyle="rgba(0, 0, 0,0)",t.strokeStyle=e.getAttribute("stroke")?e.getAttribute("stroke"):"none",t.lineCap=e.getAttribute("stroke-linecap")?e.getAttribute("stroke-linecap"):dt.strokevalues["stroke-linecap"],t.lineWidth=e.getAttribute("stroke-width")?Number(e.getAttribute("stroke-width")):Number(dt.strokevalues["stroke-width"]),t.miterLimit=e.getAttribute("stroke-miterlimit")?e.getAttribute("stroke-miterlimit"):dt.strokevalues["stroke-miterlimit"],t.linejoin=e.getAttribute("stroke-linejoin")?e.getAttribute("stroke-linejoin"):dt.strokevalues["stroke-linejoin"],dt.processXMLnode(e,t,!0)}},{key:"processimage",value:function(t){Le&&("error getting a still"!=t&&rt.addCameraFill(Le,t),e.close(),Vt.cameraToolsOff(),Vt.selectButton("select"),"error getting a still"!=t&&(Ve.record(),De.drawOffscreen()))}},{key:"available",get:function(){return Fe},set:function(e){Fe=e}}],(r=null)&&Re(t.prototype,r),n&&Re(t,n),e}();function He(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}window.Camera=ze;var Ue=[],We=0,Ve=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"setup",value:function(t){var r=Object(s.B)("div","paintundo",t);r.setAttribute("id","paintundocontrols");for(var n=[["undo",e.undo],["redo",e.redo]],i=0;i<n.length;i++)e.newToggleClicky(r,"id_p",n[i][0],n[i][1]).offsetWidth;e.updateActiveUndo()}},{key:"newToggleClicky",value:function(e,t,r,n){var i=Object(s.B)("div","undocircle",e);return Object(s.B)("div",r+" off",i),i.setAttribute("type","toggleclicky"),i.setAttribute("id",t+r),n&&(s.u?i.ontouchstart=function(e){n(e)}:i.onmousedown=function(e){n(e)}),i}},{key:"runUndo",value:function(){$e.quitEditMode(),Vt.root.removeChild(Object(s.q)("layer1")),Vt.root.appendChild(yt.toObject(Ue[We])),Vt.root.appendChild(Object(s.q)("draglayer")),Vt.root.appendChild(Object(s.q)("paintgrid")),Vt.setZoomTo(Vt.currentZoom)}},{key:"record",value:function(t){We+1<=Ue.length&&Ue.splice(We+1,Ue.length),Ue.push(e.getCanvas()),We++,Object(s.q)("id_pundo")&&e.updateActiveUndo(),t||Kn.storyStart("PaintUndo.record")}},{key:"getCanvas",value:function(){return yt.svg2string(Object(s.q)("layer1"))}},{key:"undo",value:function(t){if(!(t.touches&&t.touches.length>1)){for(t.preventDefault(),t.stopPropagation(),ze.active&&ze.doAction("undo");We>=Ue.length;)We--;var r=--We<0?"boing.wav":"tap.wav";x.sndFX(r),We<0?We=0:e.runUndo(),e.updateActiveUndo()}}},{key:"redo",value:function(t){if(!(t.touches&&t.touches.length>1)){t.preventDefault(),t.stopPropagation(),ze.active&&ze.doAction("undo");var r=++We>Ue.length-1?"boing.wav":"tap.wav";x.sndFX(r),We>Ue.length-1?We=Ue.length-1:e.runUndo(),e.updateActiveUndo()}}},{key:"updateActiveUndo",value:function(){Object(s.q)("id_pundo")&&(1==Ue.length?e.tunOffButton(Object(s.q)("id_pundo")):We<1?e.tunOffButton(Object(s.q)("id_pundo")):e.tunOnButton(Object(s.q)("id_pundo")),We>=Ue.length-1?e.tunOffButton(Object(s.q)("id_predo")):e.tunOnButton(Object(s.q)("id_predo")))}},{key:"tunOnButton",value:function(e){var t=e.childNodes[0],r=t.getAttribute("class").split(" ")[0];t.setAttribute("class",r+" on")}},{key:"tunOffButton",value:function(e){var t=e.childNodes[0],r=t.getAttribute("class").split(" ")[0];t.setAttribute("class",r+" off")}},{key:"buffer",set:function(e){Ue=e}},{key:"index",get:function(){return We},set:function(e){We=e}}],(r=null)&&He(t.prototype,r),n&&He(t,n),e}();function Ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ke=document.createElement("canvas"),Ze=document.createElement("canvas"),Xe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"bringToFront",value:function(t){if(t&&"yes"!=t.getAttribute("fixed")&&t.parentNode){for(;t.parentNode&&"layer1"!=t.parentNode.id;)t=t.parentNode;for(var r=e.groupStartsAt(Object(s.q)("layer1"),t),n=e.onTopOfBy(Object(s.q)("layer1"),t,1,r,e.getRelated(t)),i=t.parentNode,a=0;a<n.length;a++)i.appendChild(n[a]);n.length>1&&Ve.record()}}},{key:"bringElementsToFront",value:function(){for(var e=[],t=0;t<Object(s.q)("layer1").childElementCount;t++){var r=Object(s.q)("layer1").childNodes[t];"yes"!=r.getAttribute("fixed")&&"yes"!=r.getAttribute("stencil")&&e.push(r)}for(t=0;t<e.length;t++)Object(s.q)("layer1").appendChild(e[t])}},{key:"onTopOf",value:function(e,t){for(var r=[],n=t;n<e.childElementCount;n++)r.push(e.childNodes[n]);return r}},{key:"ordering",value:function(e,t){for(var r=[],n=0;n<e.childElementCount;n++)t.indexOf(e.childNodes[n])>-1&&r.push(e.childNodes[n]);return r}},{key:"groupStartsAt",value:function(e,t){for(var r=0;r<e.childElementCount;r++)if(e.childNodes[r]==t)return r;return r}},{key:"onTopOfBy",value:function(t,r,n,i,a){i=Math.max(0,i),e.drawInOffscreen(r,Ke);for(var o=i;o<t.childElementCount;o++){var s=t.childNodes[o];if("yes"!=s.getAttribute("stencil")&&"yes"!=s.getAttribute("fixed")&&"clipPath"!=s.nodeName&&"image"!=s.nodeName&&!(s.id.indexOf("group_image_")>-1||a.indexOf(s)>-1)){var l=e.overlapBox(r,s);if(1!=l){if(l>n||l>.34&&yt.getArea(s)/yt.getArea(r)<.1){if(!(c=e.verifyCollision(r,s)))continue;a.indexOf(s)<0&&(a=a.concat(e.getRelated(s))),e.onTopOfBy(t,s,n,o,a),e.drawInOffscreen(r,Ke)}}else{var c=e.verifyCollision(r,s);if(!c)continue;a=a.concat(e.getRelated(s))}}}return a}},{key:"addFromBelow",value:function(t,r,n,i){n=Math.min(t.childElementCount,n);for(var a=0;a<n;a++){var o=t.childNodes[a];"yes"!=o.getAttribute("stencil")&&"yes"!=o.getAttribute("fixed")&&"clipPath"!=o.nodeName&&"image"!=o.nodeName&&(i.indexOf(o)>-1||"none"==o.getAttribute("fill")&&e.overlapBox(r,o)>.5&&i.indexOf(o)<0&&(i=i.concat(e.getRelated(o))))}return i}},{key:"getRelated",value:function(e){var t=[];if(e.id.indexOf("pathborder_image")>-1){var r=e.id.substring(String("pathborder_").length,e.id.length),n=Object(s.q)("group_"+r);if(n)t.push(n);else{var i=rt.getImage(e);i&&t.push(i);var a=rt.getPathMask(e);a&&t.push(a)}}return t.push(e),t}},{key:"inContactWith",value:function(t,r,n,i){for(var a=[],o=i;o<t.childElementCount;o++){var s=t.childNodes[o];s.id!=r.id&&"yes"!=s.getAttribute("stencil")&&e.overlapBox(r,s)>0&&a.push(s)}return a}},{key:"includesBox",value:function(e,t){var r=yt.getBox(e),n=yt.getBox(t);if(n.width*n.height>r.width*r.height)return!1;var i=r.intersection(n);return i.isEmpty()?0:i.isEqual(n)?1:i.isEqual(r)?1:i.width*i.height/(n.width*n.height)==1}},{key:"getContainedMost",value:function(t,r,n,i){t=r.parentNode;for(var a=0;a<n;a++){var o=t.childNodes[a];if(o.id!=r.id&&e.overlapBoxBy(r,o,i))return a}return null}},{key:"overlapBox",value:function(e,t){var r=yt.getBox(e),n=yt.getBox(t);if("g"!=e.nodeName&&"g"!=t.nodeName&&0==$e.getPathCrossing(t,e).length&&n.width*n.height>r.width*r.height)return 0;var i=r.intersection(n);return i.isEmpty()?0:i.isEqual(n)?1:i.width*i.height/(n.width*n.height)}},{key:"insideMe",value:function(e,t){var r=yt.getBox(e),n=yt.getBox(t);return!r.intersection(n).isEmpty()&&0==$e.getPathCrossing(t,e).length&&n.width*n.height>r.width*r.height}},{key:"overlapBoxBy",value:function(t,r,n){return e.overlapBox(t,r)>=n}},{key:"findUnderMe",value:function(t){for(var r=Object(s.q)("layer1"),n=e.groupStartsAt(r,t),i=[],a=yt.getBox(t),o=n-1;o>-1;o--){var l=r.childNodes[o];if("staticbkg"!=l.id&&!(l.id.indexOf("erasertemp")>-1)){var c=yt.getBox(l);a.intersects(c)&&i.push(l)}}return i}},{key:"findGroup",value:function(t){var r=Kn.getTime();Kn.log("findGroup start",r,"sec"),Object(s.I)(Kn.workingCanvas,Vt.workspaceWidth,Vt.workspaceHeight);var n=e.getRelated(t),i=e.groupStartsAt(t.parentNode,t);n="none"==t.getAttribute("fill")&&dt.isCloseDPath(t)&&t.id.indexOf("pathborder_image")<0?e.addFromBelow(t.parentNode,t,i,n):n;var a=e.onTopOfBy(t.parentNode,t,.5,i,n),o=e.ordering(t.parentNode,a);return Kn.log("findGroup end",Kn.getTime()-r,"sec"),o}},{key:"verifyCollision",value:function(t,r){var n=yt.getBox(t),i=yt.getBox(r);if(!n.intersects(i))return!1;var a=n.intersection(i);if(0==a.width)return!1;if(0==a.height)return!1;a.x=Math.floor(a.x),a.y=Math.floor(a.y),a.width=Math.floor(a.width)+2,a.height=Math.floor(a.height)+2,e.drawInOffscreen(r,Ze),Object(s.I)(Kn.workingCanvas,Vt.workspaceWidth,Vt.workspaceHeight);var o=Kn.workingCanvas.getContext("2d");o.clearRect(0,0,Vt.workspaceWidth,Vt.workspaceHeight),o.save(),o.globalCompositeOperation="source-over",o.drawImage(Ze,0,0),o.globalCompositeOperation="source-in",o.drawImage(Ke,0,0),o.restore();for(var l=o.getImageData(a.x,a.y,a.width,a.height).data,c=Math.floor(l.length/4),u=0;u<c;u++){var d={x:u%a.width,y:Math.floor(u/a.width)};if(!e.isTransparent(l,d,a.width))return!0}return!1}},{key:"drawInOffscreen",value:function(t,r){var n=r.getContext("2d");Object(s.I)(r,Vt.workspaceWidth,Vt.workspaceHeight),n.clearRect(0,0,Vt.workspaceWidth,Vt.workspaceHeight);var i=t.getAttribute("stroke-width");n.save(),e.drawInContext(t,n,1,i,!1),n.restore()}},{key:"isTransparent",value:function(e,t,r){return 0==e[4*t.x+t.y*r*4+3]}},{key:"drawInContext",value:function(t,r,n,i,a){var o=pt.extract(t,4);switch(0!=o.angle&&e.rotateFromCenter(r,t,o.angle),r.scale(n,n),r.fillStyle=a&&!dt.isCloseDPath(t)||"image"==t.tagName?"#ff00FF":$e.endDotColor,r.lineWidth=i,r.strokeStyle="#ff00FF",t.getAttribute("fill")||t.getAttribute("stroke")||(r.strokeStyle="rgba(0,0,0,0)",r.fillStyle="#ff00FF"),t.tagName){case"path":a&&!dt.isCloseDPath(t)?("path"!=Vt.mode&&dt.renderPath(t,r),dt.renderPathTips(t,r)):dt.renderPath(t,r);break;case"g":for(var s=0;s<t.childElementCount;s++)r.restore(),r.save(),e.drawInContext(t.childNodes[s],r,n,i,a),r.restore(),r.save();break;default:dt.processXMLnode(t,r,!0)}}},{key:"rotateFromCenter",value:function(e,t,r){var n=yt.getBoxCenter(t);e.translate(n.x,n.y),e.rotate(r*s.c),e.translate(-n.x,-n.y)}},{key:"showmask",value:function(){var e=Object(s.A)(Vt.frame,0,0,Kn.workingCanvas.width,Kn.workingCanvas.height,{position:"absolute",zIndex:2e5,visibility:"visible"});e.setAttribute("id","layermask"),e.appendChild(Kn.workingCanvas)}},{key:"on",value:function(){Object(s.q)("layermask").style.visibility="visible"}},{key:"off",value:function(){Object(s.q)("layermask").style.visibility="hidden"}}],(r=null)&&Ge(t.prototype,r),n&&Ge(t,n),e}();function Ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Je=void 0,$e=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"process",value:function(t){var r=e.getPolyPoints(t),n=r[0];r=e.addPoints(r),(r=e.smoothPoints(r)).unshift(n),r=e.addPoints(r),r=e.deletePoints(r);var i=e.drawBezier(r);return t.parentNode.removeChild(t),i}},{key:"getPolyPoints",value:function(e){for(var t=e.points,r=[],n=0;n<t.numberOfItems;n++)r.push(t.getItem(n));return r}},{key:"smoothPoints",value:function(e){var t,r=e.length,n=[];for(t=0;t<r-1;t++){for(var i=0,a=0,o=-3;o<=3;o++){var s=Math.max(0,t+o);i+=e[s=Math.min(s,r-1)].x,a+=e[s].y}i/=7,a/=7,n.push({x:i,y:a})}return n.push(e[r-1]),n}},{key:"addPoints",value:function(t){for(var r=0,n=!0;n;){var i=e.fillWithPoints(t);if(n=i[0],++r>10)return i[1]}return i[1]}},{key:"fillWithPoints",value:function(e){for(var t=e.length,r=1,n=!1,i=[e[0]];r<t-1;){var a=e[r],o=e[r+1],s=oe.len(oe.diff(o,a));if(i.push(e[r]),s>5){var l=oe.mid(a,o);i.push({x:l.x,y:l.y}),n=!0}r++}return i.push(e[t-1]),[n,i]}},{key:"deletePoints",value:function(e){var t=e.length,r=1,n=0,i=[];i.push(e[0]);for(var a,o,l,c=s.u?40:30;r<t-1;){a=e[n],o=e[r],l=e[r+1];var u=oe.diff(a,o),d=oe.diff(l,o),h=oe.len(u)*oe.len(d);0==h&&(h=.01),(oe.dot(u,d)/h>-.9||oe.len(d)>c||oe.len(u)>c)&&(i.push(e[r]),n=r),r++}return a=e[t-2],o=e[t-1],i.length>2&&oe.len(oe.diff(a,o))<3&&i.pop(),i.push(e[t-1]),i}},{key:"drawBezier",value:function(t){var r=t[0],n=yt.addPath(Object(s.q)("layer1"),r.x,r.y);if(t.length<2)return n;var i=e.getBezier(t);return n.setAttributeNS(null,"d",i),n}},{key:"getBezier",value:function(t){dt.lastcxy=t[0];var r=t[t.length-1],n="M"+dt.lastcxy.x+","+dt.lastcxy.y,i="";if(t.length<3)i=e.lineSeg(t[1]);else{for(var a=oe.len(oe.diff(t[0],r)),o=e.curveSeg(t[0],t[1],t[2]),s=2;s<t.length-1;s++)i+=e.curveSeg(t[s-1],t[s],t[s+1]);0==a?(i+=e.curveSeg(t[t.length-2],r,t[1]),o=e.curveSeg(t[0],t[1],t[2])):i+=e.curveSeg(t[t.length-2],r,r),n+=o}return n+=i}},{key:"getControlPoint",value:function(e,t,r){var n,i=oe.len(oe.diff(e,t)),a=oe.len(oe.diff(t,r)),o=oe.len(oe.diff(e,r));n=i+a==0?0:o/(i+a);var s=Math.min(i,a),l=oe.diff(e,t),c=oe.diff(r,t),u=oe.sum(oe.norm(l),oe.norm(c)),d=oe.perp(u);if(oe.dot(d,c)<0&&(d=oe.neg(d)),0==u.x||0==u.y){var h=(Math.sqrt(2)-1)/3*4;d=oe.norm(d);var f=oe.dot(oe.diff(t,e),d);return oe.diff(t,oe.scale(d,f*h))}return oe.diff(t,oe.scale(d,n*n*s*.666))}},{key:"curveSeg",value:function(t,r,n){var i=e.getControlPoint(t,r,n),a=oe.sum(t,oe.diff(t,dt.lastcxy));return dt.lastcxy=i,"C"+a.x+","+a.y+","+i.x+","+i.y+","+r.x+","+r.y}},{key:"makeRectangle",value:function(t,r){var n=r[0],i=yt.addPath(t,n.x,n.y),a=e.getRectangularD(r);return i.setAttributeNS(null,"d",a),i.setAttribute("fill","none"),i}},{key:"getRectangularD",value:function(t){for(var r=t[0],n="M"+r.x+","+r.y,i=1;i<t.length;i++)n+=e.lineSeg(t[i]);return n+=e.lineSeg(t[0]),n+="z"}},{key:"lineSeg",value:function(e){return dt.lastcxy=e,"L"+e.x+","+e.y}},{key:"moveToCmd",value:function(e){return dt.lastcxy=e,"M"+e.x+","+e.y}},{key:"convertPoints",value:function(t){for(var r=e.getPolyPoints(t),n="M"+r[0].x+","+r[0].y,i=1;i<r.length;i++)n+=e.lineSeg(r[i]);n+="z";var a=e.getStylingFrom(t);a.d=n,a.id=Object(s.l)("path"),a["stroke-miterlimit"]=t.getAttribute("stroke-miterlimit");var o=yt.addChild(Object(s.q)("layer1"),"path",a);return t.parentNode.removeChild(t),o}},{key:"getStylingFrom",value:function(e){return{opacity:1,fill:e.getAttribute("fill"),stroke:e.getAttribute("stroke"),"stroke-width":e.getAttribute("stroke-width")}}},{key:"makeEllipse",value:function(t){var r=Number(t.getAttribute("rx")),n=Number(t.getAttribute("ry")),i=Number(t.getAttribute("cx")),a=Number(t.getAttribute("cy")),o=(Math.sqrt(2)-1)/3*4,l=[["M",i-r,a],["C",i-r,a-n*o,i-r*o,a-n,i,a-n],["C",i+r*o,a-n,i+r,a-n*o,i+r,a],["C",i+r,a+n*o,i+r*o,a+n,i,a+n],["C",i-r*o,a+n,i-r,a+n*o,i-r,a]],c=e.getStylingFrom(t);return c.d=dt.arrayToString(l),c.id=Object(s.l)("path"),c["stroke-miterlimit"]=t.getAttribute("stroke-miterlimit"),yt.addChild(Object(s.q)("layer1"),"path",c)}},{key:"getAnchorpoints",value:function(e){for(var t=dt.getCommandList(e),r=[],n=0;n<t.length;n++)"z"!=dt.getAbsoluteCommand(t[n])[0]&&r.push(dt.endp);return r}},{key:"getPointsAndCmds",value:function(t){return e.getCommands(t.getAttribute("d"))}},{key:"getCommands",value:function(e){for(var t,r=dt.getCommandList(e),n=[],i=0;i<r.length;i++){var a=dt.getAbsoluteCommand(r[i]);"m"==a[0].toLowerCase()&&(t=dt.endp),"z"!=a[0].toLowerCase()?n.push({cmd:a[0],pt:dt.endp}):n.push({cmd:a[0],pt:t})}return n}},{key:"getPointsForFirst",value:function(t){var r,n=t.getAttribute("d").match(/[M][^M]*/g);return r=n?n[0]:t.getAttribute("d"),e.getCommands(r)}},{key:"getDattribute",value:function(t){dt.lastcxy=t[0].pt;var r="M"+dt.lastcxy.x+","+dt.lastcxy.y,n="";if(t.length<3)return"z"==t[1].cmd.toLowerCase()?null:r+e.lineSeg(t[1].pt);Vt.skipNext=!1;for(var i=e.thisCommand(t,1),a=t[1],o=t[t.length-1],s=oe.len(oe.diff(t[0].pt,o.pt)),l="C"==a.cmd&&"C"==o.cmd&&0==s?"ellipse":"C"==a.cmd&&"C"==t[t.length-2].cmd&&"z"==o.cmd.toLowerCase()?"closecurve":"L"==a.cmd&&"L"==t[t.length-2].cmd&&0==s?"polygon":"C"==a.cmd&&"C"==o.cmd?"curve":"line",c=2;c<t.length-1;c++)n+=e.thisCommand(t,c);switch(l){case"ellipse":n+=e.curveSeg(t[t.length-2].pt,o.pt,a.pt),i=e.curveSeg(t[0].pt,a.pt,t[2].pt);break;case"closecurve":case"polygon":n+="z";break;case"curve":n+=e.curveSeg(t[t.length-2].pt,o.pt,o.pt);break;case"line":n+="z"==o.cmd.toLowerCase()?"z":e.lineSeg(o.pt);break;default:n+=e.lineSeg(o.pt)}return r+i+n}},{key:"thisCommand",value:function(t,r){var n,i=t[r].cmd,a=t[r].pt;if(Vt.skipNext)return Vt.skipNext=!1,"";if(e.skipCmd(t,r))return"";switch(i.toUpperCase()){case"C":case"S":var o=t[r-1].pt,s=t[r+1].pt;n=e.curveSeg(o,a,s);break;case"Z":n="Z";break;case"M":n=e.moveToCmd(a);break;default:n=e.lineSeg(a)}return n}},{key:"skipCmd",value:function(e,t){var r=e[t].cmd.toLowerCase(),n=e[t+1].cmd.toLowerCase();return"m"==r&&"m"==n||"m"==r&&"z"==n&&(Vt.skipNext=!0,!0)}},{key:"maxDistance",value:function(){return 20/Vt.currentZoom}},{key:"importPath",value:function(t){var r=t.getAttribute("d"),n=dt.getCommandList(r),i=e.adaptPath(n),a=dt.arrayToString(i);t.setAttribute("d",a)}},{key:"adaptPath",value:function(e){var t,r=[],n={x:e[0][1],y:e[0][2]};r.push(e[0]);for(var i=1;i<e.length;i++){var a=e[i].concat();switch(a.shift().toLowerCase()){case"h":n={x:a[0],y:n.y},r.push(["L",n.x,n.y]);break;case"v":n={x:n.x,y:a[0]},r.push(["L",n.x,n.y]);break;case"l":n={x:a[0],y:a[1]},r.push(["L",n.x,n.y]);break;case"c":var o={x:a[(t=a.length)-2],y:a[t-1]},s={x:a[0],y:a[1]};0==Math.floor(oe.len(oe.diff(n,s)))&&r.push(["L",n.x,n.y]),r.push(e[i]);var l={x:a[t-4],y:a[t-3]};0==Math.floor(oe.len(oe.diff(l,o)))&&r.push(["L",o.x,o.y]),n=o;break;case"z":r.push(e[i]);break;default:n={x:a[(t=a.length)-2],y:a[t-1]},r.push(e[i])}}return r}},{key:"showDots",value:function(t){pt.applyToCmds(t,pt.combineAll(t)),pt.eliminateAll(t);var r=e.getPointsForFirst(t),n=Object(s.q)("pathdots");null!=n&&n.parentNode.removeChild(n),(n=document.createElementNS(Vt.xmlns,"g")).setAttribute("style","pointer-events:none"),n.setAttribute("id","pathdots"),document.getElementById("layer1").parentNode.appendChild(n);for(var i=e.getPathDotsElem(n,r),a=0;a<i.length;a++)i[a].setAttribute("parentid",t.id);t.setAttribute("style","pointer-events:visibleStroke;");var o=i[i.length-1],l=dt.curveoptions.indexOf(o.getAttribute("cmd"))>-1;o.setAttribute("fill",l?"#009eff":"white"),o.setAttribute("opacity",.6);var c=e.getDotPoint(i[0]),u=e.getDotPoint(o);oe.len(oe.diff(u,c))<10&&"Z"!=o.getAttribute("cmd")&&o.setAttribute("fill","#ffaa00")}},{key:"getPathDotsElem",value:function(t,r){for(var n,i,a=[],o=0;o<r.length-1;o++){var s=r[o].pt,l=r[o].cmd;"M"==l&&(n=s),i=e.getDot(t,l,s),a.push(i),i.onmouseover=function(t){e.highlightDot(t)},i.onmouseout=function(t){e.unhighlightDot(t)}}var c=r[r.length-1];s=c.pt,l=c.cmd;var u=r[r.length-2];return"z"!=l.toLowerCase()&&0==oe.len(oe.diff(n,s))?(l="x",(i=e.getDot(t,l,s)).style.visibility="hidden"):0==oe.len(oe.diff(n,s))&&"z"==l.toLowerCase()&&0==oe.len(oe.diff(n,u.pt))?(i.setAttribute("cmd","x"),i.style.visibility="hidden"):("z"==l.toLowerCase()&&(l="C"==u.cmd?"C":"L"),i=e.getDot(t,l,s)),a.push(i),i.onmouseover=function(t){e.highlightDot(t)},i.onmouseout=function(t){e.unhighlightDot(t)},a}},{key:"reshape",value:function(t){for(var r=e.getDotsCoodinates(t),n=e.getPointsForFirst(t),i=oe.len(oe.diff(r[0].pt,r[r.length-1].pt)),a="x"!=r[r.length-1].cmd.toLowerCase(),o=[],s=0;s<n.length;s++)0==r.length?o.push(n[s]):("x"==r[0].cmd.toLowerCase()&&(r[0].cmd=n[s].cmd,r[0].pt=o[0].pt),o.push(r[0]),r.shift());a&&(i<10&&o.length>3?(o[o.length-1].cmd="z",o[0].pt={x:o[o.length-1].pt.x,y:o[o.length-1].pt.y}):o[o.length-1].cmd="L"==o[1].cmd?"L":"C");var l=e.getDattribute(o);if(dt.isCompoundPath(t))for(var c=t.getAttribute("d").match(/[M][^M]*/g),u=1;u<c.length;u++)l+=c[u];t.setAttributeNS(null,"d",l),rt.getImage(t)&&rt.rotatePointsOf(t)}},{key:"getDotColor",value:function(t,r){var n=e.getPointsForFirst(t),i=e.getDotPos(r);if(i<0)return"#009eff";if(i>=n.length-1)return"#ffaa00";var a=n[i].cmd;return dt.curveoptions.indexOf(a)>-1?"#009eff":"white"}},{key:"getDotPos",value:function(e){var t=e.id.split(" ");return t.length<2?-1:"grab"!=t[0]?-1:Number(t[1])-1}},{key:"getDotPoint",value:function(e){var t=pt.extract(Object(s.q)(e.getAttribute("parentid")),4),r=pt.getCombinedMatrices(Object(s.q)(e.getAttribute("parentid"))),n=pt.point(Number(e.getAttribute("cx")),Number(e.getAttribute("cy")),r.inverse());return n=pt.point(n.x,n.y,t.matrix.inverse())}},{key:"isTip",value:function(t){var r=e.getDotPos(t);return!(r<0||0!=r&&r!=Object(s.q)("pathdots").childElementCount-1)}},{key:"getDot",value:function(e,t,r){t=t.toUpperCase();var n=dt.curveoptions.indexOf(t)>-1,i=Math.floor((s.u?10:6)/Vt.currentZoom)+1,a="Z"==t,o=yt.addChild(e,"circle",{id:Object(s.l)("grab"),fill:n?"#009eff":"white",r:i,stroke:a?"none":"#064268","stroke-width":1,"pointer-events":a?"none":"all",opacity:a?0:.8});return o.setAttributeNS(null,"cx",r.x),o.setAttributeNS(null,"cy",r.y),o.setAttribute("cmd",t),o}},{key:"highlightDot",value:function(e){var t=e.target;t.setAttribute("fill","#00ffff"),t.setAttribute("opacity",1)}},{key:"unhighlightDot",value:function(e){var t=e.target;if(t){var r=dt.curveoptions.indexOf(t.getAttribute("cmd"))>-1;t.setAttribute("fill",r?"#009eff":"white"),t.setAttribute("opacity",.6)}}},{key:"hideDots",value:function(e){e&&e.setAttribute("style","pointer-events:visiblePainted;");var t=Object(s.q)("pathdots");t&&t.parentNode.removeChild(t)}},{key:"getDotsCoodinates",value:function(){for(var t=[],r=0;r<Object(s.q)("pathdots").childElementCount;r++){var n=Object(s.q)("pathdots").childNodes[r];t.push({cmd:n.getAttribute("cmd"),pt:e.getDotPoint(n)})}return t}},{key:"getDots",value:function(){for(var e=[],t=0;t<Object(s.q)("pathdots").childElementCount;t++)e.push(Object(s.q)("pathdots").childNodes[t]);return e}},{key:"addDot",value:function(t){var r=Object(s.q)("pathdots");r.parentNode.removeChild(r);var n=pt.extract(t,4),i=pt.point(Vt.initialPoint.x,Vt.initialPoint.y,n.matrix.inverse());Object(s.I)(Kn.workingCanvas,Vt.root.getAttribute("width")*Vt.currentZoom,Vt.root.getAttribute("height")*Vt.currentZoom);var a=Kn.workingCanvas.getContext("2d");a.clearRect(0,0,Kn.workingCanvas.width,Kn.workingCanvas.height),a.fillStyle="rgba(0,0,0,0)",a.lineWidth=De.linemask,a.strokeStyle="#ff00FF",t.setAttribute("d",e.addPoint(t,a,i)),e.showDots(t),Ve.record()}},{key:"getHitIndex",value:function(e,t,r){e.save(),e.beginPath();for(var n=0;n<t.length;n++)if(dt.drawCommand(e,t[n]),e.stroke(),r=oe.floor(r),0!=e.getImageData(r.x,r.y,1,1).data[3])return n;return e.stroke(),e.restore(),-1}},{key:"getHitPointIndex",value:function(e,t){for(var r=0;r<e.length;r++)if(0==oe.len(oe.diff(e[r].pt,t)))return r;return-1}},{key:"addPoint",value:function(t,r,n){var i,a=dt.getSVGcommands(t),o=e.getPointsAndCmds(t),s=e.getHitIndex(r,a,oe.floor(n));if(s>-1){var l=o[s].cmd;i=dt.curveoptions.indexOf(l)>-1||"z"==l.toLowerCase()?{cmd:"C",pt:n}:{cmd:"L",pt:e.inLine(n,s,o)},o.splice(s,0,i)}return e.getDattribute(o)}},{key:"inLine",value:function(e,t,r){var n=r[t-1].pt,i=r[t].pt,a=oe.norm(oe.diff(i,n)),o=oe.dot(a,oe.diff(e,n));return oe.sum(n,oe.scale(a,o))}},{key:"deleteDot",value:function(t,r){var n=e.getPointsForFirst(r),i=e.getPointsAndCmds(r),a="x"==Object(s.q)("pathdots").childNodes[Object(s.q)("pathdots").childElementCount-1].getAttribute("cmd");if(!(i.length!=n.length&&n.length<5||i.length<(a?6:3))){var o=e.getDotPoint(t),l=e.getHitPointIndex(i,o);if(l>0&&i.splice(l,1),0==l){var c=i[0].pt,u=i[i.length-1].pt;if(0==oe.len(oe.diff(c,u))){if(i.splice(l,1),a){i.splice(i.length-1,1),i[0].cmd="M";var d={x:i[0].pt.x,y:i[0].pt.y};i[i.length-1].pt=d;var h={cmd:"z",pt:d};i.push(h)}i[i.length-1].pt=i[0].pt}else i.splice(l,1),2==i.length&&(i[0].cmd="M",i[i.length-1].cmd="L")}var f=e.getDattribute(i),g=rt.getImage(r);null==f?(e.hideDots(r),r.parentNode.removeChild(r),g&&rt.removeClip(g)):(r.setAttribute("d",f),e.showDots(r),g&&rt.rotatePointsOf(r)),Ve.record()}}},{key:"enterEditMode",value:function(t){Je=rt.getPathBorder(t),e.showDots(Je)}},{key:"quitEditMode",value:function(){e.hideDots(Je),Je=void 0}},{key:"hitDot",value:function(t){if(!Je)return!1;var r=je.getScreenPt(t),n=e.getClosestDotTo(r,2*Math.floor((s.u?14:6)/Vt.currentZoom));return n&&(je.target=n),null!=n}},{key:"getClosestDotTo",value:function(t,r){for(var n=e.getDotsCoodinates(Je),i=99999,a=null,o=0;o<n.length;o++){var l=n[o].pt,c=oe.len(oe.diff(l,t));c<i&&(i=c,a=o+1)}return i<=r?Object(s.q)("grab "+a):null}},{key:"hitLine",value:function(t,r){return e.getPointIndex(t,r)>-1}},{key:"getPointIndex",value:function(t,r){var n=pt.extract(t,4),i=pt.point(r.x,r.y,n.matrix.inverse());Object(s.I)(Kn.workingCanvas,Vt.root.getAttribute("width"),Vt.root.getAttribute("height"));var a=Kn.workingCanvas.getContext("2d");return a.clearRect(0,0,Kn.workingCanvas.width,Kn.workingCanvas.height),a.fillStyle="rgba(0,0,0,0)",a.lineWidth=De.linemask,a.strokeStyle="#ff00FF",e.getHitIndex(a,dt.getSVGcommands(t),oe.floor(i))}},{key:"getClosestPath",value:function(t,r,n,i){for(var a,o=999999,s=0;s<n.childElementCount;s++){var l=n.childNodes[s];if(l.id!=r.id&&!dt.isCloseDPath(l)){var c=e.getStartPoint(l),u=K.distance(c.x-t.x,c.y-t.y);u<o&&(o=u,a=l)}}return o<=i?a:null}},{key:"getStartPoint",value:function(t){var r=t.getAttribute("d");return e.getAnchorpoints(r)[0]}},{key:"getLastPoint",value:function(t){var r=t.getAttribute("d"),n=e.getAnchorpoints(r);return n[n.length-1]}},{key:"join",value:function(t,r,n){pt.applyToCmds(r,pt.combineAll(r)),pt.applyToCmds(t,pt.combineAll(t));var i,a=e.getCommands(t.getAttribute("d")),o=oe.len(oe.diff(n,a[0].pt)),s=oe.len(oe.diff(n,a[a.length-1].pt)),l=o>s,c=e.getCommands(r.getAttribute("d"));l?s<o?(a[0].cmd="C",i=c.concat(a.reverse())):(c.shift(),i=a.concat(c)):o<s?(c[0].cmd="L",a[0].cmd="C",i=a.reverse().concat(c)):(a[0].cmd="L",i=c.concat(a));var u=e.getDattribute(i);oe.len(oe.diff(i[0].pt,i[i.length-1].pt))<10&&"z"!=u.charAt(u.length-1)&&(u+="z"),t.setAttributeNS(null,"d",u);var d=e.getStylingFrom(r);for(var h in d)t.setAttribute(h,d[h]);return r.parentNode&&r.parentNode.removeChild(r),t}},{key:"checkBackgroundCrop",value:function(t){var r=e.getPointsAndCmds(t),n=Xe.findUnderMe(t);if(0==n.length?e.createFromBkg(t):e.someOverlaps(t,n))t.parentNode.removeChild(t,n),Xe.bringElementsToFront();else{var i=e.getDattribute(r);t.setAttribute("d",i)}}},{key:"someOverlaps",value:function(t,r){var n=!1;e.strechEdges(t);var i=yt.getBox(t),a={x:0,y:0,width:480,height:360};if(e.withinBounds(i,a))return n;e.isClockWise(t.getAttribute("d"))||t.setAttribute("d",e.flip(t));for(var o=0;o<r.length;o++){var s=r[o];"image"!=s.tagName.toLowerCase()&&"clipPath"!=s.tagName&&(e.getContactPoints(t,s).length<2||s.id.indexOf("staticbkg")<0&&"yes"!=s.getAttribute("stencil")||e.withinBounds(i,a)&&(e.endsSameSide(t)||(e.isClockWise(s.getAttribute("d"))&&s.setAttribute("d",e.flip(s)),e.createStencil(t,s)&&(n=!0))))}return n}},{key:"createStencil",value:function(t,r){for(var n=null!=rt.getImage(r),i=e.getPointsAndCmds(t),a=e.getPointsAndCmds(r),o=Xe.groupStartsAt(Object(s.q)("layer1"),r),l=Xe.onTopOf(Object(s.q)("layer1"),o),c=r.parentNode,u=0;u<l.length;u++)c.appendChild(l[u]);var d=e.getContactPoints(t,r);if(d.length<2)return!1;var h=e.getStylingFrom(r);n&&(h.fill="none");var f=e.makeAcut(t,i,a,d[0],d[1],h);f.setAttribute("stencil","yes"),Object(s.q)("layer1").appendChild(f);var g=e.getStylingFrom(t);for(var p in g.fill=n?"none":r.getAttribute("fill"),g["stroke-width"]=n?0:Vt.strokewidth,g)r.setAttribute(p,g[p]);g.id=Object(s.l)("path"),g.d=r.getAttribute("d"),n&&(r=yt.addChild(Object(s.q)("layer1"),"path",g)),r.setAttribute("d",e.getComplement(t,r,d[0],d[1])),r.setAttribute("d",e.flip(r)),r.setAttribute("stencil","yes");for(var v=0;v<l.length;v++)c.appendChild(l[v]);return d.length>2&&e.cutBoard(Object(s.q)("layer1"),d,t,f,2),!n}},{key:"cutBoard",value:function(t,r,n,i,a){if(!(a>r.length-2)){e.isClockWise(i.getAttribute("d"))&&i.setAttribute("d",e.flip(i));var o=e.getPointsAndCmds(n),l=e.getPointsAndCmds(i),c=r[a],u=r[a+1],d=e.getStylingFrom(i),h=e.updateContactPoints(c,u,o,l);if(e.isValidSegment(h)){var f=e.makeAcut(n,o,l,h[0],h[1],d);t.appendChild(f),f.setAttribute("stencil","yes"),Object(s.q)("layer1").appendChild(f);var g=e.getStylingFrom(n);for(var p in g.fill=i.getAttribute("fill"),g["stroke-width"]=Vt.strokewidth,g)i.setAttribute(p,g[p]);i.setAttribute("d",e.getComplement(n,i,h[0],h[1])),i.setAttribute("d",e.flip(i)),i.setAttribute("stencil","yes"),e.cutBoard(t,r,n,f,a+2)}}}},{key:"moveToEdge",value:function(e){return e.x<=-10?null:e.x>=490?null:e.y>=370?null:e.y<=-10?null:e.x<=0?{x:-10,y:e.y}:e.y<=0?{x:e.x,y:-10}:e.x>=480?{x:490,y:e.y}:e.y>=360?{x:e.x,y:370}:null}},{key:"atEdge",value:function(e){return e.x<=-10||e.x>=490||e.y>=370||e.y<=-10}},{key:"endsSameSide",value:function(t){var r=e.getPointsAndCmds(t),n=r[r.length-1].pt,i=r[0].pt;return e.findEdge(i)==e.findEdge(n)}},{key:"findEdge",value:function(e){return e.x<=0?"W":e.x>=480?"E":e.y>=360?"S":"N"}},{key:"createFromBkg",value:function(t){e.strechEdges(t);var r=yt.getBox(t);if(e.withinBounds(r,{x:0,y:0,width:480,height:360}))return!1;if(e.endsSameSide(t))return!1;var n={id:Object(s.l)("path"),opacity:1,fill:"white"};n.d=dt.arrayToString([["M",-10,-10],["L",490,-10],["L",490,370],["L",-10,370],["L",-10,-10]]);var i=yt.addChild(Object(s.q)("layer1"),"path",n);i.setAttribute("stencil","yes"),e.isClockWise(t.getAttribute("d"))||t.setAttribute("d",e.flip(t)),e.isClockWise(i.getAttribute("d"))&&i.setAttribute("d",e.flip(i));var a=e.getStylingFrom(Object(s.q)("staticbkg"));for(var o in a)i.setAttribute(o,a[o]);return e.createStencil(t,i)}},{key:"withinBounds",value:function(e,t){return!(e.x<=t.x&&e.width+e.x>=t.width)&&(e.y>t.y||e.height+e.y<t.height)}},{key:"strechEdges",value:function(t){var r,n=e.getPointsAndCmds(t),i=n[n.length-1].pt;if(!e.atEdge(i)){var a=e.moveToEdge(i);a?n.push({cmd:"C",pt:a}):(r=oe.sum(i,oe.diff(i,n[n.length-2].pt)),n.push({cmd:"C",pt:r}))}var o=n[0].pt;if(!e.atEdge(o)){n[0].cmd="L";var s=e.moveToEdge(o);s?n.unshift({cmd:"M",pt:s}):(r=oe.sum(o,oe.diff(o,n[1].pt)),n.unshift({cmd:"M",pt:r}))}var l=e.getDattribute(n);t.setAttribute("d",l)}},{key:"getContactPoints",value:function(t,r){for(var n=e.getPointsAndCmds(t),i=e.getPointsAndCmds(r),a=[],o=1;o<n.length;o++)for(var s=n[o-1].pt,l=n[o].pt,c=1;c<i.length;c++){var u=i[c-1].pt,d=i[c].pt,h=oe.lineIntersect(s,l,u,d);h&&a.push([o,c,h])}return a}},{key:"makeAcut",value:function(t,r,n,i,a,o){var l=dt.getSVGcommands(t);o.d=e.chopSection(r,l,n,i,a),o.id=Object(s.l)("path");var c=yt.addChild(Object(s.q)("layer1"),"path",o);return c.setAttribute("d",e.flip(c)),c}},{key:"chopSection",value:function(t,r,n,i,a){var o="M"+i[2].x+","+i[2].y;o+=dt.arrayToString(r.slice(i[0],a[0])),o+=e.lineSeg(a[2]);var s=i[1],l=a[1],c=e.getShapeFromPoints(s,l,i[2],n);return e.fromPointsToPath(o,c)}},{key:"getShapeFromPoints",value:function(e,t,r,n){var i=[];if(t>e){var a=n.length;i=(i=n.slice(t,a)).concat(n.slice(0,e))}else t!=e&&(i=n.slice(t,e));return i.push({cmd:"L",pt:r}),i}},{key:"fromPointsToPath",value:function(t,r){var n=r[0];t+=e.lineSeg(n.pt);for(var i=1;i<r.length-1;i++)t+=e.getNextCmd(i,n,r),n=r[i];return t+=e.lineSeg(r[r.length-1].pt)}},{key:"getNextCmd",value:function(t,r,n,i){var a="";switch(n[t].cmd.toUpperCase()){case"M":if("C"==r.cmd){var o=i||n[t+1].pt;a=e.curveSeg(r.pt,n[t].pt,o)}else a=e.lineSeg(n[t].pt);break;case"C":case"S":a=e.curveSeg(r.pt,n[t].pt,i||n[t+1].pt);break;default:a=e.lineSeg(n[t].pt)}return a}},{key:"getComplement",value:function(t,r,n,i){var a=dt.getSVGcommands(t),o=e.getPointsAndCmds(r),s="M"+n[2].x+","+n[2].y;s+=dt.arrayToString(a.slice(n[0],i[0])),s+=e.lineSeg(i[2]);var l=n[1],c=i[1],u=e.getFromPoints(l,c,n[2],o);return e.fromPointsToPath(s,u)}},{key:"getFromPoints",value:function(e,t,r,n){var i=[];if(e>=t){var a=n.length;i=(i=n.slice(e,a)).concat(n.slice(0,t))}else i=n.slice(e,t);return i.length>0&&i.reverse(),i.push({cmd:"L",pt:r}),i}},{key:"updateContactPoints",value:function(t,r,n,i){var a,o,s=e.updateContact(t[0],n,i);if(null==s){var l=e.extendSearch(t[0],r[0]-1,n,i);if(null==l)return null;o=[l[0],l[1],l[2]]}else o=[t[0],s,t[2]];var c=e.updateContact(r[0],n,i);if(null==c){var u=e.extendSearch(t[0]+1,r[0]+1,n,i);if(null==u)return null;a=[u[0],u[1],u[2]]}else a=[r[0],c,r[2]];return[o,a]}},{key:"extendSearch",value:function(e,t,r,n){for(var i=e;i<r.length;i++)for(var a=r[i-1].pt,o=r[i].pt,s=1;s<n.length;s++){var l=n[s-1].pt,c=n[s].pt,u=oe.lineIntersect(a,o,l,c);if(u)return[i,s,u]}return null}},{key:"updateContact",value:function(e,t,r){for(var n=t[e-1].pt,i=t[e].pt,a=1;a<r.length;a++){var o=r[a-1].pt,s=r[a].pt;if(oe.lineIntersect(n,i,o,s))return a}return null}},{key:"isValidSegment",value:function(e){return null!=e&&e[0][1]!=e[1][1]&&e[0][2]!=e[1][1]}},{key:"isClockWise",value:function(t){return"clockwise"==e.getTurnType(e.getAnchorpoints(t))}},{key:"getTurnType",value:function(t){if(t.length<3)return"colinear";var r=e.getMinMaxPoints(t),n=e.findGreaterThanIndex(r,-1);if(!n)return"colinear";var i=e.findGreaterThanIndex(r,n.index);if(!i)return"colinear";var a=e.findGreaterThanIndex(r,i.index);return a?e.triangleAreaDir(n,i,a):"colinear"}},{key:"findGreaterThanIndex",value:function(e,t){for(var r,n=99999999,i=0;i<e.length;i++)e[i].index>t&&e[i].index<n&&(n=e[i].index,r=e[i]);return r}},{key:"triangleAreaDir",value:function(e,t,r){var n=(t.x-e.x)*(r.y-e.y)-(t.y-e.y)*(r.x-e.x);return n>0?"clockwise":n<0?"counterclockwise":"colinear"}},{key:"getMinMaxPoints",value:function(e){var t=[0,0,0,0];if(e.length<1)return t;for(var r=9999999,n=9999999,i=-9999999,a=-9999999,o=0;o<e.length;o++)e[o].x<r&&(r=e[o].x,t[0]={type:"minx",x:e[o].x,y:e[o].y,index:o}),e[o].x>i&&(i=e[o].x,t[2]={type:"maxx",x:e[o].x,y:e[o].y,index:o}),e[o].y<n&&(n=e[o].y,t[1]={type:"miny",x:e[o].x,y:e[o].y,index:o}),e[o].y>a&&(a=e[o].y,t[3]={type:"maxy",x:e[o].x,y:e[o].y,index:o});return t}},{key:"flip",value:function(t){for(var r=t.getAttribute("d").match(/[M][^M]*/g),n="",i=0;i<r.length;i++)n+=e.reverse(r[i]);return n}},{key:"reverse",value:function(t){var r=e.getCommands(t);if(r.length<2)return"";var n=r[r.length-1].cmd.toLowerCase();return r[0].cmd="z"==n?"z":n.toUpperCase(),r[r.length-1].cmd="M",r=r.reverse(),e.getDattribute(r)}},{key:"setData",value:function(t){t.getAttribute("relatedto")?e.breakRelationship(t,t.getAttribute("relatedto")):e.makeCompoundPath(t)}},{key:"breakRelationship",value:function(t,r){var n=Object(s.q)(r);if(n){var i=n.getAttribute("d").match(/[M][^M]*/g),a=e.getMatchPathIndex(t,i);if(!(a<0)){i.splice(a,1);for(var o="",l=0;l<i.length;l++)o+=i[l];n.setAttribute("d",o),t.setAttribute("d",e.flip(t)),t.removeAttribute("relatedto")}}}},{key:"getMatchPathIndex",value:function(t,r){for(var n=e.getPointsAndCmds(t),i=0;i<r.length;i++){var a=r[i],o=e.getCommands(a);if(e.countMatchingPoints(n,o)>=n.length)return i}return-1}},{key:"countMatchingPoints",value:function(e,t){for(var r=0,n=0;n<e.length;n++)for(var i=e[n].pt,a=0;a<t.length;a++){var o=t[a].pt;0==oe.len(oe.diff(i,o))&&r++}return r}},{key:"makeCompoundPath",value:function(t){var r=e.findIntersecting(t);if(0==r.length||e.containsImage(r)||e.anyCrossing(r,t))t.setAttribute("fill",Vt.fillcolor);else{var n=!1;r.sort((function(e,t){var r=yt.getArea(e),n=yt.getArea(t);return r>n?-1:r<n?1:0}));for(var i=[],a=0;a<r.length;a++)"none"!=r[a].getAttribute("fill")&&(n=!0),"image"==r[a].nodeName&&(n=!0),"path"!=r[a].tagName||dt.isCloseDPath(r[a])||(n=!0),0==a&&i.push(r[a]),a>0&&(Xe.insideMe(r[a],r[a-1])||i.push(r[a]));n?t.setAttribute("fill",Vt.fillcolor):e.processCompoundPath(t,i)}}},{key:"findIntersecting",value:function(e){var t=Vt.root.createSVGRect(),r=yt.getBox(e);t.x=r.x,t.y=r.y,t.width=r.width,t.height=r.height;var n=Vt.root.getIntersectionList(t,null),i=[];if(null!=n)for(var a=0;a<n.length;a++)"ghostlayer"!=n[a].parentNode.id&&n[a].id!=e.id&&Xe.includesBox(e,n[a])&&i.push(n[a]);return i}},{key:"containsImage",value:function(e){for(var t=0;t<e.length;t++)if("image"==e[t].nodeName)return!0;return!1}},{key:"anyCrossing",value:function(t,r){for(var n=0;n<t.length;n++)if(r!=t[n]&&"g"!=t[n].nodeName&&e.getPathCrossing(t[n],r).length>0)return!0;return!1}},{key:"getPathCrossing",value:function(t,r){for(var n=e.getAllPoints(t.getAttribute("d")),i=e.getAllPoints(r.getAttribute("d")),a=[],o=1;o<n.length;o++)for(var s=n[o-1],l=n[o],c=1;c<i.length;c++){var u=i[c-1],d=i[c],h=oe.lineIntersect(s,l,u,d);h&&a.push([o,c,h])}return a}},{key:"getAllPoints",value:function(t){var r=dt.getCommandList(t);if(0==r.length)return[];var n=[],i={x:r[0][1],y:r[0][2]};n.push(i);for(var a=1;a<r.length;a++){var o=r[a];switch(o.shift().toLowerCase()){case"l":i={x:o[0],y:o[1]},n.push(i);break;case"c":o.unshift(i.y),o.unshift(i.x);var s=o.length;i={x:o[s-2],y:o[s-1]};var l=e.getBezierPoints(o);n=n.concat(l);break;case"z":i={x:n[0].x,y:n[0].y},n.push(i)}}return(s=e.cleanBezier(n,5)).length<5?n:s}},{key:"getBezierPoints",value:function(e){if(e.length<8)return[];var t,r,n,i,a,o,s,l,c,u,d;t=e[0],a=e[1],r=e[2],o=e[3],n=e[4],s=e[5],i=e[6],l=e[7];var h=t-1,f=a-1;d=0;for(var g=1,p=new Array;d<=1&&d>=0;)c=0,u=0,c=(1-d)*(1-d)*(1-d)*t+3*(1-d)*(1-d)*d*r+3*(1-d)*d*d*n+d*d*d*i,u=(1-d)*(1-d)*(1-d)*a+3*(1-d)*(1-d)*d*o+3*(1-d)*d*d*s+d*d*d*l,c=Math.round(c),u=Math.round(u),c!=h||u!=f?(0==d&&(h=c,f=u),c-h>1||u-f>1||h-c>1||f-u>1?(d-=g,g/=1.1):(p[p.length]={x:c,y:u},h=c,f=u)):(d-=g,g*=1.1),d+=g;return p}},{key:"placePoint",value:function(e,t,r){var n=yt.addEllipse(e,t.x,t.y);n.setAttributeNS(null,"stroke-width",.5),n.setAttributeNS(null,"rx",4),n.setAttributeNS(null,"ry",4),n.setAttributeNS(null,"fill",r)}},{key:"cleanBezier",value:function(e,t){var r=e.length,n=1,i=0,a=[];for(a.push(e[0]);n<r-1;){var o=e[i],s=e[n],l=e[n+1],c=oe.diff(o,s),u=oe.diff(l,s);(oe.len(u)>t||oe.len(c)>t)&&(a.push(e[n]),i=n),n++}return a}},{key:"processCompoundPath",value:function(t,r){var n=e.isClockWise(t.getAttribute("d"));pt.applyToCmds(t,pt.combineAll(t)),pt.eliminateAll(t);for(var i=t.getAttribute("d"),a=0;a<r.length;a++)if(r[a]!=t)if("none"==r[a].getAttribute("fill"))if(r[a].setAttribute("relatedto",t.id),dt.isCompoundPath(r[a])){pt.applyToCmds(r[a],pt.combineAll(r[a])),pt.eliminateAll(r[a]);var o=r[a].getAttribute("d").match(/[M][^M]*/g);i+=n==e.isClockWise(o[0])?e.reverse(o[0]):o[0]}else n==e.isClockWise(r[a].getAttribute("d"))&&r[a].setAttribute("d",e.flip(r[a])),pt.applyToCmds(r[a],pt.combineAll(r[a])),pt.eliminateAll(r[a]),i+=r[a].getAttribute("d");else r[a].parentNode.appendChild(r[a]);t.setAttribute("d",i)}},{key:"endDotColor",get:function(){return"#ffaa00"}},{key:"selectedDotColor",get:function(){return"lime"}},{key:"selector",get:function(){return Je}}],(r=null)&&Ye(t.prototype,r),n&&Ye(t,n),e}();function Qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var et,tt,rt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"addCameraFill",value:function(t,r){t.getAttribute("relatedto")&&$e.breakRelationship(t,t.getAttribute("relatedto"));var n=e.getImage(t);n&&(e.removeClip(n,!0),t.setAttribute("id",Object(s.l)(t.nodeName))),e.createImageFromFeed(t,r)}},{key:"replaceImage",value:function(e,t){e.setAttributeNS(Vt.xmlnslink,"xlink:href","data:image/png;base64,"+t)}},{key:"createImageFromFeed",value:function(e,t){var r=e.parentNode,n="staticbkg"==e.id,i=Xe.groupStartsAt(r,e),a=Xe.onTopOf(r,i),o=yt.getBox(e).rounded(),l=new ie(0,0,Vt.workspaceWidth,Vt.workspaceHeight);(o=o.expandBy(20)).crop(l);var c=Object(s.m)("image");n&&(c+="staticbkg");var u=yt.createGroup(r,"group_"+c),d=yt.getCopy(e),h={id:"pathmask_"+c};for(var f in h)d.setAttribute(f,h[f]);yt.addChild(u,"clipPath",{id:"clip_"+c,clipPathUnits:"userSpaceOnUse"}).appendChild(d);var g=document.createElementNS(Vt.xmlns,"image"),p={x:o.x,y:o.y,width:o.width,height:o.height,id:c};for(var v in p)g.setAttribute(v,p[v]);g.setAttributeNS(Vt.xmlnslink,"xlink:href","data:image/png;base64,"+t),g.setAttribute("clip-path","url(#clip_"+c+")"),u.appendChild(g);var m={id:"pathborder_"+c,fill:"none"};for(var b in m)e.setAttribute(b,m[b]);for(var y=0;y<a.length;y++)r.appendChild(a[y])}},{key:"removeClip",value:function(e,t){var r=e.getAttribute("id"),n=r.indexOf("staticbkg")>-1,i=Object(s.q)("clip_"+r),a=Object(s.q)("group_"+r),o=Object(s.q)("pathborder_"+r);if(n&&!t){var l=i.childNodes[0];l.id="staticbkg",Object(s.q)("layer1").appendChild(l)}else a?a.parentNode.removeChild(a):(i&&i.parentNode.removeChild(i),e.parentNode.removeChild(e));o&&!t&&o.parentNode.removeChild(o)}},{key:"paint",value:function(e){var t=e.getAttribute("id"),r=e.id.indexOf("staticbkg")>-1,n=Object(s.q)("pathborder_"+t);n.setAttribute("id",r?"staticbkg":Object(s.l)("path"));var i=Object(s.q)("clip_"+t),a=Object(s.q)("group_"+t);a?a.parentNode.removeChild(a):(i&&i.parentNode.removeChild(i),e.parentNode.removeChild(e)),je.currentshape=n}},{key:"draw",value:function(e,t,r,n){var i=pt.getRotationAngle(e),a=yt.getBoxCenter(e),o=document.createElement("canvas");Object(s.I)(o,r.canvas.width,r.canvas.height);var l=o.getContext("2d"),c=e.getAttribute("xlink:href"),u=document.createElement("img");function d(i,a,l,c){var u=Number(e.getAttribute("x")),d=Number(e.getAttribute("y")),h=Number(e.getAttribute("width")),f=Number(e.getAttribute("height"));a.fillStyle="red",a.fillRect(u,d,h,f),a.save(),a.translate(c.x,c.y),a.rotate(l*s.c),a.translate(-c.x,-c.y),a.drawImage(i,u,d,h,f),a.restore(),a.save(),a.globalCompositeOperation="destination-in",a.fillStyle="#f30",a.strokeStyle="rgba(0,0,0,0)",dt.processXMLnode(t,a),a.restore(),r.drawImage(o,0,0),n&&n()}u.src=c,u.complete?d(u,l,i,a):u.onload=function(){d(u,l,i,a)}}},{key:"getImage",value:function(e){if(!e)return null;if("image"==e.nodeName)return e;if("g"==e.nodeName){var t=e.id,r=t.indexOf("group_image_")>-1?Object(s.q)(t.substr(6,t.length)):null;return r&&"image"==r.tagName?r:null}if(e.id.indexOf("pathborder_image")<0&&e.id.indexOf("pathmask_image")<0)return null;var n=e.id.indexOf("pathborder_image")<0?e.id.substring(String("pathmask_").length,e.id.length):e.id.substring(String("pathborder_").length,e.id.length);return Object(s.q)(n)}},{key:"getPathMask",value:function(e){if(e.id.indexOf("pathborder_image")<0)return null;var t=e.id.substring(String("pathborder_").length,e.id.length);return Object(s.q)("pathmask_"+t)}},{key:"getPathBorder",value:function(e){if(0==e.id.indexOf("image_"))return Object(s.q)("pathborder_"+e.id);if(e.id.indexOf("pathmask_")>-1){var t=e.id.substring(String("pathmask_").length,e.id.length);return Object(s.q)("pathborder_"+t)}return e}},{key:"cloneImage",value:function(t,r){var n=e.getClonedImage(r),i=n.id,a=r.getAttribute("xlink:href"),o=document.createElement("img");function l(e){var t=document.createElement("canvas");Object(s.I)(t,Number(e.getAttribute("width")),Number(e.getAttribute("height"))),t.getContext("2d").drawImage(o,0,0);var r=t.toDataURL("image/png");e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r)}o.src=a,o.complete?l(n):o.onload=function(){l(n)};var c=yt.getCopy(Object(s.q)("pathmask_"+r.id)),u={id:"pathmask_"+i};for(var d in u)c.setAttribute(d,u[d]);var h=yt.createGroup(t,"group_"+i);yt.addChild(h,"clipPath",{id:"clip_"+i,clipPathUnits:"userSpaceOnUse"}).appendChild(c),n.setAttribute("clip-path","url(#clip_"+i+")"),h.appendChild(n);var f=yt.getCopy(Object(s.q)("pathborder_"+r.id)),g={id:"pathborder_"+i};for(var p in g)f.setAttribute(p,g[p]);return t.appendChild(f),pt.translateTo(n,window.xform),pt.translateTo(c,window.xform),pt.translateTo(f,window.xform),n}},{key:"getClonedImage",value:function(e){for(var t=yt.attributeTable[e.tagName],r=document.createElementNS(Vt.xmlns,e.tagName),n=0;n<t.length;n++)r.setAttribute(t[n],e.getAttribute(t[n]));var i=Object(s.m)("image");r.setAttribute("id",i);var a=pt.getRotationAngle(e);return 0!=a&&pt.applyRotation(r,a),r}},{key:"rotatePointsOf",value:function(t){var r=e.getImage(t),n=e.getPathMask(t);if(n){var i=pt.getRotationAngle(r);if(n.setAttributeNS(null,"d",t.getAttribute("d")),0!=i){var a=yt.getBoxCenter(r),o=Vt.root.createSVGTransform();o.setRotate(-i,a.x,a.y),pt.rotateFromPoint(o,n)}}}}],(r=null)&&Qe(t.prototype,r),n&&Qe(t,n),e}();function nt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var it,at,ot=["C","c","s","S"],st=["Q","q","T","t"],lt=!1,ct=!1,ut={"stroke-width":1,"stroke-linecap":"butt",stroke:"rgba(0, 0, 0,0)","stroke-linejoin":"miter","stroke-miterlimit":4,"stroke-dasharray":"none","stroke-dashoffset":0,"stroke-opacity":1},dt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"drawInCanvas",value:function(t){at=!1,Object(s.I)(t.outline,t.originalImg.width,t.originalImg.height);var r=t.outline.getContext("2d");e.drawImage(t.svg,r)}},{key:"drawLayers",value:function(e,t,r){for(var n=0;n<e.childElementCount;n++)r(e.childNodes[n],t)}},{key:"drawImage",value:function(t,r){for(var n=0;n<t.childElementCount;n++)e.drawLayer(t.childNodes[n],r)}},{key:"drawLayer",value:function(t,r){r.fillStyle=t.getAttribute("fill")?"none"==t.getAttribute("fill")?"rgba(0, 0, 0,0)":t.getAttribute("fill"):"black",t.getAttribute("opacity")&&(r.fillStyle=Object(s.d)(r.fillStyle,t.getAttribute("opacity"))),r.strokeStyle=t.getAttribute("stroke")?t.getAttribute("stroke"):"rgba(0, 0, 0,0)",r.lineCap=t.getAttribute("stroke-linecap")?t.getAttribute("stroke-linecap"):e.strokevalues["stroke-linecap"],r.lineWidth=t.getAttribute("stroke-width")?Number(t.getAttribute("stroke-width")):Number(e.strokevalues["stroke-width"]),r.miterLimit=t.getAttribute("stroke-miterlimit")?t.getAttribute("stroke-miterlimit"):e.strokevalues["stroke-miterlimit"],r.linejoin=t.getAttribute("stroke-linejoin")?t.getAttribute("stroke-linejoin"):e.strokevalues["stroke-linejoin"],e.processXMLnode(t,r,e.drawLayer)}},{key:"drawElementHole",value:function(t,r){r.fillStyle=t.getAttribute("fill")&&"none"!=t.getAttribute("fill")?t.getAttribute("fill"):"black",r.strokeStyle=t.getAttribute("stroke")?t.getAttribute("stroke"):"rgba(0, 0, 0,0)",r.lineCap=t.getAttribute("stroke-linecap")?t.getAttribute("stroke-linecap"):e.strokevalues["stroke-linecap"],r.lineWidth=t.getAttribute("stroke-width")?Number(t.getAttribute("stroke-width")):Number(e.strokevalues["stroke-width"]),r.miterLimit=t.getAttribute("stroke-miterlimit")?t.getAttribute("stroke-miterlimit"):e.strokevalues["stroke-miterlimit"],r.linejoin=t.getAttribute("stroke-linejoin")?t.getAttribute("stroke-linejoin"):e.strokevalues["stroke-linejoin"],t.tagName&&e.processXMLnode(t,r,e.drawElementHole)}},{key:"drawElementMask",value:function(t,r){"image"!=t.nodeName&&"clipPath"!=t.nodeName&&(t.id.indexOf("pathborder_image")>-1?r.fillStyle="white":r.fillStyle="none"==t.getAttribute("fill")?"rgba(0, 0, 0,0)":"white",r.strokeStyle=t.getAttribute("stroke")?"white":"rgba(0, 0, 0,0)",r.lineCap=t.getAttribute("stroke-linecap")?t.getAttribute("stroke-linecap"):e.strokevalues["stroke-linecap"],r.lineWidth=t.getAttribute("stroke-width")?Number(t.getAttribute("stroke-width")):Number(e.strokevalues["stroke-width"]),r.miterLimit=t.getAttribute("stroke-miterlimit")?t.getAttribute("stroke-miterlimit"):e.strokevalues["stroke-miterlimit"],r.linejoin=t.getAttribute("stroke-linejoin")?t.getAttribute("stroke-linejoin"):e.strokevalues["stroke-linejoin"],e.processXMLnode(t,r,e.drawElementMask))}},{key:"drawElementOutline",value:function(t,r){"image"!=t.nodeName&&"clipPath"!=t.nodeName&&(t.id.indexOf("pathborder_image")>-1?r.fillStyle=window.Settings.spriteOutlineColor:r.fillStyle="none"==t.getAttribute("fill")?"rgba(0, 0, 0,0)":window.Settings.spriteOutlineColor,r.strokeStyle=window.Settings.spriteOutlineColor,r.lineCap="round",r.lineWidth=t.getAttribute("stroke-width")?Number(t.getAttribute("stroke-width"))+12:12,r.miterLimit=2,r.linejoin="round",e.processXMLnode(t,r,e.drawElementOutline))}},{key:"drawBorder",value:function(t,r){for(var n=0;n<t.childElementCount;n++)e.drawElementOutline(t.childNodes[n],r)}},{key:"drawWaterMark",value:function(t,r){for(var n=0;n<t.childElementCount;n++){var i=t.childNodes[n];"g"==i.tagName?e.drawWaterMark(i,r):e.drawObjectWaterMark(i,r)}}},{key:"drawObjectWaterMark",value:function(t,r){if("image"!=t.nodeName&&"clipPath"!=t.nodeName){t.id.indexOf("pathborder_image")>-1&&(r.fillStyle="black");var n=t.getAttribute("fill");r.fillStyle="none"==n?"rgba(0, 0, 0,0)":"black",r.strokeStyle=t.getAttribute("stroke")?"black":"rgba(0, 0, 0,0)",r.lineCap="round",r.lineWidth=t.getAttribute("stroke-width")?Number(t.getAttribute("stroke-width")):Number(e.strokevalues["stroke-width"]),r.miterLimit=t.getAttribute("stroke-miterlimit")?t.getAttribute("stroke-miterlimit"):e.strokevalues["stroke-miterlimit"],r.linejoin="round",r.lineWidth<2&&(r.lineWidth=2),r.save(),e.processXMLnode(t,r),r.restore(),!(t.id.indexOf("pathborder_image")>-1)&&("none"==n||!n||"#080808"==n||"#000000"==n||"rgba(0, 0, 0, 0)"==n||Object(s.F)(n)[2]<.25)||(r.save(),r.fillStyle="white",r.strokeStyle="rgba(0, 0, 0,0)",r.globalCompositeOperation="destination-out",e.processXMLnode(t,r),r.restore())}}},{key:"processXMLnode",value:function(t,r,n){if(t)switch(t.tagName){case"g":e.drawLayers(t,r,n);break;case"text":e.drawText(t,r);break;case"image":for(var i=t.parentNode;"svg"!=i.tagName;)i=i.parentNode;var a="pathborder_"+t.id,o=i.getElementById(a);if(!o)for(var s=i.getElementsByTagName("path"),l=0;l<s.length;l++)s[l].id==a&&(o=s[l]);rt.draw(t,o,r);break;case"clipPath":break;case"line":e.drawLine(t,r);break;case"rect":e.drawRect(t,r);break;case"ellipse":e.drawEllipse(t,r);break;case"circle":e.drawCircle(t,r);break;case"polygon":e.drawStraightLines(t,r);break;case"path":e.renderPath(t,r);break;case"polyline":e.drawPolyline(t,r);break;default:at=!0}}},{key:"drawRect",value:function(e,t){t.save();var r=Number(e.getAttribute("x")),n=Number(e.getAttribute("y")),i=Number(e.getAttribute("width")),a=Number(e.getAttribute("height"));t.strokeStyle&&"rgba(0, 0, 0,0)"!=t.strokeStyle&&t.strokeRect(r,n,i,a),t.fillStyle&&"rgba(0, 0, 0,0)"!=t.fillStyle&&t.fillRect(r,n,i,a),t.restore()}},{key:"drawLine",value:function(e,t){var r=Number(e.getAttribute("x1")),n=Number(e.getAttribute("y1")),i=Number(e.getAttribute("x2")),a=Number(e.getAttribute("y2"));t.beginPath(),t.moveTo(r,n),t.lineTo(i,a),t.stroke(),t.closePath()}},{key:"drawEllipse",value:function(t,r){var n=Number(t.getAttribute("rx")),i=Number(t.getAttribute("ry")),a=Number(t.getAttribute("cx")),o=Number(t.getAttribute("cy")),s=(Math.sqrt(2)-1)/3*4,l=[["M",a-n,o],["C",a-n,o-i*s,a-n*s,o-i,a,o-i],["C",a+n*s,o-i,a+n,o-i*s,a+n,o],["C",a+n,o+i*s,a+n*s,o+i,a,o+i],["C",a-n*s,o+i,a-n,o+i*s,a-n,o]];l=e.arrayToString(l);var c=e.getCommandList(l);if(c){lt=!1,ct=!1,r.save(),r.beginPath();for(var u=0;u<c.length;u++)e.drawCommand(r,c[u]);c[c.length-1].indexOf("z")>-1&&r.closePath(),r.fill(),r.stroke(),r.restore()}}},{key:"drawCircle",value:function(e,t){var r=Number(e.getAttribute("r")),n=Number(e.getAttribute("cx")),i=Number(e.getAttribute("cy"));t.save(),t.beginPath(),t.arc(n,i,r,0,2*Math.PI,!1),t.closePath(),t.fill(),t.stroke(),t.restore()}},{key:"drawText",value:function(e,t){t.font=e.getAttribute("font-weight")+" "+e.getAttribute("font-size")+"px "+e.getAttribute("font-family"),t.textAlign="left",t.textBaseline="top",t.fillText(e.textContent,0,0)}},{key:"renderPath",value:function(t,r){var n=t.getAttribute("d"),i=e.getCommandList(n);if(i){lt=!1,ct=!1,r.save(),r.beginPath();for(var a=0;a<i.length;a++)e.drawCommand(r,i[a]);i[i.length-1].indexOf("z")>-1&&r.closePath(),r.fill(),"destination-in"!=r.globalCompositeOperation&&r.stroke(),r.restore()}}},{key:"renderPathTips",value:function(t,r){var n=t.getAttribute("d"),i=e.getCommandList(n);if(i){lt=!1,ct=!1,e.getAbsoluteCommand(i[0]),e.drawTip(r,et.x,et.y,4);for(var a=1;a<i.length;a++)e.getAbsoluteCommand(i[a]);e.drawTip(r,et.x,et.y,4),r.restore()}}},{key:"drawTip",value:function(e,t,r,n){e.save(),e.beginPath(),e.arc(t,r,n,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke(),e.restore()}},{key:"getLastPathCommand",value:function(e){var t=e.getAttribute("d").match(/[A-DF-Za-df-z][^A-Za-df-z]*/g);return t.length>0?t[t.length-1].charAt(0):null}},{key:"isCloseDPath",value:function(t){if("path"!=t.tagName)return!0;if(e.isCompoundPath(t))return!0;var r=t.getAttribute("d").match(/[A-DF-Za-df-z][^A-Za-df-z]*/g);if(r.length<2)return!1;var n=r[r.length-1];if("z"==n.charAt(0))return!0;if(r.length<4)return!1;var i=r[0];if(n.charAt(0).toLocaleUpperCase()!=n.charAt(0))return!1;var a=e.splitNumericArgs(i.substr(1,i.length)),o=e.splitNumericArgs(n.substr(1,n.length));if(a.length<2)return!1;if(o.length<2)return!1;var s={x:a[a.length-2],y:a[a.length-1]},l={x:o[o.length-2],y:o[o.length-1]};return oe.len(oe.diff(s,l))<10}},{key:"isCompoundPath",value:function(e){var t=e.getAttribute("d").match(/[M][^M]*/g);return!!t&&t.length>1}},{key:"drawCommand",value:function(e,t){var r=t[0];ht[r](e,t),lt=ot.indexOf(t[0])>-1,ct=st.indexOf(t[0])>-1}},{key:"splitNumericArgs",value:function(e){var t=[];if(!e)return t;for(var r=e.match(/(?:\+|-)?\d+(?:\.\d+)?(?:e(?:\+|-)?\d+)?/g),n=0;n<r.length;n++)t.push(Number(r[n]));return t}},{key:"absoulteMove",value:function(e,t){et={x:t[1],y:t[2]},e.moveTo(et.x,et.y),tt=et}},{key:"relativeMove",value:function(e,t){et=oe.sum(et,{x:t[1],y:t[2]}),e.moveTo(et.x,et.y),tt=et}},{key:"closePath",value:function(e){et=tt,e.lineTo(et.x,et.y)}},{key:"absoluteLine",value:function(e,t){et={x:t[1],y:t[2]},e.lineTo(et.x,et.y)}},{key:"relativeLine",value:function(e,t){et=oe.sum(et,{x:t[1],y:t[2]}),e.lineTo(et.x,et.y)}},{key:"absoluteHLine",value:function(e,t){var r=t[1];et={x:r,y:et.y},e.lineTo(et.x,et.y)}},{key:"relativeHLine",value:function(e,t){var r=et.x+t[1];et={x:r,y:et.y},e.lineTo(et.x,et.y)}},{key:"absoluteVLine",value:function(e,t){var r=t[1];et={x:et.x,y:r},e.lineTo(et.x,et.y)}},{key:"relativeVLine",value:function(e,t){var r=et.y+t[1];et={x:et.x,y:r},e.lineTo(et.x,et.y)}},{key:"absoluteCurve",value:function(e,t){e.bezierCurveTo(t[1],t[2],t[3],t[4],t[5],t[6]),it={x:t[3],y:t[4]},et={x:t[5],y:t[6]}}},{key:"relativeCurve",value:function(e,t){var r={x:t[1],y:t[2]},n={x:t[3],y:t[4]},i={x:t[5],y:t[6]},a=oe.sum(et,r),o=oe.sum(et,n);it=o;var s=oe.sum(et,i);e.bezierCurveTo(a.x,a.y,o.x,o.y,s.x,s.y),et=s}},{key:"absoluteSmooth",value:function(e,t){var r=lt?oe.sum(et,oe.diff(et,it)):et,n={x:t[1],y:t[2]},i={x:t[3],y:t[4]};e.bezierCurveTo(r.x,r.y,n.x,n.y,i.x,i.y),et=i,it=n}},{key:"relativeSmooth",value:function(e,t){var r=lt?oe.sum(et,oe.diff(et,it)):et,n=oe.sum(et,{x:t[1],y:t[2]}),i=oe.sum(et,{x:t[3],y:t[4]});e.bezierCurveTo(r.x,r.y,n.x,n.y,i.x,i.y),et=i,it=n}},{key:"absoluteQCurve",value:function(e,t){var r={x:t[1],y:t[2]};et={x:t[3],y:t[4]},e.quadraticCurveTo(r.x,r.y,et.x,et.y),it=r}},{key:"relativeQCurve",value:function(e,t){var r=oe.sum(et,{x:t[1],y:t[2]});et=oe.sum(et,{x:t[3],y:t[4]}),it=r,e.quadraticCurveTo(r.x,r.y,et.x,et.y)}},{key:"absoluteQSmooth",value:function(e,t){var r=ct?oe.sum(et,oe.diff(et,it)):et;et={x:t[1],y:t[2]},it=r,e.quadraticCurveTo(r.x,r.y,et.x,et.y)}},{key:"relativeQSmooth",value:function(e,t){var r=ct?oe.sum(et,oe.diff(et,it)):et;et=oe.sum(et,{x:t[1],y:t[2]}),it=r,e.quadraticCurveTo(r.x,r.y,et.x,et.y)}},{key:"drawStraightLines",value:function(e,t){var r=e.points;t.save(),t.beginPath(),t.moveTo(r.getItem(0).x,r.getItem(0).y);for(var n=1;n<r.numberOfItems;n++)t.lineTo(r.getItem(n).x,r.getItem(n).y);t.lineTo(r.getItem(0).x,r.getItem(0).y),t.closePath(),t.fill(),t.stroke(),t.restore()}},{key:"drawPolyline",value:function(e,t){var r=e.points;t.save(),t.beginPath(),t.moveTo(r.getItem(0).x,r.getItem(0).y);for(var n=1;n<r.numberOfItems;n++)t.lineTo(r.getItem(n).x,r.getItem(n).y);t.closePath(),t.fill(),t.stroke(),t.restore()}},{key:"setAbsolutePath",value:function(t){var r=t.getAttribute("d"),n=e.getCommandList(r);if(n){var i=e.getAbsoluteCommands(n),a=e.arrayToString(i);t.setAttribute("d",a)}}},{key:"getSVGcommands",value:function(t){return e.getCommandList(t.getAttribute("d"))}},{key:"getCommandList",value:function(t){if(!t)return null;var r=t.match(/[A-DF-Za-df-z][^A-Za-df-z]*/g);if(!r)return null;for(var n=[],i=0;i<r.length;i++){var a=r[i],o=a.charAt(0),s="z"==o.toLowerCase()?[]:e.splitNumericArgs(a.substr(1,a.length));s.unshift(o),n.push(s)}return n}},{key:"arrayToString",value:function(e){for(var t="",r=0;r<e.length;r++){var n=e[r];t+=n[0],n.length>1&&(n.shift(),t+=n.toString())}return t}},{key:"getAbsoluteCommands",value:function(t){for(var r=[],n=0;n<t.length;n++)r.push(e.getAbsoluteCommand(t[n]));return r}},{key:"getAbsoluteCommand",value:function(e){var t=e[0];return lt=ot.indexOf(t)>-1,ct=st.indexOf(t)>-1,ft[t](e)}},{key:"setAbsoluteMove",value:function(e){return lt=!1,ct=!1,et={x:e[1],y:e[2]},tt=et,it=et,e}},{key:"setRelativeMove",value:function(e){return et={x:e[1],y:e[2]},tt=et,["M",et.x,et.y]}},{key:"setClosePath",value:function(e){return et=tt,e}},{key:"setAbsoluteLine",value:function(e){return et={x:e[1],y:e[2]},e}},{key:"setRelativeLine",value:function(e){return["L",(et=oe.sum(et,{x:e[1],y:e[2]})).x,et.y]}},{key:"setAbsoluteHLine",value:function(e){return["L",(et={x:e[1],y:et.y}).x,et.y]}},{key:"setRelativeHLine",value:function(e){return["L",(et={x:et.x+e[1],y:et.y}).x,et.y]}},{key:"setAbsoluteVLine",value:function(e){return["L",(et={x:et.x,y:e[1]}).x,et.y]}},{key:"setRelativeVLine",value:function(e){return["L",(et={x:et.x,y:et.y+e[1]}).x,et.y]}},{key:"setAbsoluteCurve",value:function(e){return it={x:e[3],y:e[4]},et={x:e[5],y:e[6]},e}},{key:"setRelativeCurve",value:function(e){var t={x:e[1],y:e[2]},r={x:e[3],y:e[4]},n={x:e[5],y:e[6]},i=oe.sum(et,t),a=oe.sum(et,r);return it=a,et=oe.sum(et,n),["C",i.x,i.y,a.x,a.y,et.x,et.y]}},{key:"setAbsoluteSmooth",value:function(e){return it={x:e[1],y:e[2]},et={x:e[3],y:e[4]},e}},{key:"setRelativeSmooth",value:function(e){var t=lt?oe.sum(et,oe.diff(et,it)):et,r=oe.sum(et,{x:e[1],y:e[2]}),n=oe.sum(et,{x:e[3],y:e[4]});return et=n,it=r,["C",t.x,t.y,r.x,r.y,n.x,n.y]}},{key:"setAbsoluteQCurve",value:function(e){return it={x:e[1],y:e[2]},et={x:e[3],y:e[4]},e}},{key:"setRelativeQCurve",value:function(e){return it=oe.sum(et,{x:e[1],y:e[2]}),et=oe.sum(et,{x:e[3],y:e[4]}),["Q",it.x,it.y,null,null]}},{key:"setAbsoluteQSmooth",value:function(e){var t=ct?oe.sum(et,oe.diff(et,it)):et;return et={x:e[1],y:e[2]},it=t,e}},{key:"setRelativeQSmooth",value:function(e){return it=ct?oe.sum(et,oe.diff(et,it)):et,["T",(et=oe.sum(et,{x:e[1],y:e[2]})).x,et.y]}},{key:"endp",get:function(){return et}},{key:"curveoptions",get:function(){return ot}},{key:"lastcxy",get:function(){return it},set:function(e){it=e}},{key:"svgerror",get:function(){return at}},{key:"strokevalues",get:function(){return ut}}],(r=null)&&nt(t.prototype,r),n&&nt(t,n),e}(),ht={M:dt.absoulteMove,m:dt.relativeMove,L:dt.absoluteLine,l:dt.relativeLine,H:dt.absoluteHLine,h:dt.relativeHLine,V:dt.absoluteVLine,v:dt.relativeVLine,C:dt.absoluteCurve,c:dt.relativeCurve,S:dt.absoluteSmooth,s:dt.relativeSmooth,Q:dt.absoluteQCurve,q:dt.relativeQCurve,T:dt.absoluteQSmooth,t:dt.relativeQSmooth,Z:dt.closePath,z:dt.closePath},ft={M:dt.setAbsoluteMove,m:dt.setRelativeMove,L:dt.setAbsoluteLine,l:dt.setRelativeLine,H:dt.setAbsoluteHLine,h:dt.setRelativeHLine,V:dt.setAbsoluteVLine,v:dt.setRelativeVLine,C:dt.setAbsoluteCurve,c:dt.setRelativeCurve,S:dt.setAbsoluteSmooth,s:dt.setRelativeSmooth,Q:dt.setAbsoluteQCurve,q:dt.setRelativeQCurve,T:dt.setAbsoluteQSmooth,t:dt.setRelativeQSmooth,Z:dt.setClosePath,z:dt.setClosePath};function gt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var pt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"getList",value:function(e){return null==e?null:e.transform?e.transform.baseVal:e.gradientTransform?e.gradientTransform.baseVal:null}},{key:"extract",value:function(t,r){for(var n=e.getList(t),i=0;i<n.numberOfItems;++i)if(n.getItem(i).type==r)return n.getItem(i);return Vt.root.createSVGTransform()}},{key:"getIndex",value:function(t,r){for(var n=e.getList(t),i=0;i<n.numberOfItems;++i)if(n.getItem(i).type==r)return i;return null}},{key:"point",value:function(t,r,n){return e.newPoint(t,r).matrixTransform(n)}},{key:"newPoint",value:function(e,t){var r=Vt.root.createSVGPoint();return r.x=e,r.y=t,r}},{key:"translateTo",value:function(t,r){if(null!=t){switch(t.tagName){case"g":for(var n=0;n<t.childElementCount;n++)null!=e.getList(t.childNodes[n])&&e.translateTo(t.childNodes[n],r,e.getScaleMatrix(t.childNodes[n]));break;case"ellipse":case"circle":var i=e.point(t.getAttribute("cx"),t.getAttribute("cy"),r.matrix);t.setAttributeNS(null,"cx",i.x),t.setAttributeNS(null,"cy",i.y);break;case"line":e.line(t,r.matrix);break;case"path":e.applyToCmds(t,r.matrix);break;case"clipPath":e.translateTo(t.childNodes[0],r);break;case"image":case"rect":var a=e.point(Number(t.getAttribute("x")),Number(t.getAttribute("y")),r.matrix);t.setAttributeNS(null,"x",a.x),t.setAttributeNS(null,"y",a.y);break;case"polygon":case"polyline":for(var o=t.points,s={x:r.matrix.e,y:r.matrix.f},l=0;l<o.numberOfItems;l++){var c=oe.sum(o.getItem(l),s);o.getItem(l).x=c.x,o.getItem(l).y=c.y}}e.updateAll(t),e.updateRotationCenter(t)}}},{key:"updateRotationCenter",value:function(t){if(0!=e.getRotationAngle(t)){var r=e.getRotationAngle(t),n=e.extract(t,4),i=e.getCombinedMatrices(t),a=yt.getBoxCenter(t);a=e.point(a.x,a.y,i),n.setRotate(r,a.x,a.y)}}},{key:"line",value:function(e,t){var r=Vt.root.createSVGPoint();r.x=Number(e.getAttribute("x1")),r.y=Number(e.getAttribute("y1")),r=r.matrixTransform(t),e.setAttribute("x1",r.x),e.setAttribute("y1",r.y),r.x=Number(e.getAttribute("x2")),r.y=Number(e.getAttribute("y2")),r=r.matrixTransform(t),e.setAttribute("x2",r.x),e.setAttribute("y2",r.y)}},{key:"eleminateTranslates",value:function(t){for(var r=e.getList(t),n=0;n<r.numberOfItems;++n)if(2==r.getItem(n).type){var i=r.getItem(n);if(r.removeItem(n),"image"==t.nodeName){var a=Object(s.q)("clip_"+t.id);a&&e.translateTo(a.childNodes[0],i)}e.translateTo(t,i)}}},{key:"eliminateAll",value:function(t){var r=e.getList(t);if(r&&r.numberOfItems>0)for(var n=r.numberOfItems;n--;)r.removeItem(n);return r}},{key:"combineAll",value:function(t){var r=e.getList(t);if(null==r)return Vt.root.createSVGMatrix();for(var n=r.numberOfItems,i=Vt.root.createSVGMatrix(),a=0;a<n;a++){var o=r.getItem(a);i=i.multiply(o.matrix)}return i}},{key:"appendForMove",value:function(t,r){var n=e.getList(t);null!=n&&(0==n.numberOfItems?n.appendItem(r):n.insertItemBefore(r,0))}},{key:"getTranslateTransform",value:function(){var e=Vt.root.createSVGTransform();return e.setTranslate(0,0),e}},{key:"applyRotation",value:function(t,r){var n=Vt.root.createSVGTransform(),i=yt.getBox(t),a=i.x+i.width/2,o=i.y+i.height/2;n.setRotate(r,a,o),e.getList(t).appendItem(n)}},{key:"getRotationAngle",value:function(t,r){var n=e.getList(t);if(!n)return 0;for(var i=n.numberOfItems,a=0;a<i;++a){var o=n.getItem(a);if(4==o.type)return r?o.angle*s.c:o.angle}return 0}},{key:"getRotation",value:function(t){for(var r=e.getList(t),n=r.numberOfItems,i=0;i<n;++i){var a=r.getItem(i);if(4==a.type)return a}var o=Vt.root.createSVGTransform(),s=yt.getBoxCenter(t);return o.setRotate(0,s.x,s.y),0==r.numberOfItems?e.getList(t).appendItem(o):e.getList(t).insertItemBefore(o,0),o}},{key:"getValid",value:function(t){if(t){var r=e.getList(t);if(!r)return null;if(r&&r.numberOfItems>0){for(var n=r.numberOfItems;n--;){var i=r.getItem(n);0==i.type&&r.removeItem(n),i.matrix.isIdentity()?r.removeItem(n):4==i.type&&(0==i.angle&&r.removeItem(n),360==i.angle&&r.removeItem(n))}if(1==r.numberOfItems&&e.getRotationAngle(t))return null}return 0==r.numberOfItems?(t.getAttribute("transform")&&t.removeAttribute("transform"),null):r}}},{key:"getCombinedMatrices",value:function(t){var r=e.getList(t);if(null==r)return Vt.root.createSVGMatrix();for(var n=r.numberOfItems,i=Vt.root.createSVGMatrix(),a=0;a<n;a++){var o=r.getItem(a);4!=o.type&&(i=i.multiply(o.matrix))}return i}},{key:"hasScaleMatrix",value:function(t){var r=e.getList(t);if(null==r)return!1;for(var n=0;n<r.numberOfItems;++n)if(3==r.getItem(n).type)return!0;return!1}},{key:"getScaleMatrix",value:function(t){var r=e.getList(t),n=e.getIndex(t,3);return null!=n?r.getItem(n).matrix:Vt.root.createSVGMatrix()}},{key:"updateAll",value:function(t){var r=e.getList(t);r&&0==r.numberOfItems&&t.removeAttribute("transform")}},{key:"applyMatrix",value:function(t,r){var n=Vt.root.createSVGTransform();n.setMatrix(r),e.getList(t).appendItem(n)}},{key:"applyToCmds",value:function(t,r){var n=t.getAttribute("d"),i=dt.getCommandList(n),a=[];if(i){for(var o=0;o<i.length;o++){var s=i[o];s=e.getModifiedCmd(s,r),a.push(s)}var l=dt.arrayToString(a);t.setAttribute("d",l)}}},{key:"getModifiedCmd",value:function(t,r){var n=e.newPoint(0,0);if(t.length<2)return t;if(t.length<3)return"h"==t[0].toLowerCase()?(n.x=t[1],t[1]=n.matrixTransform(r).x):(n.y=t[1],t[1]=n.matrixTransform(r).y),t;for(var i=1;i<t.length;i+=2)n.x=t[i],n.y=t[i+1],n=n.matrixTransform(r),t[i]=n.x,t[i+1]=n.y;return t}},{key:"rotateFromPoint",value:function(t,r){var n,i,a,o,l,c,u=r.tagName,d=e.getRotation(r);switch(u){case"g":for(var h=0;h<r.childElementCount;h++)e.rotateFromPoint(t,r.childNodes[h]);r.getAttribute("transform")&&r.removeAttribute("transform");break;case"clipPath":break;case"image":case"rect":n=yt.getBoxCenter(r),i=e.point(n.x,n.y,t.matrix),a=oe.diff(i,n),(o=Vt.root.createSVGMatrix()).e=a.x,o.f=a.y;var f=Vt.root.createSVGPoint();f.x=Number(r.getAttribute("x")),f.y=Number(r.getAttribute("y")),f=f.matrixTransform(o);var g=oe.diff({x:f.x,y:f.y},{x:r.getAttribute("x"),y:r.getAttribute("y")});if(r.setAttribute("x",f.x),r.setAttribute("y",f.y),"image"==u&&oe.len(g)>0){var p=Object(s.q)("pathmask_"+r.id);if(p){p.getAttribute("transform")&&p.removeAttribute("transform");var v=Vt.root.createSVGMatrix();v.e=g.x,v.f=g.y,e.applyToCmds(p,v)}}break;case"circle":case"ellipse":l=Number(r.getAttribute("cx")),c=Number(r.getAttribute("cy"));var m={cx:(i=e.point(l,c,t.matrix)).x,cy:i.y};for(var b in m)r.setAttributeNS(null,b,Math.round(100*m[b])/100);break;case"line":n=yt.getBoxCenter(r),i=e.point(n.x,n.y,t.matrix),a=oe.diff(i,n),(o=Vt.root.createSVGMatrix()).e=a.x,o.f=a.y,e.line(r,o);break;case"path":n=yt.getBoxCenter(r),i=e.point(n.x,n.y,t.matrix),a=oe.diff(i,n),(o=Vt.root.createSVGMatrix()).e=a.x,o.f=a.y,e.applyToCmds(r,o);break;case"polygon":case"polyline":n=yt.getBoxCenter(r),i=e.point(n.x,n.y,t.matrix),a=oe.diff(i,n),(o=Vt.root.createSVGMatrix()).e=a.x,o.f=a.y;for(var y=r.points,k=0;k<y.numberOfItems;k++)i=e.point(y.getItem(k).x,y.getItem(k).y,o),y.getItem(k).x=i.x,y.getItem(k).y=i.y}if("g"!=u&&"clipPath"!=u){d=e.getRotation(r);var w=yt.getBox(r);l=w.x+w.width/2,c=w.y+w.height/2,d.setRotate(t.angle+d.angle,l,c),e.updateRotationCenter(r),"path"==u&&(e.applyToCmds(r,e.combineAll(r)),e.eliminateAll(r))}}}],(r=null)&&gt(t.prototype,r),n&&gt(t,n),e}();function vt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}SVGMatrix.prototype.isIdentity=function(){return 1==this.a&&0==this.b&&0==this.c&&1==this.d&&0==this.e&&0==this.f};var mt,bt={path:["d"],image:["x","y","width","height"],ellipse:["cx","cy","rx","ry"],rect:["x","y","width","height"],circle:["cx","cy","r"],line:["x1","y1","x2","y2"],text:["x","y","font-size","font-family","font-style","font-weight","text-anchor","xml:space"],polyline:["points"],polygon:["points"]},yt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"init",value:function(){mt=e.getPenAttributes()}},{key:"getPenAttributes",value:function(){return{path:e.onlyKeys(e.getPenAttr()),ellipse:e.onlyKeys(e.getPenAttr()),rect:e.onlyKeys(e.getPenAttr()),line:e.onlyKeys(e.getPenAttr()),image:[],polyline:e.onlyKeys(e.getPenAttr()),polygon:e.onlyKeys(e.getPenAttr())}}},{key:"create",value:function(e,t,r){var n=document.createElementNS(Vt.xmlns,"svg");return n.setAttributeNS(null,"version",1.1),t&&n.setAttributeNS(null,"width",t),r&&n.setAttributeNS(null,"height",r),e.appendChild(n),n}},{key:"createGroup",value:function(e,t){var r=document.createElementNS(Vt.xmlns,"g");return t&&r.setAttribute("id",t),e&&e.appendChild(r),r}},{key:"addChild",value:function(e,t,r){var n=document.createElementNS(Vt.xmlns,t);for(var i in r)n.setAttribute(i,r[i]);return e&&e.appendChild(n),n}},{key:"addPath",value:function(t,r,n){var i=document.createElementNS(Vt.xmlns,"path"),a={d:"M"+r+","+n,id:Object(s.l)("path"),opacity:1},o=e.getPolyAttr();for(var l in a)i.setAttribute(l,a[l]);for(var c in o)i.setAttribute(c,o[c]);return t.appendChild(i),i}},{key:"addPolyline",value:function(t,r,n){var i=document.createElementNS(Vt.xmlns,"polyline"),a={points:" "+r+","+n+" ",id:Object(s.l)("polyline"),opacity:1},o=e.getPolyAttr();for(var l in a)i.setAttribute(l,a[l]);for(var c in o)i.setAttribute(c,o[c]);return t.appendChild(i),i}},{key:"addEllipse",value:function(t,r,n){var i=document.createElementNS(Vt.xmlns,"ellipse"),a={cx:r,cy:n,rx:0,ry:0,id:Object(s.l)("ellipse"),opacity:1};for(var o in a)i.setAttribute(o,a[o]);var l=e.getPenAttr(i);for(var c in l)i.setAttribute(c,l[c]);return t.appendChild(i),i}},{key:"addTriangle",value:function(t,r,n){var i=document.createElementNS(Vt.xmlns,"path"),a={id:Object(s.l)("path"),opacity:1},o=[["M",r,n+1],["L",r+.5,n],["L",r+1,n+1],["L",r,n+1]];a.d=dt.arrayToString(o);var l=e.getPenAttr();for(var c in a)i.setAttribute(c,a[c]);for(var u in l)i.setAttribute(u,l[u]);return t.appendChild(i),i}},{key:"addRect",value:function(t,r,n){var i=document.createElementNS(Vt.xmlns,"rect"),a={x:r,y:n,width:0,height:0,id:Object(s.l)("rect"),opacity:1};for(var o in a)i.setAttribute(o,a[o]);var l=e.getPenAttr(i);for(var c in l)i.setAttribute(c,l[c]);return t.appendChild(i),i}},{key:"getPolyAttr",value:function(){return{fill:"none",stroke:Vt.fillcolor,"stroke-width":Vt.strokewidth,"stroke-linecap":"round",opacity:1,style:"pointer-events:visiblePainted;"}}},{key:"getPenAttr",value:function(){return{fill:"none",stroke:Vt.fillcolor,"stroke-width":Vt.strokewidth,opacity:1,style:"pointer-events:visiblePainted;"}}},{key:"getCopy",value:function(t){return e.toObject(e.svg2string(t))}},{key:"svg2string",value:function(e){var t=(new XMLSerializer).serializeToString(e);return'<svg xmlns="'+Vt.xmlns+'" xmlns:xlink="'+Vt.xmlnslink+'">'+(t=t.replace(/ href="data:image/g,' xlink:href="data:image'))+"</svg>"}},{key:"toObject",value:function(e){e.replace(/>\s*</g,"><");var t=(new DOMParser).parseFromString(e,"text/xml");return document.importNode(t.documentElement.firstChild,!0)}},{key:"rename",value:function(t){if(null!=t)switch(t.tagName){case"g":if(t.id){var r=unescape(t.id).replace(/[0-9]/g,"").replace(/\s*/g,"");t.id=Object(s.l)(r)}for(var n=0;n<t.childElementCount;n++)e.rename(t.childNodes[n]);break;case"image":var i=pt.point(t.getAttribute("x"),t.getAttribute("y"),window.xform.matrix);if(t.setAttributeNS(null,"x",i.x),t.setAttributeNS(null,"y",i.y),t.id=Object(s.l)("image"),t.getAttribute("pathUrl")){var a=Object(s.l)("clippath");Object(s.q)(t.getAttribute("pathUrl")).id=a,t.setAttribute("pathUrl",a)}break;default:t.id&&(r=unescape(t.id).replace(/[0-9]/g,"").replace(/\s*/g,""),t.id=Object(s.l)(r))}}},{key:"saveBackground",value:function(e,t,r){var n=new XMLSerializer,i=n.serializeToString(e);i=i.replace(/ href/g," xlink:href");var a='<svg xmlns="'+Vt.xmlns+'" xmlns:xlink="'+Vt.xmlnslink+'" viewBox= "0 0 '+t+" "+r+'" width="'+t+'px" height="'+r+'px">',o=document.createComment("Created with Scratch Jr");return a+=n.serializeToString(o),a+=i,(a+="</svg>").replace(/></g,">\n<")}},{key:"cleanup",value:function(t){if(0!=t.childElementCount)for(var r=0;r<t.childElementCount;r++){var n=t.childNodes[r];"g"==n.tagName&&e.cleanup(n)}else"layer1"!=t.id&&t.parentNode.removeChild(t)}},{key:"saveShape",value:function(t,r,n){e.cleanup(t);var i=e.getCopy(t),a=new XMLSerializer,o=e.calculateViewBox(i);r=o.width,n=o.height;var s=a.serializeToString(i);s=s.replace(/ href/g," xlink:href");var l='<svg xmlns="'+Vt.xmlns+'" xmlns:xlink="'+Vt.xmlnslink+'" viewBox= "0 0 '+r+" "+n+'" width="'+r+'px" height="'+n+'px">',c=document.createComment("Created with Scratch Jr");return l+=a.serializeToString(c),l+=s,(l+="</svg>").replace(/></g,">\n<")}},{key:"calculateViewBox",value:function(t){var r=e.getBox(t,!0).rounded();return e.outsideBounds(r)?{width:Vt.workspaceWidth,height:Vt.workspaceHeight}:(r=r.expandBy(20),window.xform.setTranslate(-r.x,-r.y),pt.translateTo(t,window.xform),r)}},{key:"outsideBounds",value:function(e){return e.x<0||e.y<0||e.width>Vt.workspaceWidth||e.height>Vt.workspaceHeight}},{key:"notValidBox",value:function(e){return e.x+e.width<0||e.y+e.height<0||e.x>Vt.workspaceWidth||e.y>Vt.workspaceHeight}},{key:"getBoxCenter",value:function(t){var r=e.getBox(t);return{x:r.x+r.width/2,y:r.y+r.height/2}}},{key:"getTransformedBox",value:function(t){var r=pt.getCombinedMatrices(t),n=e.getBox(t),i=pt.point(n.x,n.y,r);if(n.width=Math.abs(n.width*r.a),n.height=Math.abs(n.height*r.d),n.x=i.x,n.y=i.y,r.a<0&&(n.x-=n.width),r.d<0&&(n.y-=n.height),0!=pt.getRotationAngle(t)){var a=pt.getRotation(t),o=[];o.push(pt.point(n.x,n.y,a.matrix)),o.push(pt.point(n.x+n.width,n.y,a.matrix)),o.push(pt.point(n.x+n.width,n.y+n.height,a.matrix)),o.push(pt.point(n.x,n.y+n.height,a.matrix)),n=e.getMinMax(o)}return n}},{key:"getBox",value:function(t,r){var n=new ie(0,0,0,0);if(null==t)return n;switch(t.tagName){case"circle":n.x=t.getAttribute("cx")-t.getAttribute("r"),n.y=t.getAttribute("cy")-t.getAttribute("r"),n.width=2*Number(t.getAttribute("r")),n.height=2*Number(t.getAttribute("r")),n=n.expandBy(e.getPenWidthForm(t));break;case"g":case"svg":if(0==t.childElementCount)return n;n=e.getTransformedBox(t.childNodes[0]);for(var i=0;i<t.childElementCount;i++)if(!r||"image"!=t.childNodes[i].tagName){var a=e.getTransformedBox(t.childNodes[i]);a.isEmpty()||(n=n.union(a))}break;case"ellipse":n.x=t.getAttribute("cx")-t.getAttribute("rx"),n.y=t.getAttribute("cy")-t.getAttribute("ry"),n.width=2*Number(t.getAttribute("rx")),n.height=2*Number(t.getAttribute("ry")),n=n.expandBy(e.getPenWidthForm(t));break;case"clipPath":n=e.getTransformedBox(t.childNodes[0]);break;case"image":n.x=Number(t.getAttribute("x")),n.y=Number(t.getAttribute("y")),n.width=Number(t.getAttribute("width")),n.height=Number(t.getAttribute("height"));break;case"path":n=e.getPathBox(t).expandBy(e.getPenWidthForm(t));break;case"line":var o=Number(t.getAttribute("x1")),s=Number(t.getAttribute("x2")),l=Number(t.getAttribute("y1")),c=Number(t.getAttribute("y2")),u=Math.min(o,s),d=Math.max(o,s),h=Math.min(l,c),f=Math.max(l,c);n=new ie(u,h,d-u,f-h).expandBy(e.getPenWidthForm(t));break;case"polygon":for(var g=t.points,p=[],v=0;v<g.numberOfItems;v++)p.push(g.getItem(v));n=e.getMinMax(p).expandBy(e.getPenWidthForm(t))}return n}},{key:"getArea",value:function(t){var r,n=0,i=Number(t.getAttribute("stroke-width"))/2;switch(t.tagName){case"g":var a=e.getBox(t);n=a.width*a.height;break;case"circle":n=Math.PI*Number(t.getAttribute("r"))*Number(t.getAttribute("r"));break;case"ellipse":n=Math.PI*Number(t.getAttribute("rx"))*Number(t.getAttribute("ry"));break;case"path":var o;o=dt.isCompoundPath(t)?t.getAttribute("d").match(/[M][^M]*/g)[0]:t.getAttribute("d"),o=$e.isClockWise(o)?$e.reverse(o):o,2==(r=$e.getAllPoints(o)).length&&(r=e.getPolygon(r[0],r[1],i)),n=e.polygonArea(r);break;case"line":var s=Number(t.getAttribute("x1")),l=Number(t.getAttribute("x2")),c=Number(t.getAttribute("y1")),u=Number(t.getAttribute("y2")),d=e.getPolygon({x:s,y:c},{x:l,y:u},i);n=e.polygonArea(d);break;case"polygon":var h=t.points;r=[];for(var f=0;f<h.numberOfItems;f++)r.push(h.getItem(f));n=e.polygonArea(r)}return n}},{key:"getPolygon",value:function(e,t,r){var n=oe.diff(t,e),i=oe.scale(n,.5),a=oe.perp(i),o=oe.norm(a),s=oe.sum(e,oe.scale(o,r)),l=oe.sum(e,oe.scale(o,-r));return[s,oe.sum(t,oe.scale(o,r)),oe.sum(t,oe.scale(o,-r)),l]}},{key:"polygonArea",value:function(e){for(var t=[],r=[],n=0;n<e.length;n++)t.push(e[n].x),r.push(e[n].y);for(var i=e.length,a=0,o=i-1,s=0;s<i;s++)a+=(t[o]+t[s])*(r[o]-r[s]),o=s;return a/2}},{key:"getPenWidthForm",value:function(e){var t=e.getAttribute("stroke-width");return"NaN"==Number(t).toString()?0:Number(t)}},{key:"getMinMax",value:function(e){var t=new ie(0,0,0,0);if(e.length<1)return t;for(var r=9999999,n=9999999,i=-9999999,a=-9999999,o=0;o<e.length;o++)e[o].x<r&&(r=e[o].x),e[o].x>i&&(i=e[o].x),e[o].y<n&&(n=e[o].y),e[o].y>a&&(a=e[o].y);return t.x=r,t.y=n,t.width=i-r,t.height=a-n,t}},{key:"getPathBox",value:function(t){var r,n=t.getAttribute("d").match(/[M][^M]*/g);n||(n=[t.getAttribute("d")]);for(var i=0;i<n.length;i++){var a=e.getOnePathBox(n[i]);a.isEmpty()||(r=r?a.union(r):a)}return r}},{key:"getOnePathBox",value:function(t){for(var r=dt.getCommandList(t),n=[],i=0;i<r.length;i++){var a=dt.getAbsoluteCommand(r[i]);dt.acurve&&(n.push({x:a[1],y:a[2]}),a.length>4&&n.push({x:a[3],y:a[4]})),n.push(dt.endp)}return e.getMinMax(n)}},{key:"onlyKeys",value:function(e){var t=[];for(var r in e)t.push(r);return t}},{key:"getDataurl",value:function(e,t,r){var n=new XMLSerializer,i='<svg  xmlns="'+Vt.xmlns+'" viewBox= "0 0 '+t+" "+r+'" width="'+t+'px" height="'+r+'px">\n'+n.serializeToString(e)+"</svg>";return"data:image/svg+xml;base64,"+btoa(i)}},{key:"getLayersAbove",value:function(e,t,r,n){var i=new XMLSerializer,a='<svg  xmlns="'+Vt.xmlns+'" viewBox= "0 0 '+r+" "+n+'" width="'+r+'px" height="'+n+'px">';a+="\n";for(var o=Math.min(t+1,e.childElementCount);o<e.childElementCount;o++)a+=i.serializeToString(e.childNodes[o])+"\n";return a+="</svg>","data:image/svg+xml;base64,"+btoa(a)}},{key:"getCount",value:function(t){var r=0;if("g"==t.tagName){r+=t.childElementCount;for(var n=0;n<t.childElementCount;n++){var i=t.childNodes[n];"g"==i.tagName&&(r+=e.getCount(i))}}return r}},{key:"cloneSVGelement",value:function(t){var r=Xe.findGroup(t),n=Object(s.q)("layer1");if(n){window.xform.setTranslate(5,5);var i=[],a=[];if(!(e.getCount(n)>175)){for(var o=0;o<r.length;o++){if(e.getCount(n)>175)return;var l=e.getClonedElement(Object(s.q)("layer1"),r[o]);if(l&&"g"!=l.tagName){if(i.push(r[o].id),a.push(l.id),r[o].getAttribute("id").indexOf("Boder")>-1){var c=r[o].getAttribute("id").split("Border")[0],u=i.indexOf(c);u>-1&&l.setAttribute("id",a[u]+"Border")}if(r[o].getAttribute("relatedto")){var d=i.indexOf(r[o].getAttribute("relatedto"));d>-1&&l.setAttribute("relatedto",a[d])}}}var h=e.getFlatten(Object(s.q)("layer1"));e.removeDuplicates(h)}}}},{key:"removeDuplicates",value:function(e){for(var t=0;t<e.length;t++){var r=Object(s.q)(e[t]);if(r&&r.parentNode&&"path"==r.tagName)for(var n=t+1;n<e.length;n++){var i=Object(s.q)(e[n]);if(i&&i.parentNode&&"path"==i.tagName&&i.getAttribute("d")==r.getAttribute("d")){if(r.id.indexOf("pathborder_image")>-1&&i.id.indexOf("pathborder_image")>-1){var a=i.id.substring(String("pathborder_").length,i.id.length),o=Object(s.q)("group_"+a);o&&o.parentNode.removeChild(o)}i.parentNode.removeChild(i)}}}}},{key:"getFlatten",value:function(t){for(var r=[],n=0;n<t.childElementCount;n++){var i=t.childNodes[n];i.id.indexOf("group_image_")>-1||("g"==i.tagName?r=r.concat(e.getFlatten(i)):r.push(i.id))}return r}},{key:"getClonedElement",value:function(t,r){if(r.id.indexOf("pathborder_image_")>-1)return null;if("image"==r.tagName)return null;if("clipPath"==r.tagName)return null;if("g"==r.tagName){var n=rt.getImage(r);if(n)return rt.cloneImage(t,n);for(var i=[],a=[],o=e.createGroup(t,Object(s.l)("group")),l=0;l<r.childElementCount;l++){var c=e.getClonedElement(o,r.childNodes[l]);if(i.push(r.childNodes[l].id),a.push(c.id),r.childNodes[l].getAttribute("id").indexOf("Border")>-1){var u=r.childNodes[l].getAttribute("id").split("Border")[0],d=i.indexOf(u);d>-1&&c.setAttribute("id",a[d]+"Border")}}return o}return e.getClone(t,r)}},{key:"getClone",value:function(e,t){var r=bt[t.tagName],n=mt[t.tagName],i=document.createElementNS(Vt.xmlns,t.tagName);e.appendChild(i),r=r.concat(n);for(var a=0;a<r.length;a++)null!=t.getAttribute(r[a])&&i.setAttribute(r[a],t.getAttribute(r[a]));t.getAttribute("stroke-linecap")&&i.setAttribute("stroke-linecap",t.getAttribute("stroke-linecap")),i.setAttribute("id",Object(s.l)(t.tagName));var o=pt.getRotationAngle(t),l=void 0;return pt.hasScaleMatrix(t)&&(l=pt.getScaleMatrix(t)),0!=o&&pt.applyRotation(i,o),l&&pt.applyMatrix(i,l),pt.translateTo(i,window.xform),i}},{key:"getWatermark",value:function(t,r){var n=e.getCopy(t);return e.removeExtras(n),e.changeShape(n,r),n}},{key:"changeShape",value:function(t,r){for(var n=0;n<t.childElementCount;n++){var i=t.childNodes[n];"g"==i.tagName?e.changeShape(i,r):e.setObjectWaterMark(i,r)}}},{key:"removeExtras",value:function(t){for(var r=0,n=r<t.childElementCount;n;){var i=t.childNodes[r];"image"==i.nodeName||"clipPath"==i.nodeName?t.removeChild(i):("g"==i.tagName&&e.removeExtras(i),r++),n=r<t.childElementCount}}},{key:"setObjectWaterMark",value:function(e,t){var r=e.getAttribute("fill"),n={fill:"white",stroke:e.getAttribute("stroke")?t:e.id.indexOf("Draw")>-1?t:"none","stroke-width":e.getAttribute("stroke-width")?Number(e.getAttribute("stroke-width")):Number(dt.strokevalues["stroke-width"]),"stroke-miterlimit":e.getAttribute("stroke-miterlimit")?e.getAttribute("stroke-miterlimit"):4,"stroke-linecap":"round","stroke-linejoin":"round"};for(var i in n.fill="none"==r?"none":"white",function(){if(!r)return!0;if("none"==r)return!1;if(e.id.indexOf("Border")>-1)return!0;if(e.id.indexOf("Skip")>-1)return!1;if(e.id.indexOf("Draw")>-1)return!1;if("#080808"==r||"#000000"==r||"rgba(0, 0, 0, 0)"==r)return!0;var t=Object(s.F)(r);return t[2]<.25||oe.len(oe.diff({x:.5,y:.5},{x:t[1],y:t[2]}))<.25}()&&(n.fill=t),n)e.setAttribute(i,n[i])}},{key:"isCompoundPath",value:function(e){return"path"==e.tagName&&dt.isCompoundPath(e)}},{key:"attributeTable",get:function(){return bt}},{key:"attributePenTable",get:function(){return mt}}],(r=null)&&vt(t.prototype,r),n&&vt(t,n),e}();function kt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var wt,xt,St,_t,Ct,Ot,jt,At,Pt,Tt="#080808",Nt=432,Et=384,Bt="select",It=[1,2,4,8,16],Mt=2,Dt=!1,Rt=void 0,qt=1,Lt=!1,Ft=void 0,zt=5,Ht=1,Ut={x:0,y:0},Wt={x:0,y:0},Vt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"init",value:function(t,r){(Ot=document.getElementById("paintframe")).style.width=t+"px",Ot.style.height=r+"px",on.loadCount++,Yr.requestFromServer("/static/scratchjr/assets/paint/splash.svg",e.setSplash),on.loadCount++,Yr.requestFromServer("/static/scratchjr/assets/paint/splashshade.svg",e.setSplashShade)}},{key:"setSplash",value:function(e){on.loadCount--,At=e}},{key:"setSplashShade",value:function(e){on.loadCount--,Pt="data:image/svg+xml;base64,"+btoa(e)}},{key:"open",value:function(t,r,n,i,a,o,l){zr.analyticsEvent("editor","paint_editor_opened",t?"bkg":"character"),Ve.buffer=[],Ve.index=0,zt=5,Ht=1,Nt=432,Et=384,e.clearWorkspace(),s.h.style.display="none",Ot.className="paintframe appear",Rt=r,Dt=t,wt=n,xt=i,St=a,yt.init(),_t=!0,Dt?e.initBkg(480,360):e.initSprite(o,l),window.ontouchstart=e.detectGesture,window.ondevicemotion=void 0,Kn.onBackButtonCallback.push((function(){var t=document.createEvent("TouchEvent");t.initTouchEvent(),e.backToProject(t)}))}},{key:"blockGestures",value:function(t){t.touches&&4==t.touches.length&&e.ignore(t)}},{key:"detectGesture",value:function(t){if(t.touches&&!ze.active){e.clearEvents(t),Ut=je.getScreenPt(t),Wt=je.getScreenPt(t);var r=Math.min(3,t.touches.length);[e.ignore,e.mouseDown,e.pinchStart,e.Scroll][r](t)}}},{key:"clearEvents",value:function(e){window.ontouchmove=void 0,window.ontouchend=void 0,je.currentshape&&je.stopAction(e),K.clearEvents(),je.clearEvents()}},{key:"ignore",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"Scroll",value:function(t){t.preventDefault(),t.stopPropagation(),e.canvasFits()||(De.clearLayer(),Ut=je.getScreenPt(t),window.ontouchmove=function(t){e.dragBackground(t)},window.ontouchend=function(){e.bounceBack(),e.setCanvasTransform(qt),je.clearEvents()})}},{key:"pinchStart",value:function(t){t.preventDefault(),t.stopPropagation(),je.currentshape||(window.ontouchmove=function(){e.gestureStart(t)})}},{key:"gestureStart",value:function(t){window.ontouchmove=void 0,["path","ellipse","rect"].indexOf(Bt)>-1&&je.currentshape&&je.currentshape.parentNode&&je.currentshape.parentNode.removeChild(je.currentshape),De.clearLayer(),K.scaleStartsAt=qt,K.updatePinchCenter(t),Ut=je.zoomPt(K.pinchcenter),K.clearEvents(),K.clearDragAndDrop(),window.ontouchmove=e.gestureChange,window.ontouchend=e.gestureEnd}},{key:"gestureChange",value:function(t){t.preventDefault();var r=Math.min(zt,K.scaleStartsAt*K.zoomScale(t));r=Math.max(Ht,r);var n=Object(s.q)("maincanvas"),i=n.offsetWidth*r,a=n.offsetHeight*r;if(!(Math.min(i,a)<240)){e.updateZoomScale(r);var o=je.zoomPt(K.pinchcenter),l=oe.diff(o,Ut);e.adjustPos(l)}}},{key:"gestureEnd",value:function(t){t.preventDefault(),window.ontouchmove=void 0,window.ontouchend=void 0;var r=Math.min(zt,K.scaleStartsAt*K.zoomScale(t));r=Math.max(Ht,r),e.updateZoomScale(r);var n=je.zoomPt(K.pinchcenter),i=oe.diff(n,Ut);e.adjustPos(i),K.scaleStartsAt=qt,$e.selector&&$e.showDots($e.selector),e.setZoomTo(r)}},{key:"canvasFits",value:function(){return Object(s.q)("maincanvas").offsetWidth*qt<=Object(s.q)("workspacebkg").offsetWidth&&Object(s.q)("maincanvas").offsetHeight*qt<=Object(s.q)("workspacebkg").offsetHeight}},{key:"mouseDown",value:function(t){if(!(s.u&&t.target.ontouchstart||t.target.ontouchstart)){var r=K.getTargetPoint(t);if(Object(s.s)(Object(s.q)("donecheck"),r))e.backToProject(t);else{if(t.target.parentNode&&t.target.parentNode.getAttribute("key"))return;je.mouseDown(t)}}}},{key:"close",value:function(){Lt=!0,Ot.className="paintframe disappear",s.h.style.display="block",Kn.editorEvents(),window.ontouchmove=void 0,window.ontouchend=void 0,window.onmousemove=void 0,v.close(),e.clearWorkspace(),Ve.buffer=[],Ve.index=0,De.maskData={},setTimeout((function(){Lt=!1}),500)}},{key:"backToProject",value:function(t){t.preventDefault(),t.stopPropagation(),Lt||je.dragGroup.length>0||t.touches&&t.touches.length>1||($e.quitEditMode(),ze.close(),je.clearDragGroup(),Kn.unfocus(),x.sndFX("tap.wav"),null==wt&&null==xt?e.savePageImage(e.changePage):e.saveSprite(e.changePageSprite),Kn.onBackButtonCallback.pop())}},{key:"saveEditState",value:function(){ze.close(),Kn.unfocus(),x.sndFX("tap.wav"),null==wt&&null==xt?e.savePageImage():e.saveSprite()}},{key:"setMode",value:function(t){var r;if(!(t.touches&&t.touches.length>1)&&(t.preventDefault(),null!=(r=window.event?window.event.srcElement:t.target))){if("camera"===r.getAttribute("key")&&!zr.askForCameraPermission())return;$e.quitEditMode(),ze.active?ze.doAction(r.getAttribute("key")):(["select","rotate","stamper","scissors","camera","paintbucket"].indexOf(r.getAttribute("key"))>-1&&x.sndFX("tap.wav"),e.selectButton(r.getAttribute("key")))}}},{key:"selectButton",value:function(t){e.selectButtonFromDiv(Object(s.q)("painttools"),t),e.selectButtonFromDiv(Object(s.q)("selectortools"),t),e.selectButtonFromDiv(Object(s.q)("edittools"),t),e.selectButtonFromDiv(Object(s.q)("filltools"),t),Object(s.q)("stamps")&&e.selectButtonFromDiv(Object(s.q)("stamps"),t),Bt=t,e.selectPenSize(It.indexOf(Mt))}},{key:"selectButtonFromDiv",value:function(t,r){for(var n=0;n<t.childElementCount;n++){var i=t.childNodes[n];i.childNodes[0].getAttribute("key")==r?(i.setAttribute("class",e.getClass(i,"on")),i.childNodes[0].getAttribute("class")&&i.childNodes[0].setAttribute("class",e.getClass(i.childNodes[0],"on"))):(i.setAttribute("class",e.getClass(i,"off")),i.childNodes[0].getAttribute("class")&&i.childNodes[0].setAttribute("class",e.getClass(i.childNodes[0],"off")))}}},{key:"getClass",value:function(e,t){var r=e.getAttribute("class").split(" ");return r.pop(),r.push(t),r.join(" ")}},{key:"setZoomTo",value:function(t){qt=t,e.bounceBack(),e.setCanvasTransform(t),De.drawOffscreen()}},{key:"updateZoomScale",value:function(t){qt=t,e.setCanvasTransform(t)}},{key:"setCanvasTransform",value:function(e){s.t?Object(s.q)("maincanvas").style.webkitTransform="translate3d("+Object(s.q)("maincanvas").dx+"px,"+Object(s.q)("maincanvas").dy+"px, 0px) scale("+e+","+e+")":Object(s.q)("maincanvas").style.webkitTransform="translate("+Object(s.q)("maincanvas").dx+"px,"+Object(s.q)("maincanvas").dy+"px) scale("+e+","+e+")"}},{key:"adjustPos",value:function(t){Object(s.q)("maincanvas").dx+=t.x,Object(s.q)("maincanvas").dy+=t.y,e.setCanvasTransform(qt)}},{key:"bounceBack",value:function(){var t=Math.floor((Object(s.q)("workspacebkg").offsetWidth-Nt)/2),r=Math.floor((Object(s.q)("workspacebkg").offsetHeight-Et)/2);Object(s.q)("maincanvas").dx=e.canvasFits()?t:e.getCoorx(20,t),Object(s.q)("maincanvas").dy=e.canvasFits()?r:e.getCoory(20,r)}},{key:"getCoorx",value:function(e,t){if(Object(s.q)("maincanvas").offsetWidth*qt<=Object(s.q)("workspacebkg").offsetWidth)return t;var r=Object(s.q)("maincanvas").dx+Object(s.q)("maincanvas").cx-Object(s.q)("maincanvas").cx*qt;if(r>e)return Object(s.q)("maincanvas").dx+(e-r);t=(r/qt+Object(s.q)("maincanvas").offsetWidth)*qt;var n=Object(s.q)("workspacebkg").offsetWidth-e;return t<n?Object(s.q)("maincanvas").dx+(n-t):Object(s.q)("maincanvas").dx}},{key:"getCoory",value:function(e,t){if(Object(s.q)("maincanvas").offsetHeight*qt<=Object(s.q)("workspacebkg").offsetHeight)return t;var r=Object(s.q)("maincanvas").dy+Object(s.q)("maincanvas").cy-Object(s.q)("maincanvas").cy*qt;if(r>e)return Object(s.q)("maincanvas").dy+(e-r);t=(r/qt+Object(s.q)("maincanvas").offsetHeight)*qt;var n=Object(s.q)("workspacebkg").offsetHeight-e;return t<n?Object(s.q)("maincanvas").dy+(n-t):Object(s.q)("maincanvas").dy}},{key:"scaleToFit",value:function(){var t=Ct.parentNode.parentNode.offsetHeight/(Et+10),r=Ct.parentNode.parentNode.offsetWidth/(Nt+10);e.setZoomTo(Math.min(r,t))}},{key:"dragBackground",value:function(t){if(!e.canvasFits()){var r=je.getScreenPt(t),n=oe.diff(r,Ut);e.adjustPos(n)}}},{key:"layout",value:function(){e.topbar();var t=Object(s.B)("div","innerpaint",Ot);e.leftPalette(t);var r=Object(s.B)("div","workspacebkg-container",t),n=Object(s.B)("div","workspacebkg",r);n.setAttribute("id","workspacebkg"),e.rightPalette(t),e.colorPalette(Ot),e.selectButton("path"),e.createSVGeditor(n)}},{key:"topbar",value:function(){var t=Object(s.B)("div","paintop",Ot);e.checkMark(t),Ve.setup(t),e.nameOfcostume(t)}},{key:"checkMark",value:function(t){var r=Object(s.B)("div","paintdone",t);r.id="donecheck",s.u?r.ontouchstart=e.backToProject:r.onmousedown=e.backToProject}},{key:"nameOfcostume",value:function(t){var r=Object(s.B)("form","spriteform",t);r.name="spriteform";var n=Object(s.B)("input",void 0,r);n.autocomplete=!1,n.autocorrect=!1,n.name="name",n.maxLength=25,n.firstTime=!0,n.ontouchstart=function(){},n.onfocus=e.nameFocus,n.onblur=e.nameBlur,n.onkeypress=e.handleNamePress,n.onkeyup=e.handleKeyRelease,r.onsubmit=e.submitNameChange}},{key:"submitNameChange",value:function(e){e.preventDefault(),e.target.blur()}},{key:"nameFocus",value:function(e){e.preventDefault(),e.stopPropagation();var t=e.target;t.firstTime=!0,Kn.activeFocus=t,s.t&&AndroidInterface.scratchjr_setsoftkeyboardscrolllocation(t.getBoundingClientRect().top*window.devicePixelRatio,t.getBoundingClientRect().bottom*window.devicePixelRatio),setTimeout((function(){t.setSelectionRange(t.value.length,t.value.length)}),1)}},{key:"nameBlur",value:function(e){Kn.activeFocus=void 0;var t=Kn.getSprite(),r=e.target,n=Kn.validate(r.value,t.name);r.value=n.substring(0,r.maxLength),Kn.storyStart("Paint.nameBlur")}},{key:"handleNamePress",value:function(t){if(13==(t.keyCode||t.which))e.submitNameChange(t);else{var r=t.target;r.firstTime&&(r.firstTime=!1,r.value=""),25==r.value.length&&x.sndFX("boing.wav")}}},{key:"handleKeyRelease",value:function(e){var t=e.keyCode||e.which,r=e.target;8==t&&r.firstTime&&(r.firstTime=!1,r.value="")}},{key:"leftPalette",value:function(t){var r=Object(s.B)("div","side up",t),n=Object(s.B)("div","paintpalette",r);n.setAttribute("id","paintpalette"),e.setupEditPalette(n),e.createSizeSelector(n)}},{key:"setupEditPalette",value:function(t){var r=Object(s.B)("div","section",t);r.setAttribute("id","painttools");var n=["path","ellipse","rect","tri"],i=0;for(i=0;i<n.length;i++){var a=Object(s.B)("div","element off",r),o=Object(s.B)("div","tool "+n[i]+" off",a);o.setAttribute("key",n[i]),s.u?o.ontouchstart=e.setMode:o.onmousedown=e.setMode}}},{key:"createSizeSelector",value:function(t){var r=Object(s.B)("div","section space",t);r.setAttribute("id","sizeSelector");for(var n=0;n<It.length;n++){var i=Object(s.B)("div","pensizeholder",r);i.key=n,i.ontouchstart=function(t){t.preventDefault(),t.stopPropagation();var r=Number(this.key);Mt=It[Number(this.key)],e.selectPenSize(r)};var a=Object(s.B)("div","line t"+n,i);e.drawPenSizeInColor(a)}Mt=It[1],e.selectPenSize(1)}},{key:"drawPenSizeInColor",value:function(e){e.style.background=Tt}},{key:"updateStrokes",value:function(){var t=Object(s.q)("sizeSelector");if(t)for(var r=0;r<t.childElementCount;r++){var n=t.childNodes[r];e.drawPenSizeInColor(n.childNodes[0])}}},{key:"selectPenSize",value:function(e){for(var t=Object(s.q)("sizeSelector"),r=0;r<t.childElementCount;r++){var n=t.childNodes[r];n.key==e?n.setAttribute("class","pensizeholder on"):n.setAttribute("class","pensizeholder off")}}},{key:"rightPalette",value:function(t){var r=Object(s.B)("div","side",t);e.addSidePalette(r,"selectortools",["select","rotate"]),e.addSidePalette(r,"edittools",["stamper","scissors"]),e.addSidePalette(r,"filltools","1"==zr.camera?["camera","paintbucket"]:["paintbucket"])}},{key:"addSidePalette",value:function(t,r,n){var i=Object(s.B)("div","paintpalette short",t);i.setAttribute("id",r);for(var a=0;a<n.length;a++){var o=Object(s.B)("div","element off",i),l=Object(s.B)("div","tool "+n[a]+" off",o);l.setAttribute("key",n[a]),l.ontouchstart=e.setMode}}},{key:"cameraToolsOn",value:function(){Object(s.q)("backdrop").setAttribute("class","modal-backdrop fade dark"),Object(s.K)(Object(s.q)("backdrop").style,{display:"block"});var t=Object(s.B)("div","phototopbar",Object(s.q)("backdrop"));t.setAttribute("id","photocontrols");var r=Object(s.B)("div","flipcamera",t);r.setAttribute("id","cameraflip"),r.setAttribute("key","cameraflip"),s.t&&!AndroidInterface.scratchjr_has_multiple_cameras()&&(r.style.display="none"),r.ontouchstart=e.setMode;var n=Object(s.B)("div","snapshot-container",Object(s.q)("backdrop"));n.setAttribute("id","capture-container");var i=Object(s.B)("div","snapshot",n);i.setAttribute("id","capture"),i.setAttribute("key","camerasnap"),i.ontouchstart=e.setMode;var a=Object(s.B)("div","cameraclose",t);a.setAttribute("id","cameraclose"),a.ontouchstart=e.closeCameraMode}},{key:"closeCameraMode",value:function(){x.sndFX("exittap.wav"),ze.close(),e.selectButton("select")}},{key:"cameraToolsOff",value:function(){if(Object(s.q)("backdrop").setAttribute("class","modal-backdrop fade"),Object(s.K)(Object(s.q)("backdrop").style,{display:"none"}),Object(s.q)("photocontrols")&&Object(s.q)("photocontrols").parentNode.removeChild(Object(s.q)("photocontrols")),Object(s.q)("capture")){var e=Object(s.q)("capture").parentNode,t=e.parentNode;e.removeChild(Object(s.q)("capture")),t.removeChild(Object(s.q)("capture-container"))}}},{key:"setUpCanvasArea",value:function(){var t=Object(s.q)("workspacebkg"),r=Math.floor((t.offsetWidth-Nt)/2),n=Math.floor((t.offsetHeight-Et)/2),i=Nt,a=Et,o=Object(s.q)("maincanvas");o.style.background="#F5F2F7",o.style.top="0px",o.style.left="0px",o.style.width=i+"px",o.style.height=a+"px",o.cx=o.offsetWidth/2,o.cy=o.offsetHeight/2,o.dx=r,o.dy=n,Ct.setAttributeNS(null,"width",i),Ct.setAttributeNS(null,"height",a),e.drawGrid(i,a),je.clearEvents()}},{key:"colorPalette",value:function(t){var r=e.initSwatchList(),n=Object(s.B)("div","swatchpalette-container",t),i=Object(s.B)("div","swatchpalette",n);i.setAttribute("id","swatches");for(var a=0;a<r.length;a++){var o=Object(s.B)("div","swatchbucket",i),l=Object(s.B)("div","swatchframe",o);Object(s.B)("div","swatchcolor",l).style.background=r[a],l=Object(s.B)("div","splasharea off",o),e.setSplashColor(l,At,r[a]),e.addImageUrl(l,Pt),o.ontouchstart=e.selectSwatch}e.setSwatchColor(Object(s.q)("swatches").childNodes[r.indexOf("#1C1C1C")])}},{key:"setSplashColor",value:function(t,r,n){var i="data:image/svg+xml;base64,"+btoa(r.replace(/#662D91/g,n));e.addImageUrl(t,i)}},{key:"addImageUrl",value:function(e,t){var r=document.createElement("img");r.src=t,r.style.position="absolute",e.appendChild(r)}},{key:"selectSwatch",value:function(t){if(!(t.touches&&t.touches.length>1||(t.preventDefault(),t.stopPropagation(),ze.active))){for(var r,n="swatchbucket"!=(r=window.event?window.event.srcElement:t.target).className;n;)n=(r=r.parentNode)&&"swatchbucket"!=r.className;r&&(x.sndFX("splash.wav"),e.setSwatchColor(r))}}},{key:"setSwatchColor",value:function(t){t&&["select","wand","stamper","scissors","rotate"].indexOf(Bt)>-1&&e.selectButton("paintbucket");for(var r=t.childNodes[0].childNodes[0].style.backgroundColor,n=0;n<Object(s.q)("swatches").childElementCount;n++)r==Object(s.q)("swatches").childNodes[n].childNodes[0].childNodes[0].style.backgroundColor?Object(s.q)("swatches").childNodes[n].childNodes[1].setAttribute("class","splasharea on"):Object(s.q)("swatches").childNodes[n].childNodes[1].setAttribute("class","splasharea off");Tt=r,$e.quitEditMode(),e.updateStrokes()}},{key:"initSwatchList",value:function(){return["#FFD2F2","#FF99D6","#FF4583","#C30001","#FF0023","#FF8300","#FFB200","#FFF42E","#FFF9C2","#E2FFBD","#CFF500","#50D823","#29C130","#2BBF8A","#027607","#114D24","#FFFFFF","#CCDDE7","#61787C","#1C1C1C","#D830A3","#FF64E9","#D999FF"," #A159D3","#722696","#141463","#003399","#1D40ED","#0079D3","#009EFF","#76C8FF","#ACE0FD","#11B7BC","#21F9F3","#C3FCFC","#54311E","#8E572A","#E4B69D","#FFCDA4","#FFEDD7"]}},{key:"createSVGeditor",value:function(e){var t=Object(s.B)("div","maincanvas",e);t.setAttribute("id","maincanvas"),t.style.background="#F5F2F7",t.style.top="0px",t.style.left="0px",window.onmousemove=void 0,window.onmouseup=void 0,(Ct=yt.create(t)).setAttribute("class","active3d"),window.xform=pt.getTranslateTransform(),window.selxform=pt.getTranslateTransform(),yt.createGroup(Ct,"layer1").setAttribute("style","pointer-events:visiblePainted"),yt.createGroup(Ct,"draglayer"),yt.createGroup(Ct,"paintgrid"),Object(s.q)("paintgrid").setAttribute("opacity",.5)}},{key:"clearWorkspace",value:function(){var e=function(e){for(;e.childElementCount>0;)e.removeChild(e.childNodes[0])};e(Object(s.q)("layer1")),e(Object(s.q)("paintgrid")),e(Object(s.q)("draglayer")),$e.quitEditMode()}},{key:"drawGrid",value:function(t,r){var n;Dt||(n={d:e.getGridPath(t,r,12),id:Object(s.l)("gridpath"),opacity:1,stroke:"#dcddde",fill:"none","stroke-width":.5},yt.addChild(Object(s.q)("paintgrid"),"path",n).setAttribute("style","pointer-events:none;")),n={d:e.getGridPath(t,r,Dt?24:48),id:Object(s.l)("gridpath"),opacity:1,stroke:"#c1c2c3",fill:"none","stroke-width":.5},yt.addChild(Object(s.q)("paintgrid"),"path",n).setAttribute("style","pointer-events:none;")}},{key:"getGridPath",value:function(e,t,r){for(var n="",i=r,a=0;a<e/r;a++)n+="M"+i+",0L"+i+","+t,i+=r;var o=r;for(a=0;a<t/r;a++)n+="M0,"+o+"L"+e+","+o,o+=r;return n}},{key:"initBkg",value:function(t,r){_t=!0,Nt=t,Et=r,e.setUpCanvasArea();var n=Ct.parentNode.parentNode.offsetHeight/(Et+10),i=Ct.parentNode.parentNode.offsetWidth/(Nt+10);if(e.setZoomTo(Math.min(i,n)),document.forms.spriteform.style.visibility="hidden",Rt)e.loadBackground(Rt);else{var a={id:"staticbkg",opacity:1,fixed:"yes",fill:Kn.stagecolor};a.d=dt.arrayToString([["M",0,0],["L",480,0],["L",480,360],["L",0,360],["L",0,0]]),yt.addChild(Object(s.q)("layer1"),"path",a),De.drawOffscreen(),Ve.record(!0)}}},{key:"loadBackground",value:function(t){t.indexOf("samples/")>=0?e.loadChar(t):me.keys[t]?e.getBkg(me.path+t):zr.getmedia(t,(function(t){var r=atob(t);Yr.getImagesInSVG(r,(function(){e.loadBkg(r)}))}))}},{key:"getBkg",value:function(t){var r=new XMLHttpRequest;r.onreadystatechange=function(){4==r.readyState&&e.createBkgFromXML(r.responseText)},r.open("GET",t,!0),r.send(null)}},{key:"loadBkg",value:function(t){e.createBkgFromXML(t)}},{key:"createBkgFromXML",value:function(t){_t=t.indexOf("Scratch Jr")>-1,t=t.replace(/>\s*</g,"><");for(var r=(new DOMParser).parseFromString(t,"text/xml"),n=document.importNode(r.documentElement,!0),i=e.skipUnwantedElements(n,[]),a=0;a<i.length;a++)Object(s.q)("layer1").appendChild(i[a]),"fixed"==i[a].getAttribute("id")&&i[a].setAttribute("fixed","yes"),i[a].setAttribute("file","yes");e.doAbsolute(Object(s.q)("layer1")),_t||e.reassingIds(Object(s.q)("layer1"));var o=Ct.parentNode.parentNode.offsetHeight/(Et+10),l=Ct.parentNode.parentNode.offsetWidth/(Nt+10);e.setZoomTo(Math.min(l,o)),Ve.record(!0),_t||e.selectButton("paintbucket")}},{key:"initSprite",value:function(t,r){if(_t=!0,document.forms.spriteform.style.visibility="visible",document.forms.spriteform.name.value=Object(s.q)(xt)?Object(s.q)(xt).owner.name:xt,t&&(Nt=t),r&&(Et=r),Rt)e.loadCharacter(Rt);else{e.setUpCanvasArea(),Object(s.I)(De.maskCanvas,Math.round(Number(Ct.getAttribute("width"))*qt),Math.round(Number(Ct.getAttribute("height"))*qt));var n=Ct.parentNode.parentNode.offsetHeight/(Et+10),i=Ct.parentNode.parentNode.offsetWidth/(Nt+10);e.setZoomTo(Math.min(i,n)),Ve.record(!0)}}},{key:"loadCharacter",value:function(t){t.indexOf("samples/")>=0?e.loadChar(t):me.keys[t]?e.loadChar(me.path+t):zr.getmedia(t,(function(t){var r=atob(t);Yr.getImagesInSVG(r,(function(){e.loadSprite(r)}))}))}},{key:"loadSprite",value:function(t){e.createCharFromXML(t,xt)}},{key:"loadChar",value:function(t){var r=new XMLHttpRequest;r.onreadystatechange=function(){4==r.readyState&&e.createCharFromXML(r.responseText,xt)},r.open("GET",t,!0),r.send(null)}},{key:"adjustShapePosition",value:function(e,t){window.xform.setTranslate(e,t),pt.translateTo(Object(s.q)("layer1"),window.xform)}},{key:"savePageImage",value:function(t){Object(s.q)("layer1").childElementCount>0?(Lt=!0,t&&(v.open(Ot,Object(s.q)("donecheck"),o.localize("ALERT_SAVING"),"#28A5DA"),v.balloon.style.zIndex=12e3),jt=yt.saveBackground(Object(s.q)("layer1"),Nt,Et),Yr.setMedia(jt,"svg",(function(r){e.changeBackground(r,t)}))):e.close()}},{key:"changeBackground",value:function(t,r){Ft=t;var n={cond:"md5 = ? AND version = ?",items:["*"]};n.values=[Ft,Kn.version],Yr.query("userbkgs",n,(function(t){e.checkDuplicateBkg(t,r)}))}},{key:"checkDuplicateBkg",value:function(t,r){JSON.parse(t).length>0?r&&r("duplicate"):e.addToBkgLib(r)}},{key:"addToBkgLib",value:function(e){var t=Yr.getThumbnail(jt,480,360,120,90).split(",")[1];zr.setmedia(t,"png",(function(t){var r={};r.values=[Ft,t,Kn.version,"480","360","svg"],r.stmt="insert into userbkgs ("+["md5","altmd5","version","width","height","ext"].toString()+") values (?,?,?,?,?,?)",zr.stmt(r,e)}))}},{key:"changePage",value:function(){Kn.stage.currentPage.setBackground(Ft,Kn.stage.currentPage.updateBkg),e.close()}},{key:"saveSprite",value:function(t){var r=document.forms.spriteform.name.value;if(Object(s.q)("layer1").childElementCount>0&&Ve.index>0)Lt=!0,t&&(v.open(Ot,Object(s.q)("donecheck"),"Saving...","#28A5DA"),v.balloon.style.zIndex=12e3),jt=yt.saveShape(Object(s.q)("layer1"),Nt,Et),Yr.setMedia(jt,"svg",(function(r){e.addOrModifySprite(r,t)}));else{var n=e.getLoadType(wt,r);r!=xt&&"modify"==n?Kn.stage.currentPage.modifySpriteName(r,wt):Rt&&"add"==n&&Kn.stage.currentPage.addSprite(St,Rt,r),e.close()}}},{key:"addOrModifySprite",value:function(t,r){Ft=t;var n={cond:"md5 = ? AND version = ?",items:["*"]};n.values=[Ft,Kn.version],Yr.query("usershapes",n,(function(t){e.checkDuplicate(t,r)}))}},{key:"checkDuplicate",value:function(t,r){JSON.parse(t).length>0?r&&r("duplicate"):e.addToLib(r)}},{key:"addToLib",value:function(e){var t="0.5",r=document.forms.spriteform.name.value;r=unescape(r).replace(/[0-9]/g,"").replace(/\s*/g,"");var n=yt.getBox(Object(s.q)("layer1")).rounded(),i=(n=n.expandBy(20)).width.toString(),a=n.height.toString(),o=Yr.getThumbnail(jt,i,a,120,90).split(",")[1];zr.setmedia(o,"png",(function(n){var o={};o.values=[t,Ft,n,Kn.version,i,a,"svg",r],o.stmt="insert into usershapes ("+["scale","md5","altmd5","version","width","height","ext","name"].toString()+") values (?,?,?,?,?,?,?,?)",zr.stmt(o,e)}))}},{key:"changePageSprite",value:function(){e.close();var t=document.forms.spriteform.name.value;switch(e.getLoadType(wt,t)){case"modify":Kn.stage.currentPage.modifySprite(Ft,t,wt);break;case"add":Kn.stage.currentPage.addSprite(St,Ft,t);break;default:Kn.stage.currentPage.update()}}},{key:"getLoadType",value:function(e,t){return t?e&&t?"modify":"add":"none"}},{key:"skipUnwantedElements",value:function(t,r){for(var n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];"metadata"!=i.nodeName&&"defs"!=i.nodeName&&"sodipodi:namedview"!=i.nodeName&&"#comment"!=i.nodeName&&("g"==i.nodeName&&"layer1"==i.id?(e.skipUnwantedElements(i,r),i.removeAttribute("id")&&i.removeAttribute("id")):r.push(i))}return r}},{key:"reassingIds",value:function(t){for(var r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];"yes"==n.parentNode.getAttribute("fixed")&&n.setAttribute("fixed","yes"),n.getAttribute("id")||n.setAttribute("id",Object(s.l)(n.nodeName)),"g"==n.nodeName&&e.reassingIds(n)}}},{key:"createCharFromXML",value:function(t){_t=t.indexOf("Scratch Jr")>-1;var r=Nt<432?Math.floor((432-Nt)/2):0,n=Et<384?Math.floor((384-Et)/2):0;Nt<432&&(Nt=432),Et<384&&(Et=384),e.setUpCanvasArea(),t=t.replace(/>\s*</g,"><");for(var i=(new DOMParser).parseFromString(t,"text/xml"),a=document.importNode(i.documentElement,!0),o=e.skipUnwantedElements(a,[]),l=0;l<o.length;l++)Object(s.q)("layer1").appendChild(o[l]);e.doAbsolute(Object(s.q)("layer1")),e.adjustShapePosition(r,n),_t||e.reassingIds(Object(s.q)("layer1")),e.scaleToFit(),Ht=qt<1?qt/2:1;var c=5241810/(Nt*Et),u=Math.floor(Math.sqrt(c));u<zt&&(zt=u),Ve.record(!0),_t||e.selectButton("paintbucket")}},{key:"doAbsolute",value:function(t){for(var r=0;r<t.childElementCount;r++){var n=t.childNodes[r];"path"==n.tagName&&dt.setAbsolutePath(n),"g"==n.tagName&&e.doAbsolute(t.childNodes[r])}}},{key:"getComponents",value:function(t,r){for(var n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];"metadata"!=i.nodeName&&"defs"!=i.nodeName&&"sodipodi:namedview"!=i.nodeName&&"#comment"!=i.nodeName&&("g"==i.nodeName?(e.getComponents(i,r),i.getAttribute("id")&&i.removeAttribute("id")):r.push(i))}return r}},{key:"xmlns",get:function(){return"http://www.w3.org/2000/svg"}},{key:"xmlnslink",get:function(){return"http://www.w3.org/1999/xlink"}},{key:"fillcolor",get:function(){return Tt}},{key:"workspaceWidth",get:function(){return Nt}},{key:"workspaceHeight",get:function(){return Et}},{key:"mode",get:function(){return Bt},set:function(e){Bt=e}},{key:"strokewidth",get:function(){return Mt}},{key:"currentZoom",get:function(){return qt},set:function(e){qt=e}},{key:"root",get:function(){return Ct}},{key:"saving",get:function(){return Lt}},{key:"frame",get:function(){return Ot}},{key:"splash",get:function(){return At}},{key:"splashshade",get:function(){return Pt}},{key:"initialPoint",get:function(){return Ut},set:function(e){Ut=e}},{key:"deltaPoint",get:function(){return Wt},set:function(e){Wt=e}}],(r=null)&&kt(t.prototype,r),n&&kt(t,n),e}();function Gt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Kt=null,Zt=!1,Xt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"layout",value:function(){e.topSection(),e.middleSection(),e.BottomSection(),e.fullscreenControls(),e.createFormForText(s.h),Kn.setupKeypad(),Kn.setupEditableField(),e.aspectRatioAdjustment()}},{key:"aspectRatioAdjustment",value:function(){Object(s.k)()/Object(s.j)()>1.45&&(Object(s.q)("library").style.left="3vw",Object(s.q)("pages").style.right="1vw")}},{key:"topSection",value:function(){var t=Object(s.B)("div","topsection",s.h);t.setAttribute("id","topsection"),e.leftPanel(t),e.stageArea(t),e.rightPanel(t)}},{key:"leftPanel",value:function(t){var r=Object(s.B)("div","leftpanel",t),n=Object(s.B)("div","flipme",r);n.setAttribute("id","flip"),n.ontouchstart=function(e){Kn.saveAndFlip(e)},e.layoutLibrary(r)}},{key:"middleSection",value:function(){var e=Object(s.B)("div","blockspalette",s.h);e.setAttribute("id","blockspalette"),Sr.setup(e),dr.setup(e)}},{key:"BottomSection",value:function(){re.createScripts(s.h)}},{key:"parentalGate",value:function(e,t){x.sndFX("tap.wav");var r=Object(s.B)("div","parentalgate",Object(s.q)("frame"));Object(s.B)("div","paintdone",r).ontouchstart=function(){d(!1)};var n=Object(s.B)("div","parentalgateproblem",r),i=Object(s.B)("div","parentalgatechoice",r),a=Object(s.B)("div","parentalgatechoice",r),l=Object(s.B)("div","parentalgatechoice",r),c=[["30 + 7","37","9","28",0],["22 + 3","18","25","3",1],["91 + 1","32","74","92",2],["30 + 4","34","59","12",0],["48 + 1","9","49","20",1],["32 + 6","23","99","38",2],["53 + 4","57","12","90",0],["26 + 3","17","29","8",1],["71 + 1","58","14","72",2],["11 + 8","19","23","67",0]],u=c[Math.floor(Math.random()*c.length)];function d(n){x.sndFX("exittap.wav"),Object(s.q)("frame").removeChild(r),n&&t(e)}n.textContent=u[0],i.textContent=u[1],a.textContent=u[2],l.textContent=u[3],i.ontouchstart=function(){d(0==u[4])},a.ontouchstart=function(){d(1==u[4])},l.ontouchstart=function(){d(2==u[4])},Object(s.B)("div","parentalgateexplain",r).textContent=o.localize("PARENTAL_GATE_EXPLANATION")}},{key:"addEditableName",value:function(e){var t=Object(s.B)("form","projectname",e);t.name="projectname",t.id="title",t.onsubmit=function(e){n(e)};var r=Object(s.B)("input","pnamefield",t);function n(e){e.preventDefault(),e.target.blur()}return Kt=r,r.name="myproject",r.maxLength=30,r.onkeypress=void 0,r.autocomplete="off",r.autocorrect=!1,r.onblur=void 0,r.onfocus=function(e){e.preventDefault(),r.oldvalue=r.value,s.t&&(AndroidInterface.scratchjr_setsoftkeyboardscrolllocation(r.getBoundingClientRect().top*devicePixelRatio,r.getBoundingClientRect().bottom*devicePixelRatio),AndroidInterface.scratchjr_forceShowKeyboard())},r.onkeypress=function(e){var t;13==((t=e).keyCode||t.which)&&n(t)},r}},{key:"showInfoBox",value:function(t){Zt=!0,t.preventDefault(),t.stopPropagation(),Vt.saving||Kn.onHold||(setTimeout((function(){null.ontouchend=e.hideInfoBox,Kt.onblur=function(){s.t&&AndroidInterface.scratchjr_forceHideKeyboard()}}),500),Kt.onblur=function(){Kn.isEditable()&&document.forms.projectname.myproject.focus()},null.ontouchend=null,Kn.onBackButtonCallback.push((function(){var t=document.createEvent("TouchEvent");t.initTouchEvent(),t.preventDefault(),t.stopPropagation(),e.hideInfoBox(t)})),x.sndFX("entertap.wav"),Kn.stopStrips(),bn.metadata.ctime||(bn.metadata.mtime=(new Date).getTime(),bn.metadata.ctime=(new Date).getTime().toString()),Kn.isEditable()?document.forms.projectname.myproject.value=bn.metadata.name:Object(s.q)("pname").textContent=bn.metadata.name,Object(s.q)("infobox").className="infobox fade in",Kn.isEditable()&&setTimeout((function(){}),500))}},{key:"formatTime",value:function(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}},{key:"hideInfoBox",value:function(t){t.preventDefault(),t.stopPropagation(),Kn.onBackButtonCallback.pop(),null.ontouchend=null,setTimeout((function(){null.ontouchend=e.showInfoBox}),500),Kn.isEditable()?document.forms.projectname.myproject.blur():(x.sndFX("exittap.wav"),Object(s.q)("infobox").className="infobox fade"),Zt=!1}},{key:"layoutLibrary",value:function(t){var r=Object(s.B)("div","thumbpanel",t);r.setAttribute("id","library");var n=Object(s.B)("div","spritethumbs",r),i=Object(s.B)("div","spritecc",n);i.setAttribute("id","spritecc"),i.ontouchstart=e.spriteThumbsActions;var a=Object(s.B)("div","scrollbar",r);a.setAttribute("id","scrollbar"),Object(s.B)("div","sbthumb",a).setAttribute("id","sbthumb"),Kn.isEditable()&&(Object(s.B)("div","addsprite",r).ontouchstart=e.addSprite)}},{key:"mascotData",value:function(e){var t={flip:!1,angle:0,shown:!0,type:"sprite",scale:.5,defaultScale:.5,speed:2,dirx:1,diry:1,sounds:["pop.mp3"],homex:240,homey:180,xcoor:240,ycoor:180,homeshown:!0,homeflip:!1,homescale:.5,scripts:[]};t.page=e,t.md5=Kn.defaultSprite;var r=me.keys[t.md5].name;return t.id=Object(s.l)(r),t.name=r,t}},{key:"needsScroll",value:function(){var t=Object(s.q)("spritecc"),r=t.parentNode;t.scrollHeight/r.offsetHeight==1||0==Object(s.q)("spritecc").childElementCount?Object(s.q)("scrollbar").setAttribute("class","scrollbar off"):(Object(s.q)("scrollbar").setAttribute("class","scrollbar on"),e.updateSpriteScroll())}},{key:"updateSpriteScroll",value:function(){var e=Object(s.q)("spritecc"),t=e.offsetTop,r=e.parentNode,n=-t/(e.scrollHeight/r.offsetHeight),i=r.offsetHeight/e.scrollHeight*r.offsetHeight,a=Object(s.q)("sbthumb");a.style.height=i+"px",a.style.top=n+"px"}},{key:"scrollContents",value:function(e){var t=Object(s.q)("spritecc"),r=t.offsetTop-e;r>0&&(r=0);var n={duration:.5,transition:"ease-out",style:{top:r+"px"}};Object(s.a)(t,n)}},{key:"spriteInView",value:function(t){var r=Object(s.q)("spritecc"),n=t.thumbnail;if(n){var i=Object(s.q)("spritecc").parentNode.offsetHeight,a=-Object(s.q)("spritecc").offsetTop,o=-Object(s.q)("spritecc").offsetTop;n.offsetTop+n.offsetHeight+a>i&&(o=i-(n.offsetTop+n.offsetHeight)),n.offsetTop<=a&&(o=n.offsetTop+a),o>0&&(o=0),r.style.top=o+"px",e.needsScroll()}}},{key:"resetSpriteLibrary",value:function(){Kn.getSprite()&&e.spriteInView(Kn.getSprite())}},{key:"spriteThumbsActions",value:function(t){if(!(s.u&&t.touches&&t.touches.length>1||Kn.onHold)){var r,n=K.getTargetPoint(t);if(r=window.event?window.event.srcElement:t.target,t.preventDefault(),t.stopPropagation(),Kn.blur(),r.focus(),"brush"!=r.className){var i=or.getType(r,"spritethumb");if(i){var a=Object(s.x)(r,n.x);i&&a<70&&Kn.isEditable()?or.startDragThumb(t,i):e.startSpriteScroll(t,i)}else Kn.shaking&&Kn.clearSelection()}else e.putInPaintEditor(t)}}},{key:"startSpriteScroll",value:function(t,r){Kn.shaking&&Kn.clearSelection(),r&&("scrollbar off"==Object(s.q)("scrollbar").className?K.startDrag(t,r,e.ignoreEvent,e.ignoreEvent,e.ignoreEvent,e.spriteClicked,Kn.isEditable()?or.startCharShaking:void 0):K.startDrag(t,r,e.prepareToScroll,e.stopScroll,e.spriteScolling,e.spriteClicked,Kn.isEditable()?or.startCharShaking:void 0))}},{key:"ignoreEvent",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"prepareToScroll",value:function(t){t.preventDefault(),t.stopPropagation(),e.spriteScolling(t,K.dragthumbnail)}},{key:"stopScroll",value:function(t){t.preventDefault(),t.stopPropagation(),e.spriteScolling(t,K.dragthumbnail)}},{key:"spriteScolling",value:function(t){var r=K.getTargetPoint(t),n=K.dragmousey-r.y;K.dragmousey=r.y;var i=Object(s.q)("spritecc"),a=i.offsetTop;a-=n;var o=i.parentNode;a>0&&(a=0),a+i.offsetHeight<o.offsetHeight&&(a=o.offsetHeight-i.offsetHeight),i.style.top=a+"px",e.updateSpriteScroll()}},{key:"spriteClicked",value:function(t,r){var n;t.preventDefault(),t.stopPropagation(),n=window.event?window.event.srcElement:t.target,Kn.isEditable()&&Kn.getSprite()&&("sname"==n.className&&r.owner==Kn.getSprite().id||"brush"==n.className)?e.putInPaintEditor(t):(r.className.indexOf("shakeme")<0&&r.setAttribute("class","spritethumb on"),or.clickOnSprite(t,r))}},{key:"putInPaintEditor",value:function(e){Kn.unfocus(e);var t=Kn.getSprite();t&&(Kn.stopStrips(),Vt.open(!1,t.md5,t.id,t.name,t.defaultScale,Math.round(t.w),Math.round(t.h)))}},{key:"stageArea",value:function(t){var r=Object(s.B)("div","centerpanel",t),n=Object(s.B)("div","stageframe",r);n.setAttribute("id","stageframe"),Kn.stage=new fe(n),Y.init(n),Kn.isEditable()&&(e.creatTopBarClicky(n,"addtext","addText",e.addText),e.creatTopBarClicky(n,"setbkg","changeBkg",e.addBackground)),e.creatTopBarClicky(n,"grid","gridToggle off",e.switchGrid),e.creatTopBarClicky(n,"go","go on",e.toggleRun),e.creatTopBarClicky(n,"resetall","resetall",e.resetAllSprites),e.creatTopBarClicky(n,"full","fullscreen",Kn.fullScreen),e.toggleGrid(!0)}},{key:"resetAllSprites",value:function(e){e.preventDefault(),e.stopPropagation(),Kn.onHold||(x.sndFX("tap.wav"),Kn.runtime.inactive()||Kn.stopStripsFromTop(e),Kn.resetSprites())}},{key:"toggleRun",value:function(e){Kn.runtime.inactive()?Kn.runStrips(e):Kn.stopStripsFromTop(e)}},{key:"switchGrid",value:function(){x.sndFX("tap.wav"),e.toggleGrid(!Y.hidden)}},{key:"toggleGrid",value:function(e){Y.hide(e),Object(s.q)("grid").className=Y.hidden?"gridToggle off":"gridToggle on"}},{key:"creatTopBarClicky",value:function(e,t,r,n){var i=Object(s.B)("div",r,e);i.ontouchstart=n,i.setAttribute("id",t)}},{key:"fullscreenControls",value:function(){e.nextpage=Object(s.B)("div","nextpage off",s.h),e.prevpage=Object(s.B)("div","nextpage off",s.h),s.u?e.nextpage.ontouchstart=e.nextPage:e.nextpage.onmousedown=e.nextPage,s.u?e.prevpage.ontouchstart=e.prevPage:e.prevpage.onmousedown=e.prevPage}},{key:"updatePageControls",value:function(){var t=Kn.stage.pages.indexOf(Kn.stage.currentPage);0==t?e.prevpage.setAttribute("class","prevpage off"):e.prevpage.setAttribute("class","prevpage on"),t==Kn.stage.pages.length-1?e.nextpage.setAttribute("class","nextpage off"):e.nextpage.setAttribute("class","nextpage on")}},{key:"nextPage",value:function(e){e.preventDefault(),e.stopPropagation();var t=Kn.stage.pages.indexOf(Kn.stage.currentPage);++t>=Kn.stage.pages.length||Kn.stage.setPage(Kn.stage.pages[t],!1)}},{key:"prevPage",value:function(e){e.preventDefault(),e.stopPropagation();var t=Kn.stage.pages.indexOf(Kn.stage.currentPage);t<1||Kn.stage.setPage(Kn.stage.pages[t-1],!1)}},{key:"enterFullScreen",value:function(){var t=Math.min(Object(s.k)(),s.h.offsetWidth),r=Math.max(Object(s.j)(),s.h.offsetHeight);s.h.appendChild(Object(s.q)("stage"));for(var n=["go","full"],i=0;i<n.length;i++)Object(s.q)(n[i]).className=Object(s.q)(n[i]).className+" presentationmode",s.h.appendChild(Object(s.q)(n[i]));var a=Math.min((t-s.i*s.H)/Object(s.q)("stage").owner.width,r/Object(s.q)("stage").owner.height),o=Math.floor((t-Object(s.q)("stage").owner.width*a)/2),l=Math.floor((r-Object(s.q)("stage").owner.height*a)/2);Kn.stage.setStageScaleAndPosition(a,o/a,l/a),Object(s.q)("stage").owner.currentZoom=Math.floor(100*a)/100,Object(s.q)("stage").style.webkitTextSizeAdjust=Math.floor(100*Object(s.q)("stage").owner.currentZoom)+"%",document.body.parentNode.style.background="black",Object(s.q)("stage").setAttribute("class","stage fullscreen"),e.nextpage.setAttribute("class","nextpage on")}},{key:"quitFullScreen",value:function(){var t=Object(s.q)("stageframe");t.appendChild(Object(s.q)("stage")),Kn.stage.setStageScaleAndPosition(s.H,46,74),Object(s.q)("go").className="go off nopresent",t.appendChild(Object(s.q)("go")),Object(s.q)("full").className="fullscreen",t.appendChild(Object(s.q)("full")),Object(s.q)("stage").owner.currentZoom=1,Object(s.q)("stage").style.webkitTextSizeAdjust="100%",document.body.parentNode.style.background="none",Object(s.q)("stage").setAttribute("class","stage normal"),e.nextpage.setAttribute("class","nextpage off"),e.prevpage.setAttribute("class","nextpage off"),Kn.stage.setViewPage(Kn.stage.currentPage),or.updateSprites(),or.updatePages()}},{key:"rightPanel",value:function(e){var t=Object(s.B)("div","rightpanel",e),r=Object(s.B)("div","pages",t);r.setAttribute("id","pages"),Object(s.B)("div","pagescc",r).setAttribute("id","pagecc")}},{key:"layoutToolbar",value:function(t){var r=Object(s.A)(t,220,0,132,56,{position:"absolute"});r.setAttribute("id","toolbar"),Object(s.B)("div","addText",r).ontouchstart=e.addText,Object(s.B)("div","changeBkg",r).ontouchstart=e.addBackground}},{key:"addSprite",value:function(e){Kn.onHold||(e.preventDefault(),e.stopPropagation(),K.getTargetPoint(e).x>Object(s.o)(e.target)+167||(x.sndFX("tap.wav"),Kn.stopStrips(),Kn.unfocus(e),K.dragthumbnail&&K.mouseUp(e)))}},{key:"addBackground",value:function(e){Kn.onHold||(e.preventDefault(),e.stopPropagation(),Kn.stopStrips(),Kn.unfocus(e),K.dragthumbnail&&K.mouseUp(e))}},{key:"addText",value:function(e){Kn.onHold||(e.preventDefault(),e.stopPropagation(),s.t&&"visible"===Object(s.q)("textbox").style.visibility||(Kn.unfocus(e),Kn.stage.currentPage.createText()))}},{key:"createFormForText",value:function(t){var r=Object(s.B)("div","pagetext off",t);r.setAttribute("id","textbox"),s.t&&(r.onmousedown=function(e){e.preventDefault()});var n=Object(s.B)("form","pageform",r);n.name="activetextbox",n.id="myform",n.textsprite=null;var i=Object(s.E)(n,"text");i.name="typing",i.setAttribute("class","edittext"),i.maxLength=50,i.onkeypress=void 0,i.autocomplete="off",i.autocorrect=!1,i.onblur=void 0,n.onsubmit=void 0;var a=Object(s.B)("div","pagetextactions",r),o=Object(s.B)("div","fontsizeText off",a);o.setAttribute("id","fontsizebutton"),o.ontouchstart=e.openFontSizeMenu;var l=Object(s.B)("div","changecolorText off",a);l.setAttribute("id","fontcolorbutton"),l.ontouchstart=e.topLevelColor,e.createColorMenu(r),e.createTextSizeMenu(r)}},{key:"createColorMenu",value:function(t){var r=on.fontcolors,n=Object(s.B)("div","textuicolormenu off",t);n.setAttribute("id","textcolormenu");for(var i=0;i<r.length;i++){var a=Object(s.B)("div","textcolorbucket",n),o=Object(s.B)("div","swatchframe",a);Object(s.B)("div","swatchcolor",o).style.background=r[i],o=Object(s.B)("div","splasharea off",a),Vt.setSplashColor(o,Vt.splash,r[i]),Vt.addImageUrl(o,Vt.splashshade),a.ontouchstart=e.setTextColor}e.setMenuTextColor(Object(s.q)("textcolormenu").childNodes[9])}},{key:"createTextSizeMenu",value:function(t){var r=on.fontsizes,n=Object(s.B)("div","textuifont off",t);n.setAttribute("id","textfontsizes");for(var i=0;i<r.length;i++){var a=Object(s.B)("div","textuisize t"+(i+1),n);a.fs=r[i],Object(s.B)("span",void 0,a).textContent="A",a.ontouchstart=e.setTextSize}e.setMenuTextSize(Object(s.q)("textfontsizes").childNodes[5])}},{key:"setMenuTextColor",value:function(e){for(var t=e.childNodes[0].childNodes[0].style.backgroundColor,r=0;r<Object(s.q)("textcolormenu").childElementCount;r++)t==Object(s.q)("textcolormenu").childNodes[r].childNodes[0].childNodes[0].style.backgroundColor?Object(s.q)("textcolormenu").childNodes[r].childNodes[1].setAttribute("class","splasharea on"):Object(s.q)("textcolormenu").childNodes[r].childNodes[1].setAttribute("class","splasharea off")}},{key:"setMenuTextSize",value:function(e){for(var t=e.fs,r=0;r<Object(s.q)("textfontsizes").childElementCount;r++){var n=Object(s.q)("textfontsizes").childNodes[r],i=n.fs,a=n.className.split(" ")[1];Object(s.q)("textfontsizes").childNodes[r].className=t==i?"textuisize "+a+" on":"textuisize "+a+" off"}}},{key:"topLevelColor",value:function(t){if(t.preventDefault(),t.stopPropagation(),"changecolorText on"==Object(s.q)("fontcolorbutton").className)Object(s.q)("fontcolorbutton").className="changecolorText off",Object(s.q)("textcolormenu").className="textuicolormenu off";else{Object(s.q)("fontsizebutton").className="fontsizeText off",Object(s.q)("textfontsizes").className="textuifont off";var r=document.forms.activetextbox.textsprite,n=on.fontcolors.indexOf(r);n>-1&&e.setMenuTextColor(Object(s.q)("textcolormenu").childNodes[n]),Object(s.q)("textcolormenu").className="textuicolormenu on",Object(s.q)("fontcolorbutton").className="changecolorText on"}}},{key:"setTextColor",value:function(t){if(!(t.touches&&t.touches.length>1)){t.preventDefault(),t.stopPropagation();for(var r="textcolorbucket"!=(n=window.event?window.event.srcElement:t.target).className;r;){var n=n.parentNode;r=n&&"textcolorbucket"!=n.className}if(n){x.sndFX("splash.wav"),e.setMenuTextColor(n);var i=document.forms.activetextbox.textsprite,a=n.childNodes[0].childNodes[0].style.background;i.setColor(a),dr.record({action:"edittext",where:i.div.parentNode.owner.id,who:i.id}),Kn.storyStart("UI.setTextColor"),document.forms.activetextbox.typing.style.color=a}}}},{key:"openFontSizeMenu",value:function(t){if(t.preventDefault(),t.stopPropagation(),"fontsizeText on"==Object(s.q)("fontsizebutton").className)Object(s.q)("fontsizebutton").className="fontsizeText off",Object(s.q)("textfontsizes").className="textuifont off";else{Object(s.q)("fontcolorbutton").className="changecolorText off",Object(s.q)("textcolormenu").className="textuicolormenu off";var r=document.forms.activetextbox.textsprite,n=on.fontsizes.indexOf(r.fontsize);n>-1&&e.setMenuTextSize(Object(s.q)("textfontsizes").childNodes[n]),Object(s.q)("textfontsizes").className="textuifont on",Object(s.q)("fontsizebutton").className="fontsizeText on"}}},{key:"setTextSize",value:function(t){var r;if(t.preventDefault(),t.stopPropagation(),"SPAN"==(r=window.event?window.event.srcElement:t.target).nodeName&&(r=r.parentNode),r&&"textuisize"==r.className.split(" ")[0]){e.setMenuTextSize(r);var n=document.forms.activetextbox.textsprite;n.setFontSize(r.fs),dr.record({action:"edittext",where:n.div.parentNode.owner.id,who:n.id}),Kn.storyStart("UI.setTextSize"),document.forms.activetextbox.typing.style.fontSize=r.fs*s.H+"px",Object(s.K)(document.forms.activetextbox.style,{height:(r.fs+10)*s.H+"px"})}}},{key:"clear",value:function(){for(var e=Object(s.q)("spritecc");e.childElementCount>0;)e.removeChild(e.childNodes[0]);for(var t=Object(s.q)("pagecc");t.childElementCount>0;)t.removeChild(t.childNodes[0])}},{key:"infoBoxOpen",get:function(){return Zt}}],(r=null)&&Gt(t.prototype,r),n&&Gt(t,n),e}();function Yt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Jt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.flowCaret=null,this.spr=t,this.dragList=[];var r=Object(s.q)("scriptscontainer");this.sc=Object(s.B)("div","look",r),Object(s.I)(this.sc,r.offsetWidth,r.offsetHeight),this.sc.setAttribute("id",t.id+"_scripts"),this.sc.setAttribute("class","look"),this.sc.owner=this,this.sc.top=0,this.sc.left=0}var t,r,n;return t=e,(r=[{key:"activate",value:function(){Object(s.K)(this.sc.style,{visibility:"visible"})}},{key:"deactivate",value:function(){Object(s.K)(this.sc.style,{visibility:"hidden"})}},{key:"scriptsMouseDown",value:function(e){if(!(s.u&&e.touches&&e.touches.length>1||Kn.onHold||"H3"==(o=window.event?window.event.srcElement:e.target).nodeName&&o.owner==Kn.activeFocus)){if(Kn.clearSelection(),"H3"==o.nodeName)return Kn.blur(),void Kn.editArg(e,o);if(o.firstChild&&"H3"==o.firstChild.nodeName)return Kn.blur(),void Kn.editArg(e,o.firstChild);Kn.unfocus(e);for(var t=Kn.getActiveScript(),r=K.getTargetPoint(e),n={x:Object(s.x)(t,r.x),y:Object(s.y)(t,r.y)},i=t.childElementCount-1;i>-1;i--){var a=t.childNodes[i];if(a.owner&&!a.owner.isCaret&&Object(s.r)(a,n)){var o=new WebKitCSSMatrix(window.getComputedStyle(a).webkitTransform);return void K.startDrag(e,a,re.prepareToDrag,re.dropBlock,re.draggingBlock,re.runBlock)}}re.dragBackground(e)}}},{key:"addBlockToScripts",value:function(e,t,r){null!=this.flowCaret&&this.flowCaret.div.parentNode==this.sc&&this.sc.removeChild(this.flowCaret.div),this.flowCaret=null,K.dragDiv.removeChild(e),this.sc.appendChild(e),e.owner.moveBlock(t,r);for(var n=1;n<this.dragList.length;n++){var i=this.dragList[n].div;i.parentNode.removeChild(i),this.sc.appendChild(i)}this.layout(e.owner),this.snapToPlace(this.dragList),e.owner.cShape&&this.sendToBack(e.owner),this.dragList=[]}},{key:"sendToBack",value:function(e){if(e.inside){for(var t=e.inside;null!=t;)t.div.parentNode.appendChild(t.div),t.cShape&&this.sendToBack(t),t=t.next;this.layout(e)}}},{key:"snapToPlace",value:function(e){e.length<2&&e[0].cShape?this.snapCshape(e):this.snapBlock(e)}},{key:"snapBlock",value:function(e){var t=e[0],r=t.findLast(),n=this.findClosest(this.available(0,t,e),t);this.isValid(t,n,0)?this.snapToDock(n,t,0,e):(n=this.findClosest(this.available(r.cShape?2:1,r,e),r),this.isValid(r,n,r.cShape?2:1)&&this.snapToDock(n,r,r.cShape?2:1,e))}},{key:"snapCshape",value:function(e){var t=e[0],r=t.findLast(),n=this.findClosest(this.available(0,t,e),t);this.isValid(t,n,0)?this.snapToDock(n,t,0,e):(t.isCaret?null==this.dragList[0].inside:null==t.inside)&&(n=this.findClosest(this.available(1,t,e),t),this.isValid(t,n,1))?this.snapToDock(n,t,1,e):(n=this.findClosest(this.available(2,r,e),r),this.isValid(t,n,2)&&this.snapToDock(n,r,2,e))}},{key:"isValid",value:function(e,t,r){if(null==t)return!1;var n=t[0],i=t[1];return!(t[2]>30||e.cShape&&1==r&&n.anEnd||e.anEnd&&null!=n.next||e.findFirst().aStart&&null!=n.prev||0==r&&e.findLast().anEnd&&("repeat"==n.blocktype&&1==i||this.insideCShape(n))||e.findLast().anEnd&&null!=n.next||e.findLast().anEnd&&n.findLast().anEnd)}},{key:"insideCShape",value:function(e){for(;null!=e;){var t=e.prev;if(null==t)return!1;var r=t.getMyDockNum(e);if(t.cShape&&1==r)return!0;e=t}return!1}},{key:"snapToDock",value:function(e,t,r,n){if(null!=e){t.blocktype.indexOf("caret")<0&&(Kn.storyStart("Scripts.snapToDock"),x.sndFX("snap.wav"));var i,a=e[0],o=e[1];if(t.cShape&&1==r){var s=this.getDockDxDy(a,o,t,r);i=[s[0],s[1]]}else i=this.getDockDxDy(a,o,t,r);t.isCaret&&(t.div.style.visibility="visible");for(var l=0;l<n.length;l++)n[l].moveBlock(n[l].div.left+i[0],n[l].div.top+i[1]);t.connectBlock(r,e[0],e[1])}}},{key:"available",value:function(e,t,r){for(var n=null,i=[],a=null,o=this.getBlocks(),s=0;s<o.length;s++)if(null!=(a=o[s])&&a!=t&&!a.isCaret&&!a.isReporter&&"hidden"!=a.div.style.visibility&&-1==r.indexOf(a))for(var l=a.resolveDocks(),c=0;c<l.length;c++)null!=(n=this.getDockDxDy(a,c,t,e))&&i.push([a,c,this.magnitude(n)]);return i}},{key:"magnitude",value:function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}},{key:"findClosest",value:function(e){for(var t=9999,r=null,n=0;n<e.length;n++){var i=e[n];i[2]<t&&(t=i[2],r=i)}return r}},{key:"getDockDxDy",value:function(e,t,r,n){var i=e.resolveDocks()[t],a=r.resolveDocks()[n];if(e==r)return null;if(null==i||null==a)return null;if(i[0]!=a[0])return null;if(i[1]==a[1])return null;var o=e.div.left+i[2]*e.scale,s=e.div.top+i[3]*e.scale;return[o-(r.div.left+a[2]*r.scale),s-(r.div.top+a[3]*r.scale)]}},{key:"layout",value:function(e){var t=e.findFirst();this.layoutStrip(t)}},{key:"layoutStrip",value:function(e){for(;null!=e;)e.cShape&&this.layoutCshape(e),this.layoutNextBlock(e),e=e.next}},{key:"layoutNextBlock",value:function(e){if(null!=e.next){var t=e.next,r=this.getDockDxDy(e,e.cShape?2:1,t,0);if(null==r)return;t.moveBlock(t.div.left+r[0],t.div.top+r[1])}}},{key:"layoutCshape",value:function(e){var t=0,r=0,n=e.hrubberband,i=e.inside;null!=i&&(this.adjustPos(i,0,e,1),this.layoutStrip(i),t+=this.adjustCinside(i),r+=this.adjustCheight(i)),n=e.vrubberband,e.vrubberband=r<0?0:r,e.hrubberband=t,e.redrawRepeat(),e.moveBlock(e.div.left,e.div.top+(n-e.vrubberband)*e.scale)}},{key:"adjustPos",value:function(e,t,r,n){var i=this.getDockDxDy(r,n,e,t);e.moveBlock(e.div.left+i[0],e.div.top+i[1])}},{key:"adjustCheight",value:function(e){var t=e,r=e.blockshape.height;for(e=e.next;null!=e;)e.blockshape.height>r&&(r=e.blockshape.height),e=e.next;return(r/=t.scale*window.devicePixelRatio)>66?r-66:0}},{key:"adjustCinside",value:function(e){for(var t=e,r=e;null!=e;)r=e,e=e.next;return r.blockshape.width/r.scale/window.devicePixelRatio+(r.div.left-t.div.left)/r.scale-(r.cShape,76)}},{key:"getBlocks",value:function(){for(var e=[],t=this.sc,r=0;r<t.childElementCount;r++){var n=t.childNodes[r].owner;n&&"block"==n.type&&(n.isCaret||e.push(n))}return e}},{key:"findGroup",value:function(e){return"block"!=e.type?[]:this.findingGroup([],e)}},{key:"findingGroup",value:function(e,t){for(;null!=t;)e.push(t),t.cShape&&this.findingGroup(e,t.inside),t=t.next;return e}},{key:"gettopblocks",value:function(){for(var e=this.getBlocks(),t=[],r=0;r<e.length;r++)null!=e[r].prev||e[r].isReporter||t.push(e[r]),e[r].isReporter&&(e[r].daddy=null)&&t.push(e[r]);return t}},{key:"getEncodableBlocks",value:function(){for(var e=[],t=this.sc,r=0;r<t.childElementCount;r++){var n=t.childNodes[r].owner;n&&"block"==n.type&&e.push(n)}for(var i=[],a=0;a<e.length;a++)null==e[a].prev&&i.push(e[a]);return i}},{key:"redisplay",value:function(){for(var e=this.gettopblocks(),t=0;t<e.length;t++)this.layout(e[t])}},{key:"getBlocksType",value:function(e){for(var t=[],r=this.getBlocks(),n=0;n<e.length;n++)for(var i=e[n],a=0;a<r.length;a++)i==r[a].blocktype&&t.push(r[a]);return t}},{key:"prepareCaret",value:function(e){var t=e.findLast(),r=this.getCaretType(t);null!=this.flowCaret&&this.sc.removeChild(this.flowCaret.div),this.flowCaret=null,null!=r&&(this.flowCaret=this.newCaret(r),this.flowCaret.isCaret=!0)}},{key:"newCaret",value:function(e){var t=this.sc,r=new pr(on.defs[e],!1,s.H);return Object(s.K)(r.div.style,{position:"absolute",left:"0px",top:"0px",visibility:"hidden",zIndex:10}),t.appendChild(r.div),r.moveBlock(0,0),r}},{key:"getCaretType",value:function(e){return this.dragList[0].aStart?"caretstart":e.anEnd?"caretend":this.dragList.length<2&&this.dragList[0].cShape?"caretrepeat":"caretcmd"}},{key:"removeCaret",value:function(){if(null!=this.flowCaret){var e,t=this.flowCaret.prev,r=this.flowCaret.next,n=this.flowCaret.inside;this.flowCaret.prev=null,this.flowCaret.next=null,this.flowCaret.inside=null,null!=r&&(e=r.getMyDockNum(this.flowCaret),r.setMyDock(e,null!=n?n.findLast():t),null==n&&null==t&&this.layout(r)),null!=n&&(e=n.getMyDockNum(this.flowCaret),n.setMyDock(e,t),null!=r&&(n.findLast().next=r),null==t&&this.layout(n)),null!=t&&(e=t.getMyDockNum(this.flowCaret),t.setMyDock(e,null!=n?n:r),this.layout(t)),this.flowCaret.cShape&&(this.flowCaret.vrubberband=0,this.flowCaret.hrubberband=0,this.flowCaret.redrawRepeat()),this.flowCaret.div.style.visibility="hidden"}}},{key:"insertCaret",value:function(e,t){if(null!=this.flowCaret){var r=Kn.getActiveScript(),n=Object(s.x)(r,e),i=Object(s.y)(r,t)+this.adjustCheight(this.dragList[0]);this.flowCaret.moveBlock(n,i),this.snapToPlace(new Array(this.flowCaret)),"visible"==this.flowCaret.div.style.visibility&&this.layout(this.flowCaret)}}},{key:"deleteBlocks",value:function(){Kn.storyStart("Scripts.prototype.deleteBlocks"),re.cleanCarets(),x.sndFX("cut.wav"),this.dragList.length>0&&Kn.runtime.stopThreadBlock(this.dragList[0].findFirst());for(var e=0;e<this.dragList.length;e++){var t=this.dragList[e];null!=t.blocktype&&t.div.parentNode.removeChild(t.div)}}},{key:"recreateStrip",value:function(e){for(var t=[],r=null,n=["repeat"],i=0;i<e.length;i++)if(on.defs[e[i][0]]){switch(e[i][0]){case"say":e[i][1]=unescape(e[i][1]);break;case"gotopage":var a=Kn.stage.pages.indexOf(this.spr.page);e[i][1]-1==a&&(e[i][1]=(a+1)%Kn.stage.pages.length+1);break;case"playusersnd":this.spr.sounds.length<=e[i][1]&&(e[i][0]="playsnd",e[i][1]=this.spr.sounds[0]);break;case"playsnd":this.spr.sounds.indexOf(e[i][1])<0&&(e[i][0]="playsnd",e[i][1]=this.spr.sounds[0])}var o=this.recreateBlock(e[i]);if(t.push(o),n.indexOf(o.blocktype)>-1){var s=this.recreateStrip(e[i][4]);s.length>0&&(o.inside=s[0],s[0].prev=o),o.redrawRepeat()}r&&(o.prev=r,r.next=o),r=o}return t.length>0&&this.layout(t[0]),t}},{key:"recreateBlock",value:function(e){var t=e[0],r="null"==e[1]?null:e[1],n=e[2],i=e[3],a=on.defs[t].concat();null!=r&&a.splice(4,1,r);var o=new pr(a,!1,s.H);return Object(s.K)(o.div.style,{position:"absolute",left:"0px",top:"0px"}),o.moveBlock(n*s.H,i*s.H),this.sc.appendChild(o.div),o.update(this.spr),o}}])&&Yt(t.prototype,r),n&&Yt(t,n),e}();function $t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Qt=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"sprite"==t.type?this.createSprite(t.page,t.md5,t.id,t,r):this.createText(t,r)}var t,r,n;return t=e,(r=[{key:"createSprite",value:function(e,t,r,n,i){Kn.storyStart("Sprite.prototype.createSprite"),this.div=document.createElement("div"),Object(s.K)(this.div.style,{position:"absolute",left:"0px",top:"0px"}),this.div.owner=this,this.div.id=r,this.id=r,this.md5=t,this.borderOn=!1,this.outline=document.createElement("canvas"),this.code=new Jt(this),Object(s.K)(this,n),o.isSampleLocalizedKey(this.name)&&Kn.isSampleOrStarter()&&(this.name=o.localize("SAMPLE_TEXT_"+this.name));for(var a=0;a<this.sounds.length;a++)x.loadProjectSound(this.sounds[a]);var l=JSON.parse(e.sprites);l.push(this.id),e.sprites=JSON.stringify(l);var c=this;e.div.appendChild(this.div),this.div.style.visibility="hidden",this.getAsset((function(e){c.setCostume(e,i)}))}},{key:"getAsset",value:function(e){var t=this.md5,r=this,n=me.keys[t]?me.path+t:t;if((t=me.keys[t]?me.path+t:t).indexOf("/")>-1)Yr.requestFromServer(t,a);else{var i=bn.files[t].split(",")[1];a(atob(i))}function a(t){if(t=t.replace(/>\s*</g,"><"),r.setSVG(t),t.indexOf("xlink:href")<0&&zr.path)e(n);else{var i=Yr.getImageDataURL(r.md5,btoa(t));Yr.getImagesInSVG(t,(function(){e(i)}))}}}},{key:"setSVG",value:function(e){var t=(new DOMParser).parseFromString(e,"text/xml"),r=document.importNode(t.documentElement,!0);"#comment"==r.childNodes[0].nodeName&&r.removeChild(r.childNodes[0]),this.svg=r}},{key:"setCostume",value:function(e,t){var r=document.createElement("img");r.src=e,this.img=r,this.originalImg=r.cloneNode(!1),Object(s.K)(this.img.style,{position:"absolute",left:"0px",top:"0px"}),this.div.appendChild(r);var n=this;r.complete?n.displaySprite(t):r.onload=function(){n.displaySprite(t)}}},{key:"displaySprite",value:function(e){var t=this.img.width,r=this.img.height;this.div.style.width=this.img.width+"px",this.div.style.height=this.img.height+"px",this.cx=Math.floor(t/2),this.cy=Math.floor(r/2),this.w=t,this.h=r,this.setPos(this.xcoor,this.ycoor),this.doRender(e)}},{key:"doRender",value:function(e){this.drawBorder(),this.render(),dt.drawInCanvas(this),this.readOnly=dt.svgerror,this.watermark=yt.getWatermark(this.svg,"#B3B3B3"),e&&e(this)}},{key:"drawBorder",value:function(){var e,t,r;s.t?(this.border=document.createElement("canvas"),e=this.originalImg.width,t=this.originalImg.height,r=this.svg,this.border.width=e,this.border.height=t,this.border.style.width=e*this.scale+"px",this.border.style.height=t*this.scale+"px",dt.drawBorder(r,this.border.getContext("2d"))):(this.border=document.createElement("canvas"),e=this.img.width,t=this.img.height,r=this.svg,Object(s.I)(this.border,e,t),dt.drawBorder(r,this.border.getContext("2d")))}},{key:"spriteThumbnail",value:function(e){var t=Object(s.B)("div","spritethumb off",e);t.setAttribute("id",Object(s.l)("spritethumb")),t.type="spritethumb",t.owner=this.id;var r=Object(s.B)("canvas","thumbcanvas",t);return s.t?Object(s.J)(r,64,64):Object(s.I)(r,64,64),this.drawMyImage(r,r.width,r.height),(e=Object(s.B)("p","sname",t)).textContent=this.name,Object(s.B)("div","brush",t),this.thumbnail=t,t}},{key:"updateSpriteThumb",value:function(){var e=this.thumbnail;if(e){var t=e.childNodes[0];this.drawMyImage(t,t.width,t.height),e.childNodes[1].textContent=this.name}}},{key:"drawMyImage",value:function(e,t,r){if(this.img){var n;Object(s.I)(e,t,r);var i=(n=s.t?this.originalImg:this.img).naturalWidth?n.naturalWidth:n.width,a=n.naturalHeight?n.naturalHeight:n.height,o=Math.min(t/i,r/a),l=e.getContext("2d"),c=Math.floor(o*i),u=Math.floor(o*a),d=Math.floor((t-o*i)/2),h=Math.floor((r-o*a)/2);l.drawImage(this.border,0,0,this.border.width,this.border.height,d,h,c,u),n.complete?l.drawImage(n,0,0,i,a,d,h,c,u):n.onload=function(){l.drawImage(n,0,0,i,a,d,h,c,u)}}}},{key:"goHome",value:function(){this.setPos(this.homex,this.homey),this.scale=this.homescale,this.shown=this.homeshown,this.div.style.opacity=this.shown?1:0,this.setHeading(0),this.render()}},{key:"touchingAny",value:function(){if(!this.shown)return!1;Object(s.I)(Kn.workingCanvas,480,360),Object(s.I)(Kn.workingCanvas2,480,360);for(var e=this.div.parentNode,t=this.getBoxWithEffects(),r=0;r<e.childElementCount;r++){var n=e.childNodes[r].owner;if(n&&"text"!=n.type&&n.shown&&n.id!=this.id&&(!K.dragthumbnail||n!=K.dragthumbnail.owner)){var i=n.getBoxWithEffects();if(t.intersects(i)&&this.verifyHit(n))return!0}}return!1}},{key:"verifyHit",value:function(e){var t=Kn.workingCanvas.getContext("2d"),r=Kn.workingCanvas2.getContext("2d");t.clearRect(0,0,480,360),r.clearRect(0,0,480,360);var n=this.getBoxWithEffects(),i=e.getBoxWithEffects(),a=n.intersection(i);if(0==a.width)return!1;if(0==a.height)return!1;t.globalCompositeOperation="source-over",this.stamp(t),r.globalCompositeOperation="source-over",e.stamp(r),t.globalCompositeOperation="source-in",t.drawImage(Kn.workingCanvas2,0,0);for(var o=t.getImageData(a.x,a.y,a.width,a.height).data,s=Math.floor(o.length/4),l=0;l<s;l++){var c={x:l%a.width,y:Math.floor(l/a.width)};if(this.getAlpha(o,c,a.width)>0)return!0}return!1}},{key:"getAlpha",value:function(e,t,r){return e[4*t.x+t.y*r*4+3]}},{key:"setHeading",value:function(e){this.angle=e%360,this.render()}},{key:"setPos",value:function(e,t){this.dirx=e-this.xcoor==0?1:(e-this.xcoor)/Math.abs(e-this.xcoor),this.diry=t-this.ycoor==0?1:(t-this.ycoor)/Math.abs(t-this.ycoor),this.xcoor=e,this.ycoor=t,this.wrap(),this.render(),Object(s.K)(this.div.style,{position:"absolute",left:"0px",top:"0px"}),this.updateBubble()}},{key:"wrap",value:function(){"text"==this.type?this.wrapText():this.wrapChar()}},{key:"wrapChar",value:function(){this.xcoor<0&&(this.xcoor=480+this.xcoor),this.ycoor<0&&(this.ycoor=360+this.ycoor),this.xcoor>=480&&(this.xcoor=this.xcoor-480),this.ycoor>=360&&(this.ycoor=this.ycoor-360)}},{key:"wrapText",value:function(){var e=this.cx>480?this.cx:480,t=this.cx>480?480-this.cx:0;this.xcoor<t&&(this.xcoor=e+this.xcoor),this.ycoor<0&&(this.ycoor=360+this.ycoor),this.xcoor>=e&&(this.xcoor=this.xcoor-e),this.ycoor>=360&&(this.ycoor=this.ycoor-360)}},{key:"render",value:function(){var e;if(s.t){if(e="",this.img){e="translate3d("+(this.xcoor-this.cx*this.scale)+"px,"+(this.ycoor-this.cy*this.scale)+"px, 0px)",e+=" rotate("+this.angle+"deg)",this.flip?e+=" scale(-1, 1)":e+=" scale(1, 1)";var t=this.originalImg.width*this.scale,r=this.originalImg.height*this.scale;this.div.style.width=t+"px",this.div.style.height=r+"px",this.border&&(this.border.style.width=t+"px",this.border.style.height=r+"px"),this.img.style.width=t+"px",this.img.style.height=r+"px"}else e="translate3d("+(this.xcoor-this.cx)+"px,"+(this.ycoor-this.cy)+"px, 0px)";this.setTransform(e)}else e="translate3d("+(this.xcoor-this.cx)+"px,"+(this.ycoor-this.cy)+"px, 0px)",this.img&&(e+=" rotate("+this.angle+"deg)",this.flip?e+="scale("+-this.scale+", "+this.scale+")":e+="scale("+this.scale+", "+this.scale+")"),this.setTransform(e)}},{key:"select",value:function(){this.borderOn||this.img&&this.border&&(this.div.appendChild(this.border),Object(s.K)(this.border.style,{position:"absolute",left:"0px",top:"0px"}),this.div.appendChild(this.img),Object(s.K)(this.img.style,{position:"absolute",left:"0px",top:"0px"}),this.borderOn=!0,this.render())}},{key:"unselect",value:function(){if(this.borderOn){for(;this.div.childElementCount>0;)this.div.removeChild(this.div.childNodes[0]);this.div.appendChild(this.img),this.borderOn=!1}}},{key:"setTransform",value:function(e){this.div.style.webkitTransform=e}},{key:"screenLeft",value:function(){return Math.round(this.xcoor-this.cx*this.scale)}},{key:"screenTop",value:function(){return Math.round(this.ycoor-this.cy*this.scale)}},{key:"noScaleFor",value:function(){this.setScaleTo(this.defaultScale)}},{key:"changeSizeBy",value:function(e){var t=Number(e)+100*Number(this.scale);this.scale=this.getScale(t/100),this.setPos(this.xcoor,this.ycoor),this.render()}},{key:"setScaleTo",value:function(e){(e=this.getScale(e))!=this.scale&&(this.scale=e,this.setPos(this.xcoor,this.ycoor),this.render())}},{key:"getScale",value:function(e){var t=Math.max(Math.max(this.w,this.h)*e,36),r=Math.min(Math.min(this.w,this.h)*e,360);return 36==t?36/Math.max(this.w,this.h):360==r?360/Math.min(this.w,this.h):e}},{key:"getBox",value:function(){return{x:this.screenLeft(),y:this.screenTop(),width:this.w*this.scale,height:this.h*this.scale}}},{key:"getBoxWithEffects",value:function(){if("text"==this.type)return new ie(this.screenLeft(),this.screenTop(),this.w*this.scale,this.h*this.scale);var e=Math.max(this.outline.width,this.outline.height),t=Math.floor(1.5*e*this.scale),r=Math.floor(1.5*e*this.scale);return new ie(Math.floor(this.xcoor-t/2),Math.floor(this.ycoor-r/2),Math.floor(t),Math.floor(r))}},{key:"closeBalloon",value:function(){this.balloon&&(this.balloon.parentNode.removeChild(this.balloon),this.balloon=void 0)}},{key:"openBalloon",value:function(e){this.balloon&&this.closeBalloon();var t=200,r=36,n=this.screenTop();this.balloon=Object(s.A)(Kn.stage.currentPage.div,0,0,t,r,{position:"absolute",zIndex:2,visibility:"hidden"});var i=document.createElement("img");Object(s.K)(i.style,{position:"absolute",zIndex:2}),this.balloon.appendChild(i);var a=Object(s.D)(this.balloon,e,{});a.setAttribute("class","balloon"),(t=a.offsetWidth)<36&&(t=36),t>200&&(t=200),t+=10*Object(s.q)("stage").owner.currentZoom,Object(s.K)(a.style,{position:"absolute",width:t+"px"}),t+=10,t=Math.round(t);var o=this.screenLeft()+this.div.offsetWidth*this.scale/2-t/2,l=o<0?0:o+t>480?478-t:o;l=Math.round(l),r=a.offsetHeight+12+7,Object(s.I)(this.balloon,t,r),(n-=r)<2&&(n=2),this.balloon.style.webkitTransform="translate3d("+l+"px,"+n+"px, 0px)",this.balloon.left=l,this.balloon.top=n,Object(s.K)(this.balloon.style,{position:"absolute",left:"0px",top:"0px",visibility:"visible"}),this.drawBalloon()}},{key:"updateBubble",value:function(){if(null!=this.balloon){var e=this.balloon.offsetWidth,t=this.balloon.offsetHeight,r=this.screenTop(),n=this.screenLeft()+this.div.offsetWidth*this.scale/2-e/2,i=n<0?0:n+e>480?478-e:n;i=Math.round(i),(r-=t)<2&&(r=2),this.balloon.style.webkitTransform="translate3d("+i+"px,"+r+"px, 0px)",this.balloon.left=i,this.balloon.top=r,this.drawBalloon()}}},{key:"drawBalloon",value:function(){var e=this.balloon.childNodes[0],t=this.balloon.offsetWidth,r=this.balloon.offsetHeight,n=this.balloon.left,i=r-8,a=t-1,o=this.xcoor-n;o<20&&(o=20),o>a-20&&(o=a-20);var s=a-o,l=on.balloon.concat(),c=(l=(l=(l=(l=(l=l.replace('width="30px"','width="'+t+'px"')).replace('height="44px"','height="'+r+'px"')).replace('viewBox="0 0 30 44"','viewBox="0 0 '+t+" "+r+'"')).replace("h17","h"+(a-12))).replace("v24","v"+(i-12))).split("h-2"),u=c[1].split("h-1");l=c[0]+"h"+(7-s+6)+u[0]+"h"+(7-o+6)+u[1],e.src="data:image/svg+xml;base64,"+btoa(l)}},{key:"stamp",value:function(e,t,r){var n=this.outline.width*this.scale,i=this.outline.height*this.scale,a=t||0,o=r||0;e.save(),e.translate(this.xcoor+a,this.ycoor+o),e.rotate(this.angle*s.c),this.flip&&e.scale(-1,1),e.drawImage(this.outline,-n/2,-i/2,n,i),e.restore()}},{key:"createText",value:function(e,t){var r=e.page;Object(s.K)(this,e),this.div=Object(s.B)("p","textsprite",r.div),Object(s.K)(this.div.style,{fontSize:this.fontsize+"px",color:this.color,fontFamily:window.Settings.textSpriteFont}),this.div.owner=this,this.div.id=this.id,this.scale=1,this.homescale=1,this.homeshown=!0,this.homeflip=!1,this.outline=document.createElement("canvas");var n=JSON.parse(r.sprites);if(n.push(this.id),r.sprites=JSON.stringify(n),""!=this.str||t)o.isSampleLocalizedKey(this.str)&&Kn.isSampleOrStarter()&&(this.str=o.localize("SAMPLE_TEXT_"+this.str)),this.recalculateText(),t&&t(this);else{this.setTextBox(),this.activateInput();var i=1.35*this.fontsize;r.textstartat+=i,r.textstartat+i>360&&(r.textstartat=42)}}},{key:"setTextBox",value:function(){var e=document.forms.activetextbox;e.textsprite=this;var t,r=this.getBox(),n=document.forms.activetextbox.typing;n.value=this.str,t=s.t?{color:this.color,fontSize:this.fontsize*s.H+"px"}:{color:this.color,fontSize:this.fontsize+"px"};var i,a,o=on.fontcolors.indexOf(Object(s.G)(this.color));Xt.setMenuTextColor(Object(s.q)("textcolormenu").childNodes[o<0?9:o]),Object(s.K)(n.style,t),i=s.t?r.y*s.H+Object(s.p)(Object(s.q)("stage"))-10*s.H:r.y+Object(s.p)(Object(s.q)("stage"),Object(s.q)("stage").offsetTop)-10,Object(s.q)("textbox").className="pagetext on",s.t?(a=(230-Math.round(235))*s.H+Object(s.o)(Object(s.q)("stage")),Object(s.K)(Object(s.q)("textbox").style,{top:i+"px",left:a+"px",zIndex:10}),Object(s.K)(e.style,{height:(this.fontsize+10)*s.H+"px"}),setTimeout((function(){}),500)):(a=230-Math.round(235)+Object(s.o)(Object(s.q)("stage"),Object(s.q)("stage").offsetLeft),Object(s.K)(Object(s.q)("textbox").style,{top:i+"px",left:a+"px",zIndex:10}),Object(s.K)(e.style,{height:this.fontsize+10+"px"}))}},{key:"unfocusText",value:function(){Kn.blur(),document.body.scrollTop=0,document.body.scrollLeft=0;var e=document.forms.activetextbox,t=this.oldvalue!=e.typing.value;this.noChars(e.typing.value)?this.deleteText(""!=this.oldvalue):(this.contractText(),this.div.style.visibility="visible",s.t&&(Object(s.q)("textbox").style.visibility="hidden"),Object(s.q)("textbox").className="pagetext off",Object(s.q)("textcolormenu").className="textuicolormenu off",Object(s.q)("textfontsizes").className="textuifont off",Object(s.q)("fontsizebutton").className="fontsizeText off",Object(s.q)("fontcolorbutton").className="changecolorText off",e.textsprite=null,this.deactivateInput(),t&&(dr.record({action:"edittext",where:this.div.parentNode.owner.id,who:this.id}),Kn.storyStart("Sprite.prototype.unfocusText"))),or.updatePages(),s.t&&Kn.onBackButtonCallback.pop()}},{key:"deleteText",value:function(e){var t=this.id,r=Kn.stage.currentPage;r.textstartat=this.ycoor+1.35*this.fontsize>360?36:this.ycoor;var n=JSON.parse(r.sprites),i=n.indexOf(this.id);if(!(i<0)){n.splice(i,1),this.div.parentNode.removeChild(this.div),r.sprites=JSON.stringify(n);var a=document.forms.activetextbox;Object(s.q)("textbox").style.visibility="hidden",a.textsprite=null,e&&(dr.record({action:"deletesprite",who:t,where:Kn.stage.currentPage.id}),Kn.storyStart("Sprite.prototype.deleteText"))}}},{key:"noChars",value:function(e){for(var t=0;t<e.length;t++)if(" "!=e[t])return!1;return!0}},{key:"contractText",value:function(){var e=document.forms.activetextbox;this.str=e.typing.value.substring(0,e.typing.maxLength),this.recalculateText()}},{key:"clickOnText",value:function(e){e.stopPropagation(),this.setTextBox(),Object(s.q)("textbox").style.visibility="visible",this.div.style.visibility="hidden",this.activateInput()}},{key:"activateInput",value:function(){this.oldvalue=this.str;var e=document.forms.activetextbox.typing;Object(s.q)("textbox").style.visibility="visible";var t=this;e.onblur=function(){t.unfocusText()},e.onkeypress=function(e){t.handleWrite(e)},e.onkeyup=function(e){t.handleKeyUp(e)},e.onsubmit=function(){t.unfocusText()},s.t?(setTimeout((function(){e.focus()}),500),Kn.onBackButtonCallback.push((function(){t.unfocusText()}))):s.u?e.focus():setTimeout((function(){e.focus()}),100)}},{key:"handleWrite",value:function(e){var t=e.keyCode||e.which,r=e.target;13==t?(e.preventDefault(),e.target.blur()):r.parentNode.textsprite||(Object(s.q)("textbox").style.visibility="hidden",this.deactivateInput())}},{key:"handleKeyUp",value:function(e){var t=e.target;t.parentNode.textsprite&&(t.parentNode.textsprite.str=t.value)}},{key:"deactivateInput",value:function(){var e=document.forms.activetextbox.typing;e.onblur=void 0,e.onkeypress=void 0,e.onsubmit=void 0}},{key:"activate",value:function(){for(var e=Object(s.g)(this.w,this.h,re.watermark.offsetWidth,re.watermark.offsetHeight),t=re.watermark;t.childElementCount>0;)t.removeChild(t.childNodes[0]);var r=this.getSVGimage(this.watermark);t.appendChild(r);var n={width:this.w+"px",height:this.h+"px",left:e[0]+"px",top:e[1]+"px",zoom:Math.floor(e[2]/this.w*100)+"%"};Object(s.K)(r.style,n)}},{key:"getSVGimage",value:function(e){var t=document.createElement("img"),r=(new XMLSerializer).serializeToString(e);return r=r.replace(/ href="data:image/g,' xlink:href="data:image'),t.src="data:image/svg+xml;base64,"+btoa(r),t}},{key:"setColor",value:function(e){this.color=e,this.div.style.color=this.color}},{key:"setFontSize",value:function(e){e<12&&(e=12),e>72&&(e=72),this.fontsize=e}},{key:"recalculateText",value:function(){this.div.style.color=this.color,this.div.style.fontSize=this.fontsize+"px",this.div.textContent=this.str;var e=this.outline.getContext("2d");e.font="bold "+this.fontsize+"px "+window.Settings.textSpriteFont;var t=e.measureText(this.str).width;this.w=Math.round(t)+1,this.div.style.width=2*this.w+"px",this.h=this.div.offsetHeight,this.cx=this.w/2,this.cy=this.h/2,Object(s.I)(this.outline,this.w,this.h),e.clearRect(0,0,this.outline.width,this.outline.height),e.font="bold "+this.fontsize+"px "+window.Settings.textSpriteFont,e.fillStyle=this.color,e.textAlign="left",e.textBaseline="top",e.fillText(this.str,0,0),this.setPos(this.xcoor,this.ycoor)}},{key:"startShaking",value:function(){var e=this.div.parentNode,t=Object(s.B)("div","shakeme",e);t.id="shakediv",s.t?Object(s.K)(t.style,{position:"absolute",left:this.screenLeft()+"px",top:this.screenTop()+"px",width:this.w*this.scale+"px",height:this.h*this.scale+"px"}):Object(s.K)(t.style,{position:"absolute",left:this.screenLeft()/this.scale+"px",top:this.screenTop()/this.scale+"px",width:this.w+"px",height:this.h+"px",zoom:Math.floor(100*this.scale)+"%"});var r="translate3d(0px, 0px, 0px)";this.img&&(r+=" rotate("+this.angle+"deg)",this.flip?r+="scale(-1, 1)":r+="scale(1, 1)"),this.setTransform(r),t.appendChild(this.div);var n=Object(s.B)("div","sprite"==this.type?"deletesprite":"deletetext",t);s.v&&"sprite"==this.type&&(n.style.zoom=Math.floor(1/this.scale*100)+"%"),Object(s.o)(n)-Object(s.o)(Kn.stage.div)<0&&(n.style.left=Math.abs(Object(s.o)(n)-Object(s.o)(Kn.stage.div))*this.scale+"px"),Object(s.p)(n)-Object(s.p)(Kn.stage.div)<0&&(n.style.top=Math.abs(Object(s.p)(n)-Object(s.p)(Kn.stage.div))*this.scale+"px"),n.id="deletesprite",this.div=t,this.div.owner=this}},{key:"stopShaking",value:function(){if("shakediv"==this.div.id){var e=this.div;if(this.div=this.div.childNodes[0],Kn.stage.currentPage.div.appendChild(this.div),"shakediv"==e.id&&e.parentNode.removeChild(e),s.t)this.render();else{var t="translate3d("+(this.xcoor-this.cx)+"px,"+(this.ycoor-this.cy)+"px, 0px)";this.img&&(t+=" rotate("+this.angle+"deg)",this.flip?t+="scale("+-this.scale+", "+this.scale+")":t+="scale("+this.scale+", "+this.scale+")"),this.setTransform(t)}}}},{key:"drawCloseButton",value:function(){var e=this.div.getContext("2d"),t=document.createElement("img");t.src="/static/scratchjr/assets/ui/closeit.svg",t.complete?e.drawImage(t,0,0):t.onload=function(){e.drawImage(0,0)}}},{key:"getData",value:function(){var e="sprite"==this.type?this.getSpriteData():this.getTextBoxData();if("sprite"!=this.type)return e;for(var t=[],r=Object(s.q)(this.id+"_scripts").owner.getEncodableBlocks(),n=0;n<r.length;n++)t.push(bn.encodeStrip(r[n]));return e.scripts=t,e}},{key:"getSpriteData",value:function(){var e={};return e.shown=this.shown,e.type=this.type,e.md5=this.md5,e.id=this.id,e.flip=this.flip,e.name=this.name,e.angle=this.angle,e.scale=this.scale,e.speed=this.speed,e.defaultScale=this.defaultScale,e.sounds=this.sounds,e.xcoor=this.xcoor,e.ycoor=this.ycoor,e.cx=this.cx,e.cy=this.cy,e.w=this.w,e.h=this.h,e.homex=this.homex,e.homey=this.homey,e.homescale=this.homescale,e.homeshown=this.homeshown,e.homeflip=this.homeflip,e}},{key:"getTextBoxData",value:function(){var e={};return e.shown=this.shown,e.type=this.type,e.id=this.id,e.speed=this.speed,e.cx=this.cx,e.cy=this.cy,e.w=Math.floor(this.w),e.h=Math.floor(this.h),e.xcoor=this.xcoor,e.ycoor=this.ycoor,e.homex=this.homex,e.homey=this.homey,e.str=this.str,e.color=this.color,e.fontsize=this.fontsize,e}}])&&$t(t.prototype,r),n&&$t(t,n),e}();function er(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var tr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0}var t,r,n;return t=e,(r=[{key:"identity",value:function(){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0}},{key:"setMatrix",value:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.e=e.e,this.f=e.f}},{key:"isIdentity",value:function(){return 1==this.a&&0==this.b&&0==this.c&&1==this.d&&0==this.e&&0==this.f}},{key:"rotate",value:function(e){var t=Math.cos(e*Math.PI/180),r=Math.sin(e*Math.PI/180);this.a=t,this.b=r,this.c=-r,this.d=t}},{key:"scale",value:function(e,t){this.a=e,this.d=t||e}},{key:"translate",value:function(e,t){this.e=e,this.f=t}},{key:"transformPoint",value:function(e){return{x:this.a*e.x+this.c*e.y+this.e,y:this.b*e.x+this.d*e.y+this.f}}},{key:"multiply",value:function(t){var r=new e;return r.a=this.a*t.a+this.c*t.b,r.b=this.b*t.a+this.d*t.b,r.c=this.a*t.c+this.c*t.d,r.d=this.b*t.c+this.d*t.d,r.e=this.a*t.e+this.c*t.f+this.e,r.f=this.b*t.e+this.d*t.f+this.f,Math.abs(r.a)<1e-14&&(r.a=0),Math.abs(r.b)<1e-14&&(r.b=0),Math.abs(r.c)<1e-14&&(r.c=0),Math.abs(r.d)<1e-14&&(r.d=0),Math.abs(r.e)<1e-14&&(r.e=0),Math.abs(r.f)<1e-14&&(r.f=0),r}}])&&er(t.prototype,r),n&&er(t,n),e}();function rr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var nr=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=Kn.stage.pagesdiv;this.div=Object(s.B)("div","stagepage",i),this.div.owner=this,this.id=t,this.textstartat=36,this.div.setAttribute("id",this.id),Kn.stage.currentPage=this,this.num=r?r.num:Kn.stage.pages.length+1,this.sprites=JSON.stringify([]),this.bkg=Object(s.A)(this.div,0,0,480,360,{position:"absolute",background:Kn.stagecolor}),this.bkg.type="background",Kn.stage.pages.push(this),r?this.loadPageData(r,n):this.emptyPage()}var t,r,n;return t=e,(r=[{key:"loadPageData",value:function(e,t){this.currentSpriteName=e.lastSprite,e.textstartat&&(this.textstartat=Number(e.textstartat)),e.md5&&"undefined"!=e.md5?(bn.mediaCount++,this.setBackground(e.md5,(function(){bn.substractCount(),t&&bn.mediaCount<1&&t()}))):this.clearBackground();for(var r=e.sprites,n=0;n<r.length;n++)bn.recreateObject(this,r[n],e[r[n]],o);for(var i=0;i<e.layers.length;i++){var a=Object(s.q)(e.layers[i]);a&&this.div.appendChild(a)}function o(){t&&bn.mediaCount<1&&t()}}},{key:"emptyPage",value:function(){this.clearBackground(),this.createCat()}},{key:"setCurrentSprite",value:function(e){Kn.getSprite()&&Kn.getSprite().unselect(),e?(this.currentSpriteName=e.id,e.div.style.visibility="visible",Object(s.q)("scripts").style.display=Kn.inFullscreen?"none":"block",e.activate()):(this.currentSpriteName=void 0,Object(s.q)("scripts").style.display="none")}},{key:"clearBackground",value:function(){for(;this.bkg.childElementCount>0;)this.bkg.removeChild(this.bkg.childNodes[0])}},{key:"setBackground",value:function(e,t){if("undefined"!=e)if(this.clearBackground(),this.md5=void 0,"none"!=e){if(this.md5=e,e){var r=me.keys[e]?me.path+e:e;me.keys[e]?this.setBackgroundImage(r,t):bn.files[e]&&this.setBackgroundImage(bn.files[e],t)}}else t&&t()}},{key:"setSVG",value:function(e){var t=(new DOMParser).parseFromString(e,"text/xml"),r=document.importNode(t.documentElement,!0);"#comment"==r.childNodes[0].nodeName&&r.removeChild(r.childNodes[0]),this.svg=r}},{key:"setBackgroundImage",value:function(e,t){var r=document.createElement("img");r.src=e,this.bkg.originalImg=r.cloneNode(!1),this.bkg.appendChild(r),Object(s.K)(r.style,{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%"}),this.bkg.img=r,r.complete?t&&t():r.onload=function(){t&&t()}}},{key:"setPageSprites",value:function(e){for(var t=JSON.parse(this.sprites),r=0;r<t.length;r++)Object(s.q)(t[r]).style.visibility=e}},{key:"redoChangeBkg",value:function(e){var t=e[this.id].md5?e[this.id].md5:"none";this.setBackground(t,this.updateThumb)}},{key:"updateThumb",value:function(e){var t=e||Kn.stage.currentPage;if(t.thumbnail){var r=t.thumbnail.childNodes[0].childNodes[0];t.setPageThumb(r)}}},{key:"pageThumbnail",value:function(e){var t=Object(s.B)("div","pagethumb",e);t.setAttribute("id",Object(s.l)("pagethumb")),t.owner=this.id,t.type="pagethumb";var r=Object(s.B)("div","pc-container",t),n=Object(s.B)("canvas","pc",r);this.setPageThumb(n);var i=Object(s.B)("div","pagenum",t);return Object(s.B)("p",void 0,i).textContent=this.num,Object(s.B)("div","deletethumb",t),s.u?t.ontouchstart=function(e){or.pageMouseDown(e)}:t.onmousedown=function(e){or.pageMouseDown(e)},this.thumbnail=t,t}},{key:"setPageThumb",value:function(e){var t,r;"PBS"==window.Settings.edition?(t=136,r=101):(t=132,r=99),Object(s.J)(e,t,r);var n=e.width,i=e.height,a=e.getContext("2d");if("PBS"==window.Settings.edition?(a.rect(0,0,n,i),a.fillStyle="#fff",a.fill()):a.drawImage(on.canvasMask,0,0,n,i),this.bkg.childElementCount>0){var o=this.bkg.originalImg,l=o.naturalWidth?o.naturalWidth:o.width,c=o.naturalHeight?o.naturalHeight:o.height;a.drawImage(o,0,0,l,c,0,0,n,i)}for(var u=n/480,d=0;d<this.div.childElementCount;d++){var h=this.div.childNodes[d].owner;h&&this.stampSpriteAt(a,h,u)}"PBS"!=window.Settings.edition&&(a.save(),a.globalCompositeOperation="destination-in",a.drawImage(on.canvasMask,0,0,n,i),a.restore())}},{key:"stampSpriteAt",value:function(e,t,r){t.shown&&("sprite"==t.type?t.originalImg:t.outline)}},{key:"drawSpriteImage",value:function(e,t,r,n){try{if(!r.shown)return;if(!t)return;var i=t.naturalWidth?t.naturalWidth:t.width,a=t.naturalHeight?t.naturalHeight:t.height,o=i*r.scale,l=a*r.scale;e.save();var c={x:r.cx*r.scale*n,y:r.cy*r.scale*n};e.translate(c.x,c.y),e.rotate(r.angle*s.c),e.translate(-c.x,-c.y),r.flip&&(e.scale(-1,1),e.translate(-t.width*n*r.scale,0));var u=this.getMatrixFor(r,n),d=oe.floor(u.transformPoint({x:Math.floor(r.screenLeft()*n),y:Math.floor(r.screenTop()*n)}));e.drawImage(t,0,0,i,a,d.x,d.y,Math.floor(o*n),Math.floor(l*n)),e.restore()}catch(e){console.log(e)}}},{key:"getMatrixFor",value:function(e){var t=new tr,r=e.angle?-e.angle:0;e.flip&&(t.a=-1,t.d=1);var n=new tr;return n.rotate(r),t.multiply(n)}},{key:"encodePage",value:function(){var e=this.div,t=JSON.parse(this.sprites),r={};r.textstartat=this.textstartat,r.sprites=t;var n=this.md5;n&&(r.md5=n),r.num=this.num,this.currentSpriteName=this.currentSpriteName?"sprite"==Object(s.q)(this.currentSpriteName).owner.type?this.currentSpriteName:this.getSprites()[0]:void 0,r.lastSprite=this.currentSpriteName;for(var i=0;i<t.length;i++)r[t[i]]=bn.encodeSprite(t[i]);for(var a=[],o=1;o<e.childElementCount;o++){var l=e.childNodes[o].id;l&&""!=l&&a.push(l)}return r.layers=a,r}},{key:"getSprites",value:function(){for(var e=JSON.parse(this.sprites),t=[],r=0;r<e.length;r++)"sprite"==Object(s.q)(e[r]).owner.type&&t.push(e[r]);return t}},{key:"createText",value:function(){var e={shown:!0,type:"text",scale:1,defaultScale:1,speed:2,dirx:1,diry:1,angle:0,homex:240,homey:this.textstartat,xcoor:240,ycoor:this.textstartat,str:"",color:on.fontcolors[on.fontcolors.length-1],fontsize:36,cx:0,cy:21.6,w:0,h:48.6};e.page=this,e.id=Object(s.l)("Text"),new Qt(e)}},{key:"createCat",value:function(){var e=Xt.mascotData(Kn.stage.currentPage);bn.mediaCount++,new Qt(e,this.pageAdded)}},{key:"update",value:function(e){e?dr.record({action:"modify",where:this.id,who:e.id}):dr.record({action:"recreatepage",where:this.id,who:this.id}),e?or.updateSprite(e):or.updateSprites(),or.updatePages()}},{key:"updateBkg",value:function(){var e=Kn.stage.currentPage;Kn.storyStart("Page.prototype.updateBkg"),dr.record({action:"changebkg",where:e.id,who:e.id}),or.updatePages()}},{key:"spriteAdded",value:function(e){var t=e.div.parentNode.owner;t.setCurrentSprite(e),t.update(e),Xt.spriteInView(e),Kn.onHold=!1}},{key:"pageAdded",value:function(e){var t=e.div.parentNode.owner;bn.mediaCount--,t.setCurrentSprite(e),Kn.storyStart("Page.prototype.pageAdded"),Kn.stage.pages.length>1&&dr.record({action:"addpage",where:t.id,who:t.id}),or.updateSprites(),or.updatePages()}},{key:"addSprite",value:function(e,t,r){Kn.onHold=!0;var n={flip:!1,angle:0,shown:!0,type:"sprite",scale:e,defaultScale:e,speed:2,dirx:1,diry:1,sounds:["pop.mp3"],homex:240,homescale:e,homey:180,xcoor:240,ycoor:180,homeshown:!0};n.page=Kn.stage.currentPage,n.id=Object(s.l)(r),n.name=r,n.md5=t,new Qt(n,this.spriteAdded)}},{key:"createSprite",value:function(e){new Qt(e,this.spriteAdded)}},{key:"modifySprite",value:function(e,t,r){var n=Object(s.q)(unescape(r)).owner;n||(n=Kn.getSprite()),n.md5=e,n.name=t;var i=this;n.getAsset((function(e){n.setCostume(e,i.spriteAdded)}))}},{key:"modifySpriteName",value:function(e,t){var r=Object(s.q)(unescape(t)).owner;r||(r=Kn.getSprite()),r.name=e,r.thumbnail.childNodes[1].textContent=e,dr.record({action:"modify",where:this.id,who:r.id}),Kn.storyStart("Page.prototype.modifySpriteName")}}])&&rr(t.prototype,r),n&&rr(t,n),e}();function ir(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ar=void 0,or=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"updatePages",value:function(){for(var t=Object(s.q)("pagecc");t.childElementCount>0;)t.removeChild(t.childNodes[0]);for(var r=void 0,n=0;n<Kn.stage.pages.length;n++){var i=Kn.stage.pages[n];i.num=n+1;var a=i.pageThumbnail(t);a.prev=r,r&&(r.next=a),i.id==Kn.stage.currentPage.id?e.highlighPage(a):e.unhighlighPage(a),re.updateScriptsPageBlocks(JSON.parse(i.sprites)),r=a}if(!(Kn.stage.pages.length>3)&&Kn.isEditable()){var o=e.emptyPage(t);o.prev=r,a.next=o}}},{key:"getObjectFor",value:function(e,t){for(var r=0;r<e.childElementCount;r++)if(e.childNodes[r].owner==t)return e.childNodes[r];return e.childNodes[0]}},{key:"getType",value:function(e,t){for(;null!=e;){if(e.type==t)return e;e=e.parentNode}return null}},{key:"pageMouseDown",value:function(t){if(!(s.u&&t.touches&&t.touches.length>1||Kn.onHold)){t.preventDefault(),t.stopPropagation(),window.event?e.t=window.event.srcElement:e.t=t.target;var r=e.getType(e.t,"pagethumb");if(Kn.shaking&&"deletethumb"==t.target.className)return Kn.clearSelection(),void Kn.stage.deletePage(r.owner);Kn.shaking?Kn.clearSelection():r&&(!Kn.isEditable()||Object(s.q)("pagecc").childElementCount<3?e.clickOnPage(t,r.owner):K.startDrag(t,r,e.prepareToDragPage,e.dropPage,e.draggingPage,e.clickPage,e.startPageShaking))}}},{key:"prepareToDragPage",value:function(t){t.preventDefault(),t.stopPropagation(),x.sndFX("grab.wav");var r=K.getTargetPoint(t);K.dragmousex=r.x,K.dragmousey=r.y;var n=K.dragmousex-s.h.offsetLeft-Object(s.x)(K.dragthumbnail,K.dragmousex),i=K.dragmousey-s.h.offsetTop-Object(s.y)(K.dragthumbnail,K.dragmousey),a={position:"absolute",left:"0px",top:"0px",zIndex:Kn.dragginLayer};K.dragcanvas=K.dragthumbnail,Object(s.K)(K.dragcanvas.style,a),K.move3D(K.dragcanvas,n,i),s.h.appendChild(K.dragcanvas),(ar=Object(s.B)("div","pagethumb caret",Object(s.q)("pagecc"))).prev=K.dragthumbnail.prev,ar.next=K.dragthumbnail.next,K.dragthumbnail.prev&&(K.dragthumbnail.prev.next=ar),K.dragthumbnail.next&&(K.dragthumbnail.next.prev=ar),e.layoutPages(),K.dragthumbnail.pos=e.getPagePos(K.dragcanvas.top)}},{key:"layoutPages",value:function(){for(var t=e.findFirst(),r=Object(s.q)("pagecc");t;)r.appendChild(t),t=t.next}},{key:"findFirst",value:function(){for(var e=Object(s.q)("pagecc").childNodes[0];e.prev;)e=e.prev;return e}},{key:"findLast",value:function(){for(var e=Object(s.q)("pagecc").childNodes[0];e.next;)e=e.next;return e}},{key:"getPageOrder",value:function(){for(var t=e.findFirst(),r=[];t;){var n=t.owner;n&&r.push(Object(s.q)(n).owner),t=t.next}return r}},{key:"draggingPage",value:function(t,r){t.preventDefault();var n=K.getTargetPoint(t),i=n.x-K.dragmousex,a=n.y-K.dragmousey;K.move3D(r,i,a),ar&&(e.removeCaret(),e.insertCaret(r),e.layoutPages())}},{key:"removeCaret",value:function(){var e=ar.prev,t=ar.next;e&&(e.next=t),t&&(t.prev=e),ar.prev=void 0,ar.next=void 0;var r=ar.parentNode;r&&r.removeChild(ar)}},{key:"insertCaret",value:function(t){var r=e.getPagePos(t.top);e.positionMe(r,ar),Object(s.q)("pagecc").appendChild(ar)}},{key:"getPagePos",value:function(t){var r=Object(s.q)("pagecc").childNodes[1].offsetTop-Object(s.q)("pagecc").childNodes[0].offsetTop,n=Math.floor(Object(s.y)(Object(s.q)("pagecc"),t+r/2)/r);n=Math.max(0,n);var i=e.getPageOrder().length;return Math.min(i,n)}},{key:"positionMe",value:function(t,r){var n=t>=Object(s.q)("pagecc").childElementCount?void 0:Object(s.q)("pagecc").childNodes[t];if(n){var i=n.prev;n.prev=r,r.next=n,i&&(i.next=r,r.prev=i)}else{var a=e.findLast();a.next=r,r.prev=a,r.next=void 0}}},{key:"repositionThumb",value:function(t,r){var n=e.getPagePos(r);n!=t.pos&&x.sndFX("snap.wav");var i=t.prev,a=t.next;i&&(i.next=a),a&&(a.prev=i),e.positionMe(n,t)}},{key:"dropPage",value:function(t){if(Kn.storyStart("Thumbs.dropPage"),t.preventDefault(),ar){K.dragthumbnail.prev=ar.prev,K.dragthumbnail.next=ar.next,K.dragthumbnail.prev&&(K.dragthumbnail.prev.next=K.dragthumbnail),K.dragthumbnail.next&&(K.dragthumbnail.next.prev=K.dragthumbnail),ar.parentNode&&ar.parentNode.removeChild(ar),ar=void 0,K.dragthumbnail.style.position="",K.dragthumbnail.style.left="",K.dragthumbnail.style.top="",K.dragthumbnail.style.webkitTransform="";var r=Number(K.dragthumbnail.childNodes[1].childNodes[0].textContent)-1,n=K.dragthumbnail.owner;e.repositionThumb(K.dragthumbnail,K.dragthumbnail.top);var i=Kn.stage.getPagesID();Kn.stage.pages=e.getPageOrder(),e.layoutPages(),e.updatePages(),Kn.stage.renumberPageBlocks(i),5==Sr.numcat&&Sr.selectCategory(5),e.getPageOrder()[r].id!=n&&dr.record({action:"pageorder",who:n,where:n})}}},{key:"clickPage",value:function(t){Kn.clearSelection(),e.clickOnPage(t,K.dragthumbnail.owner),K.clearEvents(),K.dragthumbnail=void 0}},{key:"clickOnPage",value:function(e,t){Kn.unfocus(e);for(var r=Object(s.q)("pagecc"),n=0;n<r.childElementCount;n++)r.childNodes[n].id;if(Kn.stage.currentPage.id!=t){var i=Object(s.q)(t).owner;Kn.stage.setPage(i,!1),dr.record({action:"changepage",who:t,where:t})}}},{key:"startPageShaking",value:function(t){Kn.shaking=t,Kn.stopShaking=e.stopPageShaking;var r=t.getAttribute("class");t.setAttribute("class",r+" shakeme"),t.childNodes[t.childElementCount-1].style.visibility="visible"}},{key:"stopPageShaking",value:function(e){Kn.shaking=void 0,Kn.stopShaking=void 0;var t=e.getAttribute("class");t=t.substr(0,t.length-8),e.setAttribute("class",t),e.childNodes[e.childElementCount-1].style.visibility="hidden"}},{key:"emptyPage",value:function(t){var r=Object(s.B)("div","pagethumb",t),n=Object(s.B)("div","empty",r);return("PBS"==window.Settings.edition?Object(s.C)(n,"/static/scratchjr/assets/ui/newpage.svg"):Object(s.C)(n,"/static/scratchjr/assets/ui/newpage.png",{position:"absolute"})).setAttribute("class","unselectable"),r.setAttribute("id","emptypage"),s.u?r.ontouchstart=function(t){e.clickOnEmptyPage(t)}:r.onmousedown=function(t){e.clickOnEmptyPage(t)},r}},{key:"clickOnEmptyPage",value:function(e){if(!(s.u&&e.touches&&e.touches.length>1)){x.sndFX("tap.wav"),e.preventDefault(),Kn.stage.currentPage.div.style.visibility="hidden",Kn.stage.currentPage.setPageSprites("hidden");var t=Object(s.q)(Kn.stage.currentPage.currentSpriteName+"_scripts");t&&t.owner.deactivate(),Kn.unfocus(e),new nr(Object(s.l)("page"))}}},{key:"highlighPage",value:function(e){e.setAttribute("class","pagethumb on")}},{key:"unhighlighPage",value:function(e){e.setAttribute("class","pagethumb off")}},{key:"overpage",value:function(e){e.setAttribute("class","pagethumb drop")}},{key:"updateSprites",value:function(){var t=Object(s.q)("spritecc");for(t.style.top="0px";t.childElementCount>0;)t.removeChild(t.childNodes[0]);for(var r=JSON.parse(Kn.stage.currentPage.sprites),n=0;n<r.length;n++){var i=Object(s.q)(r[n]);if(i){var a=i.owner;if("sprite"==a.type){var o=a.spriteThumbnail(t);a.id==Kn.stage.currentPage.currentSpriteName?e.highlighSprite(o):e.unhighlighSprite(o)}}}Kn.getSprite()||Kn.stage.currentPage.setCurrentSprite(void 0),Xt.resetSpriteLibrary()}},{key:"updateSprite",value:function(t){if(t)if(t.thumbnail)t.updateSpriteThumb();else{var r=Object(s.q)("spritecc");if("sprite"!=t.type)return;t.spriteThumbnail(r),e.selectThisSprite(t),Xt.resetSpriteLibrary()}}},{key:"startDragThumb",value:function(t,r){Kn.shaking&&"deletespritethumb"==t.target.id&&(Kn.clearSelection(),Kn.stage.removeSprite(Object(s.q)(r.owner).owner)),Kn.shaking&&Kn.clearSelection(),Kn.isEditable()?K.startDrag(t,r,e.prepareToDrag,e.drop,e.dragging,e.click,e.startCharShaking):e.clickOnSprite(t,r)}},{key:"startCharShaking",value:function(t){if(t){Kn.shaking=t,Kn.stopShaking=e.stopCharShaking;var r=t.getAttribute("class");t.setAttribute("class",r+" shakethumb"),Object(s.B)("div","deletespritethumb",t).id="deletespritethumb"}}},{key:"stopCharShaking",value:function(e){Kn.shaking=void 0,Kn.stopShaking=void 0;var t=e.getAttribute("class");t=t.substr(0,t.length-8),e.setAttribute("class",t);var r=e.childNodes[e.childElementCount-1];"deletespritethumb"==r.getAttribute("class")&&e.removeChild(r)}},{key:"selectThisSprite",value:function(t){for(var r=Object(s.q)("spritecc"),n=t.thumbnail,i=0;i<r.childElementCount;i++){var a=r.childNodes[i];a==n?e.highlighSprite(n):e.unhighlighSprite(a)}}},{key:"clickOnSprite",value:function(t,r){if(Kn.shaking&&Kn.shaking==r)return Kn.clearSelection(),void Kn.stage.removeSprite(Object(s.q)(r.owner).owner);var n=r.owner;if(Object(s.q)(n)){Kn.unfocus(t);var i=Object(s.q)(n).owner;i.div.parentNode.owner.setCurrentSprite(i),e.selectThisSprite(i)}}},{key:"prepareToDrag",value:function(t){t.preventDefault(),t.stopPropagation(),x.sndFX("grab.wav");var r=K.getTargetPoint(t);K.dragmousex=r.x,K.dragmousey=r.y,K.dragthumbnail=e.getObjectFor(Object(s.q)("spritecc"),K.dragthumbnail.owner);var n=K.dragmousex-s.h.offsetLeft-Object(s.x)(K.dragthumbnail,K.dragmousex)-Object(s.q)("topsection").offsetLeft,i=K.dragmousey-s.h.offsetTop-Object(s.y)(K.dragthumbnail,K.dragmousey)-Object(s.q)("topsection").offsetTop;i-=K.dragthumbnail.parentNode.parentNode.scrollTop,n-=K.dragthumbnail.parentNode.parentNode.scrollLeft;var a={position:"absolute",left:"0px",top:"0px",zIndex:Kn.dragginLayer,zoom:100/window.devicePixelRatio+"%"},o=Object(s.q)(K.dragthumbnail.owner).owner;K.dragcanvas=document.createElement("canvas"),o.drawMyImage(K.dragcanvas,76*s.H*window.devicePixelRatio,64*s.H*window.devicePixelRatio),Object(s.K)(K.dragcanvas.style,a),K.move3D(K.dragcanvas,n*window.devicePixelRatio,i*window.devicePixelRatio),K.dragcanvas.owner=K.dragthumbnail.owner,s.h.appendChild(K.dragcanvas)}},{key:"dragging",value:function(t,r){t.preventDefault();var n=K.getTargetPoint(t),i=n.x-K.dragmousex,a=n.y-K.dragmousey;if(K.move3D(r,i*window.devicePixelRatio,a*window.devicePixelRatio),"pages"==Sr.getLandingPlace(r,t,window.devicePixelRatio)){var o=Sr.getHittedThumb(r,Object(s.q)("pagecc"),window.devicePixelRatio);o&&!o.owner&&(o=void 0),o&&e.overpage(o);for(var l=0;l<Object(s.q)("pagecc").childElementCount;l++){var c=Object(s.q)("pagecc").childNodes[l];if(c.owner){var u=Object(s.q)(c.owner);o&&o.id!=c.id&&(u.owner.id==Kn.stage.currentPage.id?e.highlighPage(c):e.unhighlighPage(c))}}}else e.removePagesCaret()}},{key:"removePagesCaret",value:function(){for(var t=0;t<Object(s.q)("pagecc").childElementCount;t++){var r=Object(s.q)("pagecc").childNodes[t];r.owner&&(Object(s.q)(r.owner).owner.id==Kn.stage.currentPage.id?e.highlighPage(r):e.unhighlighPage(r))}}},{key:"drop",value:function(e,t){switch(e.preventDefault(),Sr.getLandingPlace(t,e,window.devicePixelRatio)){case"pages":var r=Sr.getHittedThumb(t,Object(s.q)("pagecc"),window.devicePixelRatio);r&&"emptypage"!=r.id&&Kn.stage.copySprite(t,r)}K.dragcanvas&&K.dragcanvas.parentNode.removeChild(K.dragcanvas),K.dragcanvas=void 0}},{key:"click",value:function(t,r){t.preventDefault(),t.stopPropagation(),window.event?e.t=window.event.srcElement:e.t=t.target,r.setAttribute("class",Kn.isEditable()?"spritethumb on":"spritethumb noneditable"),e.clickOnSprite(t,r)}},{key:"highlighSprite",value:function(e){e.setAttribute("class",Kn.isEditable()?"spritethumb on":"spritethumb noneditable"),re.setActiveScript(e.owner),Sr.reset()}},{key:"unhighlighSprite",value:function(e){e.setAttribute("class","spritethumb off");var t=Object(s.q)(e.owner+"_scripts");t.owner.deactivate();for(var r=0;r<t.childElementCount;r++)t.childNodes[r].owner&&t.childNodes[r].owner.unhighlight()}},{key:"quickHighlight",value:function(e){e.owner==Kn.stage.currentPage.currentSpriteName?e.className="spritethumb on target":e.className="spritethumb off target"}},{key:"quickRestore",value:function(e){e.owner==Kn.stage.currentPage.currentSpriteName?e.className=Kn.isEditable()?"spritethumb on":"spritethumb noneditable":e.className="spritethumb off"}}],(r=null)&&ir(t.prototype,r),n&&ir(t,n),e}();function sr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var lr,cr=[],ur=0,dr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"init",value:function(){ur=cr.length,e.update()}},{key:"setup",value:function(t){var r=Object(s.B)("div","controlundo",t);r.setAttribute("id","undocontrols");for(var n=[["undo",e.prevStep],["redo",e.nextStep]],i=0;i<n.length;i++)e.newToggleClicky(r,"id_",n[i][0],n[i][1]);e.update()}},{key:"newToggleClicky",value:function(e,t,r,n){var i=Object(s.B)("div",r+"button",e);return i.setAttribute("type","toggleclicky"),i.setAttribute("id",t+r),n&&(s.u?i.ontouchstart=function(e){n(e)}:i.onmousedown=function(e){n(e)}),i}},{key:"record",value:function(t){Kn.getActiveScript()&&Kn.getActiveScript().owner.removeCaret(),ur+1<=cr.length&&cr.splice(ur+1,cr.length);var r=bn.getUndo();for(var n in t)r[n]=t[n];cr.push(r),ur++,e.update(),Kn.changed=!0}},{key:"prevStep",value:function(t){if(!(s.u&&t.touches&&t.touches.length>1)){for(t.preventDefault(),t.stopPropagation(),Kn.unfocus(),Kn.time=t.timeStamp;ur>=cr.length;)ur--;var r=--ur<0?"boing.wav":"tap.wav";x.sndFX(r),ur<0?ur=0:e.smartRecreate("prev",cr[ur+1],cr[ur])}}},{key:"nextStep",value:function(t){if(!(s.u&&t.touches&&t.touches.length>1)){t.preventDefault(),t.stopPropagation(),Kn.unfocus(),Kn.time=t.timeStamp;var r=++ur>cr.length-1?"boing.wav":"tap.wav";x.sndFX(r),ur>cr.length-1?ur=cr.length-1:e.smartRecreate("next",cr[ur],cr[ur])}}},{key:"smartRecreate",value:function(t,r,n){Kn.stopStrips();var i=r.action,a=r.where,o=r.who;switch(i){case"pageorder":Kn.stage.pages=e.getPageOrder(n),e.recreateAllScripts(n),Kn.stage.setPage(Object(s.q)(n.currentPage).owner,!1),5==Sr.numcat&&Sr.selectCategory(5);break;case"changepage":Kn.stage.setPage(Object(s.q)(n.currentPage).owner,!1);break;case"changebkg":Object(s.q)(a).owner.redoChangeBkg(n);break;case"scripts":e.redoScripts(n,a,o),o&&Object(s.q)(o)&&(Object(s.q)(a).owner.setCurrentSprite(Object(s.q)(o).owner),or.selectThisSprite(Object(s.q)(o).owner),Xt.resetSpriteLibrary());break;case"deletepage":case"addpage":n[a]?e.copyPage(n,a):e.removePage(n,a);break;case"deletesprite":case"copy":n[a][o]?e.copySprite(n,a,o):e.removeSprite(n,a,o);break;case"deletesound":var l=n[a][o].sounds.concat();Object(s.q)(o).owner.sounds=l,e.redoScripts(n,a,o),3==Sr.numcat&&Sr.selectCategory(3);break;case"recordsound":if(o=Object(s.q)(n[a][o].id).owner,r.sound&&o.sounds.indexOf(r.sound)>-1){var c=o.sounds.indexOf(r.sound);c>-1&&o.sounds.splice(c,1)}else o.sounds.push(r.sound);3==Sr.numcat&&Sr.selectCategory(3);break;case"edittext":case"modify":e.removeSprite(n,a,o),n[a][o]&&e.copySprite(n,a,o);break;default:bn.clear(),e.recreate(cr[ur])}e.update()}},{key:"copyPage",value:function(t,r){var n=Kn.getSprite()?Object(s.q)(Kn.stage.currentPage.currentSpriteName+"_scripts"):void 0;n&&n.owner.deactivate(),bn.recreatePage(r,t[r],(function(){Kn.stage.pages=e.getPageOrder(t),Kn.stage.setPage(Object(s.q)(t.currentPage).owner,!1),e.recreateAllScripts(t);var r=t[t.currentPage].lastSprite;if(r&&Object(s.q)(r)){var n=Object(s.q)(r).owner;n.div.parentNode.owner.setCurrentSprite(n),or.selectThisSprite(n),5==Sr.numcat&&Sr.selectCategory(5)}}))}},{key:"getPageOrder",value:function(e){for(var t=e.pages,r=[],n=0;n<t.length;n++)r.push(Object(s.q)(t[n]).owner);return r}},{key:"recreateAllScripts",value:function(t){for(var r=0;r<t.pages.length;r++)for(var n=t[t.pages[r]],i=n.sprites,a=0;a<i.length;a++){var o=n[i[a]];o&&"sprite"==o.type&&Object(s.q)(o.id+"_scripts")&&e.redoScripts(t,t.pages[r],i[a])}}},{key:"removePage",value:function(t,r){if(Object(s.q)(r)){var n=Object(s.q)(r).owner;n&&(Kn.stage.removePageBlocks(r),Kn.stage.removePage(n),Kn.stage.pages=e.getPageOrder(t),0==Kn.stage.pages.length?e.copyPage(t,t.currentPage):(Kn.stage.setViewPage(Object(s.q)(t.currentPage).owner),or.updateSprites(),or.updatePages()))}}},{key:"redoScripts",value:function(e,t,r){for(var n=Object(s.q)(r+"_scripts");n.childElementCount>0;)n.removeChild(n.childNodes[0]);for(var i=n.owner,a=e[t][r].scripts,o=0;o<a.length;o++)i.recreateStrip(a[o])}},{key:"copySprite",value:function(t,r,n){var i=t[r][n];bn.recreateObject(Object(s.q)(r).owner,n,i,(function(n){if("sprite"==n.type)r==Kn.stage.currentPage.id&&(n.div.style.visibility="visible"),e.setSprite(r,t);else{var i=1.35*n.fontsize;n.homey==n.page.textstartat&&(n.page.textstartat+=i),or.updatePages()}}),t[r].lastSprite==n)}},{key:"setSprite",value:function(e,t){if(or.updatePages(),e==Kn.stage.currentPage.id){var r=Object(s.q)(e).owner,n=t[e].lastSprite,i=n?Object(s.q)(n):void 0;if(i){var a=i.owner;r.setCurrentSprite(a),Xt.needsScroll(),or.updateSprites()}else r.setCurrentSprite(void 0)}}},{key:"removeSprite",value:function(t,r,n){if(Object(s.q)(n)){var i=Object(s.q)(n).owner,a=i.thumbnail;Kn.runtime.stopThreadSprite(i);var o=Object(s.q)(r).owner,l=JSON.parse(o.sprites),c=l.indexOf(n);if(l.splice(c,1),o.sprites=JSON.stringify(l),Object(s.q)(n).parentNode.removeChild(Object(s.q)(n)),Object(s.q)(n+"_scripts")){var u=Object(s.q)(n+"_scripts");u&&u.parentNode.removeChild(u),a&&a.parentNode&&a.parentNode.removeChild(a),e.setSprite(r,t)}else or.updatePages()}}},{key:"recreate",value:function(t){bn.mediaCount=0,Kn.stage.pages=[];var r=t.pages;t.projectsounds&&(x.projectsounds=t.projectsounds);for(var n=0;n<r.length;n++)bn.recreatePage(r[n],t[r[n]]);e.loadPage(t.currentPage)}},{key:"loadPage",value:function(t){Kn.stage.getPagesID().indexOf(t)<0?Kn.stage.currentPage=Kn.stage.pages[0]:Kn.stage.currentPage=Kn.stage.getPage(t),Kn.stage.currentPage.div.style.visibility="visible",Kn.stage.currentPage.setPageSprites("visible"),lr=100,bn.mediaCount>0?setTimeout((function(){e.updateImages()}),20):e.doneLoading()}},{key:"updateImages",value:function(){lr--,bn.mediaCount<1||lr<1?e.doneLoading():setTimeout((function(){e.updateImages()}),20)}},{key:"flashIcon",value:function(t,r){t.setAttribute("class",r),setTimeout((function(){e.update()}),1e3)}},{key:"doneLoading",value:function(){or.updateSprites(),or.updatePages()}},{key:"update",value:function(){Object(s.q)("id_undo")&&(1==cr.length?e.tunOffButton(Object(s.q)("id_undo")):ur<1?e.tunOffButton(Object(s.q)("id_undo")):e.tunOnButton(Object(s.q)("id_undo")),ur>=cr.length-1?e.tunOffButton(Object(s.q)("id_redo")):e.tunOnButton(Object(s.q)("id_redo")))}},{key:"tunOnButton",value:function(e){var t=e.getAttribute("class").split(" ")[0];e.setAttribute("class",t+" enable")}},{key:"tunOffButton",value:function(e){var t=e.getAttribute("class").split(" ")[0];e.setAttribute("class",t+" disable")}}],(r=null)&&sr(t.prototype,r),n&&sr(t,n),e}();function hr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var fr=function(){function e(t){switch(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.daddy=t,this.type="blockarg",this.argType=t.spec[3],this.argType){case"n":this.argValue=t.spec[4],this.div=this.addNumArg();break;case"t":this.argValue=t.spec[4],o.isSampleLocalizedKey(this.argValue)&&Kn.isSampleOrStarter()&&(this.argValue=o.localize("SAMPLE_TEXT_"+this.argValue)),this.div=this.addTextArg();break;case"m":this.argValue=t.spec[4],this.list=JSON.stringify(t.spec[1]),this.numperrow=3,this.icon=this.getIconFrom(t.spec[4],t.spec[1]),this.div=this.addImageMenu(this.closePictureMenu);break;case"d":this.argValue=t.spec[4],this.list=JSON.stringify(t.spec[1]),this.numperrow=3,this.icon=on.speeds[this.argValue],this.div=this.addImageMenu(this.menuCloseSpeeds);break;case"p":this.argValue=t.spec[4],this.div=this.pageIcon(this.argValue),t.blockshape.getContext("2d").drawImage(this.div,0,0,this.div.width,this.div.height,0,0,this.div.width*t.scale,this.div.height*t.scale);break;case"s":this.argValue=t.spec[4],this.div=Object(s.A)(t.div,2,46,60,20,{position:"absolute",zoom:100*t.scale+"%"}),Object(s.D)(this.div,this.argValue.split(".")[0],{width:"60px"}).setAttribute("class","soundname");break;case"r":this.argValue=t.spec[4],this.div=Object(s.B)("div","recordedCircle",t.div),Object(s.K)(this.div.style,{zoom:100*t.scale+"%"}),Object(s.B)("p","recordedNumber",this.div).textContent=this.daddy.inpalette?this.argValue:"?"}}var t,r,n;return t=e,(r=[{key:"update",value:function(){"r"==this.argType&&(this.div.childNodes[0].textContent=this.argValue),this.arg&&"p"==this.argType&&this.arg.updateIcon()}},{key:"getScreenPt",value:function(){return{x:Object(s.o)(this.daddy.div),y:Object(s.p)(this.daddy.div)}}},{key:"addNumArg",value:function(){var e=this.argValue.toString();return this.daddy.inpalette?this.addLabel(e,!1):this.addNumArgument(e)}},{key:"addTextArg",value:function(){var e=this.argValue.toString();return this.daddy.inpalette?this.addLabel(e,!0):this.addTextArgument(e,!0)}},{key:"addLabel",value:function(e,t){var r=this.daddy.scale,n=t?8:16,i=57;"repeat"==this.daddy.blocktype&&(n=Math.round(this.daddy.blockshape.width/window.devicePixelRatio/r)-60,i=Math.round(this.daddy.blockshape.height/window.devicePixelRatio/r)-10);var a=t?on.textfieldimg:on.numfieldimg,o=t?53:36,l=17,c=Object(s.z)(this.daddy.div,0,0,o*window.devicePixelRatio,l*window.devicePixelRatio,{position:"absolute",webkitTransform:"translate("+-o*window.devicePixelRatio/2+"px, "+-l*window.devicePixelRatio/2+"px) scale("+r/window.devicePixelRatio+") translate("+(n*window.devicePixelRatio+o*window.devicePixelRatio/2)+"px, "+(i*window.devicePixelRatio+l*window.devicePixelRatio/2)+"px)",pointerEvents:"all"}).getContext("2d");a.complete?c.drawImage(a,0,0,o,l,0,0,o*window.devicePixelRatio,l*window.devicePixelRatio):a.onload=function(){c.drawImage(a,0,0,o,l,0,0,o*window.devicePixelRatio,l*window.devicePixelRatio)};var u=Object(s.A)(this.daddy.div,n,i,o,l,{position:"absolute",zoom:100*r+"%",margin:"0px",padding:"0px"}),d=Object(s.z)(u,0,0,o*window.devicePixelRatio,l*window.devicePixelRatio,{position:"absolute",webkitTransform:"translate("+-o*window.devicePixelRatio/2+"px, "+-l*window.devicePixelRatio/2+"px) scale("+1/window.devicePixelRatio+") translate("+o*window.devicePixelRatio/2+"px, "+l*window.devicePixelRatio/2+"px)"});c=d.getContext("2d");var h=12*window.devicePixelRatio+"px "+window.Settings.blockArgFont,f=Object(s.n)(c,h,e).width;return Object(s.L)(c,h,"#77787b",e,l*window.devicePixelRatio-3,Math.round((o*window.devicePixelRatio-f)/2)),u}},{key:"addNumArgument",value:function(e){var t=Object(s.B)("div","numfield",this.daddy.div);"repeat"==this.daddy.blocktype&&Object(s.K)(t.style,{left:this.daddy.blockshape.width/window.devicePixelRatio-62*this.daddy.scale+"px",top:this.daddy.blockshape.height/window.devicePixelRatio-11*this.daddy.scale+"px"});var r=Object(s.B)("h3",void 0,t);return this.input=r,r.owner=this,r.textContent=e,this.arg=t,t.parentNode.height+=10*window.devicePixelRatio,Object(s.I)(t.parentNode,t.parentNode.width,t.parentNode.height),t}},{key:"addTextArgument",value:function(e){var t=Object(s.B)("div","textfield",this.daddy.div),r=Object(s.B)("h3",void 0,t);return this.input=r,r.owner=this,r.textContent=e,this.arg=t,t.parentNode.height+=10*window.devicePixelRatio,Object(s.I)(t.parentNode,t.parentNode.width,t.parentNode.height),t}},{key:"setValue",value:function(e){this.input&&(this.argValue=e,this.input.textContent=e)}},{key:"isText",value:function(){return"n"!=this.argType}},{key:"getIconFrom",value:function(e,t){for(var r=0;r<t.length;r++)if(t[r].indexOf(e)>-1)return t[r];return t[0]}},{key:"addImageMenu",value:function(e){if(this.drawChoice(this.daddy.blockicon),this.button=this.addPressButton(),!this.daddy.inpalette){var t=this;s.u?t.button.ontouchstart=function(r){t.pressDropDown(r,e)}:t.button.onmousedown=function(r){t.pressDropDown(r,e)},this.button.parentNode.height+=this.button.height/2,Object(s.I)(this.button.parentNode,this.button.parentNode.width,this.button.parentNode.height)}return this.daddy.blockicon}},{key:"drawChoice",value:function(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);var r=on.getImageFrom("/static/scratchjr/assets/blockicons/"+this.icon,"svg"),n=this.daddy.scale;return r.complete?t.drawImage(r,0,0,r.width,r.height,0,0,r.width*n*window.devicePixelRatio,r.height*n*window.devicePixelRatio):r.onload=function(){t.drawImage(r,0,0,r.width,r.height,0,0,r.width*n*window.devicePixelRatio,r.height*n*window.devicePixelRatio)},e}},{key:"addPressButton",value:function(){var e,t=this.daddy.scale;e=this.daddy.inpalette?this.daddy.aStart?26:16:this.daddy.aStart?20:10;var r=this.daddy.inpalette?36:48,n=this.daddy.inpalette?20:27,i=this.daddy.inpalette?on.pressbuttonSmall:on.pressbutton,a=Object(s.z)(this.daddy.div,e,56,r,n,{position:"absolute",zoom:100*t+"%",pointerEvents:"all",webkitTransform:"translateZ(0)"}),o=a.getContext("2d");return i.complete?o.drawImage(i,0,0):i.onload=function(){o.drawImage(i,0,0)},a}},{key:"pressDropDown",value:function(e,t){s.u&&e.touches&&e.touches.length>1||Kn.onHold||(e.preventDefault(),e.stopPropagation(),Kn.unfocus(e),this.daddy&&T.openDropDown(this.daddy.div,t))}},{key:"closePictureMenu",value:function(e,t,r,n){e.preventDefault();var i=r.owner.arg.argValue;r.owner.arg.argValue=n.substring(n.indexOf("_")+1,n.length);var a=r.owner.blockicon.getContext("2d");if(r.icon=on.getImageFrom("/static/scratchjr/assets/blockicons/"+n,"svg"),a.clearRect(0,0,85*s.H*window.devicePixelRatio,66*s.H*window.devicePixelRatio),r.icon.complete){var o=r.icon.width,l=r.icon.height;a.drawImage(r.icon,0,0,o,l,0,0,o*s.H*window.devicePixelRatio,l*s.H*window.devicePixelRatio)}else r.icon.onload=function(){var e=r.icon.width,t=r.icon.height;a.drawImage(r.icon,0,0,e,t,0,0,e*s.H*window.devicePixelRatio,t*s.H*window.devicePixelRatio)};if(T.openMenu&&T.openMenu.parentNode.removeChild(T.openMenu),r.owner.arg.argValue!=i){var c=r.parentNode.owner.spr,u={action:"scripts",where:c.div.parentNode.owner.id,who:c.id};dr.record(u),Kn.storyStart("BlockArg.prototype.closePictureMenu")}T.openMenu=void 0}},{key:"menuCloseSpeeds",value:function(e,t,r,n){e.preventDefault();var i=r.owner.arg.argValue;r.owner.arg.argValue=on.speeds.indexOf(n);var a=r.owner.blockicon.getContext("2d");if(r.icon=on.getImageFrom("/static/scratchjr/assets/blockicons/"+n,"svg"),a.clearRect(0,0,64*s.H*window.devicePixelRatio,64*s.H*window.devicePixelRatio),r.owner.blockicon.style.display="none",r.owner.blockicon.style.display="inherit",r.icon.complete){var o=r.icon.width,l=r.icon.height;a.drawImage(r.icon,0,0,o,l,0,0,o*s.H*window.devicePixelRatio,l*s.H*window.devicePixelRatio)}else r.icon.onload=function(){var e=r.icon.width,t=r.icon.height;a.drawImage(r.icon,0,0,e,t,0,0,e*s.H*window.devicePixelRatio,t*s.H*window.devicePixelRatio)};if(T.openMenu&&T.openMenu.parentNode.removeChild(T.openMenu),r.owner.arg.argValue!=i){var c=r.parentNode.owner.spr,u={action:"scripts",where:c.div.parentNode.owner.id,who:c.id};dr.record(u),Kn.storyStart("BlockArg.prototype.menuCloseSpeeds")}T.openMenu=void 0}},{key:"pageIcon",value:function(e){var t=window.devicePixelRatio,r=Kn.stage.pages[e-1],n=document.createElement("canvas");if(Object(s.I)(n,86*t,66*t),!r)return n;var i=document.createElement("canvas");Object(s.I)(i,52*t,42*t);var a=i.getContext("2d");a.fillStyle="#AE1F24",a.fillRect(0,0,i.width,i.height),a.fillStyle="#28A5DA",a.fillRect(1*t,1*t,50*t,40*t);var o=document.createElement("canvas"),l=46*t,c=36*t;Object(s.I)(o,l,c);var u=o.getContext("2d");if(u.fillStyle="white",u.fillRect(0,0,o.width,o.height),r.bkg.childElementCount>0){var d=r.bkg.childNodes[0],h=d.naturalWidth?d.naturalWidth:d.width,f=d.naturalHeight?d.naturalHeight:d.height;u.drawImage(d,0,0,h,f,0,0,l,c)}for(var g=l/480,p=0;p<r.div.childElementCount;p++){var v=r.div.childNodes[p].owner;v&&r.stampSpriteAt(u,v,g)}a.drawImage(o,3*t,3*t);var m=n.getContext("2d");return m.fillStyle="#AE1F24",m.beginPath(),m.arc(63*t,19*t,10*t,0*t,2*Math.PI,!0),m.closePath(),m.fill(),m.drawImage(i,14*t,16*t),m.beginPath(),m.fillStyle="#28A5DA",m.strokeStyle="#355E7C",m.arc(63*t,19*t,8*t,0*t,2*Math.PI,!0),m.closePath(),m.stroke(),m.fill(),Object(s.L)(m,"bold "+12*t+"px "+window.Settings.blockArgFont,"white",r.num,26*t,58*t),n}},{key:"updateIcon",value:function(){var e=this.argValue;Kn.stage.pages[e-1].num=e,this.div=this.pageIcon(e);var t=this.daddy;t.blockshape.getContext("2d").drawImage(this.div,0,0,this.div.width,this.div.height,0,0,this.div.width*t.scale,this.div.height*t.scale)}}])&&hr(t.prototype,r),n&&hr(t,n),e}();function gr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var pr=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.div=document.createElement("div"),Object(s.K)(this.div.style,{pointerEvents:"none"}),this.setBlockshapeFromSpecs(t,r,n),this.blockshape=document.createElement("canvas"),Object(s.I)(this.div,this.getWidth()*this.scale,this.getHeight()*this.scale),Object(s.I)(this.blockshape,this.getWidth()*this.scale*window.devicePixelRatio,this.getHeight()*this.scale*window.devicePixelRatio),this.addShadow(),this.div.appendChild(this.blockshape),Object(s.K)(this.blockshape.style,{position:"absolute",left:"0px",top:"0px",webkitTransform:"translate("+-this.blockshape.width/2+"px, "+-this.blockshape.height/2+"px) scale("+1/window.devicePixelRatio+") translate("+this.blockshape.width/2+"px, "+this.blockshape.height/2+"px)",pointerEvents:"all"}),this.addHighlight(),this.drawBlock(),Object(s.I)(this.div,this.blockshape.width/window.devicePixelRatio,this.blockshape.height/window.devicePixelRatio),this.isCaret||(this.createArgument(),this.div.owner=this)}var t,r,n;return t=e,(r=[{key:"getWidth",value:function(){return"repeat"==this.blocktype?176:"gotopage"==this.blocktype?86:this.aStart||this.anEnd?84:76}},{key:"getHeight",value:function(){return"repeat"==this.blocktype?82:66}},{key:"setBlockshapeFromSpecs",value:function(e,t,r){this.spec=e,this.isReporter="reporter"==e[1],this.blocktype=e[0],this.icon=e[1],this.image=e[2],this.aStart="caretstart"==this.blocktype||this.image==on.yellowStart,this.anEnd="caretend"==this.blocktype||this.image==on.redEnd||this.image==on.redEndLong,this.cShape="repeat"==this.blocktype||"caretrepeat"==this.blocktype,this.prev=null,this.next=null,this.inside=null,this.isCaret=this.blocktype.indexOf("caret")>-1,this.type="block",this.arg=null,this.daddy=null,this.scale=r||1,this.repeatCounter=-1,this.originalCount=-1,this.threads=[],this.inpalette=t,this.min=e[6],this.max=e[7],this.shadowimg=this.spec.length<9?null:e[8],this.hrubberband=0,this.vrubberband=0,this.done=!1}},{key:"addShadow",value:function(){if(this.shadow=document.createElement("canvas"),this.div.appendChild(this.shadow),Object(s.K)(this.shadow.style,{position:"absolute",left:"1px",top:"4px",opacity:this.inpalette?window.Settings.paletteBlockShadowOpacity:1,visibility:"hidden",webkitTransform:"translate("+-this.blockshape.width/2+"px, "+-this.blockshape.height/2+"px) scale("+1/window.devicePixelRatio+") translate("+this.blockshape.width/2+"px, "+this.blockshape.height/2+"px)",pointerEvents:"all"}),Object(s.I)(this.shadow,this.blockshape.width,this.blockshape.height),this.shadowimg){var e=this.shadow.getContext("2d"),t=this.shadowimg;t.complete?e.drawImage(t,0,0,t.width,t.height,0,0,t.width*this.scale*window.devicePixelRatio,t.height*this.scale*window.devicePixelRatio):t.onload=function(){e.drawImage(t,0,0,t.width,t.height,0,0,t.width*this.scale*window.devicePixelRatio,t.height*this.scale*window.devicePixelRatio)}}}},{key:"lift",value:function(){this.shadow.style.visibility="visible"}},{key:"drop",value:function(){this.shadow.style.visibility="hidden"}},{key:"addHighlight",value:function(){var e=this.spec[5];if(e){this.shine=document.createElement("canvas"),this.div.appendChild(this.shine),Object(s.I)(this.shine,this.blockshape.width,this.blockshape.height),Object(s.K)(this.shine.style,{position:"absolute",left:"0px",top:"0px",visibility:"hidden",webkitTransform:"translate("+-this.blockshape.width/2+"px, "+-this.blockshape.height/2+"px) scale("+1/window.devicePixelRatio+") translate("+this.blockshape.width/2+"px, "+this.blockshape.height/2+"px)",pointerEvents:"all"});var t=this.shine.getContext("2d");e.complete?t.drawImage(e,0,0,e.width,e.height,0,0,e.width*this.scale*window.devicePixelRatio,e.height*this.scale*window.devicePixelRatio):e.onload=function(){t.drawImage(e,0,0,e.width,e.height,0,0,e.width*this.scale*window.devicePixelRatio,e.height*this.scale*window.devicePixelRatio)}}}},{key:"drawBlock",value:function(){var e=this.blockshape;this.blockshape.getContext("2d").clearRect(0,0,e.width,e.height);var t=this;this.image.complete?this.drawBlockType():this.image.onload=function(){t.drawBlockType()}}},{key:"drawBlockType",value:function(){this.blockshape.getContext("2d").drawImage(this.image,0,0,this.image.width,this.image.height,0,0,this.image.width*this.scale*window.devicePixelRatio,this.image.height*this.scale*window.devicePixelRatio);var e=document.createElement("canvas");this.blockicon=e,this.div.appendChild(e),Object(s.I)(e,this.blockshape.width,this.blockshape.height),Object(s.K)(e.style,{position:"absolute",left:"0px",top:"0px",webkitTransform:"translate("+-this.blockshape.width/2+"px, "+-this.blockshape.height/2+"px) scale("+1/window.devicePixelRatio+") translate("+this.blockshape.width/2+"px, "+this.blockshape.height/2+"px)",pointerEvents:"all"}),this.icon&&this.icon.tagName&&this.drawIcon(),this.done=!0}},{key:"updateBlock",value:function(){this.arg&&"p"==this.arg.argType&&this.arg.updateIcon()}},{key:"highlight",value:function(){this.blocktype.indexOf("caret")>-1||this.div.parentNode&&("palette"!=this.div.parentNode.id&&this.div.parentNode!=Kn.getActiveScript()||(this.shine.style.visibility="visible"))}},{key:"unhighlight",value:function(){this.blocktype.indexOf("caret")>-1||(this.shine.style.visibility="hidden")}},{key:"drawIcon",value:function(){var e=0,t=0,r=this.blockicon.getContext("2d");switch(this.blocktype){case"repeat":var n=Math.round(74*this.scale*window.devicePixelRatio),i=Math.round(65*this.scale*window.devicePixelRatio);Object(s.I)(this.blockicon,n,i),e=0,this.blockicon.style.left=this.shine.width/window.devicePixelRatio-Math.round(77*this.scale)+"px",t=Math.round(14*this.scale*window.devicePixelRatio),Object(s.K)(this.blockicon.style,{position:"absolute",webkitTransform:"translate("+-n/2+"px, "+-i/2+"px) scale("+1/window.devicePixelRatio+") translate("+n/2+"px, "+i/2+"px)"})}this.drawMyIcon(r,e,t)}},{key:"drawMyIcon",value:function(e,t,r){var n=this,i=this.icon;i.complete?e.drawImage(i,0,0,i.width,i.height,t,r,i.width*n.scale*window.devicePixelRatio,i.height*n.scale*window.devicePixelRatio):i.onload=function(){e.drawImage(i,0,0,i.width,i.height,t,r,i.width*n.scale*window.devicePixelRatio,i.height*n.scale*window.devicePixelRatio)}}},{key:"createArgument",value:function(){null!=this.spec[4]&&(this.arg=new fr(this))}},{key:"getArgValue",value:function(){return null==this.arg?null:this.arg.argValue}},{key:"getSoundName",value:function(e){var t=this.arg.argValue;return"NaN"==Number(t).toString()?t:e.length<=t?e[0]:e[t]}},{key:"update",value:function(e){this.arg&&this.arg.update(e)}},{key:"setSound",value:function(e){var t=this.arg.div;t.parentNode.removeChild(t);var r=this.blockicon;r.parentNode.removeChild(r);var n=e,i=on.defs[n];this.setBlockshapeFromSpecs(i),this.drawBlock(),this.createArgument()}},{key:"duplicateBlock",value:function(t,r,n){var i=this.blocktype,a=on.defs[i];a[4]=this.getArgValue();var o=new e(a,!1,s.H);return Object(s.K)(o.div.style,{position:"absolute",left:"0px",top:"0px"}),o.moveBlock(t,r),o.update(n),o}},{key:"resolveDocks",value:function(){var e=this.getWidth(),t=this.getHeight();return this.aStart?[["start",!0,0,t/2],["flow",!1,e-this.notchSize(),t/2]]:this.anEnd?[["flow",!0,0,t/2],["changestate",!1,e-3,t/2]]:this.isReporter?[["input",!0,0,0],["input",!1,e-this.notchSize(),t/2]]:this.cShape?[["flow",!0,0,this.blockshape.height/this.scale/window.devicePixelRatio-33],["flow",!1,35,this.blockshape.height/this.scale/window.devicePixelRatio-33],["flow",!1,this.blockshape.width/this.scale/window.devicePixelRatio-this.notchSize()-1,this.blockshape.height/this.scale/window.devicePixelRatio-33]]:[["flow",!0,0,t/2],["flow",!1,e-this.notchSize(),t/2]]}},{key:"notchSize",value:function(){return 11}},{key:"connectBlock",value:function(e,t,r){if(!this.isConnectedAfterFirst(e,t,r)&&(this.connectLast(e,t,r),this.setMyDock(e,t),t.setMyDock(r,this),this.cShape&&1==e&&this.inside.findLast().anEnd)){var n=this.inside.findLast();n.prev.next=null;var i=this.findLast();i.next=n,n.prev=i}}},{key:"getMyDock",value:function(e){return this[(this.cShape?["prev","inside","next"]:["prev","next"])[e]]}},{key:"setMyDock",value:function(e,t){this[(this.cShape?["prev","inside","next"]:["prev","next"])[e]]=t}},{key:"getMyDockNum",value:function(e){return(this.cShape?[this.prev,this.inside,this.next]:[this.prev,this.next]).indexOf(e)}},{key:"isConnectedAfterFirst",value:function(e,t){if(0==e)return!1;var r=t.prev;if(null==r)return!1;if(this==r)return!1;var n=r.getMyDockNum(t);return this.findFirst().connectBlock(0,r,n),!0}},{key:"findLast",value:function(){return null==this.next?this:this.next.findLast()}},{key:"findFirst",value:function(){return null==this.prev?this:this.prev.findFirst()}},{key:"connectLast",value:function(e,t,r){if(0==e){var n=t.getMyDock(r),i=this.findLast();if(n!=i)if(this.cShape&&null==this.inside&&null!=n&&!n.anEnd){var a=n.findLast();if(this.inside=n,n.prev=this,a.anEnd){i.next=a;var o=a.prev;o&&(o.next=null),a.prev=i}}else{if(i.next=n,null==n)return;n.prev=i}}}},{key:"detachBlock",value:function(){var e=this.prev;null!=e&&(this.prev=null,e.cShape&&e.inside==this?e.inside=null:e.next=null)}},{key:"moveBlock",value:function(e,t){this.div.top=t,this.div.left=e,this.div.style.webkitTransform="translate3d("+this.div.left+"px,"+this.div.top+"px, 0)"}},{key:"redrawRepeat",value:function(){if(this.redrawShape(this.blockshape,this.image),this.blocktype.indexOf("caret")<0&&this.redrawShape(this.shadow,this.shadowimg),!(this.blocktype.indexOf("caret")>-1)){var e=this.blockshape.width/window.devicePixelRatio-78*this.scale,t=this.blockshape.height/window.devicePixelRatio-82*this.scale;this.blockicon.style.left=e+"px",this.arg.div.style.left=this.blockshape.width/window.devicePixelRatio-66*this.scale+"px",this.blockicon.style.top=t+"px",this.arg.div.style.top=this.blockshape.height/window.devicePixelRatio-11*this.scale+"px"}}},{key:"redrawShape",value:function(e,t){Object(s.I)(this.div,(92+this.hrubberband+84)*this.scale,(100+this.vrubberband)*this.scale);var r=this.scale*window.devicePixelRatio;Object(s.I)(e,(92+this.hrubberband+84)*r,(82+this.vrubberband)*r),Object(s.K)(e.style,{webkitTransform:"translate("+-e.width/2+"px, "+-e.height/2+"px) scale("+1/window.devicePixelRatio+") translate("+e.width/2+"px, "+e.height/2+"px)"});var n=e.getContext("2d");n.drawImage(t,0,0,92,29,0,0,92*r,29*r),n.drawImage(t,92,0,1,29,92*r,0,this.hrubberband*r,29*r),n.drawImage(t,93,0,t.width-93,29,92*r+this.hrubberband*r,0,83*r,29*r),n.drawImage(t,0,29,92,1,0,29*r,92*r,this.vrubberband*r),n.drawImage(t,93,29,t.width-93,1,92*r+this.hrubberband*r,29*r,83*r,this.vrubberband*r),n.drawImage(t,0,29,45,53,0,29*r+this.vrubberband*r,45*r,53*r),n.drawImage(t,93,29,t.width-93,53,92*r+this.hrubberband*r,29*r+this.vrubberband*r,83*r,53*r)}}])&&gr(t.prototype,r),n&&gr(t,n),e}();function vr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var mr=.75,br=0,yr=void 0,kr=5,wr=void 0,xr=void 0,Sr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"setup",value:function(t){mr*=s.H,kr*=s.H,e.blockdx*=s.H,yr=90*mr,e.createCategorySelectors(t);var r=Object(s.B)("div","palette",t);r.setAttribute("id","palette"),r.ontouchstart=function(t){e.paletteMouseDown(t)};var n=Object(s.B)("div","papercut",t);Object(s.B)("div","withstyle",n)}},{key:"createCategorySelectors",value:function(t){var r=Object(s.B)("div","categoryselector",t);r.setAttribute("id","selectors");var n=Object(s.B)("div","catbkg",r);Object(s.B)("div","catimage",n);for(var i=15*s.H,a=54*s.H,o=0;o<on.categories.length;o++)e.createSelector(r,o,i+o*a,0,on.categories[o])}},{key:"paletteMouseDown",value:function(t){if(!(s.u&&t.touches&&t.touches.length>1||Kn.onHold)){t.preventDefault(),Kn.blur();for(var r=Object(s.q)("palette"),n=K.getTargetPoint(t),i={x:Object(s.x)(r,n.x),y:Object(s.y)(r,n.y)},a=0;a<r.childElementCount;a++){var o=r.childNodes[a];Object(s.s)(o,i)&&(Kn.shaking&&Kn.shaking==o?e.removeSound(o):K.startDrag(t,o,e.prepareForDrag,e.dropBlockFromPalette,re.draggingBlock,e.showHelp,e.startShaking))}Kn.clearSelection()}}},{key:"isRecorded",value:function(e){var t=e.owner.getArgValue();return Kn.getActiveScript().owner.spr.sounds.indexOf(t)>0}},{key:"removeSound",value:function(t){x.sndFX("cut.wav");var r=t.owner.getArgValue(),n=Kn.getSprite();if(n){var i=n.div.parentNode.owner,a=n.sounds.concat();if(!(r>=a.length)){a.splice(r,1),n.sounds=a;for(var o=n.getData(),l=Object(s.q)(n.id+"_scripts");l.childElementCount>0;)l.removeChild(l.childNodes[0]);for(var c=l.owner,u=o.scripts,d=0;d<u.length;d++)c.recreateStrip(u[d]);dr.record({action:"deletesound",who:n.id,where:i.id,sound:window.name}),Kn.storyStart("Palette.removeSound"),e.selectCategory(3)}}}},{key:"showHelp",value:function(t,r){var n=r.owner,i=on.blockDesc(n,Kn.getSprite())[n.blocktype];i&&(e.openPaletteBalloon(r,i),wr=setTimeout(e.closeHelpBalloon,2e3))}},{key:"startShaking",value:function(t){t.owner&&("playusersnd"==t.owner.blocktype?(Kn.shaking=t,Kn.stopShaking=e.stopShaking,t.setAttribute("class","shakeme"),Object(s.B)("div","deletesound",t)):e.showHelp(null,t))}},{key:"clickBlock",value:function(t,r){Kn.shaking&&r==Kn.shaking?e.removeSound(r):(Kn.clearSelection(),e.showHelp(t,r))}},{key:"stopShaking",value:function(e){if(e.owner){Kn.shaking=void 0,Kn.stopShaking=void 0,e.setAttribute("class","");var t=e.childNodes[e.childElementCount-1];"deletesound"==t.getAttribute("class")&&e.removeChild(t)}}},{key:"openPaletteBalloon",value:function(t,r){xr&&e.closeHelpBalloon();var n=Math.floor(14*window.devicePixelRatio*s.H),i=80*window.devicePixelRatio*s.H,a=36*window.devicePixelRatio*s.H,o=Object(s.p)(t)-36*s.H;(xr=Object(s.z)(s.h,0,o,i,a,{position:"absolute",zIndex:1e3})).icon=t;var l=xr.getContext("2d");(i=16*window.devicePixelRatio*s.H+Object(s.n)(l,"bold "+n+"px "+window.Settings.paletteBalloonFont,r).width)<36*s.H&&(i=36*s.H);var c=(Object(s.o)(t)+t.offsetWidth/2)*window.devicePixelRatio-i/2;Object(s.I)(xr,i,a),Object(s.K)(xr.style,{position:"absolute",webkitTransform:"translate("+-i/2+"px, "+-a/2+"px) scale("+1/window.devicePixelRatio+") translate("+(c+i/2)+"px, "+a/2+"px)"}),e.drawBalloon(xr.getContext("2d"),i,a),Object(s.L)(l,"bold "+n+"px "+window.Settings.paletteBalloonFont,"white",r,21*window.devicePixelRatio*s.H,8*window.devicePixelRatio*s.H)}},{key:"hide",value:function(){Object(s.q)("blockspalette").childNodes[0].style.display="none",Object(s.q)("blockspalette").childNodes[1].style.display="none"}},{key:"show",value:function(){Object(s.q)("blockspalette").childNodes[0].style.display="inline-block",Object(s.q)("blockspalette").childNodes[1].style.display="inline-block"}},{key:"closeHelpBalloon",value:function(){wr&&clearTimeout(wr),xr&&xr.parentNode.removeChild(xr),xr=void 0,wr=void 0}},{key:"drawBalloon",value:function(e,t,r){var n=new Array(["M",0,4],["q",0,-4,4,-4],["h",t-8],["q",4,0,4,4],["v",r-11-8],["q",0,4,-4,4],["h",-t/2+4+11],["l",-11,11],["l",-11,-11],["h",-t/2+4+11],["q",-4,0,-4,-4],["z"]);e.clearRect(0,0,Math.max(e.canvas.width,t),Math.max(e.canvas.height,r)),e.fillStyle="#4682B5",e.lineWidth=2,e.beginPath(),f.render(e,n),e.fill()}},{key:"prepareForDrag",value:function(t){t.preventDefault(),x.sndFX("grab.wav"),Kn.runtime.inactive()||Kn.stopStrips();var r=Kn.getActiveScript().owner;r.flowCaret=null;var n=K.getTargetPoint(t);if(K.dragmousex=n.x,K.dragmousey=n.y,K.dragthumbnail.parentNode||(K.dragthumbnail=e.getBlockNamed(K.dragthumbnail.owner.blocktype),K.dragthumbnail)){var i=K.dragmousex-s.h.offsetLeft-Object(s.x)(K.dragthumbnail,K.dragmousex),a=K.dragmousey-s.h.offsetTop-Object(s.y)(K.dragthumbnail,K.dragmousey);K.dragcanvas=K.dragthumbnail.owner.duplicateBlock(i,a,r.spr).div,K.dragcanvas.style.zIndex=Kn.dragginLayer,K.dragDiv.appendChild(K.dragcanvas),r.dragList=[K.dragcanvas.owner],r.prepareCaret(K.dragcanvas.owner)}else K.cancelAll()}},{key:"getBlockNamed",value:function(e){for(var t=Object(s.q)("palette"),r=0;r<t.childElementCount;r++)if(t.childNodes[r].owner.blocktype==e)return t.childNodes[r];return null}},{key:"createSelector",value:function(t,r,n,i,a){var o=51*s.H,l=57*s.H,c=Object(s.A)(t,n,i,o,l,{position:"absolute"});c.index=r;var u=a[1].cloneNode(!0);u.width=o,u.height=l,c.appendChild(u),Object(s.K)(u.style,{position:"absolute",zIndex:6,visibility:"visible"});var d=a[0].cloneNode(!0);d.width=o,d.height=l,c.appendChild(d),c.bkg=a[2],Object(s.K)(d.style,{position:"absolute",zIndex:8,visibility:"hidden"}),c.ontouchstart=function(t){e.clickOnCategory(t)}}},{key:"getPaletteSize",value:function(){var e=Object(s.q)("palette").childNodes[0],t=Object(s.q)("palette").childNodes[Object(s.q)("palette").childElementCount-1];return t.offsetLeft+t.offsetWidth-e.offsetLeft}},{key:"clickOnCategory",value:function(t){if(t){t.preventDefault(),Kn.unfocus(t);var r=t.target;x.sndFX("keydown.wav");var n=r.parentNode?r.parentNode.index:2;e.selectCategory(n)}}},{key:"selectCategory",value:function(t){var r=Object(s.q)("selectors");br=t;for(var n=r.childNodes[t+1],i=1;i<r.childElementCount;i++){var a=r.childNodes[i];a.childNodes[0].style.visibility=a.index!=t?"visible":"hidden",a.childNodes[1].style.visibility=a.index==t?"visible":"hidden"}var o=Object(s.q)("palette");for(Object(s.q)("blockspalette").style.background=n.bkg;o.childElementCount>0;)o.removeChild(o.childNodes[0]);if(Kn.getSprite()){for(var l=on.palettes[t].concat(),c=10,u=0;u<l.length;u++)"space"==l[u]?c+=30*mr:(e.newScaledBlock(o,l[u],"repeat"==l[u]?.65*s.H:mr,c,kr).lift(),c+=yr);c+=30,t==on.categories.length-1&&Kn.stage.pages.length>1&&e.addPagesBlocks(c),3==t&&Kn.getSprite().sounds.length>0&&e.addSoundsBlocks(10)}}},{key:"reset",value:function(){br==on.categories.length-1&&e.selectCategory(on.categories.length-1),3==br&&e.selectCategory(3)}},{key:"showSelectors",value:function(e){for(var t=br,r=Object(s.q)("selectors"),n=0;n<r.childElementCount;n++){var i=r.childNodes[n];i.childNodes[0].style.visibility=i.index!=t&&e?"visible":"hidden",i.childNodes[1].style.visibility=i.index==t&&e?"visible":"hidden",i.childNodes[2].style.visibility=i.index!=t&&e?"visible":"hidden",i.childNodes[3].style.visibility=i.index==t&&e?"visible":"hidden"}}},{key:"addPagesBlocks",value:function(t){for(var r=Object(s.q)("palette"),n=on.defs.gotopage,i=0;i<Kn.stage.pages.length;i++)Kn.stage.pages[i].id!=Kn.stage.currentPage.id&&(n[4]=i+1,e.newScaledBlock(r,"gotopage",mr,t,kr).lift(),t+=yr+5)}},{key:"addSoundsBlocks",value:function(t){for(var r=Object(s.q)("palette"),n=Kn.getSprite(),i=n?n.sounds:[],a=0;a<i.length;a++){var o=me.sounds.indexOf(i[a])<0?"playusersnd":"playsnd",l=me.sounds.indexOf(i[a])<0?a:i[a],c=e.addBlockSound(r,o,l,t,kr);c.lift(),t+=yr}i.length<6&&e.drawRecordSound(c.div.offsetWidth,c.div.offsetHeight,t)}},{key:"addBlockSound",value:function(t,r,n,i,a){var o=on.defs[r],s=o[4];o[4]=n;var l=e.newScaledBlock(t,r,mr,i,a);return o[4]=s,l}},{key:"drawRecordSound",value:function(t,r,n){var i=Object(s.q)("palette"),a=Object(s.A)(i,n,0,t,r,{top:6*s.H+"px"}),o=Object(s.z)(a,0,0,a.offsetWidth*window.devicePixelRatio,a.offsetHeight*window.devicePixelRatio,{webkitTransform:"translate("+-a.offsetWidth*window.devicePixelRatio/2+"px, "+-a.offsetHeight*window.devicePixelRatio/2+"px) scale("+1/window.devicePixelRatio+") translate("+a.offsetWidth*window.devicePixelRatio/2+"px, "+a.offsetHeight*window.devicePixelRatio/2+"px)"});on.mic.complete?Object(s.e)(on.mic,o):on.mic.onload=function(){Object(s.e)(on.mic,o)},s.u&&(a.ontouchstart=e.recordSound)}},{key:"recordSound",value:function(e){e.preventDefault(),e.stopPropagation(),zr.askpermission()&&Kn.clearSelection()}},{key:"inStatesPalette",value:function(){var e=Object(s.q)("selectors");return"hidden"==e.childNodes[e.childElementCount-1].childNodes[0].style.visibility}},{key:"getLandingPlace",value:function(t,r,n){n=void 0!==n?n:1;var i=Kn.getActiveScript().owner,a=r?K.getTargetPoint(r):null;a&&!a.x&&(a=null);var o=new ie(t.left/n,t.top/n,t.offsetWidth/n,t.offsetHeight/n),l=new ie(Object(s.o)(Object(s.q)("palette")),Object(s.p)(Object(s.q)("palette")),Object(s.q)("palette").offsetWidth,Object(s.q)("palette").offsetHeight);return null==i.flowCaret||null==i.flowCaret.prev&&null==i.flowCaret.next&&null==i.flowCaret.inside?l.overlapElemBy(o,.66)&&l.hitRect({x:t.left/n,y:t.top/n})?"palette":a&&l.hitRect(a)?"palette":e.overlapsWith(Object(s.q)("scripts"),o)?"scripts":e.overlapsWith(Object(s.q)("palette"),o)?"palette":e.overlapsWith(Object(s.q)("library"),o)?"library":e.overlapsWith(Object(s.q)("pages"),o)?"pages":null:"scripts"}},{key:"overlapsWith",value:function(e,t){var r=new ie(Object(s.o)(e),Object(s.p)(e),e.offsetWidth,e.offsetHeight);return t.intersects(r)}},{key:"overlapsWith2",value:function(e,t){var r=new ie(e.offsetLeft,e.offsetTop,e.offsetWidth,e.offsetHeight);return t.intersects(r)}},{key:"getBlockfromChild",value:function(e){for(;null!=e;){if(e.owner)return e;e=e.parentNode}return null}},{key:"getHittedThumb",value:function(e,t,r){r=void 0!==r?r:1;for(var n=new ie(e.left/r,e.top/r,e.offsetWidth/r,e.offsetHeight/r),i=0,a=null,o=t.parentNode.scrollTop,l=0;l<t.childElementCount;l++){var c=t.childNodes[l];if("FORM"!=c.nodeName){var u=new ie(Object(s.o)(c,c.offsetLeft),Object(s.p)(c,c.offsetTop)-o,c.offsetWidth,c.offsetHeight),d=n.intersection(u),h=d.width*d.height;h>i&&(i=h,a=c)}}return a}},{key:"newScaledBlock",value:function(e,t,r,n,i){var a=new pr(on.defs[t],!0,r);return Object(s.K)(a.div.style,{position:"absolute",left:n+"px",top:i+"px"}),e.appendChild(a.div),a}},{key:"dropBlockFromPalette",value:function(t,r){switch(t.preventDefault(),e.getLandingPlace(r,t)){case"scripts":var n=Kn.getActiveScript(),i=Object(s.x)(n,r.left),a=Object(s.y)(n,r.top);re.blockDropped(n,i,a);var o=Kn.getActiveScript().owner.spr;dr.record({action:"scripts",where:o.div.parentNode.owner.id,who:o.id}),Kn.storyStart("Palette.dropBlockFromPalette");break;default:Kn.getActiveScript().owner.deleteBlocks()}Kn.getActiveScript().owner.dragList=[]}},{key:"numcat",get:function(){return br}},{key:"helpballoon",get:function(){return xr},set:function(e){xr=e}}],(r=null)&&vr(t.prototype,r),n&&vr(t,n),e}();function _r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Cr,Or,jr=null,Ar=null,Pr=!1,Tr=!1,Nr=!0,Er=!1,Br=!1,Ir=null,Mr=null,Dr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"init",value:function(){var t=Object(s.B)("div","record fade",s.h);t.setAttribute("id","recorddialog");var r=Object(s.B)("div","toolbar",t),n=Object(s.B)("div","actions",r);Object(s.B)("div","microphone",n);var i=Object(s.B)("div","recordbuttons",n),a=Object(s.B)("div","recorddone",i);s.u?a.ontouchstart=e.saveSoundAndClose:a.onmousedown=e.saveSoundAndClose;var o=Object(s.B)("div","soundbox",t);o.setAttribute("id","soundbox");var l=Object(s.B)("div","soundvolume",o);l.setAttribute("id","soundvolume");for(var c=0;c<13;c++){var u=Object(s.B)("div","indicator",l);Object(s.B)("div","soundlevel",u)}var d=Object(s.B)("div","soundcontrols",o);d.setAttribute("id","soundcontrols");for(var h=[["record",e.record],["stop",e.stopSnd],["play",e.playSnd]],f=0;f<h.length;f++)e.newToggleClicky(d,"id_",h[f][0],h[f][1])}},{key:"appear",value:function(){Object(s.q)("backdrop").setAttribute("class","modal-backdrop fade in"),Object(s.K)(Object(s.q)("backdrop").style,{display:"block"}),Object(s.q)("recorddialog").setAttribute("class","record fade in"),Kn.stopStrips(),Br=!0,Kn.onBackButtonCallback.push(e.saveSoundandClose)}},{key:"disappear",value:function(){setTimeout((function(){Object(s.q)("backdrop").setAttribute("class","modal-backdrop fade"),Object(s.K)(Object(s.q)("backdrop").style,{display:"none"}),Object(s.q)("recorddialog").setAttribute("class","record fade")}),333),Br=!1,Kn.onBackButtonCallback.pop()}},{key:"newToggleClicky",value:function(e,t,r,n){var i=Object(s.B)("div","controlwrap",e);return Object(s.B)("div",r+"snd off",i),i.setAttribute("type","toggleclicky"),i.setAttribute("id",t+r),n&&(s.u?i.ontouchstart=function(e){n(e)}:i.onmousedown=function(e){n(e)}),i}},{key:"toggleButtonUI",value:function(e,t){var r="id_"+e,n=t?"on":"off",i=e+"snd";Object(s.q)(r).childNodes[0].setAttribute("class",i+" "+n)}},{key:"updateVolume",value:function(e){var t=Math.round(13*e),r=Object(s.q)("soundvolume");Pr||(t=0);for(var n=0;n<13;n++)r.childNodes[n].childNodes[0].setAttribute("class",n>t?"soundlevel off":"soundlevel on")}},{key:"recordUIoff",value:function(){e.toggleButtonUI("record",!1);for(var t=Object(s.q)("soundvolume"),r=0;r<Object(s.q)("soundvolume").childElementCount;r++)t.childNodes[r].childNodes[0].setAttribute("class","soundlevel off")}},{key:"record",value:function(t){function r(){Pr?e.stopRecording():zr.sndrecord(e.startRecording)}Er?e.killRecorder(t):Tr?e.stopPlayingSound(r):r()}},{key:"startRecording",value:function(t){parseInt(t)<0?(Ar=void 0,Pr=!1,e.killRecorder(),Sr.selectCategory(3)):(Ar=t,Pr=!0,Er=!1,e.soundname=t,e.toggleButtonUI("record",!0),jr=setInterval((function(){zr.volume(e.updateVolume,e.recordError)}),33),Ir=setTimeout((function(){Pr&&e.stopRecording()}),3e4))}},{key:"playSnd",value:function(t){Er?e.killRecorder(t):Ar&&(Tr?e.stopPlayingSound():Pr?e.stopRecording(e.startPlaying):e.startPlaying())}},{key:"startPlaying",value:function(){zr.startplay(e.timeOutPlay),e.toggleButtonUI("play",!0),Tr=!0}},{key:"timeOutPlay",value:function(t){parseInt(t)<0&&(t=.1),Mr=setTimeout((function(){e.toggleButtonUI("play",!1),Tr=!1}),1e3*t)}},{key:"stopSnd",value:function(t){Er?e.killRecorder(t):Ar&&(e.flashStopButton(),Pr?e.stopRecording():Tr&&e.stopPlayingSound())}},{key:"flashStopButton",value:function(){e.toggleButtonUI("stop",!0),setTimeout((function(){e.toggleButtonUI("stop",!1)}),200)}},{key:"stopPlayingSound",value:function(t){zr.stopplay(t),e.toggleButtonUI("play",!1),Tr=!1,window.clearTimeout(Mr),Mr=null}},{key:"stopRecording",value:function(t){null!=Ir&&(clearTimeout(Ir),Ir=null),null!=jr?(window.clearInterval(jr),jr=null,setTimeout((function(){e.volumeCheckStopped(t)}),33)):e.volumeCheckStopped(t)}},{key:"volumeCheckStopped",value:function(t){Pr=!1,e.recordUIoff(),zr.recordstop(t)}},{key:"saveSoundAndClose",value:function(){Er||!Ar?e.killRecorder():Tr?e.stopPlayingSound(e.closeContinueSave):Pr?e.stopRecording(e.closeContinueSave):e.closeContinueSave()}},{key:"closeContinueSave",value:function(){zr.recorddisappear("YES",e.registerProjectSound)}},{key:"closeContinueRemove",value:function(){zr.recorddisappear("NO",e.tearDownRecorder)}},{key:"registerProjectSound",value:function(){x.loadProjectSound(Ar,(function(t){if("error"!=t){var r=Kn.getSprite(),n=r.div.parentNode.owner;r.sounds.push(Ar),dr.record({action:"recordsound",who:r.id,where:n.id,sound:Ar}),Kn.storyStart("Record.registerProjectSound")}e.tearDownRecorder(),Sr.selectCategory(3)}))}},{key:"killRecorder",value:function(){Tr?e.stopPlayingSound(e.closeContinueRemove):Pr?e.stopRecording(e.closeContinueRemove):e.closeContinueRemove()}},{key:"tearDownRecorder",value:function(){Er&&(Er=!1),Pr=!1,Ar=null,e.disappear()}},{key:"recordError",value:function(){Er=!0,e.killRecorder()}},{key:"available",get:function(){return Nr},set:function(e){Nr=e}},{key:"dialogOpen",get:function(){return Br}}],(r=null)&&_r(t.prototype,r),n&&_r(t,n),e}();function Rr(e){return(Rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Lr=0,Fr=null,zr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"waitForInterface",value:function(t){if(null==Fr)return"undefined"!=typeof AndroidInterface?(Fr=AndroidInterface,void(t&&t())):void("object"!=Rr(window.tablet)?setTimeout((function(){e.waitForInterface(t)}),100):(Fr=window.tablet,t&&t()));t()}},{key:"getVersionName",value:function(){return Fr.getVersionName()}},{key:"openUrlWithSaferi",value:function(e){Fr.openUrlWithSaferi?Fr.openUrlWithSaferi(e):window.open(e)}},{key:"stmt",value:function(e,t){var r=Fr.database_stmt(JSON.stringify(e));void 0!==t&&t(r)}},{key:"query",value:function(e,t){var r=Fr.database_query(JSON.stringify(e));void 0!==t&&t(r)}},{key:"setfield",value:function(t,r,n,i,a){var o={},s=[n+" = ?"];o.values=[i],o.stmt="update "+t+" set "+s.toString()+" where id = "+r,e.stmt(o,a)}},{key:"cleanassets",value:function(e,t){Fr.io_cleanassets(e),t()}},{key:"getmedia",value:function(t,r){!function(t,r,n){var i=Fr.io_getmedialen(t,r);e.processdata(r,0,i,"",n)}(t,++Lr,r)}},{key:"getmediadata",value:function(e,t,r,n){var i=Fr.io_getmediadata(e,t,r);n&&n(i)}},{key:"processdata",value:function(t,r,n,i,a){if(0==n)return e.getmediadone(t),void a(i);var o=n<1e5?n:1e5;e.getmediadata(t,r,o,(function(s){e.processdata(t,r+o,n-o,i+s,a)}))}},{key:"getsettings",value:function(t){var r=Fr.io_getsettings();console.log(r);var n=r.split(",");e.path=n[0]+"/",n.length>2&&(Dr.available="YES"===n[2]),n.length>3&&(ze.available="YES"===n[3]),t&&t(r)}},{key:"getmediadone",value:function(e,t){var r=Fr.io_getmediadone(e);t&&t(r)}},{key:"setmedia",value:function(e,t,r){var n=Fr.io_setmedia(e,t);r&&r(n)}},{key:"setmedianame",value:function(e,t,r,n){var i=Fr.io_setmedianame(e,t,r);n&&n(i)}},{key:"getmd5",value:function(e,t){var r=Fr.io_getmd5(e);t&&t(r)}},{key:"remove",value:function(e,t){var r=Fr.io_remove(e);t&&t(r)}},{key:"getfile",value:function(e,t){var r=Fr.io_getfile(e);t&&t(r)}},{key:"setfile",value:function(e,t,r){var n=Fr.io_setfile(e,btoa(t));r&&r(n)}},{key:"registerSound",value:function(e,t,r){var n=Fr.io_registersound(e,t);r&&r(n)}},{key:"playSound",value:function(e,t){var r=Fr.io_playsound(e);t&&t(r)}},{key:"stopSound",value:function(e,t){var r=Fr.io_stopsound(e);t&&t(r)}},{key:"soundDone",value:function(e){x.soundDone(e)}},{key:"sndrecord",value:function(e){var t=Fr.recordsound_recordstart();e&&e(t)}},{key:"recordstop",value:function(e){var t=Fr.recordsound_recordstop();e&&e(t)}},{key:"volume",value:function(e){var t=Fr.recordsound_volume();e&&e(t)}},{key:"startplay",value:function(e){var t=Fr.recordsound_startplay();e&&e(t)}},{key:"stopplay",value:function(e){var t=Fr.recordsound_stopplay();e&&e(t)}},{key:"recorddisappear",value:function(e,t){var r=Fr.recordsound_recordclose(e);t&&t(r)}},{key:"askpermission",value:function(){var e=Fr.askForPermission();return Dr.available="YES"===e,"YES"===e}},{key:"askForCameraPermission",value:function(){var e=Fr.askForCameraPermission();return ze.available="YES"===e,"YES"===e}},{key:"hascamera",value:function(){Or=Fr.scratchjr_cameracheck()}},{key:"startfeed",value:function(e,t){var r=JSON.stringify(e),n=Fr.scratchjr_startfeed(r);t&&t(n)}},{key:"stopfeed",value:function(e){var t=Fr.scratchjr_stopfeed();e&&e(t)}},{key:"choosecamera",value:function(e,t){var r=Fr.scratchjr_choosecamera(e);t&&t(r)}},{key:"captureimage",value:function(e){Fr.scratchjr_captureimage(e)}},{key:"hidesplash",value:function(e){s.v&&Fr.hideSplash(),e&&e()}},{key:"trace",value:function(e){console.log(e)}},{key:"parse",value:function(e){console.log(JSON.parse(e))}},{key:"tracemedia",value:function(e){console.log(atob(e))}},{key:"sendSjrToShareDialog",value:function(e,t,r,n,i){Fr.sendSjrUsingShareDialog(e,t,r,n,i)}},{key:"loadProjectFromSjr",value:function(e){try{Yr.loadProjectFromSjr(e)}catch(e){var t="Couldn't load share -- project data corrupted. "+e.message;return v.open(Object(s.q)("frame"),Object(s.q)("frame"),t,"#ff0000"),console.log(e),0}return 1}},{key:"deviceName",value:function(e){e(Fr.deviceName())}},{key:"analyticsEvent",value:function(e,t,r,n){n||(n=1),j.currentUsage}},{key:"pageError",value:function(e){console.log("XCODE ERROR:",e),window.location.href.indexOf("home.html")>-1&&Lobby.errorTimer&&Lobby.errorLoading(e)}},{key:"path",get:function(){return Cr},set:function(e){Cr=e}},{key:"camera",get:function(){return Or}},{key:"database",get:function(){return"projects"}}],(r=[{key:"ignore",value:function(){}}])&&qr(t.prototype,r),n&&qr(t,n),e}();window.iOS=zr;var Hr=r(14),Ur=r.n(Hr);function Wr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Vr=null,Gr=0,Kr=0,Zr="",Xr="",Yr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"requestSynchronous",value:function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),0===t.status||200===t.status?t.responseText:""}},{key:"requestFromServer",value:function(e,t){var r=new XMLHttpRequest;r.addEventListener("error",(function(e){e.preventDefault(),e.stopPropagation()}),!1),r.onreadystatechange=function(){4==r.readyState&&t(r.responseText)},r.open("GET",e,!0),r.send(null)}},{key:"getThumbnail",value:function(e,t,r,n,i){e=e.replace(/>\s*</g,"><");var a=(new DOMParser).parseFromString(e,"text/xml"),o=document.importNode(a.documentElement,!0);"#comment"==o.childNodes[0].nodeName&&o.removeChild(o.childNodes[0]);var l=document.createElement("canvas");Object(s.I)(l,t,r);for(var c=l.getContext("2d"),u=0;u<o.childElementCount;u++)dt.drawLayer(o.childNodes[u],c);if(!n||!i)return l.toDataURL("image/png");var d=document.createElement("canvas");return Object(s.I)(d,n,i),Object(s.f)(l,d),d.toDataURL("image/png")}},{key:"getAsset",value:function(t,r){me.keys[t]?r(me.path+t):t.indexOf("/")>-1?e.requestFromServer(t,(function(n){var i=e.getImageDataURL(t,btoa(n));n.indexOf("xlink:href")<0?r(t):e.getImagesInSVG(n,(function(){r(i)}))})):"png"==e.getExtension(t)&&zr.path?r(zr.path+t):zr.getmedia(t,(function(n){var i=atob(n);if(i.indexOf("xlink:href")<0&&zr.path)r(zr.path+t);else{var a=e.getImageDataURL(t,n);e.getImagesInSVG(i,(function(){r(a)}))}}))}},{key:"getImagesInSVG",value:function(t,r){(t=t.replace(/>\s*</g,"><")).indexOf("xlink:href")<0?r():function(t,r){var n=(new DOMParser).parseFromString(t,"text/xml"),i=document.importNode(n.documentElement,!0);"#comment"==i.childNodes[0].nodeName&&i.removeChild(i.childNodes[0]);for(var a=e.getImages(i,[]),o=a.length,s=0;s<a.length;s++){var l=a[s].getAttribute("xlink:href"),c=document.createElement("img");c.src=l,c.complete?u():c.onload=function(){u()}}function u(){--o<1&&(i=null,n=null,r())}}(t,r)}},{key:"getImages",value:function(t,r){for(var n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];"metadata"!=i.nodeName&&"defs"!=i.nodeName&&"sodipodi:namedview"!=i.nodeName&&"#comment"!=i.nodeName&&("image"==i.nodeName&&r.push(i),"g"==i.nodeName&&e.getImages(i,r))}return r}},{key:"getImageDataURL",value:function(t,r){var n="";switch(e.getExtension(t)){case"svg":n="data:image/svg+xml;base64,";break;case"png":n="data:image/png;base64,"}return n+r}},{key:"getObject",value:function(t,r){t.indexOf("/")>-1?e.requestFromServer(t,(function(e){r(e)})):e.getObjectinDB("projects",t,r)}},{key:"getObjectinDB",value:function(e,t,r){var n={};n.stmt="select * from "+e+" where id = ?",n.values=[t],zr.query(n,r)}},{key:"setMedia",value:function(e,t,r){zr.setmedia(btoa(e),t,r)}},{key:"query",value:function(e,t,r){var n={};n.stmt="select "+t.items+" from "+e+" where "+t.cond+(t.order?" order by "+t.order:""),n.values=t.values,zr.query(n,r)}},{key:"deleteobject",value:function(e,t,r){var n={};n.stmt="delete from "+e+" where id = ?",n.values=[t],zr.stmt(n,r)}},{key:"createProject",value:function(e,t){var r={},n=["name","version","deleted","ctime","mtime","isGift","userid","projectid"],i="?,?,?,?,?,?,?,?",a=e.ctime?e.ctime:(new Date).getTime().toString(),o=e.mtime?e.mtime:(new Date).getTime().toString(),s=e.isgift?e.isgift:"0",l=e.userid?e.userid:"",c=e.projectid?e.projectid:"";function u(e,t){n.push(e),i+=",?",r.values.push(t)}r.values=[e.name,e.version,"NO",a,o,s,l,c],e.json&&u("json",JSON.stringify(e.json)),e.thumbnail&&u("thumbnail",JSON.stringify(e.thumbnail)),r.stmt="insert into projects ("+n.toString()+") values ("+i+")",zr.stmt(r,t)}},{key:"saveProject",value:function(e,t){var r={};r.values=[e.version,e.deleted,e.name,JSON.stringify(e.json),JSON.stringify(e.thumbnail),e.mtime,e.userid,e.projectid],r.stmt="update projects set "+["version = ?","deleted = ?","name = ?","json = ?","thumbnail = ?","mtime = ?","userid = ?","projectid = ?"].toString()+" where id = "+e.id,zr.stmt(r,t)}},{key:"setProjectIsGift",value:function(e,t){t&&t()}},{key:"getExtension",value:function(e){return e.substring(e.indexOf(".")+1,e.length)}},{key:"getFilename",value:function(e){return e.substring(0,e.indexOf("."))}},{key:"parseProjectData",value:function(e){var t=new Object;for(var r in e)t[r.toLowerCase()]=e[r];return t}},{key:"zipProject",value:function(t,r){e.getObject(t,(function(t){var n={thumbnails:[],characters:[],backgrounds:[],sounds:[]},i=e.parseProjectData(JSON.parse(t)[0]);"string"==typeof i.json&&(i.json=JSON.parse(i.json)),"string"==typeof i.thumbnail&&(i.thumbnail=JSON.parse(i.thumbnail));var a=function(e,t){t&&void 0!==t&&t.indexOf("samples/")<0&&t&&void 0!==t&&!me.keys[t]&&me.sounds.indexOf(t)<0&&n[e].indexOf(t)<0&&n[e].push(t)};a("thumbnails",i.thumbnail.md5);for(var o=i.json,s=0;s<o.pages.length;s++){var l=o[o.pages[s]];a("backgrounds",l.md5);for(var c=0;c<l.sprites.length;c++){var u=l[l.sprites[c]];if("sprite"==u.type){a("characters",u.md5);for(var d=0;d<u.sounds.length;d++)a("sounds",u.sounds[d])}}}(Vr=new Ur.a).folder("project");var h=JSON.stringify(i);Vr.file("project/data.json",h,{}),Gr=0,Kr=0;for(var f=function(t,r){var n=function(e){Vr.file("project/"+t+"/"+r,e,{base64:!0,createFolders:!0}),Kr++};r in me.keys?e.requestFromServer(me.path+r,(function(e){n(btoa(e))})):zr.getmedia(r,n)},g=0;g<n.thumbnails.length;g++)f("thumbnails",n.thumbnails[g]),Gr++;for(var p=0;p<n.characters.length;p++)f("characters",n.characters[p]),Gr++;for(var v=0;v<n.backgrounds.length;v++)f("backgrounds",n.backgrounds[v]),Gr++;for(var m=0;m<n.sounds.length;m++)f("sounds",n.sounds[m]),Gr++;Zr=(Zr=i.name.replace(/\s*/g,"")).replace(/[\/\?<>\\:\*\|":]/g,"_").replace(/[\x00-\x1f\x80-\x9f]/g,"_").replace(/^\.+$/,"_").replace(/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,"_").replace(/[\. ]+$/,"_"),Xr=i.name,function e(){Kr/Gr==1?r(Vr.generate({compression:"STORE"})):setTimeout(e,200)}()}))}},{key:"uniqueProjectName",value:function(t,r,n){var i=function(e){var t=e.split(" "),r=t.pop();return isNaN(r)?{name:e,number:null}:{name:t.join(" "),number:parseInt(r)}},a=i(t.name),o={cond:"deleted = ? AND gallery IS NULL",items:["name"],values:["NO"]};e.query(zr.database,o,(function(o){var s=null;o=JSON.parse(o);for(var l=0;l<o.length;l++){var c=e.parseProjectData(o[l]).name,u=i(c);a.name==u.name&&(s=null!=u.number?u.number+1:2)}null!=s&&(!a.number||s>a.number)?t.name=a.name+" "+s:n&&(t.name=a.name+" 1"),r(t)}))}},{key:"loadProjectFromSjr",value:function(t,r,n,i){var a=Ur()();a.load(t,{base64:!0});var o={};a.filter((function(t,a){if(a.dir)return!1;if("data.json"===t.split("/").pop()){var s=JSON.parse(a.asText());if((parseInt(s.version.replace("iOSv",""))||0)>1)throw new Error("Project created in a new version of ScratchJr. Please upgrade ScratchJr.");n&&(s.id=n.id),i&&(s.projectid=i.id,s.userid=i.userId),"create"===r?e.createProject(s,(function(){})):e.saveProject(s,(function(){}));for(var l=s.json,c=0;c<l.pages.length;c++)for(var u=l[l.pages[c]],d=0;d<u.sprites.length;d++){var h=u[u.sprites[d]];"sprite"===h.type&&(o[h.md5]=unescape(h.name).replace(/[0-9]/g,"").replace(/\s*/g,""))}}})),a.filter((function(t,r){if(r.dir)return!1;var n=t.split("/")[1],i=t.split("/").pop(),a=i.split(".")[0],s=i.split(".").pop();if(!a||!s)return!1;if(i in me.keys)return!1;var l=r.asBinary(),c=btoa(l);"thumbnails"===n||"sounds"===n?zr.setmedianame(c,a,s,(function(){})):"characters"===n?zr.setmedianame(c,a,s,(function(){var t=(new DOMParser).parseFromString(l,"text/xml"),r=t.getElementsByTagName("svg")[0].width.baseVal.value,n=t.getElementsByTagName("svg")[0].height.baseVal.value,a="0.5";e.getImagesInSVG(l,(function(){var t=e.getThumbnail(l,r,n,120,90).split(",")[1],s=o[i];zr.setmedia(t,"png",(function(t){var o={cond:"ext = ? AND md5 = ? AND altmd5 = ? AND name = ? AND scale = ? AND width = ? AND height = ?",items:["*"]};o.values=["svg",i,t,s,a,r.toString(),n.toString()],o.order="ctime desc",e.query("usershapes",o,(function(e){if(0===(e=JSON.parse(e)).length){var o={};o.values=[a,i,t,"iOSv01",r.toString(),n.toString(),"svg",s],o.stmt="insert into usershapes ("+["scale","md5","altmd5","version","width","height","ext","name"].toString()+") values (?,?,?,?,?,?,?,?)",zr.stmt(o,(function(){}))}}))}))}))})):"backgrounds"===n&&zr.setmedianame(c,a,s,(function(){e.getImagesInSVG(l,(function(){var t=e.getThumbnail(l,480,360,120,90).split(",")[1];zr.setmedia(t,"png",(function(t){var r={cond:"ext = ? AND md5 = ? AND altmd5 = ?",items:["*"]};r.values=["svg",i,t],r.order="ctime desc",e.query("userbkgs",r,(function(e){if(0===(e=JSON.parse(e)).length){var r={};r.values=[i,t,"iOSv01","480","360","svg"],r.stmt="insert into userbkgs ("+["md5","altmd5","version","width","height","ext"].toString()+") values (?,?,?,?,?,?)",zr.stmt(r,(function(){}))}}))}))}))}))}))}},{key:"zipFileName",get:function(){return Zr}},{key:"shareName",get:function(){return Xr}}],(r=null)&&Wr(t.prototype,r),n&&Wr(t,n),e}();function Jr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $r=0,Qr={},en=["#c4281b","#da8540","#ffdd33","#287f46","#0d50ab","#ff8ae9","#8f56e3","#f2f3f2","#6d6e6c","#1b2a34"],tn=[16,24,36,48,56,72],rn=["LetterGet_Orange","LetterGet_Red","LetterGet_Yellow","LetterGet_Green","LetterGet_Blue","LetterGet_Purple"],nn=["LetterSend_Orange","LetterSend_Red","LetterSend_Yellow","LetterSend_Green","LetterSend_Blue","LetterSend_Purple"],an=["speed0","speed1","speed2"],on=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"initBlocks",value:function(){Qr=new Object,e.loadGraphics(),e.defs=e.setupBlocksSpecs(),e.palettes=e.setupPalettesDef(),e.categories=e.setupCategories(),"PBS"==window.Settings.edition?e.canvasMask=e.getImageFrom("/static/scratchjr/assets/ui/canvasmask","svg"):e.canvasMask=e.getImageFrom("/static/scratchjr/assets/ui/canvasmask"),"PBS"!=window.Settings.edition&&(e.projectThumb=e.getImageFrom("/static/scratchjr/assets/lobby/pmask")),Yr.requestFromServer("/static/scratchjr/assets/balloon.svg",e.setBalloon),$r++}},{key:"setBalloon",value:function(t){$r--,e.balloon=t}},{key:"loadGraphics",value:function(){e.mic=e.getImageFrom("/static/scratchjr/assets/ui/recordslot","svg"),e.yellowStart=e.getImageFrom("/static/scratchjr/assets/blocks/start","svg"),e.yellowStartH=e.getImageFrom("/static/scratchjr/assets/blocks/eh/startH"),e.yellowCmd=e.getImageFrom("/static/scratchjr/assets/blocks/yellowCmd","svg"),e.yellowCmdH=e.getImageFrom("/static/scratchjr/assets/blocks/eh/yellowCmdH"),e.redEnd=e.getImageFrom("/static/scratchjr/assets/blocks/endshort","svg"),e.redEndH=e.getImageFrom("/static/scratchjr/assets/blocks/eh/stopH"),e.orangeCmd=e.getImageFrom("/static/scratchjr/assets/blocks/flow","svg"),e.orangeCmdH=e.getImageFrom("/static/scratchjr/assets/blocks/eh/flowH"),e.limeCmd=e.getImageFrom("/static/scratchjr/assets/blocks/sounds","svg"),e.limeCmdH=e.getImageFrom("/static/scratchjr/assets/blocks/eh/soundsH"),e.pinkCmd=e.getImageFrom("/static/scratchjr/assets/blocks/looks","svg"),e.pinkCmdH=e.getImageFrom("/static/scratchjr/assets/blocks/eh/looksH"),e.redEndLong=e.getImageFrom("/static/scratchjr/assets/blocks/endlong","svg"),e.redEndLongH=e.getImageFrom("/static/scratchjr/assets/blocks/eh/stoplongH"),e.cShape=e.getImageFrom("/static/scratchjr/assets/blocks/repeat"),e.cShapeH=e.getImageFrom("/static/scratchjr/assets/blocks/eh/repeatH"),e.blueCmd=e.getImageFrom("/static/scratchjr/assets/blocks/blueCmd","svg"),e.blueCmdH=e.getImageFrom("/static/scratchjr/assets/blocks/eh/blueCmdH"),e.textfieldimg=e.getImageFrom("/static/scratchjr/assets/misc/Text-01"),e.numfieldimg=e.getImageFrom("/static/scratchjr/assets/misc/Number-01"),e.pressbutton=e.getImageFrom("/static/scratchjr/assets/misc/pushbutton-01","svg"),e.pressbuttonSmall=e.getImageFrom("/static/scratchjr/assets/misc/pushbutton","svg"),e.caretrepeat=e.getImageFrom("/static/scratchjr/assets/blocks/caretrepeat"),e.cmdS=e.getImageFrom("/static/scratchjr/assets/blocks/shadowCmd","svg"),e.startS=e.getImageFrom("/static/scratchjr/assets/blocks/shadowStart","svg"),e.endS=e.getImageFrom("/static/scratchjr/assets/blocks/shadowEndShort","svg"),e.endLongS=e.getImageFrom("/static/scratchjr/assets/blocks/shadowEndLong","svg"),e.repeatS=e.getImageFrom("/static/scratchjr/assets/blocks/shadowRepeat")}},{key:"getImageFrom",value:function(e,t){var r=document.createElement("img");return r.src=e+(t?"."+t:".png"),r.complete||(Qr[r.src]=r,$r++,r.onload=function(){delete Qr[r.src],$r--}),r}},{key:"refreshLoading",value:function(){for(var e in Qr)Qr[e].complete&&$r--}},{key:"setupCategories",value:function(){return new Array([e.getImageFrom("/static/scratchjr/assets/categories/StartOn","svg"),e.getImageFrom("/static/scratchjr/assets/categories/StartOff","svg"),window.Settings.categoryStartColor],[e.getImageFrom("/static/scratchjr/assets/categories/MotionOn","svg"),e.getImageFrom("/static/scratchjr/assets/categories/MotionOff","svg"),window.Settings.categoryMotionColor],[e.getImageFrom("/static/scratchjr/assets/categories/LooksOn","svg"),e.getImageFrom("/static/scratchjr/assets/categories/LooksOff","svg"),window.Settings.categoryLooksColor],[e.getImageFrom("/static/scratchjr/assets/categories/SoundOn","svg"),e.getImageFrom("/static/scratchjr/assets/categories/SoundOff","svg"),window.Settings.categorySoundColor],[e.getImageFrom("/static/scratchjr/assets/categories/FlowOn","svg"),e.getImageFrom("/static/scratchjr/assets/categories/FlowOff","svg"),window.Settings.categoryFlowColor],[e.getImageFrom("/static/scratchjr/assets/categories/StopOn","svg"),e.getImageFrom("/static/scratchjr/assets/categories/StopOff","svg"),window.Settings.categoryStopColor])}},{key:"setupPalettesDef",value:function(){return[["onflag","onclick","ontouch","onmessage","message"],["forward","back","up","down","right","left","hop","home"],["say","space","grow","shrink","same","space","hide","show"],[],["wait","stopmine","setspeed","repeat"],["endstack","forever"]]}},{key:"setupBlocksSpecs",value:function(){return{onflag:["onflag",e.getImageFrom("/static/scratchjr/assets/blockicons/greenFlag","svg"),e.yellowStart,null,null,e.yellowStartH,null,null,e.startS],onmessage:["onmessage",rn,e.yellowStart,"m","Orange",e.yellowStartH,null,null,e.startS],onclick:["onclick",e.getImageFrom("/static/scratchjr/assets/blockicons/OnTouch","svg"),e.yellowStart,null,null,e.yellowStartH,null,null,e.startS],ontouch:["ontouch",e.getImageFrom("/static/scratchjr/assets/blockicons/Bump","svg"),e.yellowStart,null,null,e.yellowStartH,null,null,e.startS],message:["message",nn,e.yellowCmd,"m","Orange",e.yellowCmdH,null,null,e.cmdS],repeat:["repeat",e.getImageFrom("/static/scratchjr/assets/blockicons/Repeat","svg"),e.cShape,"n",4,e.cShapeH,0,24,e.repeatS],forward:["forward",e.getImageFrom("/static/scratchjr/assets/blockicons/Foward","svg"),e.blueCmd,"n",1,e.blueCmdH,-20,20,e.cmdS],back:["back",e.getImageFrom("/static/scratchjr/assets/blockicons/Back","svg"),e.blueCmd,"n",1,e.blueCmdH,-20,20,e.cmdS],up:["up",e.getImageFrom("/static/scratchjr/assets/blockicons/Up","svg"),e.blueCmd,"n",1,e.blueCmdH,-15,15,e.cmdS],down:["down",e.getImageFrom("/static/scratchjr/assets/blockicons/Down","svg"),e.blueCmd,"n",1,e.blueCmdH,-15,15,e.cmdS],right:["right",e.getImageFrom("/static/scratchjr/assets/blockicons/Right","svg"),e.blueCmd,"n",1,e.blueCmdH,-12,12,e.cmdS],left:["left",e.getImageFrom("/static/scratchjr/assets/blockicons/Left","svg"),e.blueCmd,"n",1,e.blueCmdH,-12,12,e.cmdS],home:["home",e.getImageFrom("/static/scratchjr/assets/blockicons/Home","svg"),e.blueCmd,null,null,e.blueCmdH,null,null,e.cmdS],hop:["hop",e.getImageFrom("/static/scratchjr/assets/blockicons/Hop","svg"),e.blueCmd,"n",2,e.blueCmdH,-15,15,e.cmdS],wait:["wait",e.getImageFrom("/static/scratchjr/assets/blockicons/Wait","svg"),e.orangeCmd,"n",10,e.orangeCmdH,0,50,e.cmdS],setspeed:["setspeed",an,e.orangeCmd,"d",1,e.orangeCmdH,null,null,e.cmdS],stopmine:["stopmine",e.getImageFrom("/static/scratchjr/assets/blockicons/Stop","svg"),e.orangeCmd,null,null,e.orangeCmdH,null,null,e.cmdS],say:["say",e.getImageFrom("/static/scratchjr/assets/blockicons/Say","svg"),e.pinkCmd,"t",o.localize("SAY_BLOCK_DEFAULT_ARGUMENT"),e.pinkCmdH,null,null,e.cmdS],show:["show",e.getImageFrom("/static/scratchjr/assets/blockicons/Appear","svg"),e.pinkCmd,null,null,e.pinkCmdH,null,null,e.cmdS],hide:["hide",e.getImageFrom("/static/scratchjr/assets/blockicons/Disappear","svg"),e.pinkCmd,null,null,e.pinkCmdH,null,null,e.cmdS],grow:["grow",e.getImageFrom("/static/scratchjr/assets/blockicons/Grow","svg"),e.pinkCmd,"n",2,e.pinkCmdH,-10,10,e.cmdS],shrink:["shrink",e.getImageFrom("/static/scratchjr/assets/blockicons/Shrink","svg"),e.pinkCmd,"n",2,e.pinkCmdH,-10,10,e.cmdS],same:["same",e.getImageFrom("/static/scratchjr/assets/blockicons/Reset","svg"),e.pinkCmd,null,null,e.pinkCmdH,null,null,e.cmdS],playsnd:["playsnd",e.getImageFrom("/static/scratchjr/assets/blockicons/Speaker","svg"),e.limeCmd,"s","pop.mp3",e.limeCmdH,null,null,e.cmdS],playusersnd:["playusersnd",e.getImageFrom("/static/scratchjr/assets/blockicons/Microphone","svg"),e.limeCmd,"r","1",e.limeCmdH,null,null,e.cmdS],endstack:["endstack",null,e.redEnd,null,null,e.redEndH,null,null,e.endS],forever:["forever",e.getImageFrom("/static/scratchjr/assets/blockicons/Forever","svg"),e.redEnd,null,null,e.redEndH,null,null,e.endS],gotopage:["gotopage",null,e.redEndLong,"p","2",e.redEndLongH,null,null,e.endLongS],caretstart:["caretstart",null,e.getImageFrom("/static/scratchjr/assets/blocks/caretstart","svg"),null,null,null,null,null],caretend:["caretend",null,e.getImageFrom("/static/scratchjr/assets/blocks/caretend","svg"),null,null,null,null,null],caretrepeat:["caretrepeat",null,e.getImageFrom("/static/scratchjr/assets/blocks/caretrepeat"),null,null,null,null,null],caretcmd:["caretcmd",null,e.getImageFrom("/static/scratchjr/assets/blocks/caretcmd","svg"),null,null,null,null,null]}}},{key:"blockDesc",value:function(e,t){var r=e.getArgValue()?e.getArgValue().toString():"playsnd"==e.blocktype?"SOUND":"";return{onflag:o.localize("BLOCK_DESC_GREEN_FLAG"),onclick:o.localize("BLOCK_DESC_ON_TAP",{CHARACTER_NAME:t.name}),ontouch:o.localize("BLOCK_DESC_ON_BUMP",{CHARACTER_NAME:t.name?t.name:""}),onmessage:o.localize("BLOCK_DESC_ON_MESSAGE",{COLOR:o.localize("BLOCK_DESC_MESSAGE_COLOR_ORANGE")}),repeat:o.localize("BLOCK_DESC_REPEAT"),forward:o.localize("BLOCK_DESC_MOVE_RIGHT"),back:o.localize("BLOCK_DESC_MOVE_LEFT"),up:o.localize("BLOCK_DESC_MOVE_UP"),down:o.localize("BLOCK_DESC_MOVE_DOWN"),home:o.localize("BLOCK_DESC_GO_HOME"),left:o.localize("BLOCK_DESC_TURN_LEFT"),right:o.localize("BLOCK_DESC_TURN_RIGHT"),hop:o.localize("BLOCK_DESC_HOP"),wait:o.localize("BLOCK_DESC_WAIT"),setspeed:o.localize("BLOCK_DESC_SET_SPEED"),stopmine:o.localize("BLOCK_DESC_STOP",{CHARACTER_NAME:t.name?t.name:t.str}),say:o.localize("BLOCK_DESC_SAY"),show:o.localize("BLOCK_DESC_SHOW"),hide:o.localize("BLOCK_DESC_HIDE"),grow:o.localize("BLOCK_DESC_GROW"),shrink:o.localize("BLOCK_DESC_SHRINK"),same:o.localize("BLOCK_DESC_RESET_SIZE"),playsnd:o.localize("BLOCK_DESC_PLAY_SOUND",{SOUND_NAME:o.localize("BLOCK_DESC_PLAY_SOUND_POP")}),playusersnd:o.localize("BLOCK_DESC_PLAY_RECORDED_SOUND"),endstack:o.localize("BLOCK_DESC_END"),stopall:o.localize("BLOCK_DESC_STOP",{CHARACTER_NAME:t.name?t.name:""}),forever:o.localize("BLOCK_DESC_REPEAT_FOREVER"),gotopage:o.localize("BLOCK_DESC_GO_TO_PAGE",{PAGE:r}),message:o.localize("BLOCK_DESC_SEND_MESSAGE",{COLOR:o.localize("BLOCK_DESC_MESSAGE_COLOR_ORANGE")})}}},{key:"loadCount",get:function(){return $r},set:function(e){$r=e}},{key:"fontcolors",get:function(){return en}},{key:"fontsizes",get:function(){return tn}},{key:"speeds",get:function(){return an}}],(r=null)&&Jr(t.prototype,r),n&&Jr(t,n),e}();function sn(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,i)}function ln(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var cn,un=void 0,dn=-1,hn=!1,fn=void 0,gn=void 0,pn=!1,vn=1,mn={},bn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n,i,a;return t=e,r=null,n=[{key:"clear",value:function(){Kn.stage.clear(),Xt.clear()}},{key:"load",value:function(t,r){vn=1,mn=t.files,on.loadCount>0?setTimeout((function(){e.delayLoad(t,r)}),32):e.startLoad(t,r)}},{key:"delayLoad",value:function(t,r){on.loadCount<1?e.startLoad(t,r):setTimeout((function(){e.delayLoad(t,r)}),32)}},{key:"startLoad",value:(i=regeneratorRuntime.mark((function t(r,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Xt.layout(),e.dataRecieved(r,n);case 2:case"end":return t.stop()}}),t)})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=i.apply(e,t);function o(e){sn(a,r,n,o,s,"next",e)}function s(e){sn(a,r,n,o,s,"throw",e)}o(void 0)}))},function(e,t){return a.apply(this,arguments)})},{key:"dataRecieved",value:function(t,r){function n(){Sr.selectCategory(1),setTimeout((function(){Sr.selectCategory(1)}),100),Vt.layout(),e.liftCurtain(),Kn.stage.currentPage.update(),Kn.changed=!1,Kn.storyStarted=!1,r()}dn=-1,(un=t).json?e.loadData(t,n):(dn=0,new nr(Object(s.l)("page")),Sr.selectCategory(1),setTimeout((function(){Sr.selectCategory(1)}),100),e.loadwait(n))}},{key:"init",value:function(){Kn.log("Project init",Kn.getTime(),"sec"),Object(s.B)("div","modal-backdrop fade",s.h.parentNode).setAttribute("id","backdrop"),Object(s.K)(Object(s.q)("backdrop").style,{display:"none"});var t=Object(s.B)("div","modal-outer",s.h.parentNode),r=Object(s.B)("div","modal-middle",t),n=Object(s.B)("div","modal hide fade",r);n.setAttribute("id","modaldialog"),Object(s.K)(Object(s.q)("modaldialog").style,{});var i=Object(s.B)("div","modal-body",n);i.setAttribute("id","modalbody"),Object(s.K)(i.style,{zoom:s.H}),e.drawBlind()}},{key:"setProgress",value:function(e){if(Object(s.q)("progressbar")){var t=66-Math.round(66*e/100);Kn.log("setProgress",e,t,dn,vn),Object(s.q)("progressbar").style.height=t+"px",0==t&&(Object(s.q)("progressbar2").style.height="0px",Object(s.q)("topcover").style.background="#F9A737")}}},{key:"drawBlind",value:function(){Object(s.q)("backdrop").setAttribute("class","modal-backdrop fade in"),Object(s.K)(Object(s.q)("backdrop").style,{display:"block"}),Object(s.K)(Object(s.q)("modaldialog").style,{display:"block"}),Object(s.q)("modaldialog").setAttribute("class","modal fade in")}},{key:"loadwait",value:function(t){null!=fn&&window.clearInterval(fn),vn=dn,dn<=0?e.getStarted(t):fn=window.setInterval((function(){e.loadTask(t)}),32)}},{key:"loadTask",value:function(t){dn<=0&&e.getStarted(t)}},{key:"getMediaLoadRatio",value:function(e){return dn>vn&&(vn=dn),20+e-dn/vn*e}},{key:"getStarted",value:function(t){fn&&window.clearInterval(fn),fn=null,Kn.log("Project images retrieved from server",Kn.getTime(),"sec"),e.setLoadPage(cn,t),Kn.log("load done",Kn.getTime(),"sec","-- media missing = ",dn),Kn.stage.resetPages(),Kn.runtime.beginTimer()}},{key:"liftCurtain",value:function(){Object(s.q)("backdrop").setAttribute("class","modal-backdrop fade"),Object(s.K)(Object(s.q)("backdrop").style,{display:"none"}),Object(s.q)("modaldialog").setAttribute("class","modal fade"),Object(s.K)(Object(s.q)("modaldialog").style,{display:"none"})}},{key:"setLoadPage",value:function(e,t){Kn.log("setLoadPage",Kn.getTime(),"sec"),Kn.stage.getPagesID().indexOf(e)<0?Kn.stage.currentPage=Kn.stage.pages[0]:Kn.stage.currentPage=Kn.stage.getPage(e),Kn.stage.currentPage.div.style.visibility="visible";for(var r=Kn.stage.pages,n=0;n<r.length;n++)Kn.stage.currentPage==r[n]?Kn.stage.currentPage.setPageSprites("visible"):r[n].setPageSprites("hidden");t&&t()}},{key:"loadData",value:function(t,r){dn=0,e.loadme(t,r),pn=!1}},{key:"loadme",value:function(t,r){e.recreate(t),e.loadwait(r)}},{key:"getLoadType",value:function(e,t,r){return null!=e?"bkg":r?t&&r?"modify":"add":"none"}},{key:"recreate",value:function(t){var r=t.json.json;dn=0,Kn.stage.pages=[];var n=r.pages;cn=r.currentPage;for(var i=0;i<n.length;i++)e.recreatePage(n[i],r[n[i]]);vn=dn}},{key:"recreatePage",value:function(e,t,r){new nr(e,t,r).div.style.visibility="hidden"}},{key:"substractCount",value:function(){dn--,Object(s.q)("backdrop").className}},{key:"recreateObject",value:function(e,t,r,n,i){var a,o=r.scripts;if(r.page=e,"sprite"==r.type){dn++,r.defaultScale||(r.defaultScale=.5),a=new Qt(r,(function(e){e.setPos(r.xcoor,r.ycoor),dn--,n&&n(e)}));for(var l=Object(s.q)(t+"_scripts").owner,c=0;c<o.length;c++)l.recreateStrip(o[c]);i?l.activate():l.deactivate()}else a=new Qt(r,n);return a.div.style.opacity=a.shown?1:0,a}},{key:"prepareToSave",value:function(t,r){hn?(v.open(s.h,Object(s.q)("flip"),"Waiting","#28A5DA"),e.waitUntilSaved(t,r)):(v.open(s.h,Object(s.q)("flip"),"Saving","#28A5DA"),e.save(t,r))}},{key:"saveLocalPromise",value:function(t){return new Promise((function(r,n){hn?(v.open(s.h,Object(s.q)("flip"),"Waiting","#28A5DA"),e.waitUntilSaved(t,r)):(v.open(s.h,Object(s.q)("flip"),"Saving","#28A5DA"),e.save(t,r))}))}},{key:"waitUntilSaved",value:function(t,r){hn?setTimeout((function(){e.waitUntilSaved(t,r)}),500):e.save(t,r)}},{key:"thumbnailUnique",value:function(e,t,r){r&&r()}},{key:"save",value:function(t,r){hn=!0;var n=un.thumbnail;if(n&&"storyStarter"!=Kn.editmode){var i="string"==typeof n?JSON.parse(n):n;i.md5.indexOf("samples/")<0&&e.thumbnailUnique(i.md5,t,(function(e){e&&zr.remove(i.md5,zr.trace)}))}function a(e){un.thumbnail={pagecount:Kn.stage.pages.length,md5:e},un.mtime=(new Date).getTime().toString(),Yr.saveProject(un,o)}function o(){hn=!1,r&&r(JSON.parse(JSON.stringify(un)))}un.projectid=Kn.projectId?Kn.projectId:"",un.id=t,un.json=e.getProject(Kn.stage.pages[0].id),e.getThumbnailPNG(Kn.stage.pages[0],192,144,(function(e){var t=e.split(",")[1];zr.getmd5(t,(function(e){!function(e,t){var r=Kn.currentProject+"_"+e;zr.setmedianame(t,r,"png",a)}(e,t)}))}))}},{key:"getProject",value:function(e){var t={};t.pages=Kn.stage.getPagesID(),t.currentPage=e;for(var r=0;r<Kn.stage.pages.length;r++)t[Kn.stage.pages[r].id]=Kn.stage.pages[r].encodePage();return t}},{key:"getUndo",value:function(){return e.getProject(Kn.stage.currentPage.id)}},{key:"encodeSprite",value:function(e){return Object(s.q)(e).owner.getData()}},{key:"encodeStrip",value:function(t){for(var r=[],n=["playsnd","gotopage","playusersnd","setcolor","onmessage","message","setspeed"],i=["repeat"],a=["caretcmd","caretend","caretstart"];null!=t;){var o=t.blocktype;if(a.indexOf(o)>-1)t=t.next;else{"caretrepeat"==o&&(o="repeat");var s=null!=t.arg||n.indexOf(o)>-1?t.getArgValue():null;s||0==s||(s="null");var l=[o,s,t.div.left/t.scale,t.div.top/t.scale];if(i.indexOf(o)>-1){var c=e.encodeStrip(t.inside);l.push(c)}r.push(l),t=t.next}}return r}},{key:"getThumbnailPNG",value:function(t,r,n,i){var a=r/480;Kn.stage.pages.length;var o=document.createElement("canvas");Object(s.I)(o,r,n);var l=o.getContext("2d"),c=t.md5;if(l.fillStyle=window.Settings.stageColor,l.fillRect(0,0,r,n),c){var u;if("png"==c.substr(c.length-3)){var d=t.div.firstElementChild.firstElementChild;u=e.drawPNGInCanvas(d,480,360)}else u=e.drawSVGinCanvas(t.svg,480,360);l.drawImage(u,0,0,480,360,0,0,r,n),e.drawSprites(t,a,o,r,n,i)}else e.drawSprites(t,a,o,r,n,i)}},{key:"drawPNGInCanvas",value:function(e,t,r){var n=document.createElement("canvas");return Object(s.I)(n,t,r),n.getContext("2d").drawImage(e,0,0,t,r),n}},{key:"drawSVGinCanvas",value:function(e,t,r){var n=document.createElement("canvas");Object(s.I)(n,t,r);for(var i=n.getContext("2d"),a=0;a<e.childElementCount;a++)dt.drawLayer(e.childNodes[a],i,dt.drawLayer);return n}},{key:"maskBorders",value:function(e,t,r){e.save(),e.globalCompositeOperation="destination-in","PBS"!=window.Settings.edition&&e.drawImage(on.projectThumb,0,0,t,r),e.restore()}},{key:"drawSprites",value:function(t,r,n,i,a,o){function s(r){if(r<t.div.childElementCount){var l=t.div.childNodes[r].owner;l&&l.shown?function(e,t,r,n,i,a){s(a+1)}(0,0,l.outline,0,0,r):s(r+1)}else e.maskBorders(n.getContext("2d"),i,a),o(n.toDataURL("image/png"))}n.getContext("2d"),s(1)}},{key:"metadata",get:function(){return un},set:function(e){un=e}},{key:"mediaCount",get:function(){return dn},set:function(e){dn=e}},{key:"loadIcon",set:function(e){gn=e},get:function(){return gn}},{key:"error",get:function(){return pn}},{key:"files",get:function(){return mn},set:function(e){mn=e}}],r&&ln(t.prototype,r),n&&ln(t,n),e}();function yn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var kn=[-48,-30,-22,-14,-6,0,6,14,22,30,48],wn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"init",value:function(){e.table={},e.table.done=e.Done,e.table.missing=e.Ignore,e.table.onflag=e.Ignore,e.table.onmessage=e.Ignore,e.table.onclick=e.Ignore,e.table.ontouch=e.OnTouch,e.table.onchat=e.Ignore,e.table.repeat=e.Repeat,e.table.forward=e.Forward,e.table.back=e.Back,e.table.up=e.Up,e.table.down=e.Down,e.table.left=e.Left,e.table.right=e.Right,e.table.home=e.Home,e.table.setspeed=e.SetSpeed,e.table.message=e.Message,e.table.setcolor=e.SetColor,e.table.bigger=e.Bigger,e.table.smaller=e.Smaller,e.table.wait=e.Wait,e.table.caretcmd=e.Ignore,e.table.caretstart=e.Ignore,e.table.caretend=e.Ignore,e.table.caretrepeat=e.Ignore,e.table.gotopage=e.GotoPage,e.table.endstack=e.DoNextBlock,e.table.stopall=e.StopAll,e.table.stopmine=e.StopMine,e.table.forever=e.Forever,e.table.hop=e.Hop,e.table.show=e.Show,e.table.hide=e.Hide,e.table.playsnd=e.playSound,e.table.playusersnd=e.playSound,e.table.grow=e.Grow,e.table.shrink=e.Shrink,e.table.same=e.Same,e.table.say=e.Say}},{key:"Done",value:function(e){null!=e.oldblock&&e.oldblock.unhighlight(),e.oldblock=null,e.isRunning=!1}},{key:"setTime",value:function(e){e.time=new Date-0}},{key:"showTime",value:function(){}},{key:"DoNextBlock",value:function(e){e.waitTimer=10,e.thisblock=e.thisblock.next}},{key:"StopAll",value:function(){Kn.stopStrips()}},{key:"StopMine",value:function(e){for(var t=e.spr,r=0;r<Kn.runtime.threadsRunning.length;r++)Kn.runtime.threadsRunning[r].spr==t&&Kn.runtime.threadsRunning[r].thisblock!=e.thisblock&&Kn.runtime.threadsRunning[r].stop(!0);e.thisblock=e.thisblock.next,Kn.runtime.yield=!0}},{key:"playSound",value:function(e){var t=e.thisblock.getSoundName(e.spr.sounds);if(!e.audio){var r=x.projectSounds[t];if(!r)return void(e.thisblock=e.thisblock.next);e.audio=r,r.play()}e.audio&&e.audio.done()&&(e.audio.clear(),e.thisblock=e.thisblock.next,e.audio=void 0),e.waitTimer=4}},{key:"Say",value:function(t){var r=t.thisblock,n=t.spr,i=r.getArgValue();if(t.count<0)t.count=Math.max(30,30*Math.round(i.length/8)),n.openBalloon(i),e.setTime(t);else{var a=t.count;--a<0?(t.count=-1,n.closeBalloon(),e.showTime(t),t.thisblock=t.thisblock.next):(t.waitTimer=1,t.count=a)}}},{key:"GotoPage",value:function(t){var r=t.thisblock,n=Number(r.getArgValue());if(t.count<0)t.count=2,e.setTime(t);else{var i=t.count;--i<0?(t.count=-1,e.showTime(t),Kn.stage.gotoPage(n)):(t.waitTimer=1,t.count=i)}}},{key:"Forever",value:function(e){e.thisblock=e.firstBlock.aStart?e.firstBlock.next:e.firstBlock,Kn.runtime.yield=!0}},{key:"Repeat",value:function(e){var t=e.thisblock,r=Number(t.getArgValue());r<1&&(r=1),t.repeatCounter<0&&(t.repeatCounter=r),0==t.repeatCounter?(t.repeatCounter=-1,e.thisblock=e.thisblock.next,e.waitTimer=1):(e.stack.push(e.thisblock),t.repeatCounter--,e.thisblock=e.thisblock.inside,Kn.runtime.yield=!0)}},{key:"Ignore",value:function(e){e.thisblock=e.thisblock.next}},{key:"Wait",value:function(t){var r=t.thisblock.getArgValue();t.waitTimer=Math.round(3.125*r),e.setTime(t),t.thisblock=t.thisblock.next}},{key:"Home",value:function(e){e.spr.goHome(),e.waitTimer=1,e.thisblock=e.thisblock.next}},{key:"SetSpeed",value:function(e){var t=e.spr,r=Number(e.thisblock.getArgValue());t.speed=Math.pow(2,r),e.waitTimer=1,e.thisblock=e.thisblock.next}},{key:"Hop",value:function(t){t.count<0&&(t.count=kn.length,e.setTime(t)),e.hopTo(t)}},{key:"hopTo",value:function(t){var r=t.spr,n=t.thisblock,i=Number(n.getArgValue()),a=t.count;if(--a<0)t.count=-1,t.vector={x:0,y:0},e.showTime(t),t.thisblock=t.thisblock.next;else{t.vector={x:0,y:kn[a]};var o=r.ycoor-t.vector.y/5*i;o<0&&(o=0),o>=360-Y.size&&(o=360-Y.size),r.setPos(r.xcoor+t.vector.x,o),t.waitTimer=1+Math.floor(Math.pow(2,2-Math.floor(r.speed/2))/2),t.count=a}}},{key:"Down",value:function(t){var r=24*Number(t.thisblock.getArgValue()),n=Math.abs(r);if(0==r)return t.thisblock=t.thisblock.next,t.waitTimer=1,t.distance=-1,void(t.vector={x:0,y:0});0==r?t.distance=0:t.distance<0&&(t.distance=n,t.vector={x:0,y:2},e.setTime(t)),e.moveAtSpeed(t)}},{key:"Up",value:function(t){var r=24*Number(t.thisblock.getArgValue()),n=Math.abs(r);if(0==r)return t.thisblock=t.thisblock.next,t.waitTimer=1,t.distance=-1,void(t.vector={x:0,y:0});t.distance<0&&(t.distance=n,t.vector={x:0,y:-2},e.setTime(t)),e.moveAtSpeed(t)}},{key:"Forward",value:function(t){var r=t.spr,n=24*Number(t.thisblock.getArgValue()),i=Math.abs(n);if(r.flip&&(r.flip=!1,r.render()),0==n)return t.thisblock=t.thisblock.next,t.waitTimer=1*Math.pow(2,2-Math.floor(r.speed/2)),t.vector={x:0,y:0},void(t.distance=-1);t.distance<0&&(t.distance=i,t.vector={x:2,y:0},e.setTime(t)),e.moveAtSpeed(t)}},{key:"Back",value:function(t){var r=t.spr,n=24*Number(t.thisblock.getArgValue()),i=Math.abs(n);if(r.flip||(r.flip=!0,r.render()),0==n)return t.thisblock=t.thisblock.next,t.vector={x:0,y:0},void(t.waitTimer=1*Math.pow(2,2-Math.floor(r.speed/2)));0==n?t.distance=0:t.distance<0&&(t.distance=i,t.vector={x:-2,y:0},e.setTime(t)),e.moveAtSpeed(t)}},{key:"moveAtSpeed",value:function(t){var r=t.spr,n=t.distance,i=12*Number(t.thisblock.getArgValue()),a=oe.scale(t.vector,r.speed*Math.abs(i)/i);(n-=Math.abs(oe.len(a)))<0?(a=oe.scale(t.vector,t.distance),r.setPos(r.xcoor+a.x,r.ycoor+a.y),t.distance=-1,t.vector={x:0,y:0},e.showTime(t),t.thisblock=t.thisblock.next):(r.setPos(r.xcoor+a.x,r.ycoor+a.y),t.waitTimer=1,t.distance=n)}},{key:"Right",value:function(t){var r=t.spr,n=30*Number(t.thisblock.getArgValue());t.count<0&&(t.count=Math.floor(Math.abs(n)/r.speed*.25),t.angleStep=4*r.speed*Math.abs(n)/n,t.finalAngle=r.angle+n,t.finalAngle=t.finalAngle%360,t.finalAngle<0&&(t.finalAngle+=360),t.finalAngle>360&&(t.finalAngle-=360),e.setTime(t)),e.turning(t)}},{key:"Left",value:function(t){var r=t.spr,n=30*Number(t.thisblock.getArgValue());t.count<0&&(t.count=Math.floor(Math.abs(n)/r.speed*.25),t.angleStep=4*-r.speed*Math.abs(n)/n,t.finalAngle=r.angle-n,t.finalAngle=t.finalAngle%360,t.finalAngle<0&&(t.finalAngle+=360),t.finalAngle>360&&(t.finalAngle-=360),e.setTime(t)),e.turning(t)}},{key:"turning",value:function(t){var r=t.spr,n=t.count;--n<0?(t.count=-1,r.setHeading(t.finalAngle),e.showTime(t),t.thisblock=t.thisblock.next):(r.setHeading(r.angle+t.angleStep),t.waitTimer=1,t.count=n)}},{key:"Same",value:function(t){var r=t.spr,n=(r.defaultScale-r.scale)/r.defaultScale*10;if(0==n)return t.waitTimer=1,t.thisblock=t.thisblock.next,t.count=-1,t.distance=-1,void(t.firstBlock.aStart||(r.homescale=r.defaultScale));t.count<0&&(t.distance=r.defaultScale*Math.abs(n)/n*r.speed,t.count=Math.floor(5*Math.floor(Math.abs(n))/r.speed),e.setTime(t),t.firstBlock.aStart||(r.homescale=r.defaultScale)),0==t.count?(t.count=-1,r.noScaleFor(),t.distance=-1,e.showTime(t),t.thisblock=t.thisblock.next):(r.changeSizeBy(2*t.distance),t.waitTimer=1,t.count=t.count-1)}},{key:"Grow",value:function(t){var r=t.spr,n=Number(t.thisblock.getArgValue());t.count<0&&(t.distance=Number(r.scale)+10*n*r.defaultScale/100,t.distance=Math.round(1e3*t.distance)/1e3,t.count=Math.floor(5*Math.abs(n)/r.speed),e.setTime(t)),0==t.count?(t.count=-1,r.setScaleTo(t.distance),t.firstBlock.aStart||(r.homescale=r.scale),t.distance=-1,e.showTime(t),t.thisblock=t.thisblock.next):(r.changeSizeBy(2*r.defaultScale*r.speed*Math.abs(n)/n),t.waitTimer=1,t.count=t.count-1)}},{key:"Shrink",value:function(t){var r=t.spr,n=Number(t.thisblock.getArgValue());t.count<0&&(t.distance=r.scale-10*n*r.defaultScale/100,t.distance=Math.round(1e3*t.distance)/1e3,t.count=Math.floor(5*Math.abs(n)/r.speed),e.setTime(t)),0==t.count?(t.count=-1,r.setScaleTo(t.distance),t.firstBlock.aStart||(r.homescale=r.scale),t.distance=-1,e.showTime(t),t.thisblock=t.thisblock.next):(r.changeSizeBy(2*-r.defaultScale*r.speed*Math.abs(n)/n),t.waitTimer=1,t.count=t.count-1)}},{key:"Show",value:function(t){var r=t.spr;r.shown=!0,t.count<0&&(t.count=4==r.speed?0:Math.floor(15/r.speed),e.setTime(t)),0==t.count?(t.count=-1,r.div.style.opacity=1,e.showTime(t),t.thisblock=t.thisblock.next,t.firstBlock.aStart||(r.homeshown=!0)):(r.div.style.opacity=Math.min(1,Number(r.div.style.opacity)+r.speed/15),t.waitTimer=2,t.count=t.count-1)}},{key:"Hide",value:function(t){var r=t.spr;r.shown=!1,t.count<0&&(t.count=4==r.speed?0:Math.floor(15/r.speed),e.setTime(t)),0==t.count?(t.count=-1,r.div.style.opacity=0,e.showTime(t),t.thisblock=t.thisblock.next,t.firstBlock.aStart||(r.homeshown=!1)):(r.div.style.opacity=Math.max(0,Number(r.div.style.opacity)-r.speed/15),t.waitTimer=2,t.count=t.count-1)}},{key:"OnTouch",value:function(e){e.spr.touchingAny()&&(e.stack.push(e.firstBlock),e.thisblock=e.thisblock.next),e.waitTimer=1}},{key:"Message",value:function(t){var r,n=t.thisblock;if(t.firstTime){var i=[],a=n.getArgValue();e.applyToAllStrips(["onmessage"],(function(e,t){"onmessage"==e.blocktype&&e.getArgValue()==a&&i.push([t,e])}));var o=[];for(var s in i)r=i[s],o.push(Kn.runtime.restartThread(r[0],r[1],!0));t.firstTime=!1,t.called=o}for(var l=!0,c=0;c<t.called.length;c++)t.called[c].isRunning&&(l=!1);l?(t.called=null,t.firstTime=!0,t.thisblock=t.thisblock.next,t.waitTimer=2):Kn.runtime.yield=!0}},{key:"applyToAllStrips",value:function(e,t){if(Kn.stage){var r=Kn.stage.currentPage;if(r&&r.div)for(var n=0;n<r.div.childElementCount;n++){var i=r.div.childNodes[n].owner;if(i){var a=Object(s.q)(i.id+"_scripts");if(a)for(var o=a.owner.getBlocksType(e),l=0;l<o.length;l++)t(o[l],i)}}}}},{key:"hopList",get:function(){return kn}}],(r=null)&&yn(t.prototype,r),n&&yn(t,n),e}();function xn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Sn=function(){function e(t,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.firstBlock=r.findFirst(),this.thisblock=r,this.oldblock=null,this.spr=t,this.audio=void 0,this.stack=[],this.firstTime=!0,this.count=-1,this.waitTimer=0,this.distance=-1,this.called=[],this.vector={x:0,y:0},this.isRunning=!0,this.time=0,this}var t,r,n;return t=e,(r=[{key:"clear",value:function(){this.stack=[],this.firstTime=!0,this.count=-1,this.waitTimer=0,this.vector={x:0,y:0},this.distance=-1,this.called=[],this.thisblock=this.firstBlock}},{key:"duplicate",value:function(){var t=new e(this.spr,this.firstBlock);return t.count=-1,t.firstBlock=this.firstBlock,t.thisblock=this.thisblock,t.oldblock=null,t.spr=this.spr,t.stack=this.stack,t.firstTime=this.firstTime,t.vector={x:0,y:0},t.waitTimer=0,t.distance=-1,t.called=this.called,t.isRunning=this.isRunning,t}},{key:"deselect",value:function(e){for(;null!=e;)e.unhighlight(),e.inside&&(e.repeatCounter=-1,this.deselect(e.inside)),e=e.next}},{key:"stop",value:function(e){this.stopping(e),this.isRunning=!1}},{key:"stopping",value:function(e){this.endPrim(e),this.deselect(this.firstBlock),this.clear(),this.spr.closeBalloon()}},{key:"endPrim",value:function(e){if(this.thisblock){var t=this.thisblock,r=this.spr;switch(t.blocktype){case"down":case"back":case"forward":case"up":if(this.distance>-1&&!e){var n=oe.scale(this.vector,this.distance%24);r.setPos(r.xcoor+n.x,r.ycoor+n.y)}break;case"hop":var i=this.count,a=Number(t.getArgValue());if(--i>0){for(var o=0,s=i;s>-1;s--)o+=wn.hopList[i];this.vector={x:0,y:o};var l=r.ycoor-this.vector.y/5*a;l<0&&(l=0),l>=360-Y.size&&(l=360-Y.size),r.setPos(r.xcoor+this.vector.x,l)}break;case"playsnd":case"playusersnd":this.audio&&(this.audio.stop(),this.audio=void 0);break;case"hide":r.div.style.opacity=0,this.firstBlock.aStart||e||(r.homeshown=!1);break;case"show":r.div.style.opacity=1,this.firstBlock.aStart||e||(r.homeshown=!0);break;case"same":r.noScaleFor();break;case"grow":case"shrink":this.firstBlock.aStart||e||(r.homescale=r.scale);break;case"right":case"left":var c=r.angle;c%30!=0&&(c=30*(Math.floor(c/30)+1)),r.setHeading(c)}}}}])&&xn(t.prototype,r),n&&xn(t,n),e}();function _n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Cn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.threadsRunning=[],this.thread=void 0,this.intervalId=void 0,this.yield=!1}var t,r,n;return t=e,(r=[{key:"beginTimer",value:function(){null!=this.intervalId&&window.clearInterval(this.intervalId);var e=this;this.intervalId=window.setInterval((function(){e.tickTask()}),32),bn.saving=!1,this.threadsRunning=[]}},{key:"tickTask",value:function(){if(Kn.updateRunStopButtons(),!(this.threadsRunning.length<1)){for(var e=[],t=0;t<this.threadsRunning.length;t++)this.threadsRunning[t].isRunning&&e.push(this.threadsRunning[t]);this.threadsRunning=e;for(var r=0;r<this.threadsRunning.length;r++)this.step(r)}}},{key:"inactive",value:function(){if(this.threadsRunning.length<1)return!0;for(var e=!0,t=0;t<this.threadsRunning.length;t++){var r=this.threadsRunning[t];r&&(r.isRunning&&"ontouch"!=r.firstBlock.blocktype&&(e=!1),"ontouch"==r.firstBlock.blocktype&&null!=r.thisblock&&"ontouch"!=r.thisblock.blocktype&&(e=!1))}return e}},{key:"step",value:function(e){for(this.yield=!1,this.thread=this.threadsRunning[e];;){if(!this.thread.isRunning)return;if(this.thread.waitTimer>0)return void(this.thread.waitTimer+=-1);if(this.yield)return;null==this.thread.thisblock?(this.endCase(),this.yield=!0):this.runPrim()}}},{key:"addRunScript",value:function(e,t){this.restartThread(e,t)}},{key:"stopThreads",value:function(){for(var e in this.threadsRunning)this.threadsRunning[e].stop();this.threadsRunning=[]}},{key:"stopThreadBlock",value:function(e){for(var t in this.threadsRunning)this.threadsRunning[t].firstBlock==e&&this.threadsRunning[t].stop()}},{key:"stopThreadSprite",value:function(e){for(var t in this.threadsRunning)this.threadsRunning[t].spr==e&&this.threadsRunning[t].stop()}},{key:"removeRunScript",value:function(e){var t=[];for(var r in this.threadsRunning)this.threadsRunning[r].spr==e&&(this.threadsRunning[r].isRunning&&(null!=this.threadsRunning[r].thisblock&&this.threadsRunning[r].endPrim(),t.push(this.threadsRunning[r].duplicate())),this.threadsRunning[r].isRunning=!1,null!=this.threadsRunning[r].oldblock&&this.threadsRunning[r].oldblock.unhighlight());return t}},{key:"runPrim",value:function(){null!=this.thread.oldblock&&this.thread.oldblock.unhighlight(),this.thread.oldblock=null;var e=wn.table[this.thread.thisblock.blocktype];null==e?e=wn.table.missing:(["repeat","gotopage"].indexOf(this.thread.thisblock.blocktype)<0&&(this.thread.thisblock.highlight(),this.thread.oldblock=this.thread.thisblock),wn.time=new Date-0,e(this.thread))}},{key:"endCase",value:function(){if(null!=this.thread.oldblock&&this.thread.oldblock.unhighlight(),0==this.thread.stack.length)wn.Done(this.thread);else{var e=this.thread.stack.pop();this.thread.thisblock=e,this.runPrim()}}},{key:"restartThread",value:function(e,t,r){for(var n=new Sn(e,t),i=!1,a=0;a<this.threadsRunning.length;a++)this.threadsRunning[a].firstBlock==t&&(i=!0,"ontouch"!=t.blocktype&&(null!=this.threadsRunning[a].oldblock&&this.threadsRunning[a].oldblock.unhighlight(),this.threadsRunning[a].stopping(r),n=this.threadsRunning[a]));return i||this.threadsRunning.push(n),n}}])&&_n(t.prototype,r),n&&_n(t,n),e}();function On(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var jn,An=document.createElement("canvas"),Pn=document.createElement("canvas"),Tn=void 0,Nn=void 0,En=void 0,Bn=!1,In=void 0,Mn=void 0,Dn=!1,Rn=void 0,qn="60",Ln="look",Fn=!1,zn=!1,Hn=void 0,Un=void 0,Wn=!0,Vn=null,Gn=[],Kn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"appinit",value:function(t,r){jn=new Date-0,on.initBlocks(),Object(s.w)(),bn.init(),x.init(),Vt.init(),wn.init(),Nn=new Cn,dr.init(),e.editorEvents(),bn.load(t,r),K.init()}},{key:"clearEventAndTimer",value:function(){window.ontouchstart=null,window.ontouchmove=null,window.ontouchend=null,window.onresize=null,window.onmouseup=null,window.onmousemove=null,window.ontouchcancel=null,window.ondevicemotion=null,clearInterval(Nn.intervalId);var e=document.getElementById("playerHide");e.parentNode.removeChild(e)}},{key:"storyStart",value:function(){}},{key:"editorEvents",value:function(){document.ongesturestart=void 0,window.ontouchstart=e.unfocus,s.u?window.ontouchend=void 0:window.onmouseup=void 0}},{key:"unfocus",value:function(t){Sr.helpballoon&&(Sr.helpballoon.parentNode.removeChild(Sr.helpballoon),Sr.helpballoon=void 0),document.forms.editable&&t&&t.target==document.forms.editable.field||document.forms.activetextbox&&t&&t.target==document.forms.activetextbox.typing||document.forms.projectname&&t&&t.target==document.forms.projectname.myproject||("input"==document.activeElement.tagName.toLowerCase()&&document.activeElement.blur(),e.clearSelection(),e.blur())}},{key:"clearSelection",value:function(){Hn&&Un(Hn)}},{key:"blur",value:function(){x.firstTime&&x.firstClick(),e.editDone(),T.closeMyOpenMenu()}},{key:"getSprite",value:function(){if(En.currentPage.currentSpriteName&&Object(s.q)(En.currentPage.currentSpriteName))return Object(s.q)(En.currentPage.currentSpriteName).owner}},{key:"gestureStart",value:function(e){e.preventDefault(),x.firstTime&&x.firstClick()}},{key:"log",value:function(){}},{key:"getTime",value:function(){return(new Date-jn)/1e3}},{key:"isSampleOrStarter",value:function(){return"look"==Ln||"storyStarter"==Ln}},{key:"isEditable",value:function(){return"look"!=Ln}},{key:"onResume",value:function(){Wn=!0,Vn=window.setInterval((function(){!Wn||zn||bn.saving||Xt.infoBoxOpen||(zn=!1,v.close())}),window.Settings.autoSaveInterval)}},{key:"onPause",value:function(){Wn=!1,window.clearInterval(Vn)}},{key:"updateRunStopButtons",value:function(){var t=Nn.inactive();Bn?(Object(s.q)("go").className=t?"go on presentationmode":"go off presentationmode",Xt.updatePageControls()):(Object(s.q)("go").className=t?"go on":"go off",Y.updateCursor()),e.getSprite()&&(t&&!Bn?e.getSprite().select():e.getSprite().unselect()),t&&Fn&&(En.currentPage.updateThumb(),Fn=!1)}},{key:"runStrips",value:function(t){e.stopStripsFromTop(t),e.unfocus(t),e.startGreenFlagThreads(),Fn=!0}},{key:"startGreenFlagThreads",value:function(){e.resetSprites(),e.startCurrentPageStrips(["onflag","ontouch"])}},{key:"startCurrentPageStrips",value:function(t){for(var r=En.currentPage.div,n=0;n<r.childElementCount;n++){var i=r.childNodes[n].owner;i&&Object(s.q)(i.id+"_scripts")&&e.startScriptsFor(i,t)}}},{key:"startScriptsFor",value:function(e,t){for(var r=Object(s.q)(e.id+"_scripts").owner.getBlocksType(t),n=0;n<r.length;n++){var i=r[n];Nn.addRunScript(e,i)}}},{key:"stopStripsFromTop",value:function(t){t.preventDefault(),t.stopPropagation(),e.unfocus(t),e.stopStrips(),Fn=!1}},{key:"stopStrips",value:function(){Nn.stopThreads(),En.currentPage.updateThumb()}},{key:"resetSprites",value:function(){En.resetPage(En.currentPage)}},{key:"fullScreen",value:function(t){"fullscreen"==Object(s.q)("full").className?(Gn.push((function(){var t=document.createEvent("TouchEvent");t.initTouchEvent(),e.quitFullScreen(t)})),e.enterFullScreen(t)):e.quitFullScreen(t)}},{key:"displayStatus",value:function(e){for(var t=["topsection","blockspalette","scripts","flip","projectinfo"],r=0;r<t.length;r++)Object(s.q)(t[r])&&(Object(s.q)(t[r]).style.display=e)}},{key:"enterFullScreen",value:function(t){zn||(t.preventDefault(),t.stopPropagation(),e.unfocus(t),e.displayStatus("none"),Bn=!0,Xt.enterFullScreen(),document.body.style.background="black")}},{key:"quitFullScreen",value:function(t){t.preventDefault(),t.stopPropagation(),e.displayStatus("block"),Bn=!1,Xt.quitFullScreen(),Gn.pop(),document.body.style.background="white"}},{key:"getActiveScript",value:function(){var e=En.currentPage.currentSpriteName+"_scripts";return Object(s.q)(e)}},{key:"getBlocks",value:function(){return e.getActiveScript().owner.getBlocks()}},{key:"setupEditableField",value:function(){(Mn=Object(s.B)("form","textform",s.h)).name="editable";var t=Object(s.B)("input","textinput",Mn);function r(e){e.preventDefault(),e.stopPropagation(),e.target.blur(),Gn.pop()}t.name="field",t.onkeypress=function(e){var t;13==((t=e).keyCode||t.which)&&r(t)},Mn.onsubmit=function(e){r(e)},t.maxLength=50,t.onfocus=e.handleTextFieldFocus,t.onblur=e.handleTextFieldBlur}},{key:"editArg",value:function(t,r){t.preventDefault(),t.stopPropagation(),r&&r.owner.isText()?e.textClicked(t,r):e.numberClicked(t,r),Gn.push((function(){e.editDone()}))}},{key:"textClicked",value:function(e,t){}},{key:"handleTextFieldFocus",value:function(e){}},{key:"handleTextFieldBlur",value:function(e){}},{key:"setupKeypad",value:function(){(In=Object(s.B)("div","picokeyboard",s.h)).ontouchstart=e.eatEvent;for(var t=Object(s.B)("div","insidekeyboard",In),r=1;r<10;r++)e.keyboardAddKey(t,r,"onekey");e.keyboardAddKey(t,"-","onekey minus"),e.keyboardAddKey(t,"0","onekey"),e.keyboardAddKey(t,void 0,"onekey delete")}},{key:"eatEvent",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"keyboardAddKey",value:function(t,r,n){var i=Object(s.B)("div",n,t);Object(s.B)("span",void 0,i).textContent=r||"",i.ontouchstart=e.numEditKey}},{key:"numberClicked",value:function(t,r){var n=Tn?Tn.delta:0;Tn&&"blockarg"==Tn.type&&(Tn.div.className="numfield off",e.numEditDone());var i=r.owner;(Tn=i).delta=n,i.oldvalue=r.textContent,Tn.div.className="numfield on",In.className="picokeyboard on",Dn=!0;var a=r.parentNode.parentNode.owner;Number(a.min)<0?e.setMinusKey():e.setSpaceKey(),0==n&&e.needsToScroll(i)}},{key:"needsToScroll",value:function(t){var r=e.getActiveScript(),n=t.daddy.div.left+t.daddy.div.offsetWidth+r.left,i=window.innerWidth-In.offsetWidth-10,a=n>i?i-n:0;if(a<0){var o={duration:.5,transition:"ease-out",style:{left:r.left+a+"px"},onComplete:function(){re.scroll.refresh()}};Object(s.b)(r,o)}Tn.delta=a}},{key:"numEditKey",value:function(t){t.preventDefault(),t.stopPropagation();var r=t.target;if(r){""==r.className&&(r=r.parentNode),"onekey space"!=r.className&&x.sndFX("keydown.wav");var n=r.textContent,i=Tn.input;if(n){var a=i.textContent;Dn&&(Dn=!1,a="0"),"-"!=n||"0"==a?("0"==a?a=n:a+=n,"NaN"!=Number(a).toString()&&(Number(a)>99||Number(a)<-99)?x.sndFX("boing.wav"):Tn.setValue(a)):x.sndFX("boing.wav")}else"onekey delete"!=r.parentNode.className&&"onekey delete"!=r.className||e.numEditDelete()}}},{key:"setSpaceKey",value:function(){In.childNodes[0].childNodes[9].className="onekey space",In.childNodes[0].childNodes[9].childNodes[0].textContent=""}},{key:"setMinusKey",value:function(){In.childNodes[0].childNodes[9].className="onekey minus",In.childNodes[0].childNodes[9].childNodes[0].textContent="-"}},{key:"validateNumber",value:function(e){return Number(e)}},{key:"revokeInput",value:function(e){return e}},{key:"numEditDelete",value:function(){var e=Tn.input.textContent;0!=e.length&&(e=e.substring(0,e.length-1)),0==e.length&&(e="0"),Tn.setValue(e)}},{key:"editDone",value:function(){"INPUT"===document.activeElement.tagName&&document.activeElement.blur(),null!=Tn&&"blockarg"==Tn.type&&(Tn.isText()?document.forms.editable.field.blur():(e.closeNumberEdit(),Gn.pop()))}},{key:"closeNumberEdit",value:function(){e.numEditDone(),e.resetScroll(),In.className="picokeyboard off",Tn.div.className="numfield off",Tn=void 0}},{key:"numEditDone",value:function(){var t=Tn.input.textContent;"-"==t&&(t=0),"-0"==t&&(t=0),t=e.validateNumber(t);var r=Tn;if(Tn.setValue(parseFloat(t)),r.argValue=t,r.daddy&&r.daddy.div.parentNode.owner){var n=r.daddy.div.parentNode.owner.spr;if(n&&n.div.parentNode){var i={action:"scripts",where:n.div.parentNode.owner.id,who:n.id};r.argValue!=r.oldvalue&&(e.storyStart("ScratchJr.numEditDone"),dr.record(i))}}}},{key:"resetScroll",value:function(){var t=Tn.delta;if(t<0){var r=e.getActiveScript(),n={duration:.5,transition:"ease-out",style:{left:r.left-t+"px"},onComplete:function(){re.scroll.refresh()}};Object(s.b)(r,n)}}},{key:"validate",value:function(e,t){return 0==e.replace(/\s*/g,"").length?t:e}},{key:"saveProjectState",value:function(){x.sndFX("tap.wav"),"none"==s.h.style.display?Vt.saveEditState((function(){})):(e.unfocus(),e.stopStrips())}},{key:"goBack",value:function(){if(0===Gn.length){var e=document.createEvent("TouchEvent");e.initTouchEvent(),e.preventDefault(),e.stopPropagation()}else(0,Gn[Gn.length-1])()}},{key:"workingCanvas",get:function(){return An}},{key:"workingCanvas2",get:function(){return Pn}},{key:"activeFocus",get:function(){return Tn},set:function(e){Tn=e}},{key:"runtime",get:function(){return Nn}},{key:"stage",get:function(){return En},set:function(e){En=e}},{key:"inFullscreen",get:function(){return Bn}},{key:"stagecolor",get:function(){return"#F5F2F7"}},{key:"defaultSprite",get:function(){return"Cat.svg"}},{key:"layerTop",get:function(){return 10}},{key:"layerAboveBottom",get:function(){return 4}},{key:"dragginLayer",get:function(){return 7e3}},{key:"projectId",get:function(){return Rn},set:function(e){Rn=e}},{key:"currentProject",get:function(){return qn},set:function(e){qn=e}},{key:"editmode",get:function(){return Ln},set:function(e){Ln=e}},{key:"time",set:function(e){jn=e}},{key:"userStart",set:function(e){Fn=e}},{key:"onHold",get:function(){return zn},set:function(e){zn=e}},{key:"shaking",get:function(){return Hn},set:function(e){Hn=e}},{key:"stopShaking",get:function(){return Un},set:function(e){Un=e}},{key:"version",get:function(){return"iOSv01"}},{key:"onBackButtonCallback",get:function(){return Gn}}],(r=null)&&On(t.prototype,r),n&&On(t,n),e}(),Zn=r(52);function Xn(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,i)}function Yn(){var e;return e=regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ur.a,e.next=3,r.loadAsync(t.split(",")[1],{base64:!0});case 3:n=e.sent,i={},e.t0=regeneratorRuntime.keys(n.files);case 6:if((e.t1=e.t0()).done){e.next=31;break}if(o=e.t1.value,s=o.split("/").pop(),"svg"!==(l=s.split(".").pop())){e.next=15;break}return e.next=13,n.files[o].async("base64");case 13:e.t2=e.sent,i[s]="data:image/svg+xml;base64,"+e.t2;case 15:if("png"!==l){e.next=20;break}return e.next=18,n.files[o].async("base64");case 18:e.t3=e.sent,i[s]="data:image/png;base64,"+e.t3;case 20:if("wav"!==l){e.next=25;break}return e.next=23,n.files[o].async("base64");case 23:e.t4=e.sent,i[s]="data:audio/wav;base64,"+e.t4;case 25:if(!s||"json"!==l){e.next=29;break}return e.next=28,n.files[o].async("text");case 28:a=e.sent;case 29:e.next=6;break;case 31:return e.abrupt("return",{files:i,json:JSON.parse(a)});case 32:case"end":return e.stop()}}),e)})),(Yn=function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){Xn(a,n,i,o,s,"next",e)}function s(e){Xn(a,n,i,o,s,"throw",e)}o(void 0)}))}).apply(this,arguments)}var Jn=function(e){return Yn.apply(this,arguments)},$n=r(25),Qn=r.n($n);function ei(e){return(ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ti(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ri(e,t){return!t||"object"!==ei(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ni(e){return(ni=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ii(e,t){return(ii=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ai=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ri(this,ni(t).apply(this,arguments))}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ii(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){return i.a.createElement("div",{className:Qn.a.spin},this.props.children,i.a.createElement("div",{className:Qn.a.cover,style:{display:this.props.spinning?"block":"none"}},i.a.createElement("div",null)))}}])&&ti(r.prototype,n),a&&ti(r,a),t}(n.Component);function oi(e){return(oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function si(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,i)}function li(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){si(a,n,i,o,s,"next",e)}function s(e){si(a,n,i,o,s,"throw",e)}o(void 0)}))}}function ci(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ui(e){return(ui=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function di(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hi(e,t){return(hi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var gi=!1;window.Settings=Zn,me.loadMediaLib();var pi=function(e){function t(){var e,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return r=function(e,t){return!t||"object"!==oi(t)&&"function"!=typeof t?di(e):t}(this,(e=ui(t)).call.apply(e,[this].concat(i))),fi(di(r),"state",{loading:!1,isLoadProject:!1}),fi(di(r),"loadProject",li(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!gi){e.next=2;break}return e.abrupt("return");case 2:return gi=!0,r.setState({loading:!0}),e.prev=4,e.next=7,r.props.getProject();case 7:return t=e.sent,e.next=10,Jn(t);case 10:n=e.sent,Kn.appinit(n,(function(){var e=document.body.clientWidth/480,t=document.getElementById("stageContainer"),n=document.getElementById("btnContainer"),i=document.getElementById("stage"),a=document.getElementById("go"),o=document.getElementById("resetall");Kn.unfocus(),i.owner.currentZoom=e,i.style.webkitTextSizeAdjust=100*e+"%",Kn.stage.setStageScaleAndPosition(e,240,180),t.appendChild(i),n.appendChild(a),n.appendChild(o),r.setState({isLoadProject:!0}),window.addEventListener("resize",(function(){e=document.body.clientWidth/480,i.owner.currentZoom=e,i.style.webkitTextSizeAdjust=100*e+"%",Kn.stage.setStageScaleAndPosition(e,240,180)}))})),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(4),console.log(""),console.log(e.t0);case 18:r.setState({loading:!1}),gi=!1;case 20:case"end":return e.stop()}}),e,null,[[4,14]])})))),r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hi(e,t)}(t,e),r=t,(n=[{key:"componentDidMount",value:function(){this.loadProject()}},{key:"componentWillUnmount",value:function(){Kn.clearEventAndTimer()}},{key:"render",value:function(){var e=this.state.loading;return i.a.createElement(i.a.Fragment,null,i.a.createElement(ai,{spinning:e},i.a.createElement("div",{className:"stagejr"},i.a.createElement("div",{className:"stageContainer",id:"stageContainer"}),i.a.createElement("div",{className:"btnContainer",id:"btnContainer"}))),i.a.createElement("div",{id:"playerHide"},i.a.createElement("div",{className:"frame",id:"frame"}),i.a.createElement("div",{className:"libframe",id:"libframe"}),i.a.createElement("div",{className:"paintframe",id:"paintframe"})))}}])&&ci(r.prototype,n),a&&ci(r,a),t}(n.Component);r.d(t,"PlayerJR",(function(){return pi}))}])}));